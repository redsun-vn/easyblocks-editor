{"version":3,"file":"index.cjs","sources":["../../src/EditorContext.ts","../../src/utils/array/last.ts","../../src/utils/array/toArray.ts","../../src/utils/array/preOrderPathComparator.ts","../../src/utils/array/includesAny.ts","../../src/utils/deepClone.ts","../../src/utils/deepCompare.ts","../../src/utils/hooks/useForceRerender.ts","../../src/utils/object/dotNotationGet.ts","../../src/utils/serialize.ts","../../src/utils/sleep.ts","../../src/utils/uniqueId.ts","../../src/utils/assert.ts","../../src/ConfigAfterAutoContext.ts","../../src/EditorExternalDataProvider.tsx","../../src/useWindowKeyDown.ts","../../src/EditorIframe.tsx","../../src/pathToCompiledPath.ts","../../src/buildTinaFields.ts","../../src/utils/copyToClipboard.ts","../../src/SidebarFooter.tsx","../../src/tinacms/fields/components/Toggle.tsx","../../src/tinacms/fields/components/constants.ts","../../src/tinacms/fields/components/isMixedFieldValue.ts","../../src/tinacms/fields/components/Select.tsx","../../src/tinacms/fields/components/RadioGroup.tsx","../../src/tinacms/fields/components/NumberInput.tsx","../../src/tinacms/fields/plugins/Tooltip.tsx","../../src/tinacms/fields/plugins/useTooltip.ts","../../src/tinacms/fields/plugins/wrapFieldWithMeta.tsx","../../src/tinacms/fields/plugins/numberFormat.ts","../../src/tinacms/fields/plugins/NumberFieldPlugin.tsx","../../src/tinacms/fields/plugins/textFormat.ts","../../src/tinacms/fields/plugins/SelectFieldPlugin.tsx","../../src/tinacms/fields/plugins/RadioGroupFieldPlugin.tsx","../../src/tinacms/fields/plugins/TextFieldPlugin.tsx","../../src/tinacms/fields/plugins/ToggleFieldPlugin.tsx","../../src/tinacms/fields/plugins/TokenField/TokenFieldPlugin.tsx","../../src/utils/isConfigPathRichTextPart.ts","../../src/tinacms/fields/components/getUniqueValues.ts","../../src/tinacms/form-builder/utils/mergeCommonFields.ts","../../src/tinacms/fields/plugins/BlockFieldPlugin.tsx","../../src/tinacms/fields/plugins/IdentityFieldPlugin.tsx","../../src/tinacms/fields/plugins/MissingWidget.tsx","../../src/tinacms/fields/plugins/ExternalField/ExternalField.tsx","../../src/tinacms/fields/plugins/ResponsiveField/responsiveFieldController.ts","../../src/tinacms/fields/plugins/ResponsiveField/ResponsiveFieldPlugin.tsx","../../src/tinacms/fields/plugins/SVGPicker/SVGPicker.tsx","../../src/tinacms/fields/plugins/SliderFieldPlugin.tsx","../../src/tinacms/fields/plugins/LocalFIeld.tsx","../../src/sidebar/PositionPickerInput.tsx","../../src/tinacms/fields/plugins/PositionFieldPlugin.tsx","../../src/tinacms/form-builder/utils/createFieldController.ts","../../src/tinacms/form-builder/fields-builder.tsx","../../src/tinacms/styles/Styles.tsx","../../src/tinacms/styles/Button.tsx","../../src/inline-settings.tsx","../../src/EditorSidebar.tsx","../../src/EditorTopBar.tsx","../../src/normalizeToStringArray.ts","../../src/getAllComponentTypes.ts","../../src/getAllComponentsOfType.ts","../../src/unrollAcceptsFieldIntoComponents.ts","../../src/ModalPicker.tsx","../../src/TemplateModal.tsx","../../src/editorActions.ts","../../src/paste/reconcile.ts","../../src/paste/insert.ts","../../src/paste/destinationResolver.ts","../../src/paste/manager.ts","../../src/selectionFrame/cssVariables.ts","../../src/selectionFrame/AddButton.tsx","../../src/selectionFrame/SelectionFrame.styles.ts","../../src/selectionFrame/calculateAddButtonProperties.ts","../../src/selectionFrame/SelectionFrame.tsx","../../src/utils/config/configMap.ts","../../src/templates/getTemplates.ts","../../src/form.ts","../../src/tinacms/react-core/use-form.ts","../../src/utils/config/getConfigSnapshot.ts","../../src/utils/locales/addLocalizedFlag.ts","../../src/utils/locales/removeLocalizedFlag.ts","../../src/useDataSaver.ts","../../src/useEditorGlobalKeyboardShortcuts.ts","../../src/EditorHistory.ts","../../src/useEditorHistory.ts","../../src/utils/locales/checkLocalesCorrectness.ts","../../src/Editor.tsx","../../src/sidebar/validate-color/index.ts","../../src/sidebar/ColorTokenWidget.tsx","../../src/sidebar/SpaceTokenWidget.tsx","../../src/parseQueryParams.ts","../../src/sidebar/DocumentDataWidget.tsx","../../src/SectionPicker.tsx","../../src/SearchableSmallPickerModal.tsx","../../src/EasyblocksParent.tsx","../../src/CanvasRoot/CanvasRoot.tsx","../../src/EditableComponentBuilder/SelectionFrameController.tsx","../../src/EditableComponentBuilder/BlockControls.tsx","../../src/EditableComponentBuilder/EditableComponentBuilder.editor.tsx","../../src/Placeholder.tsx","../../src/EditorChildWindow.tsx","../../src/PreviewRenderer.tsx","../../src/debug/debugTypes.ts","../../src/debug/DebugSection/DebugSection.definition.ts","../../src/debug/debugTokens.ts","../../src/debug/DebugSection/DebugSection.tsx","../../src/debug/DebugUrlWidget.tsx","../../src/debug/addDebugToEditorProps.ts","../../src/EasyblocksEditor.tsx"],"sourcesContent":["import {\r\n  Backend,\r\n  CompiledComponentConfig,\r\n  Document,\r\n  ExternalTypeDefinition,\r\n  InlineTypeDefinition,\r\n  InlineTypeWidgetComponentProps,\r\n  NoCodeComponentEntry,\r\n  Template,\r\n  TokenTypeDefinition,\r\n  TokenTypeWidgetComponentProps,\r\n  Widget,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  EditorContextType as BaseEditorContextType,\r\n  CompilationCache,\r\n  InternalAnyField,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport React, { ComponentType, useContext } from \"react\";\r\nimport { Form } from \"./form\";\r\nimport { ActionsType, InternalWidgetComponentProps } from \"./types\";\r\n\r\nexport type EditorExternalTypeDefinition = Omit<\r\n  ExternalTypeDefinition,\r\n  \"widgets\"\r\n> & {\r\n  widgets: Array<\r\n    Widget & {\r\n      component?: ComponentType<InternalWidgetComponentProps>;\r\n    }\r\n  >;\r\n};\r\n\r\ntype EditorInlineTypeDefinition = Omit<InlineTypeDefinition, \"widgets\"> & {\r\n  widget: Widget & {\r\n    component?: ComponentType<InlineTypeWidgetComponentProps<any>>;\r\n  };\r\n};\r\n\r\ntype EditorTokenTypeDefinition = Omit<TokenTypeDefinition, \"widgets\"> & {\r\n  widget?: Widget & {\r\n    component?: ComponentType<TokenTypeWidgetComponentProps<any>>;\r\n  };\r\n};\r\n\r\nexport type EditorContextType = Omit<BaseEditorContextType, \"types\"> & {\r\n  backend: Backend;\r\n  templates?: Template[];\r\n  syncTemplates: (props: { mode?: \"create\" | \"edit\" | \"delete\"; template?: Template }) => void;\r\n  focussedField: Array<string>;\r\n  setFocussedField: (field: Array<string> | string) => void;\r\n  form: Form<any, InternalAnyField>;\r\n  isEditing?: boolean;\r\n  actions: ActionsType;\r\n  save: (document: Document) => Promise<void>;\r\n  compiledComponentConfig?: CompiledComponentConfig;\r\n  configAfterAuto?: NoCodeComponentEntry;\r\n  compilationCache: CompilationCache;\r\n  isAdminMode: boolean;\r\n  readOnly: boolean;\r\n  disableCustomTemplates: boolean;\r\n  types: Record<\r\n    string,\r\n    | EditorExternalTypeDefinition\r\n    | EditorInlineTypeDefinition\r\n    | EditorTokenTypeDefinition\r\n  >;\r\n  components: Record<string, ComponentType<any>>;\r\n};\r\n\r\nexport const EditorContext = React.createContext<EditorContextType | null>(\r\n  null\r\n);\r\n\r\nexport function useEditorContext() {\r\n  const context = useContext(EditorContext);\r\n  if (!context) {\r\n    throw new Error(\"EditorContext not defined\");\r\n  }\r\n  return context;\r\n}\r\n","function last<T extends Array<any>>(collection: T): T[number] {\r\n  return collection[collection.length - 1];\r\n}\r\n\r\nexport { last };\r\n","// eslint-disable-next-line @typescript-eslint/ban-types\r\nfunction toArray<T extends {}>(scalarOrCollection: T | Array<T>): Array<T> {\r\n  if (Array.isArray(scalarOrCollection)) {\r\n    return scalarOrCollection;\r\n  }\r\n\r\n  return [scalarOrCollection];\r\n}\r\n\r\nexport { toArray };\r\n","const takeNumbers = (path: string) =>\r\n  path\r\n    .split(\".\")\r\n    .map((x) => parseInt(x, 10))\r\n    .filter((x) => !Number.isNaN(x));\r\n\r\nconst preOrderPathComparator =\r\n  (direction: \"ascending\" | \"descending\" = \"ascending\") =>\r\n  (pathA: string, pathB: string) => {\r\n    const order = direction === \"ascending\" ? 1 : -1;\r\n\r\n    const numbersA = takeNumbers(pathA);\r\n    const numbersB = takeNumbers(pathB);\r\n\r\n    const numberALength = numbersA.length;\r\n    const numberBLength = numbersB.length;\r\n\r\n    if (numberALength === 0 || numberBLength === 0) {\r\n      throw new Error(`Cannot compare paths '${pathA}' and '${pathB}'.`);\r\n    }\r\n\r\n    const shorterLength = Math.min(numberALength, numberBLength);\r\n    let index = 0;\r\n    while (index < shorterLength) {\r\n      const valueA = numbersA[index];\r\n      const valueB = numbersB[index];\r\n      if (valueA !== valueB) {\r\n        return order * Math.sign(valueA - valueB);\r\n      }\r\n      index++;\r\n    }\r\n\r\n    return order * Math.sign(numberBLength - numberALength);\r\n  };\r\n\r\nexport { preOrderPathComparator };\r\n","function includesAny<T>(a: T[], b: T[]) {\r\n  return a.some((i) => b.includes(i));\r\n}\r\n\r\nexport { includesAny };\r\n","function deepClone<T>(source: T): T {\r\n  return JSON.parse(JSON.stringify(source)) as T;\r\n}\r\n\r\nexport { deepClone };\r\n","function deepCompare(...objectsToCompare: Array<Record<string, any>>): boolean {\r\n  for (let index = 0; index < objectsToCompare.length - 1; index++) {\r\n    const currentObject = sortObject(objectsToCompare[index]);\r\n    const nextObject = sortObject(objectsToCompare[index + 1]);\r\n\r\n    const areObjectsHashesEqual =\r\n      JSON.stringify(currentObject) === JSON.stringify(nextObject);\r\n\r\n    if (!areObjectsHashesEqual) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction sortObject(value: unknown) {\r\n  if (typeof value !== \"object\") {\r\n    return value;\r\n  }\r\n\r\n  if (Array.isArray(value)) {\r\n    return [...value].sort();\r\n  }\r\n\r\n  if (value === null) {\r\n    return null;\r\n  }\r\n\r\n  const sortedObject: Record<string, any> = {};\r\n  const objectKeys = Object.keys(value).sort();\r\n\r\n  objectKeys.forEach((key) => {\r\n    sortedObject[key] = sortObject((value as Record<string, any>)[key]);\r\n  });\r\n\r\n  return sortedObject;\r\n}\r\n\r\nexport { deepCompare, sortObject };\r\n","\"use client\";\r\nimport { useRef, useState } from \"react\";\r\n\r\nfunction useForceRerender() {\r\n  const [, setDummyState] = useState({});\r\n\r\n  const forceRerender = useRef(() => {\r\n    setDummyState({});\r\n  }).current;\r\n\r\n  return { forceRerender };\r\n}\r\n\r\nexport { useForceRerender };\r\n","export function dotNotationGet(obj: any, path: string) {\r\n  if (path === \"\") {\r\n    return obj;\r\n  }\r\n  return path.split(\".\").reduce((acc, curVal) => acc && acc[curVal], obj);\r\n}\r\n","function serialize(value: unknown) {\r\n  if (value instanceof Error) {\r\n    return JSON.parse(JSON.stringify(value, Object.getOwnPropertyNames(value)));\r\n  }\r\n\r\n  return JSON.parse(JSON.stringify(value));\r\n}\r\n\r\nexport { serialize };\r\n","export function sleep(ms: number) {\r\n  return new Promise((resolve) => setTimeout(resolve, ms));\r\n}\r\n","function uniqueId(): string {\r\n  const id = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(\r\n    /[xy]/g,\r\n    function (c) {\r\n      const r = (Math.random() * 16) | 0,\r\n        v = c == \"x\" ? r : (r & 0x3) | 0x8;\r\n      return v.toString(16);\r\n    }\r\n  );\r\n\r\n  return id;\r\n}\r\n\r\nexport { uniqueId, uniqueId as uuidv4 };\r\n","function assertDefined<T>(value: T, message?: string): Exclude<T, undefined> {\r\n  if (value === undefined) {\r\n    throw new Error(message ?? \"Value is undefined\");\r\n  }\r\n\r\n  return value as Exclude<T, undefined>;\r\n}\r\n\r\nfunction assertNonNullable<T>(value: T): Exclude<T, null> {\r\n  if (value === null) {\r\n    throw new Error(\"Value is null\");\r\n  }\r\n\r\n  return value as Exclude<T, null>;\r\n}\r\n\r\nexport { assertDefined, assertNonNullable };\r\n","import React, { useContext } from \"react\";\r\nimport { NoCodeComponentEntry } from \"@redsun-vn/easyblocks-core\";\r\n\r\nexport const ConfigAfterAutoContext =\r\n  React.createContext<NoCodeComponentEntry | null>(null);\r\n\r\nexport function useConfigAfterAuto() {\r\n  const configAfterAutoContext = useContext(ConfigAfterAutoContext);\r\n\r\n  if (!configAfterAutoContext) {\r\n    throw new Error(\"CompiledConfigContext is required for Responsive field\");\r\n  }\r\n\r\n  return configAfterAutoContext;\r\n}\r\n","import { ExternalData } from \"@redsun-vn/easyblocks-core\";\r\nimport React, { createContext, ReactNode, useContext } from \"react\";\r\n\r\nconst ExternalDataContext = createContext<ExternalData>({});\r\n\r\nfunction EditorExternalDataProvider({\r\n  children,\r\n  externalData,\r\n}: {\r\n  children: ReactNode;\r\n  externalData: ExternalData;\r\n}) {\r\n  return (\r\n    <ExternalDataContext.Provider value={externalData}>\r\n      {children}\r\n    </ExternalDataContext.Provider>\r\n  );\r\n}\r\n\r\nfunction useEditorExternalData() {\r\n  return useContext(ExternalDataContext);\r\n}\r\n\r\nexport { EditorExternalDataProvider, useEditorExternalData };\r\n","import { useEffect } from \"react\";\r\n\r\nexport enum ExtraKeys {\r\n  ALT_KEY = \"altKey\",\r\n  CTRL_KEY = \"ctrlKey\",\r\n  META_KEY = \"metaKey\",\r\n  SHIFT_KEY = \"shiftKey\",\r\n}\r\n\r\nconst actionKeys: ExtraKeys[] = [\r\n  ExtraKeys.ALT_KEY,\r\n  ExtraKeys.CTRL_KEY,\r\n  ExtraKeys.META_KEY,\r\n  ExtraKeys.SHIFT_KEY,\r\n];\r\n\r\ninterface GlobalKeyDownConfig {\r\n  extraKeys: ExtraKeys[];\r\n  isDisabled: boolean;\r\n}\r\n\r\nexport const useWindowKeyDown = (\r\n  key: string,\r\n  callback: (...args: unknown[]) => any,\r\n  { extraKeys, isDisabled }: GlobalKeyDownConfig = {\r\n    extraKeys: [],\r\n    isDisabled: false,\r\n  }\r\n) => {\r\n  const downHandler = (event: KeyboardEvent) => {\r\n    const isExtraKeysPressed = extraKeys.every((k) => event[k]);\r\n    const extraKeysSet = new Set([...extraKeys]);\r\n\r\n    const isOtherExtraKeysPressed = actionKeys\r\n      .filter((k) => !extraKeysSet.has(k))\r\n      .some((k) => event[k]);\r\n\r\n    if (event.key === key && isExtraKeysPressed && !isOtherExtraKeysPressed) {\r\n      event.preventDefault();\r\n      callback();\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!isDisabled) {\r\n      document\r\n        .getElementsByTagName(\"iframe\")![0]\r\n        .contentWindow!.window.document.body.addEventListener(\r\n          \"keydown\",\r\n          downHandler\r\n        );\r\n\r\n      window.addEventListener(\"keydown\", downHandler);\r\n      return () => {\r\n        window.removeEventListener(\"keydown\", downHandler);\r\n      };\r\n    }\r\n  }, [isDisabled]);\r\n};\r\n","import { Colors } from \"@redsun-vn/easyblocks-design-system\";\r\nimport React, { useState } from \"react\";\r\nimport { styled } from \"styled-components\";\r\nimport { ExtraKeys, useWindowKeyDown } from \"./useWindowKeyDown\";\r\n\r\ninterface EditorIframeWrapperProps {\r\n  onEditorHistoryRedo: () => void;\r\n  onEditorHistoryUndo: () => void;\r\n  width: number;\r\n  height: number;\r\n  transform: string;\r\n  containerRef: React.RefObject<HTMLDivElement>;\r\n}\r\n\r\nfunction EditorIframe({\r\n  onEditorHistoryRedo,\r\n  onEditorHistoryUndo,\r\n  width,\r\n  height,\r\n  transform,\r\n  containerRef,\r\n}: EditorIframeWrapperProps) {\r\n  const [isIframeReady, setIframeReady] = useState(false);\r\n\r\n  const handleIframeLoaded = () => {\r\n    setIframeReady(true);\r\n  };\r\n\r\n  useWindowKeyDown(\"z\", onEditorHistoryUndo, {\r\n    extraKeys: [ExtraKeys.META_KEY],\r\n    isDisabled: !isIframeReady,\r\n  });\r\n\r\n  useWindowKeyDown(\"z\", onEditorHistoryRedo, {\r\n    extraKeys: [ExtraKeys.META_KEY, ExtraKeys.SHIFT_KEY],\r\n    isDisabled: !isIframeReady,\r\n  });\r\n\r\n  useWindowKeyDown(\"z\", onEditorHistoryUndo, {\r\n    extraKeys: [ExtraKeys.CTRL_KEY],\r\n    isDisabled: !isIframeReady,\r\n  });\r\n\r\n  useWindowKeyDown(\"y\", onEditorHistoryRedo, {\r\n    extraKeys: [ExtraKeys.CTRL_KEY],\r\n    isDisabled: !isIframeReady,\r\n  });\r\n\r\n  return (\r\n    <IframeContainer ref={containerRef}>\r\n      <IframeInnerContainer>\r\n        <Iframe\r\n          id=\"shopstory-canvas\"\r\n          src={window.location.href}\r\n          onLoad={handleIframeLoaded}\r\n          style={{\r\n            // These properties will change a lot during resizing, so we don't pass it to styled component to prevent\r\n            // class name recalculations\r\n            width,\r\n            height,\r\n            transform,\r\n          }}\r\n        />\r\n      </IframeInnerContainer>\r\n    </IframeContainer>\r\n  );\r\n}\r\n\r\nexport { EditorIframe };\r\n\r\nconst IframeContainer = styled.div`\r\n  position: relative;\r\n  flex: 1 1 auto;\r\n  background: ${Colors.black100};\r\n`;\r\n\r\nconst IframeInnerContainer = styled.div`\r\n  position: absolute; // absolute to prevent grid container having effect on parent div width (div can be oversized)\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  display: grid;\r\n  justify-content: center;\r\n  align-items: center;\r\n`;\r\n\r\nconst Iframe = styled.iframe`\r\n  background: white;\r\n  border: none;\r\n  transform-origin: center;\r\n`;\r\n","import { SchemaProp } from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  findComponentDefinitionById,\r\n  isSchemaPropActionTextModifier,\r\n  isSchemaPropTextModifier,\r\n  parsePath,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { EditorContextType } from \"./EditorContext\";\r\n\r\nexport function pathToCompiledPath(\r\n  path: string,\r\n  editorContext: EditorContextType\r\n): string {\r\n  const pathInfo = parsePath(path, editorContext.form);\r\n\r\n  if (pathInfo.parent) {\r\n    const definition = findComponentDefinitionById(\r\n      pathInfo.parent.templateId,\r\n      editorContext\r\n    )!;\r\n\r\n    const schemaProp = definition.schema.find(\r\n      (schemaProp) => schemaProp.prop === pathInfo.parent!.fieldName\r\n    )!;\r\n\r\n    const result = `${pathToCompiledPath(\r\n      pathInfo.parent.path,\r\n      editorContext\r\n    )}.${getPropertyNameFromSchemaProp(schemaProp)}.${\r\n      pathInfo.parent.fieldName\r\n    }.${pathInfo.index!}`;\r\n\r\n    if (result.startsWith(\".\")) {\r\n      return result.substring(1);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  return \"\";\r\n}\r\n\r\nfunction getPropertyNameFromSchemaProp(schemaProp: SchemaProp) {\r\n  if (\r\n    isSchemaPropTextModifier(schemaProp) ||\r\n    isSchemaPropActionTextModifier(schemaProp)\r\n  ) {\r\n    return \"textModifiers\";\r\n  }\r\n\r\n  return \"components\";\r\n}\r\n","import {\r\n  CompiledCustomComponentConfig,\r\n  FieldPortal,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  InternalAnyTinaField,\r\n  InternalField,\r\n  stripRichTextPartSelection,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { dotNotationGet } from \"@/utils\";\r\nimport type { EditorContextType } from \"./EditorContext\";\r\nimport { pathToCompiledPath } from \"./pathToCompiledPath\";\r\n\r\nexport function isFieldPortal(\r\n  x: InternalAnyTinaField | FieldPortal\r\n): x is FieldPortal {\r\n  return \"portal\" in x;\r\n}\r\n\r\nexport function buildTinaFields(\r\n  path: string,\r\n  editorContext: EditorContextType\r\n) {\r\n  return internalBuildTinaFields(path, editorContext);\r\n}\r\n\r\nfunction internalBuildTinaFields(\r\n  path: string,\r\n  editorContext: EditorContextType,\r\n  fieldsFilter?: (field: InternalAnyTinaField | FieldPortal) => boolean\r\n) {\r\n  const compiledPath = pathToCompiledPath(\r\n    stripRichTextPartSelection(path),\r\n    editorContext\r\n  );\r\n\r\n  const compiledComponent: CompiledCustomComponentConfig = dotNotationGet(\r\n    editorContext.compiledComponentConfig!,\r\n    compiledPath\r\n  );\r\n\r\n  let allFields: InternalAnyTinaField[] = [];\r\n\r\n  (compiledComponent.__editing?.fields ?? [])\r\n    .filter((field) =>\r\n      fieldsFilter ? fieldsFilter(field as InternalAnyTinaField) : true\r\n    )\r\n    .forEach((item) => {\r\n      if (isFieldPortal(item)) {\r\n        let fields: InternalAnyTinaField[] = [];\r\n\r\n        if (item.portal === \"component\") {\r\n          const portalComponentFields = internalBuildTinaFields(\r\n            item.source,\r\n            editorContext\r\n          );\r\n          fields.push(...portalComponentFields);\r\n\r\n          if (!item.includeHeader) {\r\n            fields = fields.filter((x) => x.prop !== \"$myself\");\r\n          }\r\n\r\n          const groups = item.groups;\r\n          if (groups) {\r\n            fields = fields.filter(\r\n              (x) =>\r\n                x.prop === \"$myself\" ||\r\n                groups.includes(x.group || \"___doesn't matter___\")\r\n            );\r\n          }\r\n        } else if (item.portal === \"field\") {\r\n          if (item.hidden) {\r\n            return;\r\n          }\r\n\r\n          const portalFieldFields = internalBuildTinaFields(\r\n            item.source,\r\n            editorContext,\r\n            (field) => !isFieldPortal(field) && field.prop === item.fieldName\r\n          );\r\n\r\n          if (portalFieldFields.length === 0) {\r\n            console.warn(\r\n              `Missing field \"${item.fieldName}\" at path \"${item.source}\" in portal for component ${compiledComponent._component}`\r\n            );\r\n            return;\r\n          }\r\n\r\n          const portalField = {\r\n            ...portalFieldFields[0],\r\n            ...item.overrides,\r\n          };\r\n\r\n          fields.push(portalField);\r\n        } else if (item.portal === \"multi-field\") {\r\n          if (item.sources.length === 0) {\r\n            if (item.hidden) {\r\n              return;\r\n            }\r\n\r\n            throw new Error(\r\n              `Missing sources for multi field portal of component \"${compiledComponent._component}\" at path \"${path}\". Set \"hidden\" to \"true\" for this portal if sources are empty`\r\n            );\r\n          }\r\n\r\n          const portalFieldFields = item.sources.flatMap((source) =>\r\n            internalBuildTinaFields(\r\n              source,\r\n              editorContext,\r\n              (field) => !isFieldPortal(field) && field.prop === item.fieldName\r\n            )\r\n          );\r\n\r\n          const firstField = portalFieldFields[0];\r\n          const combinedField: InternalField = {\r\n            ...firstField,\r\n            ...item.overrides,\r\n            name: portalFieldFields.flatMap((field) => field.name),\r\n          };\r\n\r\n          fields.push(combinedField);\r\n        }\r\n\r\n        allFields = [...allFields, ...fields];\r\n      } else {\r\n        allFields.push(item as InternalField);\r\n      }\r\n    });\r\n\r\n  // Analytics fields should always go to the bottom (later they'll be in separate tab)\r\n\r\n  const nonAnalyticsFields = allFields.filter((x) => x.group !== \"Analytics\");\r\n  const analyticsFields = allFields.filter((x) => x.group === \"Analytics\");\r\n\r\n  return [...nonAnalyticsFields, ...analyticsFields];\r\n}\r\n","export async function copyToClipboard(textToCopy: string) {\r\n  // Navigator clipboard api needs a secure context (https)\r\n  if (navigator.clipboard && window.isSecureContext) {\r\n    await navigator.clipboard.writeText(textToCopy);\r\n  } else {\r\n    // Use the 'out of viewport hidden text area' trick\r\n    const textArea = document.createElement(\"textarea\");\r\n    textArea.value = textToCopy;\r\n\r\n    // Move textarea out of the viewport so it's not visible\r\n    textArea.style.position = \"absolute\";\r\n    textArea.style.left = \"-999999px\";\r\n\r\n    document.body.prepend(textArea);\r\n    textArea.select();\r\n\r\n    try {\r\n      document.execCommand(\"copy\");\r\n    } catch (error) {\r\n      console.error(error);\r\n    } finally {\r\n      textArea.remove();\r\n    }\r\n  }\r\n}","import { dotNotationGet } from \"@/utils\";\r\nimport { NoCodeComponentEntry } from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  findComponentDefinition,\r\n  stripRichTextPartSelection,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport {\r\n  ButtonPrimary,\r\n  ButtonSecondary,\r\n  Colors,\r\n  Fonts,\r\n  useToaster,\r\n} from \"@redsun-vn/easyblocks-design-system\";\r\nimport * as React from \"react\";\r\nimport { styled } from \"styled-components\";\r\nimport { useEditorContext } from \"./EditorContext\";\r\nimport { pathToCompiledPath } from \"./pathToCompiledPath\";\r\nimport { copyToClipboard } from \"./utils/copyToClipboard\";\r\n\r\nconst IdWrapper = styled.div`\r\n  display: block;\r\n  padding: 16px;\r\n  ${Fonts.body}\r\n  color: ${Colors.black40};\r\n`;\r\n\r\nexport function SidebarFooter(props: { paths: string[] }) {\r\n  const editorContext = useEditorContext();\r\n  const toaster = useToaster();\r\n  const { form, isAdminMode } = editorContext;\r\n\r\n  if (props.paths.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  const path = stripRichTextPartSelection(props.paths[0]);\r\n  const value: NoCodeComponentEntry = dotNotationGet(form.values, path);\r\n\r\n  if (!value) {\r\n    return null;\r\n  }\r\n\r\n  const compiledPath = pathToCompiledPath(path, editorContext);\r\n  const compiledValue = dotNotationGet(\r\n    editorContext.compiledComponentConfig,\r\n    compiledPath\r\n  );\r\n\r\n  const widthInfo = compiledValue.__editing?.widthInfo;\r\n  const width = widthInfo?.width?.xl;\r\n  const widthAuto = widthInfo?.auto?.xl;\r\n\r\n  const definition = findComponentDefinition(value, editorContext);\r\n  const isSaveable = !!definition?.allowSave;\r\n\r\n  const showSaveAsTemplate =\r\n    isSaveable &&\r\n    !editorContext.readOnly &&\r\n    !editorContext.disableCustomTemplates;\r\n\r\n  return (\r\n    <div>\r\n      <IdWrapper>\r\n        <div>Id: {value._id}</div>\r\n        <br />\r\n\r\n        {showSaveAsTemplate && (\r\n          <ButtonSecondary\r\n            onClick={() => {\r\n              editorContext.actions.openTemplateModal({\r\n                mode: \"create\",\r\n                config: value,\r\n                width,\r\n                widthAuto,\r\n              });\r\n            }}\r\n          >\r\n            Save as template\r\n          </ButtonSecondary>\r\n        )}\r\n\r\n        {isAdminMode && (\r\n          <div style={{ paddingTop: 16 }}>\r\n            <div>\r\n              <ButtonPrimary\r\n                onClick={async () => {\r\n                  try {\r\n                    await copyToClipboard(JSON.stringify(value));\r\n                    toaster.success(\"Copied\");\r\n                  } catch (error) {\r\n                    toaster.error(\"Copy Entry Error!\");\r\n                  }\r\n                }}\r\n              >\r\n                Copy entry\r\n              </ButtonPrimary>\r\n            </div>\r\n            {value._master && (\r\n              <div style={{ paddingTop: 16 }}>Master: {value._master}</div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </IdWrapper>\r\n    </div>\r\n  );\r\n}\r\n","import { InternalField } from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { Toggle as DesignSystemToggle } from \"@redsun-vn/easyblocks-design-system\";\r\nimport React, { FC } from \"react\";\r\nimport { styled } from \"styled-components\";\r\n\r\nexport interface ToggleProps {\r\n  name: string;\r\n  input: any;\r\n  field: ToggleFieldDefinition;\r\n  disabled?: boolean;\r\n  onBlur: <T>(event?: React.FocusEvent<T>) => void;\r\n  onChange: <T>(event: React.ChangeEvent<T> | any) => void;\r\n  onFocus: <T>(event?: React.FocusEvent<T>) => void;\r\n}\r\n\r\ninterface ToggleFieldDefinition extends InternalField {\r\n  component: \"toggle\";\r\n  toggleLabels?: boolean | FieldLabels;\r\n}\r\n\r\ntype FieldLabels = { true: string; false: string };\r\n\r\nexport const Toggle: FC<ToggleProps> = ({ input, field, disabled = false }) => {\r\n  const checked = !!(input.value || input.checked);\r\n\r\n  const toggleProps = {\r\n    ...input,\r\n    labels: null,\r\n    name: field.name,\r\n    disabled,\r\n    value: checked,\r\n    checked,\r\n  };\r\n  return (\r\n    <ToggleFieldWrapper>\r\n      <DesignSystemToggle {...toggleProps} />\r\n    </ToggleFieldWrapper>\r\n  );\r\n};\r\n\r\nconst ToggleFieldWrapper = styled.div`\r\n  display: flex;\r\n  justify-content: flex-end;\r\n`;\r\n","const MIXED_VALUE = \"__MIXED__\";\r\n\r\nconst COMPONENTS_SUPPORTING_MIXED_VALUES = [\r\n  \"block\",\r\n  \"radio-group\",\r\n  \"select\",\r\n  \"token\",\r\n];\r\n\r\nexport { COMPONENTS_SUPPORTING_MIXED_VALUES, MIXED_VALUE };\r\n","import { FieldMixedValue } from \"../../../types\";\r\n\r\nfunction isMixedFieldValue(value: unknown): value is FieldMixedValue {\r\n  return (\r\n    typeof value === \"object\" &&\r\n    value !== null &&\r\n    \"__mixed__\" in value &&\r\n    (value as FieldMixedValue).__mixed__\r\n  );\r\n}\r\n\r\nexport { isMixedFieldValue };\r\n","import { InternalField } from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport {\r\n  Select,\r\n  SelectItem,\r\n  SelectSeparator,\r\n} from \"@redsun-vn/easyblocks-design-system\";\r\nimport React from \"react\";\r\nimport { FieldMixedValue } from \"../../../types\";\r\nimport { FieldRenderProps } from \"../../form-builder\";\r\nimport { MIXED_VALUE } from \"./constants\";\r\nimport { isMixedFieldValue } from \"./isMixedFieldValue\";\r\n\r\ntype Option =\r\n  | {\r\n      value: string;\r\n      label: string;\r\n    }\r\n  | {\r\n      isDivider: true;\r\n    };\r\n\r\ninterface SelectFieldProps extends InternalField {\r\n  options: (Option | string)[];\r\n}\r\n\r\nexport interface SelectFieldComponentProps\r\n  extends FieldRenderProps<string | FieldMixedValue> {\r\n  name: Array<string> | string;\r\n  field: SelectFieldProps;\r\n  disabled?: boolean;\r\n  options?: (Option | string)[];\r\n}\r\n\r\nexport const SelectFieldComponent: React.FC<SelectFieldComponentProps> = ({\r\n  input,\r\n  field,\r\n  options,\r\n}) => {\r\n  const { value, onChange } = input;\r\n  const isMixedValue = isMixedFieldValue(value);\r\n\r\n  const selectOptions = options || field.options;\r\n  const normalizedSelectOptions = selectOptions.map(toProps);\r\n\r\n  if (isMixedValue) {\r\n    normalizedSelectOptions.unshift(\r\n      {\r\n        label: \"Mixed\",\r\n        value: MIXED_VALUE,\r\n      },\r\n      {\r\n        isDivider: true,\r\n      }\r\n    );\r\n  }\r\n\r\n  const inputValue = isMixedValue ? MIXED_VALUE : value;\r\n\r\n  const handleChange = (value: string) => {\r\n    onChange(value);\r\n  };\r\n\r\n  return (\r\n    <Select value={inputValue} onChange={handleChange}>\r\n      {normalizedSelectOptions.map(toComponent)}\r\n    </Select>\r\n  );\r\n};\r\n\r\nfunction toProps(option: Option | string): Option {\r\n  if (typeof option === \"object\") return option;\r\n  return { value: option, label: option };\r\n}\r\n\r\nfunction toComponent(option: Option) {\r\n  if (\"isDivider\" in option) {\r\n    return <SelectSeparator key=\"divider\" />;\r\n  }\r\n\r\n  return (\r\n    <SelectItem\r\n      key={option.value}\r\n      value={option.value}\r\n      isDisabled={option.value === MIXED_VALUE}\r\n    >\r\n      {option.label}\r\n    </SelectItem>\r\n  );\r\n}\r\n","import { Option } from \"@redsun-vn/easyblocks-core\";\r\nimport { InternalField } from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport {\r\n  Icons,\r\n  SelectInline,\r\n  ToggleButton,\r\n} from \"@redsun-vn/easyblocks-design-system\";\r\nimport React from \"react\";\r\nimport { FieldMixedValue } from \"../../../types\";\r\nimport { FieldRenderProps } from \"../../form-builder\";\r\nimport { isMixedFieldValue } from \"./isMixedFieldValue\";\r\n\r\ninterface RadioGroupFieldProps extends InternalField {\r\n  options: Option[];\r\n  direction?: \"horizontal\" | \"vertical\";\r\n  variant?: \"radio\" | \"button\";\r\n}\r\n\r\nexport interface RadioGroupProps\r\n  extends FieldRenderProps<string | FieldMixedValue> {\r\n  name: string;\r\n  field: RadioGroupFieldProps;\r\n  disabled?: boolean;\r\n  options?: (Option | string)[];\r\n}\r\n\r\nexport const RadioGroup: React.FC<RadioGroupProps> = ({\r\n  input,\r\n  field,\r\n  options,\r\n}) => {\r\n  const { value } = input;\r\n  const radioOptions = options || field.options;\r\n  const toggleButtonValue = isMixedFieldValue(value) ? undefined : value;\r\n\r\n  const toProps = (option: Option | string): Exclude<Option, string> => {\r\n    if (typeof option === \"object\") return option;\r\n    return { value: option, label: option };\r\n  };\r\n\r\n  const radioOptionsMapped = radioOptions ? radioOptions.map(toProps) : [];\r\n\r\n  return (\r\n    radioOptionsMapped && (\r\n      <SelectInline {...input} value={toggleButtonValue}>\r\n        {radioOptionsMapped.map((option) => {\r\n          let Icon: Exclude<Exclude<Option, string>[\"icon\"], string> =\r\n            undefined;\r\n\r\n          if (typeof option.icon === \"string\" && option.icon in Icons) {\r\n            Icon = Icons[option.icon as keyof typeof Icons];\r\n          }\r\n\r\n          if (typeof option.icon === \"function\") {\r\n            Icon = option.icon;\r\n          }\r\n\r\n          return (\r\n            <ToggleButton\r\n              key={option.value}\r\n              icon={Icon}\r\n              value={option.value}\r\n              hideLabel={option.hideLabel}\r\n            >\r\n              {option.label ?? option.value}\r\n            </ToggleButton>\r\n          );\r\n        })}\r\n      </SelectInline>\r\n    )\r\n  );\r\n};\r\n","import * as React from \"react\";\r\nimport { Input } from \"@redsun-vn/easyblocks-design-system\";\r\n\r\ninterface NumberProps\r\n  extends React.DetailedHTMLProps<\r\n    React.InputHTMLAttributes<HTMLInputElement>,\r\n    HTMLInputElement\r\n  > {\r\n  step?: string | number;\r\n}\r\n\r\nexport const NumberInput: React.FC<NumberProps> = ({\r\n  onChange,\r\n  value,\r\n  step,\r\n  min,\r\n  max,\r\n}) => (\r\n  <Input\r\n    type=\"number\"\r\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n    // @ts-ignore\r\n    step={step}\r\n    value={value}\r\n    onChange={onChange}\r\n    min={min}\r\n    max={max}\r\n  />\r\n);\r\n","import { Fonts } from \"@redsun-vn/easyblocks-design-system\";\r\nimport React, { CSSProperties, forwardRef, ReactNode } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { styled } from \"styled-components\";\r\n\r\ninterface TooltipProps {\r\n  children: ReactNode;\r\n  style?: CSSProperties;\r\n}\r\n\r\nconst Tooltip = forwardRef<HTMLDivElement, TooltipProps>(\r\n  ({ children, style = {}, ...rest }, ref) => {\r\n    return createPortal(\r\n      <div style={{ ...style, zIndex: 100100 }} ref={ref} {...rest}>\r\n        {children}\r\n      </div>,\r\n      document.body\r\n    );\r\n  }\r\n);\r\n\r\nexport { Tooltip, TooltipBody, TooltipArrow };\r\n\r\nconst TooltipBody = styled.div`\r\n  position: relative;\r\n  top: 6px;\r\n\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: center;\r\n  align-items: center;\r\n\r\n  padding: 6px 4px;\r\n\r\n  background: #333333;\r\n  border-radius: 2px;\r\n\r\n  ${Fonts.body}\r\n  color: #fff;\r\n`;\r\n\r\nconst TooltipArrow = styled.div`\r\n  width: 12px;\r\n  height: 6px;\r\n  margin: 0 auto;\r\n\r\n  background: #333333;\r\n  clip-path: polygon(50% 0%, 0% 100%, 100% 100%);\r\n`;\r\n","import { TooltipTriggerAria, useTooltipTrigger } from \"@react-aria/tooltip\";\r\nimport { CSSProperties, MouseEvent, RefCallback, useState } from \"react\";\r\nimport { usePopper } from \"react-popper\";\r\n\r\ninterface TooltipOptions {\r\n  isDisabled?: boolean;\r\n  onClick?: () => void;\r\n}\r\n\r\ntype TooltipResult = {\r\n  isOpen: boolean;\r\n  arrowProps: {\r\n    ref: RefCallback<HTMLElement>;\r\n    style: CSSProperties;\r\n  };\r\n} & TooltipTriggerAria;\r\n\r\nfunction useTooltip({\r\n  isDisabled,\r\n  onClick,\r\n}: TooltipOptions = {}): TooltipResult {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [triggerElement, setTriggerElement] = useState<HTMLElement | null>(\r\n    null\r\n  );\r\n  const [tooltipElement, setTooltipElement] = useState<HTMLElement | null>(\r\n    null\r\n  );\r\n  const [arrowElement, setArrowElement] = useState<HTMLElement | null>(null);\r\n\r\n  const { styles, attributes } = usePopper(triggerElement, tooltipElement, {\r\n    strategy: \"absolute\",\r\n    placement: \"bottom\",\r\n    modifiers: [\r\n      { name: \"arrow\", options: { element: arrowElement, padding: 6 } },\r\n    ],\r\n  });\r\n\r\n  const tooltipTrigger = useTooltipTrigger(\r\n    {\r\n      isDisabled,\r\n      delay: 0,\r\n    },\r\n    {\r\n      isOpen,\r\n      open: () => {\r\n        setIsOpen(true);\r\n      },\r\n      close: () => {\r\n        setIsOpen(false);\r\n      },\r\n    },\r\n    { current: triggerElement }\r\n  );\r\n\r\n  const triggerProps = {\r\n    ref: setTriggerElement,\r\n    ...tooltipTrigger.triggerProps,\r\n    onClick:\r\n      onClick === undefined\r\n        ? tooltipTrigger.tooltipProps.onClick\r\n        : (event: MouseEvent<HTMLButtonElement>) => {\r\n            tooltipTrigger.tooltipProps.onClick?.(event);\r\n            onClick();\r\n          },\r\n  };\r\n\r\n  const tooltipProps = {\r\n    ref: setTooltipElement,\r\n    style: styles.popper,\r\n    ...attributes.popper,\r\n    ...tooltipTrigger.tooltipProps,\r\n  };\r\n\r\n  const arrowProps = {\r\n    ref: setArrowElement,\r\n    style: styles.arrow,\r\n  };\r\n\r\n  return {\r\n    isOpen,\r\n    triggerProps,\r\n    tooltipProps,\r\n    arrowProps,\r\n  };\r\n}\r\n\r\nexport { useTooltip };\r\n","import {\r\n  ExternalReference,\r\n  ExternalSchemaProp,\r\n  LocalTextReference,\r\n  TextSchemaProp,\r\n  TrulyResponsiveValue,\r\n  getExternalReferenceLocationKey,\r\n  isEmptyExternalReference,\r\n  isIdReferenceToDocumentExternalValue,\r\n  isTrulyResponsiveValue,\r\n  responsiveValueFindDeviceWithDefinedValue,\r\n  responsiveValueForceGet,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  InternalField,\r\n  isExternalSchemaProp,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport {\r\n  Fonts,\r\n  Loader,\r\n  Select,\r\n  SelectItem,\r\n  Typography,\r\n} from \"@redsun-vn/easyblocks-design-system\";\r\nimport { dotNotationGet, toArray, uniqueId } from \"@/utils\";\r\nimport React, { ReactNode, useState } from \"react\";\r\nimport { styled, css } from \"styled-components\";\r\nimport { useConfigAfterAuto } from \"../../../ConfigAfterAutoContext\";\r\nimport {\r\n  EditorExternalTypeDefinition,\r\n  useEditorContext,\r\n} from \"../../../EditorContext\";\r\nimport { useEditorExternalData } from \"../../../EditorExternalDataProvider\";\r\nimport { Form } from \"../../../form\";\r\nimport { FieldRenderProps } from \"../../form-builder\";\r\nimport { COMPONENTS_SUPPORTING_MIXED_VALUES } from \"../components/constants\";\r\nimport { isMixedFieldValue } from \"../components/isMixedFieldValue\";\r\nimport type { ResponsiveFieldDefinition } from \"./ResponsiveField/responsiveFieldController\";\r\nimport { Tooltip, TooltipArrow, TooltipBody } from \"./Tooltip\";\r\nimport { useTooltip } from \"./useTooltip\";\r\n\r\ntype ExtraFieldMetaWrapperFields = {\r\n  layout?: \"column\" | \"row\";\r\n  noWrap?: boolean;\r\n  isLabelHidden?: boolean;\r\n};\r\n\r\nexport interface FieldProps<InputProps extends Record<string, unknown>>\r\n  extends FieldRenderProps<any, HTMLElement> {\r\n  field: InternalField;\r\n  form: Form;\r\n}\r\n\r\ntype InputFieldType<\r\n  ExtraFieldProps extends Record<string, unknown>,\r\n  InputProps extends Record<string, unknown>\r\n> = Omit<FieldProps<InputProps>, \"meta\"> &\r\n  ExtraFieldProps &\r\n  ExtraFieldMetaWrapperFields & {\r\n    children: ReactNode;\r\n    renderLabel?: (props: { label: string }) => ReactNode;\r\n  };\r\n\r\n// Wraps the Field component in labels describing the field's meta state\r\n// Add any other fields that the Field component should expect onto the ExtraFieldProps generic type\r\n\r\nexport function FieldMetaWrapper<\r\n  ExtraFieldProps extends Record<string, unknown> = Record<string, unknown>,\r\n  InputProps extends Record<string, unknown> = Record<string, unknown>\r\n>({\r\n  children,\r\n  field,\r\n  input,\r\n  noWrap,\r\n  layout = \"row\",\r\n  renderLabel,\r\n  isLabelHidden,\r\n}: InputFieldType<ExtraFieldProps, InputProps>) {\r\n  const editorContext = useEditorContext();\r\n  const configAfterAuto = useConfigAfterAuto();\r\n  const externalData = useEditorExternalData();\r\n  const { isOpen, tooltipProps, triggerProps, arrowProps } = useTooltip();\r\n\r\n  const {\r\n    actions: { runChange },\r\n    form,\r\n    focussedField,\r\n  } = editorContext;\r\n\r\n  const isMixedValueSupported = isMixedValueSupportedByComponent(\r\n    isResponsiveField(field) ? field.subComponent : field.component\r\n  );\r\n\r\n  const isMixedValue = isMixedFieldValue(input.value);\r\n  const fieldNames = toArray(field.name);\r\n\r\n  function handleButtonMixedClick() {\r\n    runChange(() => {\r\n      fieldNames.forEach((fieldName, _, names) => {\r\n        const firstFieldValue = dotNotationGet(form.values, names[0]);\r\n        form.change(fieldName, firstFieldValue);\r\n      });\r\n    });\r\n  }\r\n\r\n  const resolvedLayout = field.layout ?? layout;\r\n\r\n  const content = (\r\n    <div\r\n      style={{\r\n        width: \"100%\",\r\n        display: \"flex\",\r\n        alignItems: resolvedLayout === \"row\" ? \"flex-end\" : \"flex-start\",\r\n        flexDirection: \"column\",\r\n      }}\r\n    >\r\n      {!isMixedValue || (isMixedValue && isMixedValueSupported) ? (\r\n        children\r\n      ) : (\r\n        <TextButton\r\n          component=\"button\"\r\n          variant=\"label\"\r\n          color=\"black40\"\r\n          onClick={handleButtonMixedClick}\r\n        >\r\n          Mixed\r\n        </TextButton>\r\n      )}\r\n    </div>\r\n  );\r\n\r\n  if (noWrap) {\r\n    return content;\r\n  }\r\n\r\n  const label = field.label || input.name;\r\n  const { schemaProp } = field;\r\n  const isExternalField =\r\n    isExternalSchemaProp(schemaProp, editorContext.types) ||\r\n    (schemaProp.type === \"text\" && !input.value.id?.startsWith(\"local.\"));\r\n  const componentPaths = fieldNames.map((fieldName) =>\r\n    fieldName[0].split(\".\").slice(0, -1).join(\".\")\r\n  );\r\n  const fieldValues = fieldNames.map((f) => dotNotationGet(configAfterAuto, f));\r\n  const configs = componentPaths.map((c) => dotNotationGet(configAfterAuto, c));\r\n  const externalValues = isExternalField\r\n    ? configs.map(\r\n        (c) =>\r\n          externalData[\r\n            getExternalReferenceLocationKey(\r\n              focussedField.length === 0 ? \"$\" : c._id,\r\n              schemaProp.prop,\r\n              isTrulyResponsiveValue(input.value)\r\n                ? responsiveValueFindDeviceWithDefinedValue(\r\n                    input.value,\r\n                    editorContext.breakpointIndex,\r\n                    editorContext.devices\r\n                  )?.id\r\n                : undefined\r\n            )\r\n          ]\r\n      )\r\n    : undefined;\r\n\r\n  const currentBreakpointFieldValues = fieldValues.map((v) =>\r\n    responsiveValueForceGet(v, editorContext.breakpointIndex)\r\n  );\r\n\r\n  const isLoadingExternalValue =\r\n    isExternalField &&\r\n    externalValues?.length === 0 &&\r\n    currentBreakpointFieldValues.every(\r\n      (v) =>\r\n        !isEmptyExternalReference(v) &&\r\n        !isIdReferenceToDocumentExternalValue(v.id)\r\n    );\r\n\r\n  return (\r\n    <FieldWrapper margin={false} layout={resolvedLayout}>\r\n      {!isLabelHidden && (\r\n        <FieldLabelWrapper isFullWidth={resolvedLayout === \"column\"}>\r\n          {renderLabel?.({ label }) ?? (\r\n            <FieldLabel\r\n              htmlFor={toArray(field.name).join(\",\")}\r\n              isError={\r\n                externalValues !== undefined && \"error\" in externalValues\r\n              }\r\n              {...triggerProps}\r\n            >\r\n              <span\r\n                style={{\r\n                  lineHeight: \"100%\",\r\n                  overflow: \"hidden\",\r\n                  textOverflow: \"ellipsis\",\r\n                }}\r\n              >\r\n                {label}\r\n              </span>\r\n              {isOpen && (\r\n                <Tooltip {...tooltipProps}>\r\n                  <TooltipArrow {...arrowProps} />\r\n                  <TooltipBody>{field.description ?? field.label}</TooltipBody>\r\n                </Tooltip>\r\n              )}\r\n            </FieldLabel>\r\n          )}\r\n\r\n          {isLoadingExternalValue && (\r\n            <div\r\n              style={{\r\n                marginLeft: \"6px\",\r\n              }}\r\n            >\r\n              <Loader />\r\n            </div>\r\n          )}\r\n\r\n          {resolvedLayout === \"column\" &&\r\n            (isExternalSchemaProp(schemaProp, editorContext.types) ||\r\n              schemaProp.type === \"text\") &&\r\n            !isMixedValue && (\r\n              <WidgetsSelect\r\n                schemaProp={schemaProp}\r\n                value={currentBreakpointFieldValues[0]}\r\n                onChange={(widgetId) => {\r\n                  if (widgetId === \"@easyblocks/local-text\") {\r\n                    const newFieldValue: LocalTextReference = {\r\n                      id: `local.${uniqueId()}`,\r\n                      value: {},\r\n                      widgetId,\r\n                    };\r\n\r\n                    input.onChange(newFieldValue);\r\n                    return;\r\n                  }\r\n\r\n                  if (isTrulyResponsiveValue(input.value)) {\r\n                    const newFieldValue: TrulyResponsiveValue<ExternalReference> =\r\n                      {\r\n                        ...input.value,\r\n                        [editorContext.breakpointIndex]: {\r\n                          id: null,\r\n                          widgetId,\r\n                        },\r\n                      };\r\n\r\n                    input.onChange(newFieldValue);\r\n                  } else {\r\n                    const newFieldValue: ExternalReference = {\r\n                      id: null,\r\n                      widgetId,\r\n                    };\r\n\r\n                    input.onChange(newFieldValue);\r\n                  }\r\n                }}\r\n                isRootComponent={fieldNames.some(\r\n                  (f) => f.split(\".\").length === 1\r\n                )}\r\n              />\r\n            )}\r\n        </FieldLabelWrapper>\r\n      )}\r\n\r\n      <FieldInputWrapper layout={resolvedLayout}>{content}</FieldInputWrapper>\r\n\r\n      {!isMixedFieldValue &&\r\n        isExternalField &&\r\n        externalValues!.length > 0 &&\r\n        \"error\" in externalValues![0] && (\r\n          <FieldError>{externalValues![0].error.message}</FieldError>\r\n        )}\r\n    </FieldWrapper>\r\n  );\r\n}\r\n\r\nfunction WidgetsSelect({\r\n  value,\r\n  onChange,\r\n  schemaProp,\r\n  isRootComponent,\r\n}: {\r\n  value: LocalTextReference | ExternalReference;\r\n  onChange: (widgetId: string) => void;\r\n  schemaProp: ExternalSchemaProp | TextSchemaProp;\r\n  isRootComponent: boolean;\r\n}) {\r\n  const editorContext = useEditorContext();\r\n  const [selectedWidgetId, setSelectedWidgetId] = useState(value.widgetId);\r\n\r\n  const widgets = (\r\n    editorContext.types[schemaProp.type] as EditorExternalTypeDefinition\r\n  ).widgets;\r\n  const availableWidgets = isRootComponent\r\n    ? widgets.filter((w) => {\r\n        return w.id !== \"@easyblocks/document-data\";\r\n      })\r\n    : [...widgets];\r\n\r\n  if (schemaProp.type === \"text\") {\r\n    availableWidgets.unshift({\r\n      id: \"@easyblocks/local-text\",\r\n      label: \"Local text\",\r\n      component: () => {\r\n        return null;\r\n      },\r\n    });\r\n  }\r\n\r\n  if (availableWidgets.length <= 1) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <FieldLabelIconWrapper>\r\n      <Select\r\n        value={selectedWidgetId}\r\n        onChange={(widgetId) => {\r\n          setSelectedWidgetId(widgetId);\r\n          onChange(widgetId);\r\n        }}\r\n      >\r\n        {availableWidgets.map((widget) => {\r\n          return (\r\n            <SelectItem value={widget.id} key={widget.id}>\r\n              {widget.label ?? widget.id}\r\n            </SelectItem>\r\n          );\r\n        })}\r\n      </Select>\r\n    </FieldLabelIconWrapper>\r\n  );\r\n}\r\n\r\nfunction isResponsiveField(\r\n  field: InternalField\r\n): field is ResponsiveFieldDefinition {\r\n  return (\r\n    typeof field.component === \"string\" && field.component === \"responsive2\"\r\n  );\r\n}\r\n\r\nfunction isMixedValueSupportedByComponent(\r\n  component: InternalField[\"component\"]\r\n): boolean {\r\n  if (typeof component === \"string\") {\r\n    return COMPONENTS_SUPPORTING_MIXED_VALUES.includes(component);\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nconst TextButton = styled(Typography)`\r\n  padding: 0;\r\n  margin: 0;\r\n  background: transparent;\r\n  border: 0;\r\n  font-weight: 500;\r\n\r\n  &:hover {\r\n    color: black;\r\n    cursor: pointer;\r\n    text-decoration: underline;\r\n  }\r\n`;\r\n\r\nexport function wrapFieldsWithMeta<\r\n  ExtraFieldProps extends Record<string, any> = Record<string, any>,\r\n  InputProps extends Record<string, any> = Record<string, any>\r\n>(\r\n  Field: React.ComponentType<InputFieldType<ExtraFieldProps, InputProps>>,\r\n  extraProps?: ExtraFieldMetaWrapperFields\r\n) {\r\n  return (props: InputFieldType<ExtraFieldProps, InputProps>) => {\r\n    return (\r\n      <FieldMetaWrapper {...props} {...extraProps}>\r\n        <Field {...props} />\r\n      </FieldMetaWrapper>\r\n    );\r\n  };\r\n}\r\n\r\ninterface FieldWrapperProps {\r\n  margin: boolean;\r\n  layout: \"column\" | \"row\";\r\n}\r\n\r\nconst FieldWrapper = styled.div<FieldWrapperProps>`\r\n  display: flex;\r\n  flex-direction: ${({ layout }) => layout};\r\n  gap: ${({ layout }) => (layout === \"row\" ? \"10px\" : \"4px\")};\r\n  justify-content: space-between;\r\n  align-items: flex-start;\r\n  ${({ layout }) =>\r\n    layout === \"column\" &&\r\n    css`\r\n      flex-grow: 1;\r\n    `}\r\n  position: relative;\r\n  padding: 4px 16px;\r\n`;\r\n\r\nconst FieldLabelWrapper = styled.div<{ isFullWidth: boolean }>`\r\n  all: unset;\r\n  position: relative;\r\n  display: flex;\r\n  flex-direction: row;\r\n  align-items: center;\r\n  ${({ isFullWidth }) => isFullWidth && { width: \"100%\" }}\r\n  min-height: 28px;\r\n  overflow: hidden;\r\n`;\r\n\r\ntype FieldLabelProps = {\r\n  isError: boolean;\r\n};\r\n\r\nconst FieldLabel = styled.label<FieldLabelProps>`\r\n  all: unset;\r\n  ${Fonts.body};\r\n  color: ${({ isError }) => (isError ? \"red\" : \"#000\")};\r\n  text-overflow: ellipsis;\r\n  overflow: hidden;\r\n  cursor: default;\r\n`;\r\n\r\nconst FieldLabelIconWrapper = styled.span`\r\n  display: flex;\r\n  font-size: 14px;\r\n  line-height: 1;\r\n  margin-left: auto;\r\n  padding-left: 8px;\r\n\r\n  svg {\r\n    width: 14px;\r\n    height: 14px;\r\n    flex-shrink: 0;\r\n  }\r\n`;\r\n\r\nconst FieldError = styled.span`\r\n  display: block;\r\n  color: red;\r\n  font-size: var(--tina-font-size-1);\r\n  margin-top: 8px;\r\n  font-weight: var(--tina-font-weight-regular);\r\n`;\r\n\r\ninterface FieldInputWrapper {\r\n  layout: \"row\" | \"column\";\r\n}\r\n\r\nconst FieldInputWrapper = styled.div<FieldInputWrapper>`\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  align-items: center;\r\n\r\n  ${({ layout }) =>\r\n    layout === \"row\"\r\n      ? css`\r\n          flex-grow: 1;\r\n        `\r\n      : css`\r\n          width: 100%;\r\n        `};\r\n  min-height: 28px;\r\n`;\r\n","export const parse = (value?: string) => value && +value;\r\n","import React from \"react\";\r\nimport { wrapFieldsWithMeta } from \"./wrapFieldWithMeta\";\r\nimport { NumberInput as BaseNumberField, InputProps } from \"../components\";\r\nimport { parse } from \"./numberFormat\";\r\n\r\nconst NumberField = wrapFieldsWithMeta<{\r\n  step: string | number;\r\n  min?: number;\r\n  max?: number;\r\n  input: InputProps;\r\n}>(({ input, field }) => {\r\n  return (\r\n    <BaseNumberField\r\n      {...input}\r\n      step={field.step}\r\n      min={field.min}\r\n      max={field.max}\r\n    />\r\n  );\r\n});\r\n\r\nexport const NumberFieldPlugin = {\r\n  name: \"number\",\r\n  Component: NumberField,\r\n  parse,\r\n};\r\n","export const parse = (value?: string) => value || \"\";\r\n","import { wrapFieldsWithMeta } from \"./wrapFieldWithMeta\";\r\nimport { SelectFieldComponent } from \"../components\";\r\nimport { parse } from \"./textFormat\";\r\n\r\nconst SelectField = wrapFieldsWithMeta(SelectFieldComponent);\r\n\r\nexport const SelectFieldPlugin = {\r\n  name: \"select\",\r\n  type: \"select\",\r\n  Component: SelectField,\r\n  parse,\r\n};\r\n","import { wrapFieldsWithMeta } from \"./wrapFieldWithMeta\";\r\nimport { RadioGroup } from \"../components\";\r\n\r\nconst RadioGroupField = wrapFieldsWithMeta(RadioGroup);\r\n\r\nexport const RadioGroupFieldPlugin = {\r\n  name: \"radio-group\",\r\n  Component: RadioGroupField,\r\n};\r\n","import {\r\n  LocalTextReference,\r\n  ResponsiveValue,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  InternalField,\r\n  useTextValue,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { Input } from \"@redsun-vn/easyblocks-design-system\";\r\nimport React from \"react\";\r\nimport { FieldRenderProps } from \"react-final-form\";\r\nimport { useEditorContext } from \"../../../EditorContext\";\r\nimport { parse } from \"./textFormat\";\r\nimport { FieldMetaWrapper } from \"./wrapFieldWithMeta\";\r\n\r\ntype TextFieldProps = FieldRenderProps<\r\n  ResponsiveValue<string> | LocalTextReference\r\n> & {\r\n  field: InternalField & {\r\n    placeholder?: string;\r\n    normalize: (value: string) => string | null;\r\n  };\r\n};\r\n\r\nfunction TextField({ input, field, noWrap }: TextFieldProps) {\r\n  const editorContext = useEditorContext();\r\n  const { value, onChange, ...restInputProperties } = input;\r\n\r\n  const inputProps = useTextValue(\r\n    value,\r\n    onChange,\r\n    editorContext.contextParams.locale,\r\n    editorContext.locales,\r\n    field.placeholder,\r\n    field.normalize\r\n  );\r\n\r\n  const isTextSchemaProp = field.schemaProp.type === \"text\";\r\n\r\n  return (\r\n    <FieldMetaWrapper\r\n      input={input}\r\n      field={field}\r\n      layout={isTextSchemaProp ? \"column\" : \"row\"}\r\n      noWrap={noWrap}\r\n    >\r\n      <Input\r\n        {...restInputProperties}\r\n        {...inputProps}\r\n        controlSize=\"full-width\"\r\n        align={!isTextSchemaProp ? \"right\" : \"left\"}\r\n        withBorder={isTextSchemaProp}\r\n      />\r\n    </FieldMetaWrapper>\r\n  );\r\n}\r\n\r\nexport const TextFieldPlugin = {\r\n  name: \"text\",\r\n  Component: TextField,\r\n  parse,\r\n};\r\n","import { wrapFieldsWithMeta } from \"./wrapFieldWithMeta\";\r\nimport { Toggle } from \"../components\";\r\n\r\nconst ToggleField = wrapFieldsWithMeta(Toggle);\r\n\r\nexport const ToggleFieldPlugin = {\r\n  name: \"toggle\",\r\n  type: \"checkbox\",\r\n  Component: ToggleField,\r\n};\r\n","import {\r\n  TokenValue as CoreTokenValue,\r\n  Field,\r\n  NonNullish,\r\n  ThemeFont,\r\n  ThemeTokenValue,\r\n  TokenTypeWidgetComponentProps,\r\n  getDevicesWidths,\r\n  isTrulyResponsiveValue,\r\n  responsiveValueFill,\r\n  responsiveValueForceGet,\r\n  responsiveValueGetDefinedValue,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  Colors,\r\n  Input,\r\n  Select,\r\n  SelectItem,\r\n  SelectSeparator,\r\n} from \"@redsun-vn/easyblocks-design-system\";\r\nimport React, {\r\n  ComponentType,\r\n  Fragment,\r\n  ReactNode,\r\n  forwardRef,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { FieldRenderProps } from \"react-final-form\";\r\nimport { styled } from \"styled-components\";\r\nimport { EditorContextType, useEditorContext } from \"../../../../EditorContext\";\r\nimport { FieldMixedValue } from \"../../../../types\";\r\nimport { MIXED_VALUE } from \"../../components/constants\";\r\nimport { isMixedFieldValue } from \"../../components/isMixedFieldValue\";\r\nimport { wrapFieldsWithMeta } from \"../wrapFieldWithMeta\";\r\n\r\ninterface TokenField<TokenValue extends NonNullish = NonNullish> extends Field {\r\n  tokens: { [key: string]: ThemeTokenValue<TokenValue> };\r\n  normalizeCustomValue?: (value: string) => any;\r\n  allowCustom?: boolean;\r\n  extraValues?: Array<string | { value: string; label: string }>;\r\n}\r\n\r\ninterface TokenFieldProps<TokenValue extends NonNullish>\r\n  extends FieldRenderProps<\r\n    CoreTokenValue | FieldMixedValue,\r\n    HTMLSelectElement\r\n  > {\r\n  field: TokenField<TokenValue>;\r\n}\r\n\r\nconst CUSTOM_OPTION_VALUE = \"__custom__\";\r\n\r\nfunction extraValuesIncludes(\r\n  extraValues: Array<string | { value: string; label: string }>,\r\n  value: string\r\n) {\r\n  for (let i = 0; i < extraValues.length; i++) {\r\n    const extraValue = extraValues[i];\r\n    if (typeof extraValue === \"string\") {\r\n      if (extraValue === value) {\r\n        return true;\r\n      }\r\n    } else {\r\n      if (extraValue.value === value) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\ntype TokenTypesResult = Record<\r\n  string,\r\n  Extract<EditorContextType[\"types\"][string], { type: \"token\" }>\r\n>;\r\n\r\nfunction useTokenTypes(): TokenTypesResult {\r\n  const editorContext = useEditorContext();\r\n\r\n  const tokenTypes = Object.fromEntries(\r\n    Object.entries(editorContext.types).filter<\r\n      [string, TokenTypesResult[string]]\r\n    >(\r\n      (\r\n        typeDefinitionEntry\r\n      ): typeDefinitionEntry is [string, TokenTypesResult[string]] => {\r\n        return typeDefinitionEntry[1].type === \"token\";\r\n      }\r\n    )\r\n  );\r\n\r\n  return tokenTypes;\r\n}\r\n\r\nfunction TokenFieldComponent<TokenValue extends NonNullish>({\r\n  input,\r\n  field,\r\n}: TokenFieldProps<TokenValue>) {\r\n  const editorContext = useEditorContext();\r\n  const tokenTypes = useTokenTypes();\r\n  const tokenTypeDefinition = tokenTypes[field.schemaProp.type];\r\n  const normalizeCustomValue = field.normalizeCustomValue || ((x: string) => x);\r\n  const allowCustom = field.allowCustom ?? false;\r\n  const extraValues = field.extraValues ?? [];\r\n\r\n  const [inputValue, setInputValue] = useState(\r\n    isMixedFieldValue(input.value) ? \"\" : input.value?.value.toString() ?? \"\"\r\n  );\r\n\r\n  const customValueTextFieldRef = useRef<HTMLInputElement | null>(null);\r\n\r\n  const options = Object.entries(field.tokens).map(([tokenId, tokenValue]) => {\r\n    if (tokenTypeDefinition.token === \"fonts\") {\r\n      const fontTokenLabel = getFontTokenLabel(\r\n        tokenId,\r\n        tokenValue,\r\n        editorContext\r\n      );\r\n\r\n      return {\r\n        id: tokenId,\r\n        label: fontTokenLabel,\r\n      };\r\n    }\r\n\r\n    return {\r\n      id: tokenId,\r\n      label: tokenValue.label ?? tokenId,\r\n    };\r\n  });\r\n\r\n  // Extra values are displayed in select\r\n  if (field.extraValues) {\r\n    field.extraValues.forEach((extraValue) => {\r\n      if (typeof extraValue === \"string\") {\r\n        options.push({\r\n          id: extraValue,\r\n          label: extraValue,\r\n        });\r\n      } else {\r\n        options.push({\r\n          id: extraValue.value,\r\n          label: extraValue.label,\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  // If token exist but is removed from a theme -> let's add special option for this\r\n  if (\r\n    !isMixedFieldValue(input.value) &&\r\n    typeof input.value.tokenId === \"string\" &&\r\n    !field.tokens[input.value.tokenId]\r\n  ) {\r\n    options.unshift({\r\n      id: input.value.tokenId,\r\n      label: `(removed) ${input.value.tokenId}`,\r\n    });\r\n  }\r\n\r\n  const isExtraValueSelected =\r\n    !isMixedFieldValue(input.value) &&\r\n    !input.value.tokenId &&\r\n    extraValuesIncludes(\r\n      extraValues,\r\n      responsiveValueGetDefinedValue(\r\n        input.value.value,\r\n        editorContext.breakpointIndex,\r\n        editorContext.devices,\r\n        getDevicesWidths(\r\n          editorContext.devices\r\n        ) /** FOR NOW TOKENS ARE RELATIVE TO SCREEN **/\r\n      ) as string\r\n    );\r\n\r\n  const shouldShowCustomValueInput =\r\n    !isMixedFieldValue(input.value) &&\r\n    !(input.value.tokenId || isExtraValueSelected) &&\r\n    allowCustom;\r\n\r\n  const selectValue = isMixedFieldValue(input.value)\r\n    ? MIXED_VALUE\r\n    : input.value.tokenId ??\r\n      (isExtraValueSelected\r\n        ? (input.value.value as string)\r\n        : CUSTOM_OPTION_VALUE);\r\n\r\n  const onSelectChange = (selectedValue: string) => {\r\n    if (selectedValue === CUSTOM_OPTION_VALUE) {\r\n      if (isMixedFieldValue(input.value)) {\r\n        input.onChange({\r\n          value: \"\",\r\n          widgetId: tokenTypeDefinition.widget?.id,\r\n        });\r\n        setInputValue(\"\");\r\n        return;\r\n      }\r\n\r\n      let value = input.value.value;\r\n\r\n      // responsive token values are transformed into value from current breakpoint\r\n      if (isTrulyResponsiveValue(value)) {\r\n        value = responsiveValueGetDefinedValue(\r\n          // Not sure about usage of responsiveValueGet without widths\r\n          value,\r\n          editorContext.breakpointIndex,\r\n          editorContext.devices,\r\n          getDevicesWidths(\r\n            editorContext.devices\r\n          ) /** FOR NOW TOKENS ARE RELATIVE TO SCREEN **/\r\n        ) as string;\r\n      }\r\n\r\n      input.onChange({\r\n        value,\r\n        widgetId: input.value.widgetId,\r\n      });\r\n      setInputValue(value);\r\n\r\n      queueMicrotask(() => {\r\n        customValueTextFieldRef.current?.focus();\r\n      });\r\n    } else if (extraValuesIncludes(extraValues, selectedValue)) {\r\n      input.onChange({\r\n        value: selectedValue,\r\n        widgetId: tokenTypeDefinition.widget?.id,\r\n      });\r\n    } else {\r\n      input.onChange({\r\n        tokenId: selectedValue,\r\n        value: field.tokens[selectedValue].value,\r\n        widgetId: tokenTypeDefinition.widget?.id,\r\n      });\r\n    }\r\n  };\r\n\r\n  const CustomInputWidgetComponent = tokenTypeDefinition?.widget?.component as\r\n    | ComponentType<TokenTypeWidgetComponentProps<string>>\r\n    | undefined;\r\n\r\n  const customInputElement = shouldShowCustomValueInput ? (\r\n    <div>\r\n      <div style={{ height: 4 }} />\r\n      {CustomInputWidgetComponent ? (\r\n        <CustomInputWidgetComponent\r\n          value={inputValue}\r\n          onChange={(value) => {\r\n            input.onChange({\r\n              value,\r\n              widgetId: tokenTypeDefinition.widget?.id,\r\n            });\r\n          }}\r\n          params={\r\n            \"params\" in field.schemaProp ? field.schemaProp.params : undefined\r\n          }\r\n        />\r\n      ) : (\r\n        <Input\r\n          value={inputValue}\r\n          onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\r\n            setInputValue(e.target.value);\r\n          }}\r\n          onBlur={() => {\r\n            const normalizedValue = normalizeCustomValue(inputValue);\r\n            setInputValue(normalizedValue);\r\n            input.onChange({\r\n              value: normalizedValue,\r\n            });\r\n          }}\r\n          ref={customValueTextFieldRef}\r\n          align={\"right\"}\r\n        />\r\n      )}\r\n    </div>\r\n  ) : null;\r\n\r\n  if (tokenTypeDefinition.token === \"colors\") {\r\n    return (\r\n      <Fragment>\r\n        <Select value={selectValue} onChange={onSelectChange}>\r\n          {isMixedFieldValue(input.value) && (\r\n            <>\r\n              <SelectColorTokenItem value={MIXED_VALUE} isDisabled>\r\n                Mixed\r\n              </SelectColorTokenItem>\r\n              <SelectSeparator />\r\n            </>\r\n          )}\r\n          {\r\n            <Fragment>\r\n              {options.map((o) => {\r\n                return (\r\n                  <SelectColorTokenItem\r\n                    key={o.id}\r\n                    value={o.id}\r\n                    // Color tokens are always strings\r\n                    previewColor={\r\n                      (field.tokens[o.id]?.value as unknown as\r\n                        | string\r\n                        | undefined) ?? o.id\r\n                    }\r\n                  >\r\n                    {o.label}\r\n                  </SelectColorTokenItem>\r\n                );\r\n              })}\r\n              {allowCustom && (\r\n                <>\r\n                  <SelectSeparator />\r\n                  <SelectColorTokenItem\r\n                    value={CUSTOM_OPTION_VALUE}\r\n                    previewColor={\r\n                      selectValue === CUSTOM_OPTION_VALUE\r\n                        ? ((\r\n                            input.value as Exclude<\r\n                              (typeof input)[\"value\"],\r\n                              FieldMixedValue\r\n                            >\r\n                          ).value as string)\r\n                        : undefined\r\n                    }\r\n                  >\r\n                    Custom\r\n                  </SelectColorTokenItem>\r\n                </>\r\n              )}\r\n            </Fragment>\r\n          }\r\n        </Select>\r\n        {customInputElement}\r\n      </Fragment>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Root>\r\n      <Select value={selectValue} onChange={onSelectChange}>\r\n        {isMixedFieldValue(input.value) && (\r\n          <>\r\n            <SelectItem value={MIXED_VALUE} isDisabled>\r\n              Mixed\r\n            </SelectItem>\r\n            <SelectSeparator />\r\n          </>\r\n        )}\r\n\r\n        {selectValue === CUSTOM_OPTION_VALUE && !allowCustom && (\r\n          <>\r\n            <SelectItem value={CUSTOM_OPTION_VALUE} isDisabled>\r\n              Custom\r\n            </SelectItem>\r\n            <SelectSeparator />\r\n          </>\r\n        )}\r\n        {\r\n          <Fragment>\r\n            {options.map((o) => {\r\n              return (\r\n                <SelectItem key={o.id} value={o.id}>\r\n                  {o.label}\r\n                </SelectItem>\r\n              );\r\n            })}\r\n            {allowCustom && (\r\n              <>\r\n                <SelectSeparator />\r\n                <SelectItem value={CUSTOM_OPTION_VALUE}>Custom</SelectItem>\r\n              </>\r\n            )}\r\n          </Fragment>\r\n        }\r\n      </Select>\r\n      {customInputElement}\r\n    </Root>\r\n  );\r\n}\r\n\r\nfunction getFontTokenLabel(\r\n  name: string,\r\n  token: ThemeTokenValue<ThemeFont>,\r\n  editorContext: EditorContextType\r\n) {\r\n  const filledResponsiveFontValue = responsiveValueFill(\r\n    token.value,\r\n    editorContext.devices,\r\n    getDevicesWidths(editorContext.devices)\r\n  );\r\n\r\n  const currentDeviceFontValue = responsiveValueForceGet(\r\n    filledResponsiveFontValue,\r\n    editorContext.breakpointIndex\r\n  );\r\n\r\n  if (isValidFontTokenValue(currentDeviceFontValue)) {\r\n    return `${token.label ?? name} (${stripPxUnit(\r\n      currentDeviceFontValue.fontSize\r\n    )}/${stripPxUnit(currentDeviceFontValue.lineHeight)})`;\r\n  }\r\n\r\n  return token.label ?? name;\r\n}\r\n\r\nfunction stripPxUnit(value: number | string) {\r\n  if (typeof value === \"number\") {\r\n    return value;\r\n  }\r\n\r\n  return value.replace(new RegExp(\"px\"), \"\");\r\n}\r\n\r\nfunction isValidFontTokenValue(value: unknown): value is {\r\n  fontSize: number | string;\r\n  lineHeight: number | string;\r\n} {\r\n  return (\r\n    typeof value === \"object\" &&\r\n    value !== null &&\r\n    \"fontSize\" in value &&\r\n    \"lineHeight\" in value\r\n  );\r\n}\r\n\r\nconst Root = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: flex-end;\r\n`;\r\n\r\nexport const TokenFieldPlugin = {\r\n  name: \"token\",\r\n  type: \"token\",\r\n  Component: wrapFieldsWithMeta(TokenFieldComponent),\r\n};\r\n\r\nconst SelectColorTokenItem = forwardRef<\r\n  HTMLDivElement,\r\n  {\r\n    children: ReactNode;\r\n    previewColor?: string;\r\n    value: string;\r\n    isDisabled?: boolean;\r\n  }\r\n>((props, ref) => {\r\n  return (\r\n    <SelectItem value={props.value} isDisabled={props.isDisabled} ref={ref}>\r\n      <span\r\n        style={{\r\n          display: \"flex\",\r\n          alignItems: \"center\",\r\n          gap: \"6px\",\r\n        }}\r\n      >\r\n        <svg\r\n          xmlns=\"http://www.w3.org/2000/svg\"\r\n          width=\"15\"\r\n          height=\"16\"\r\n          viewBox=\"0 0 15 16\"\r\n          fill=\"none\"\r\n        >\r\n          <circle\r\n            cx=\"7.28931\"\r\n            cy=\"8.00024\"\r\n            r=\"6.78931\"\r\n            fill={props.previewColor ?? \"#fff\"}\r\n            stroke={Colors.black100}\r\n          />\r\n        </svg>\r\n        <span>{props.children}</span>\r\n      </span>\r\n    </SelectItem>\r\n  );\r\n});\r\n","const RICH_TEXT_PART_CONFIG_PATH_REGEXP =\r\n  /\\.elements\\.[a-z(\\-_A-Z)?]+\\.\\d+(\\.elements\\.\\d+){2,3}(\\.\\{\\d+,\\d+\\})?$/;\r\n\r\nfunction isConfigPathRichTextPart(configPath: string): boolean {\r\n  return RICH_TEXT_PART_CONFIG_PATH_REGEXP.test(configPath);\r\n}\r\n\r\nexport { isConfigPathRichTextPart, RICH_TEXT_PART_CONFIG_PATH_REGEXP };\r\n","/**\r\n *\r\n * @param collection Array of values\r\n * @param mapper Optional callback function that will be invoked for each item of given array to map it into comparable string\r\n */\r\nfunction getUniqueValues<\r\n  Collection extends Array<any>,\r\n  Item extends Collection[number]\r\n>(\r\n  collection: Collection,\r\n  mapper?: (item: Item, index: number) => string | undefined\r\n): Array<Item> {\r\n  if (mapper) {\r\n    const uniqueValues = new Set<string | undefined>();\r\n    const uniqueItems: Array<Item> = [];\r\n\r\n    collection.forEach((item, index) => {\r\n      const mappedItem = mapper(item, index);\r\n\r\n      if (!uniqueValues.has(mappedItem)) {\r\n        uniqueValues.add(mappedItem);\r\n        uniqueItems.push(item);\r\n      }\r\n    });\r\n\r\n    return uniqueItems;\r\n  }\r\n\r\n  return Array.from(new Set(collection));\r\n}\r\n\r\nexport { getUniqueValues };\r\n","import { SchemaProp } from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  InternalComponentDefinition,\r\n  InternalField,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { last } from \"@/utils\";\r\nimport { getUniqueValues } from \"../../fields/components/getUniqueValues\";\r\n\r\nexport interface MergeCommonFieldsParameters {\r\n  fields: Array<Array<InternalField>>;\r\n}\r\n\r\nfunction mergeCommonFields({\r\n  fields,\r\n}: MergeCommonFieldsParameters): Array<InternalField> {\r\n  const mergedCommonFields: Array<InternalField> = [];\r\n  const fieldsGroupedByProperty = groupFieldsByPropertyName(fields.flat());\r\n\r\n  for (const currentFields of Object.values(fieldsGroupedByProperty)) {\r\n    if (currentFields.length < fields.length) {\r\n      continue;\r\n    }\r\n\r\n    /**\r\n     * Some fields can be hidden depending on the context of usage\r\n     * ex. margin bottom is not applicable to the last element in stack\r\n     */\r\n    const visibleFields = currentFields.filter((field) => {\r\n      return !field.hidden;\r\n    });\r\n\r\n    if (visibleFields.length === 0) {\r\n      continue;\r\n    }\r\n\r\n    const fieldDefinitionIds = visibleFields.map(\r\n      (field) => getFieldSchemaWithDefinition(field).definition.id\r\n    );\r\n\r\n    /**\r\n     * All fields for given property have to be defined within the same schema, because ex.\r\n     * field can have the same prop name in schema A, but different meaning in schema B\r\n     */\r\n    const uniqueDefinitionIds = getUniqueValues(fieldDefinitionIds);\r\n\r\n    // It's common when interacting with $richText to pass fields of parent or ancestor down to @easyblocks/rich-text-part.\r\n    // Verify if the all unique ids aren't fields of $richText components.\r\n    if (\r\n      uniqueDefinitionIds.length > 1 &&\r\n      !uniqueDefinitionIds.every((id) => id.startsWith(\"@easyblocks/rich-text\"))\r\n    ) {\r\n      continue;\r\n    }\r\n\r\n    const firstVisibleField = visibleFields[0];\r\n\r\n    mergedCommonFields.push({\r\n      ...firstVisibleField,\r\n      name:\r\n        visibleFields.length === 1\r\n          ? firstVisibleField.name\r\n          : getUniqueValues(visibleFields.flatMap((field) => field.name)),\r\n    });\r\n  }\r\n\r\n  return mergedCommonFields;\r\n}\r\n\r\nfunction groupFieldsByPropertyName(\r\n  fields: Array<InternalField>\r\n): Record<string, Array<InternalField>> {\r\n  return fields.reduce((repeatedFields, field) => {\r\n    const currentFieldPropertyName = getPropertyName(field.schemaProp.prop);\r\n    const fields = repeatedFields[currentFieldPropertyName];\r\n    repeatedFields[currentFieldPropertyName] =\r\n      fields !== undefined ? [...fields, field] : [field];\r\n    return repeatedFields;\r\n  }, {} as Record<string, Array<InternalField>>);\r\n}\r\n\r\nfunction getPropertyName(fieldName: string): string {\r\n  const fieldNameParts = fieldName.split(\".\");\r\n  let lastPart = last(fieldNameParts);\r\n\r\n  // If property name starts with `$` sign it's a special property of fake field.\r\n  if (lastPart.startsWith(\"$\")) {\r\n    lastPart = lastPart.slice(1);\r\n  }\r\n\r\n  if (fieldNameParts[0] === \"$previous\") {\r\n    return `${fieldNameParts[0]}.${lastPart}`;\r\n  }\r\n\r\n  return lastPart;\r\n}\r\n\r\nfunction getFieldSchemaWithDefinition(field: InternalField): SchemaProp & {\r\n  definition: InternalComponentDefinition;\r\n} {\r\n  return field.schemaProp as SchemaProp & {\r\n    definition: InternalComponentDefinition;\r\n  };\r\n}\r\n\r\nexport { mergeCommonFields };\r\n","import {\r\n  NoCodeComponentEntry,\r\n  ComponentSchemaProp,\r\n  ExternalData,\r\n  ExternalReference,\r\n  LocalTextReference,\r\n  NoCodeComponentDefinition,\r\n  SidebarPreviewVariant,\r\n  resolveExternalValue,\r\n  resolveLocalisedValue,\r\n  responsiveValueForceGet,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  Component$$$SchemaProp,\r\n  InternalField,\r\n  findComponentDefinition,\r\n  isExternalSchemaProp,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport {\r\n  ButtonGhost,\r\n  Colors,\r\n  Fonts,\r\n  Icons,\r\n  ThumbnailButton,\r\n  ThumbnailType,\r\n  Typography,\r\n} from \"@redsun-vn/easyblocks-design-system\";\r\nimport { dotNotationGet, toArray } from \"@/utils\";\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport { styled, css, keyframes } from \"styled-components\";\r\nimport { useConfigAfterAuto } from \"../../../ConfigAfterAutoContext\";\r\nimport { EditorContextType, useEditorContext } from \"../../../EditorContext\";\r\nimport { useEditorExternalData } from \"../../../EditorExternalDataProvider\";\r\nimport { SidebarFooter } from \"../../../SidebarFooter\";\r\nimport { buildTinaFields } from \"../../../buildTinaFields\";\r\nimport { FieldMixedValue } from \"../../../types\";\r\nimport { isConfigPathRichTextPart } from \"../../../utils/isConfigPathRichTextPart\";\r\nimport { FieldRenderProps, FieldsBuilder } from \"../../form-builder\";\r\nimport { mergeCommonFields } from \"../../form-builder/utils/mergeCommonFields\";\r\nimport { isMixedFieldValue } from \"../components/isMixedFieldValue\";\r\nimport { Form } from \"../../../form\";\r\nimport { FormApi } from \"final-form\";\r\n\r\ninterface BlocksFieldDefinition extends InternalField {\r\n  component: \"block\";\r\n  schemaProp: ComponentSchemaProp | Component$$$SchemaProp;\r\n}\r\n\r\ninterface BlockFieldProps\r\n  extends FieldRenderProps<NoCodeComponentEntry[] | FieldMixedValue> {\r\n  field: BlocksFieldDefinition;\r\n  form: FormApi;\r\n  tinaForm: Form;\r\n  isLabelHidden?: boolean;\r\n}\r\n\r\nconst BlockField = ({ field, input, isLabelHidden }: BlockFieldProps) => {\r\n  const [isSubcomponentPanelExpanded, setIsSubcomponentPanelExpanded] =\r\n    React.useState(false);\r\n  const editorContext = useEditorContext();\r\n  const { actions } = editorContext;\r\n  const { openComponentPicker } = actions;\r\n  const isMixed = isMixedFieldValue(input.value);\r\n\r\n  const config: NoCodeComponentEntry | null = (() => {\r\n    if (isMixed) {\r\n      return null;\r\n    }\r\n\r\n    // @ts-expect-error We can safely ignore the error since we know the value is not mixed\r\n    return input.value[0] || null;\r\n  })();\r\n\r\n  const normalizedName = toArray(field.name);\r\n  // Let's create paths\r\n  const paths = normalizedName.map((x) => `${x}.0`);\r\n  const componentPickerPath = normalizedName[0];\r\n\r\n  return (\r\n    <>\r\n      {!isLabelHidden && (\r\n        <div\r\n          style={{\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n            padding: \"4px 16px\",\r\n            minHeight: \"28px\",\r\n          }}\r\n        >\r\n          <Typography>{field.label || field.name}</Typography>\r\n        </div>\r\n      )}\r\n      <div\r\n        style={{\r\n          display: \"flex\",\r\n          justifyContent: \"space-between\",\r\n          alignItems: \"center\",\r\n          padding: \"4px 16px\",\r\n        }}\r\n      >\r\n        {config !== null && (\r\n          <>\r\n            <div style={{ flex: \"1 1 auto\", minWidth: 0 }}>\r\n              <SubComponentPanelButton\r\n                paths={paths}\r\n                isExpanded={isSubcomponentPanelExpanded}\r\n                onExpand={() => {\r\n                  setIsSubcomponentPanelExpanded(true);\r\n                }}\r\n                onCollapse={() => {\r\n                  setIsSubcomponentPanelExpanded(false);\r\n                }}\r\n              />\r\n            </div>\r\n            {!field.schemaProp.required && (\r\n              <div style={{ flex: \"0 0 auto\", minWidth: 0 }}>\r\n                <ButtonGhost\r\n                  onClick={() => {\r\n                    if (\r\n                      editorContext.focussedField.some(isConfigPathRichTextPart)\r\n                    ) {\r\n                      input.onChange([]);\r\n                    } else {\r\n                      actions.removeItems(paths);\r\n                    }\r\n                  }}\r\n                  icon={Icons.Remove}\r\n                  aria-label=\"Remove\"\r\n                />\r\n              </div>\r\n            )}\r\n          </>\r\n        )}\r\n\r\n        {config === null &&\r\n          (isMixed ? (\r\n            <ThumbnailButton label={\"Mixed\"} disabled={true} />\r\n          ) : (\r\n            <AddButton\r\n              onAdd={() => {\r\n                openComponentPicker({ path: componentPickerPath }).then(\r\n                  (newConfig) => {\r\n                    if (newConfig) {\r\n                      if (\r\n                        editorContext.focussedField.some(\r\n                          isConfigPathRichTextPart\r\n                        )\r\n                      ) {\r\n                        input.onChange([newConfig]);\r\n                      } else {\r\n                        actions.replaceItems(paths, newConfig);\r\n                      }\r\n\r\n                      setIsSubcomponentPanelExpanded(true);\r\n                    }\r\n                  }\r\n                );\r\n              }}\r\n            />\r\n          ))}\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\ninterface AddButtonProps {\r\n  onAdd: () => void;\r\n}\r\n\r\nfunction AddButton({ onAdd }: AddButtonProps) {\r\n  return (\r\n    <ButtonGhost\r\n      style={{\r\n        width: \"100%\",\r\n        paddingLeft: \"0\",\r\n      }}\r\n      onClick={onAdd}\r\n      height={\"32px\"}\r\n      noPadding\r\n    >\r\n      <div\r\n        style={{\r\n          display: \"flex\",\r\n          alignItems: \"center\",\r\n          gap: \"8px\",\r\n          width: \"100%\",\r\n        }}\r\n      >\r\n        <div\r\n          style={{\r\n            display: \"grid\",\r\n            placeItems: \"center\",\r\n            width: \"32px\",\r\n            height: \"32px\",\r\n            marginLeft: \"-1px\",\r\n            border: `1px dashed ${Colors.black20}`,\r\n            borderRadius: \"2px\",\r\n          }}\r\n        >\r\n          <Icons.Add size={16} />\r\n        </div>\r\n        Add\r\n      </div>\r\n    </ButtonGhost>\r\n  );\r\n}\r\n\r\ninterface SubComponentPanelButtonProps {\r\n  paths: string[];\r\n  isExpanded: boolean;\r\n  onExpand: () => void;\r\n  onCollapse: () => void;\r\n}\r\n\r\nconst SubComponentPanelButton = ({\r\n  paths,\r\n  isExpanded,\r\n  onExpand,\r\n  onCollapse,\r\n}: SubComponentPanelButtonProps) => {\r\n  const sidebarPanelsRoot = document.getElementById(\"sidebar-panels-root\");\r\n  const editorContext = useEditorContext();\r\n  const externalData = useEditorExternalData();\r\n  const entryAfterAuto = useConfigAfterAuto();\r\n\r\n  const config = dotNotationGet(editorContext.form.values, paths[0]);\r\n  const componentDefinition = findComponentDefinition(config, editorContext);\r\n  const label =\r\n    componentDefinition?.label ??\r\n    componentDefinition?.id ??\r\n    `Cant find custom component with id: ${config._component} in your project. Please contact your developers to resolve this issue.`;\r\n  const showError = componentDefinition === undefined;\r\n\r\n  const sidebarPreview = componentDefinition\r\n    ? getSidebarPreview(\r\n        componentDefinition,\r\n        dotNotationGet(entryAfterAuto, paths[0]),\r\n        externalData,\r\n        editorContext\r\n      )\r\n    : undefined;\r\n\r\n  const defaultThumbnail: ThumbnailType | undefined =\r\n    componentDefinition?.thumbnail\r\n      ? { type: \"image\", src: componentDefinition.thumbnail }\r\n      : undefined;\r\n  const thumbnail: ThumbnailType | undefined =\r\n    sidebarPreview?.thumbnail ?? defaultThumbnail;\r\n  const description: string | undefined = sidebarPreview?.description;\r\n\r\n  return showError ? (\r\n    <Error>{label}</Error>\r\n  ) : (\r\n    <>\r\n      <ThumbnailButton\r\n        onClick={onExpand}\r\n        label={label}\r\n        description={description}\r\n        thumbnail={thumbnail}\r\n      />\r\n\r\n      {sidebarPanelsRoot &&\r\n        ReactDOM.createPortal(\r\n          <Panel\r\n            isExpanded={isExpanded}\r\n            onCollapse={onCollapse}\r\n            paths={paths}\r\n          />,\r\n          sidebarPanelsRoot\r\n        )}\r\n    </>\r\n  );\r\n};\r\n\r\nfunction getSidebarPreview(\r\n  componentDefinition: NoCodeComponentDefinition,\r\n  entryAfterAuto: NoCodeComponentEntry,\r\n  externalData: ExternalData,\r\n  editorContext: EditorContextType\r\n): SidebarPreviewVariant | undefined {\r\n  const previewValues = Object.fromEntries(\r\n    componentDefinition.schema.map((s) => {\r\n      const value = responsiveValueForceGet(\r\n        entryAfterAuto[s.prop],\r\n        editorContext.breakpointIndex\r\n      );\r\n\r\n      if (isExternalSchemaProp(s, editorContext.types)) {\r\n        const externalDataValue = resolveExternalValue(\r\n          value as ExternalReference,\r\n          entryAfterAuto._id,\r\n          s,\r\n          externalData\r\n        );\r\n        return [s.prop, externalDataValue];\r\n      }\r\n\r\n      if (s.type === \"text\") {\r\n        return [\r\n          s.prop,\r\n          resolveLocalisedValue<string>(\r\n            (value as LocalTextReference).value,\r\n            editorContext\r\n          )?.value,\r\n        ];\r\n      }\r\n\r\n      return [s.prop, value];\r\n    })\r\n  );\r\n\r\n  return componentDefinition.preview?.({ values: previewValues, externalData });\r\n}\r\n\r\nconst Error = styled.div`\r\n  ${Fonts.body}\r\n  padding: 7px 6px 7px;\r\n  color: hsl(0deg 0% 50% / 0.8);\r\n  white-space: normal;\r\n  background: hsl(0deg 100% 50% / 0.2);\r\n  margin-right: 10px;\r\n  border-radius: 2px;\r\n`;\r\n\r\ninterface PanelProps {\r\n  onCollapse(): void;\r\n  isExpanded: boolean;\r\n  paths: string[];\r\n}\r\n\r\nexport const PanelContext = React.createContext<\r\n  { onClose: () => void } | undefined\r\n>(undefined);\r\n\r\nfunction Panel({ onCollapse, isExpanded, paths }: PanelProps) {\r\n  const editorContext = useEditorContext();\r\n\r\n  const fields: Array<InternalField> = React.useMemo(() => {\r\n    if (!isExpanded) {\r\n      return [];\r\n    }\r\n\r\n    const fieldsPerName = toArray(paths).map((path) => {\r\n      return buildTinaFields(path, editorContext);\r\n    });\r\n\r\n    const mergedFields = mergeCommonFields({\r\n      fields: fieldsPerName,\r\n    });\r\n\r\n    return mergedFields;\r\n  }, [isExpanded, paths]);\r\n\r\n  return (\r\n    <PanelContext.Provider\r\n      value={{\r\n        onClose: onCollapse,\r\n      }}\r\n    >\r\n      <GroupPanel isExpanded={isExpanded}>\r\n        <PanelBody>\r\n          {isExpanded ? (\r\n            <div>\r\n              <FieldsBuilder form={editorContext.form} fields={fields} />\r\n              <SidebarFooter paths={paths} />\r\n            </div>\r\n          ) : null}\r\n        </PanelBody>\r\n      </GroupPanel>\r\n    </PanelContext.Provider>\r\n  );\r\n}\r\n\r\nexport const BlockFieldPlugin = {\r\n  __type: \"field\",\r\n  name: \"block\",\r\n  Component: BlockField,\r\n};\r\n\r\nconst PanelBody = styled.div`\r\n  background: white;\r\n  position: relative;\r\n  height: 100%;\r\n  overflow-y: auto;\r\n`;\r\n\r\nconst GroupPanelKeyframes = keyframes`\r\n  0% {\r\n    transform: translate3d( 100%, 0, 0 );\r\n  }\r\n  100% {\r\n    transform: translate3d( 0, 0, 0 );\r\n  }\r\n`;\r\n\r\nconst GroupPanel = styled.div<{ isExpanded: boolean }>`\r\n  position: absolute;\r\n  width: 100%;\r\n  top: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  overflow: hidden;\r\n  /* z-index: var(--tina-z-index-1); */\r\n  pointer-events: ${(p) => (p.isExpanded ? \"all\" : \"none\")};\r\n\r\n  > * {\r\n    ${(p) =>\r\n      p.isExpanded &&\r\n      css`\r\n        animation-name: ${GroupPanelKeyframes};\r\n        animation-duration: 150ms;\r\n        animation-delay: 0ms;\r\n        animation-iteration-count: 1;\r\n        animation-timing-function: ease-out;\r\n        animation-fill-mode: backwards;\r\n      `};\r\n\r\n    ${(p) =>\r\n      !p.isExpanded &&\r\n      css`\r\n        transition: transform 150ms ease-out;\r\n        transform: translate3d(100%, 0, 0);\r\n      `};\r\n  }\r\n`;\r\n","import {\r\n  ComponentSchemaProp,\r\n  Field,\r\n  NoCodeComponentEntry,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  findComponentDefinitionById,\r\n  parsePath,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport {\r\n  ButtonGhost,\r\n  Icons,\r\n  Typography,\r\n} from \"@redsun-vn/easyblocks-design-system\";\r\nimport { toArray } from \"@/utils\";\r\nimport React, { useContext } from \"react\";\r\nimport type { FieldRenderProps } from \"react-final-form\";\r\nimport { css } from \"styled-components\";\r\nimport { useEditorContext } from \"../../../EditorContext\";\r\nimport { isMixedFieldValue } from \"../components/isMixedFieldValue\";\r\nimport { PanelContext } from \"./BlockFieldPlugin\";\r\n\r\ninterface IdentityFieldProps\r\n  extends FieldRenderProps<NoCodeComponentEntry, HTMLElement> {\r\n  field: Field;\r\n}\r\n\r\nfunction IdentityField({ input, field }: IdentityFieldProps) {\r\n  const editorContext = useEditorContext();\r\n  const panelContext = useContext(PanelContext);\r\n\r\n  const isMixed = isMixedFieldValue(input.value);\r\n  const config = isMixed ? null : input.value;\r\n\r\n  if (config == null) {\r\n    return null;\r\n  }\r\n\r\n  const componentDefinition = findComponentDefinitionById(\r\n    config._component,\r\n    editorContext\r\n  );\r\n\r\n  const configPaths = toArray(field.name);\r\n  const { parent } = parsePath(configPaths[0], editorContext.form);\r\n  const isWithinNestedPanel = panelContext !== undefined;\r\n\r\n  const parentComponentDefinition = parent\r\n    ? findComponentDefinitionById(parent.templateId, editorContext)\r\n    : undefined;\r\n  const parentSchemaProp = parentComponentDefinition?.schema.find(\r\n    (schemaProp) => schemaProp.prop === parent!.fieldName\r\n  );\r\n\r\n  const isNonRemovable =\r\n    (componentDefinition?.id.startsWith(\"@easyblocks/rich-text\") &&\r\n      componentDefinition.id !== \"@easyblocks/rich-text\") ||\r\n    (parentSchemaProp\r\n      ? parentSchemaProp.type === \"component\" &&\r\n        (parentSchemaProp as ComponentSchemaProp).required\r\n      : true);\r\n\r\n  const isNonChangable =\r\n    componentDefinition?.id === \"@easyblocks/rich-text-part\" ||\r\n    componentDefinition?.id === editorContext.rootComponent.id;\r\n\r\n  function handleChangeComponentType() {\r\n    if (isNonChangable) {\r\n      return;\r\n    }\r\n\r\n    if (!parent) {\r\n      return;\r\n    }\r\n\r\n    const componentPickerPath = parent.path + \".\" + parent.fieldName;\r\n\r\n    editorContext.actions\r\n      .openComponentPicker({ path: componentPickerPath })\r\n      .then((selectedConfig) => {\r\n        if (!selectedConfig) {\r\n          return;\r\n        }\r\n\r\n        editorContext.actions.replaceItems(configPaths, selectedConfig);\r\n      });\r\n  }\r\n\r\n  function handleRemove() {\r\n    if (isNonRemovable) {\r\n      return;\r\n    }\r\n\r\n    editorContext.actions.removeItems(configPaths);\r\n  }\r\n\r\n  const titleContent = (\r\n    <div\r\n      style={{\r\n        display: \"flex\",\r\n        alignItems: \"center\",\r\n        gap: \"2px\",\r\n      }}\r\n    >\r\n      <Typography\r\n        style={{\r\n          lineHeight: \"14px\",\r\n          fontWeight: \"700\",\r\n        }}\r\n      >\r\n        {componentDefinition?.label ?? componentDefinition?.id}\r\n      </Typography>\r\n      {!isNonChangable && <Icons.ChevronDown size={16} />}\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        display: \"flex\",\r\n        gap: \"8px\",\r\n        minHeight: \"28px\",\r\n        padding: \"10px\",\r\n      }}\r\n    >\r\n      <div\r\n        style={{\r\n          display: \"flex\",\r\n          alignItems: \"center\",\r\n          flex: \"1 0\",\r\n        }}\r\n      >\r\n        {isWithinNestedPanel && (\r\n          <ButtonGhost\r\n            icon={Icons.ChevronLeft}\r\n            onClick={() => {\r\n              panelContext.onClose();\r\n            }}\r\n            style={{\r\n              marginRight: \"auto\",\r\n            }}\r\n          />\r\n        )}\r\n\r\n        {isNonChangable && (\r\n          <div style={{ padding: \"7px 6px\" }}>{titleContent}</div>\r\n        )}\r\n        {!isNonChangable && (\r\n          <ButtonGhost onClick={handleChangeComponentType}>\r\n            {titleContent}\r\n          </ButtonGhost>\r\n        )}\r\n\r\n        <ButtonGhost\r\n          aria-label=\"Remove component\"\r\n          icon={Icons.Remove}\r\n          onClick={handleRemove}\r\n          style={{\r\n            marginLeft: \"auto\",\r\n            opacity: isNonRemovable ? 0 : 1,\r\n            pointerEvents: isNonRemovable ? \"none\" : \"auto\",\r\n          }}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst IdentityFieldPlugin = {\r\n  name: \"identity\",\r\n  Component: IdentityField,\r\n};\r\n\r\nexport { IdentityFieldPlugin };\r\n","import { Typography } from \"@redsun-vn/easyblocks-design-system\";\r\nimport React from \"react\";\r\n\r\nexport function MissingWidget(props: { type: string }) {\r\n  return <Typography>Missing widget for type \"{props.type}\".</Typography>;\r\n}\r\n","import {\r\n  ExternalReference,\r\n  FetchCompoundResourceResultValues,\r\n  getExternalReferenceLocationKey,\r\n  isEmptyExternalReference,\r\n  isIdReferenceToDocumentExternalValue,\r\n  isResolvedCompoundExternalDataValue,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport { Select, SelectItem } from \"@redsun-vn/easyblocks-design-system\";\r\nimport { dotNotationGet, toArray } from \"@/utils\";\r\nimport React, { ComponentType, useLayoutEffect } from \"react\";\r\nimport {\r\n  EditorContextType,\r\n  EditorExternalTypeDefinition,\r\n  useEditorContext,\r\n} from \"../../../../EditorContext\";\r\nimport { useEditorExternalData } from \"../../../../EditorExternalDataProvider\";\r\nimport {\r\n  FieldMixedValue,\r\n  InternalWidgetComponentProps,\r\n} from \"../../../../types\";\r\nimport { FieldRenderProps } from \"../../../form-builder\";\r\nimport { isMixedFieldValue } from \"../../components/isMixedFieldValue\";\r\nimport { MissingWidget } from \"../MissingWidget\";\r\nimport { FieldMetaWrapper } from \"../wrapFieldWithMeta\";\r\n\r\ntype ExternalFieldProps = FieldRenderProps<\r\n  ExternalReference | FieldMixedValue,\r\n  any\r\n>;\r\n\r\nconst ExternalFieldComponent = (props: ExternalFieldProps) => {\r\n  const {\r\n    tinaForm,\r\n    field,\r\n    input,\r\n    input: { value },\r\n  } = props;\r\n  const editorContext = useEditorContext();\r\n  const externalData = useEditorExternalData();\r\n\r\n  const fieldNames = toArray(field.name);\r\n\r\n  const isSchemaPropRootParam = field.schemaProp.type.startsWith(\"param__\");\r\n\r\n  const ExternalField: ComponentType<InternalWidgetComponentProps> | undefined =\r\n    !isMixedFieldValue(input.value)\r\n      ? isSchemaPropRootParam\r\n        ? getWidgetComponentForRootParam(input.value, editorContext)\r\n        : getWidgetComponentByType(\r\n            input.value,\r\n            field.schemaProp.type,\r\n            editorContext\r\n          )\r\n      : undefined;\r\n\r\n  const path = fieldNames[0].split(\".\").slice(0, -1).join(\".\");\r\n  const configId = dotNotationGet(editorContext.form.values, path)._id;\r\n  const externalReferenceLocationKey = getExternalReferenceLocationKey(\r\n    configId,\r\n    field.schemaProp.prop,\r\n    field.schemaProp.responsive ? editorContext.breakpointIndex : undefined\r\n  );\r\n  const externalValue = externalReferenceLocationKey\r\n    ? externalData[externalReferenceLocationKey]\r\n    : undefined;\r\n\r\n  const isExternalValueResolvedCompoundExternalDataValue =\r\n    !isMixedFieldValue(value) &&\r\n    !isEmptyExternalReference(value) &&\r\n    externalValue !== undefined &&\r\n    isResolvedCompoundExternalDataValue(externalValue);\r\n\r\n  const basicResources = isExternalValueResolvedCompoundExternalDataValue\r\n    ? getBasicResourcesOfType(externalValue.value, field.schemaProp.type)\r\n    : [];\r\n\r\n  const isCompoundResourceValueSelectVisible =\r\n    isExternalValueResolvedCompoundExternalDataValue &&\r\n    !isIdReferenceToDocumentExternalValue(value.id) &&\r\n    basicResources.length > 1;\r\n\r\n  useLayoutEffect(() => {\r\n    if (\r\n      isExternalValueResolvedCompoundExternalDataValue &&\r\n      basicResources.length === 1 &&\r\n      !value.key\r\n    ) {\r\n      // We perform form change manually to avoid storing this change in editor's history\r\n      editorContext.form.change(fieldNames[0], {\r\n        ...value,\r\n        key: basicResources[0].key,\r\n      });\r\n    }\r\n  });\r\n\r\n  return (\r\n    <FieldMetaWrapper {...props} form={tinaForm} layout=\"column\">\r\n      <div\r\n        style={{\r\n          width: \"100%\",\r\n        }}\r\n      >\r\n        {isMixedFieldValue(value) ? (\r\n          \"Mixed\"\r\n        ) : (\r\n          <div\r\n            style={{\r\n              display: \"flex\",\r\n              flexDirection: \"column\",\r\n              alignItems: \"flex-start\",\r\n              gap: \"8px\",\r\n            }}\r\n          >\r\n            {ExternalField ? (\r\n              <ExternalField\r\n                id={value.id}\r\n                resourceKey={\"key\" in value ? value.key : undefined}\r\n                onChange={(newId, newKey) => {\r\n                  const newValue: ExternalReference = {\r\n                    id: newId,\r\n                    widgetId: value.widgetId,\r\n                  };\r\n\r\n                  if (newKey && newValue.id !== null) {\r\n                    newValue.key = newKey;\r\n                  }\r\n\r\n                  input.onChange(newValue);\r\n                }}\r\n                path={fieldNames[0]}\r\n                params={field.schemaProp.params}\r\n              />\r\n            ) : (\r\n              <MissingWidget type={field.schemaProp.type} />\r\n            )}\r\n\r\n            {isCompoundResourceValueSelectVisible && (\r\n              <CompoundResourceValueSelect\r\n                options={basicResources.map((r) => ({\r\n                  id: externalReferenceLocationKey,\r\n                  key: r.key,\r\n                  label: r.label ?? r.key,\r\n                }))}\r\n                resource={{\r\n                  id: externalReferenceLocationKey,\r\n                  key: value.key,\r\n                }}\r\n                onResourceKeyChange={(_, key) => {\r\n                  input.onChange({\r\n                    ...value,\r\n                    key,\r\n                  });\r\n                }}\r\n              />\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </FieldMetaWrapper>\r\n  );\r\n};\r\n\r\nexport const ExternalFieldPlugin = {\r\n  name: \"external\",\r\n  Component: ExternalFieldComponent,\r\n};\r\n\r\nfunction getWidgetComponentByType(\r\n  externalReference: ExternalReference,\r\n  type: string,\r\n  editorContext: EditorContextType\r\n) {\r\n  return (\r\n    editorContext.types[type] as EditorExternalTypeDefinition\r\n  ).widgets.find((w) => w.id === externalReference.widgetId)?.component;\r\n}\r\n\r\nfunction getWidgetComponentForRootParam(\r\n  externalReference: ExternalReference,\r\n  editorContext: EditorContextType\r\n) {\r\n  return Object.values(editorContext.types)\r\n    .filter((t): t is EditorExternalTypeDefinition => t.type === \"external\")\r\n    .flatMap((t) => t.widgets)\r\n    .find((w) => w.id === externalReference.widgetId)?.component;\r\n}\r\n\r\nexport function getBasicResourcesOfType(\r\n  compoundResourceValues: FetchCompoundResourceResultValues,\r\n  type: string\r\n) {\r\n  return Object.entries(compoundResourceValues)\r\n    .filter(([, r]) => r.type === type)\r\n    .map(([key, r]) => {\r\n      return {\r\n        key,\r\n        ...r,\r\n      };\r\n    });\r\n}\r\n\r\nexport function CompoundResourceValueSelect(props: {\r\n  options: Array<{ id: string; key: string; label: string }>;\r\n  resource:\r\n    | { id: null; key: undefined }\r\n    | { id: string; key: string | undefined };\r\n  onResourceKeyChange: (id: string, key: string) => void;\r\n}) {\r\n  return (\r\n    <Select\r\n      onChange={(value) => {\r\n        const selectedOption = JSON.parse(value);\r\n        props.onResourceKeyChange(selectedOption.id, selectedOption.key);\r\n      }}\r\n      value={\r\n        props.resource.id !== null && props.resource.key !== undefined\r\n          ? JSON.stringify({ id: props.resource.id, key: props.resource.key })\r\n          : \"\"\r\n      }\r\n      placeholder=\"Select source...\"\r\n    >\r\n      {props.options.map((r) => {\r\n        return (\r\n          <SelectItem\r\n            key={`${r.id}.${r.key}`}\r\n            value={JSON.stringify({ id: r.id, key: r.key })}\r\n          >\r\n            {r.label}\r\n          </SelectItem>\r\n        );\r\n      })}\r\n    </Select>\r\n  );\r\n}\r\n","import {\r\n  isTrulyResponsiveValue,\r\n  responsiveValueForceGet,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport { InternalField } from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { dotNotationGet, toArray } from \"@/utils\";\r\nimport { EditorContextType } from \"../../../../EditorContext\";\r\nimport { Form } from \"../../../../form\";\r\n\r\nexport type ResponsiveFieldDefinition = Omit<InternalField, \"component\"> & {\r\n  component: \"responsive2\";\r\n  subComponent: string;\r\n  hasAuto?: boolean;\r\n};\r\n\r\ntype ResponsiveFieldController = {\r\n  field: InternalField;\r\n  isResponsive: boolean;\r\n  isSet: boolean;\r\n  reset: () => void;\r\n  toggleOffAuto: () => void;\r\n};\r\n\r\nfunction getSavedValue(\r\n  value: any,\r\n  previousValue: any,\r\n  editorContext: EditorContextType\r\n) {\r\n  const breakpointIndex = editorContext.breakpointIndex;\r\n\r\n  if (typeof value === \"string\" && value.startsWith(\"##\")) {\r\n    // return value; -- commented based on comments below\r\n    // we could potentially change that logic to setting only the current breakpoint. There are use cases when this makes sense.\r\n    // 1. If we have a section \"from library\" with some default and we change value to responsive, we usually want to change it for all breakpoints.\r\n    // 2. However, if we set mobile and go to desktop and change value to responsive, we actually want to set it only to a specific breakpoint and not touch mobile.\r\n    // 3. If default were responsive, it'd be easier and we'd go with 2.\r\n    // 4. Changing entire set to responsive value is dangerous if someone set some breakpoint nicely. It would break.\r\n  }\r\n\r\n  // Responsiveness is not enabled for this field\r\n  if (!isTrulyResponsiveValue(previousValue)) {\r\n    if (value === undefined || value === null) {\r\n      return null;\r\n    }\r\n\r\n    return value;\r\n  }\r\n\r\n  const result = { ...previousValue };\r\n  result[breakpointIndex] = value;\r\n  return result;\r\n}\r\n\r\nexport function responsiveFieldController(config: {\r\n  field: ResponsiveFieldDefinition;\r\n  formValues: Form[\"values\"];\r\n  onChange: (newValues: Array<any>) => void;\r\n  editorContext: EditorContextType;\r\n  valuesAfterAuto: Record<string, any>;\r\n}): ResponsiveFieldController {\r\n  const { field, formValues, onChange, editorContext, valuesAfterAuto } =\r\n    config;\r\n\r\n  function originalFormat(value: unknown, fieldName: string) {\r\n    return field.format?.(value, fieldName, field) ?? value;\r\n  }\r\n\r\n  function originalParse(value: unknown, fieldName: string) {\r\n    return field.parse?.(value, fieldName, field) ?? value;\r\n  }\r\n\r\n  const normalizedFieldName = toArray(field.name);\r\n\r\n  const fieldValues = normalizedFieldName.map((fieldName) =>\r\n    dotNotationGet(formValues, fieldName)\r\n  );\r\n\r\n  const isResponsive = fieldValues.every((fieldValue) =>\r\n    isTrulyResponsiveValue(fieldValue)\r\n  );\r\n\r\n  const isSet =\r\n    isResponsive &&\r\n    fieldValues.every(\r\n      (fieldValue) => fieldValue[editorContext.breakpointIndex] !== undefined\r\n    );\r\n\r\n  const format = (value: any, name: string) => {\r\n    const valueAfterFormat = originalFormat(value, name);\r\n    const displayedValue =\r\n      (isTrulyResponsiveValue(valueAfterFormat)\r\n        ? valueAfterFormat[editorContext.breakpointIndex]\r\n        : valueAfterFormat) ?? null;\r\n    return displayedValue;\r\n  };\r\n\r\n  const parse = (value: any, name: string) => {\r\n    if (value === null) {\r\n      throw new Error(\r\n        \"parse in ResponsiveController has null value which should be impossible (null values should disappear once other value is picked!\"\r\n      );\r\n    }\r\n\r\n    const fieldValue = originalFormat(dotNotationGet(formValues, name), name);\r\n    const savedValue = getSavedValue(value, fieldValue, editorContext);\r\n\r\n    return originalParse(savedValue, name);\r\n  };\r\n\r\n  const reset = () => {\r\n    if (!isResponsive) {\r\n      throw new Error(\"should never happen\");\r\n    }\r\n\r\n    const nextValues = normalizedFieldName.map((fieldName) => {\r\n      const previousValue = originalFormat(\r\n        dotNotationGet(formValues, fieldName),\r\n        fieldName\r\n      );\r\n\r\n      const newValue = {\r\n        ...previousValue,\r\n      };\r\n\r\n      delete newValue[editorContext.breakpointIndex];\r\n\r\n      if (Object.keys(newValue).length <= 1) {\r\n        return field.defaultValue;\r\n      }\r\n\r\n      return originalParse(newValue, fieldName);\r\n    });\r\n\r\n    onChange(nextValues);\r\n  };\r\n\r\n  const toggleOffAuto = () => {\r\n    const currentBreakpointValues = fieldValues.map(\r\n      (fieldValue) => fieldValue[editorContext.breakpointIndex]\r\n    );\r\n\r\n    let areAllFieldValuesAuto = true;\r\n    let isAnyFieldValueAuto = false;\r\n\r\n    currentBreakpointValues.forEach((value) => {\r\n      if (value === undefined) {\r\n        if (!isAnyFieldValueAuto) {\r\n          isAnyFieldValueAuto = true;\r\n        }\r\n      } else {\r\n        if (areAllFieldValuesAuto) {\r\n          areAllFieldValuesAuto = false;\r\n        }\r\n      }\r\n    });\r\n\r\n    const newFieldsValues = normalizedFieldName.map((fieldName) => {\r\n      const fieldValue = dotNotationGet(formValues, fieldName);\r\n      const nextFieldValue = areAllFieldValuesAuto\r\n        ? dotNotationGet(valuesAfterAuto, normalizedFieldName[0])\r\n        : isAnyFieldValueAuto\r\n          ? fieldValues.find(\r\n            (value) => value[editorContext.breakpointIndex] !== undefined\r\n          )\r\n          : fieldValue;\r\n\r\n      const newFieldValue = {\r\n        ...fieldValue,\r\n        [editorContext.breakpointIndex]: responsiveValueForceGet(\r\n          // next field comes from auto, so value is defined\r\n          nextFieldValue,\r\n          editorContext.breakpointIndex\r\n        ),\r\n      };\r\n\r\n      return newFieldValue;\r\n    });\r\n\r\n    onChange(newFieldsValues);\r\n  };\r\n\r\n  const valueField: InternalField = {\r\n    ...field,\r\n    component: field.subComponent,\r\n    format,\r\n    parse,\r\n  };\r\n\r\n  return {\r\n    field: valueField,\r\n    isResponsive,\r\n    isSet,\r\n    reset,\r\n    toggleOffAuto,\r\n  };\r\n}\r\n","import { responsiveValueForceGet } from \"@redsun-vn/easyblocks-core\";\r\nimport { Colors, Fonts, Icons } from \"@redsun-vn/easyblocks-design-system\";\r\nimport { dotNotationGet, toArray } from \"@/utils\";\r\nimport React from \"react\";\r\nimport { styled } from \"styled-components\";\r\nimport { useConfigAfterAuto } from \"../../../../ConfigAfterAutoContext\";\r\nimport { useEditorContext } from \"../../../../EditorContext\";\r\nimport { FieldBuilder } from \"../../../form-builder\";\r\nimport { MIXED_VALUE } from \"../../components/constants\";\r\nimport { getUniqueValues } from \"../../components/getUniqueValues\";\r\nimport { Tooltip, TooltipArrow, TooltipBody } from \"../Tooltip\";\r\nimport { useTooltip } from \"../useTooltip\";\r\nimport { FieldMetaWrapper } from \"../wrapFieldWithMeta\";\r\nimport {\r\n  ResponsiveFieldDefinition,\r\n  responsiveFieldController,\r\n} from \"./responsiveFieldController\";\r\n\r\ntype ResponsivePluginProps = {\r\n  input: {\r\n    value: any;\r\n    onChange: (...values: Array<any>) => void;\r\n  };\r\n  field: ResponsiveFieldDefinition;\r\n  tinaForm: any;\r\n  form: any;\r\n  meta: any;\r\n};\r\n\r\nconst ResponsiveField = (props: ResponsivePluginProps) => {\r\n  const { tinaForm, field, input } = props;\r\n\r\n  const editorContext = useEditorContext();\r\n  const configAfterAuto = useConfigAfterAuto();\r\n  const normalizedFieldName = toArray(field.name);\r\n\r\n  const fieldValues = normalizedFieldName.map((fieldName) =>\r\n    dotNotationGet(configAfterAuto, fieldName)\r\n  );\r\n\r\n  const scalarFieldValues = fieldValues.map((fieldValue) => {\r\n    return responsiveValueForceGet(\r\n      // value from auto, so it's safe\r\n      fieldValue,\r\n      editorContext.breakpointIndex\r\n    );\r\n  });\r\n\r\n  const uniqueValues = getUniqueValues(scalarFieldValues, (value) =>\r\n    typeof value === \"object\" ? JSON.stringify(value) : value\r\n  );\r\n\r\n  const isMixedValue = uniqueValues.length > 1;\r\n  const value = isMixedValue ? MIXED_VALUE : uniqueValues[0];\r\n  const controller = responsiveFieldController({\r\n    field,\r\n    onChange: (newValues) => {\r\n      input.onChange(...newValues);\r\n    },\r\n    formValues: tinaForm.values,\r\n    editorContext,\r\n    valuesAfterAuto: configAfterAuto,\r\n  });\r\n\r\n  const isValueDifferentFromMainBreakpoint =\r\n    controller.isSet &&\r\n    editorContext.breakpointIndex !== editorContext.mainBreakpointIndex;\r\n\r\n  const isFieldVisible =\r\n    !controller.isResponsive ||\r\n    controller.isSet ||\r\n    editorContext.breakpointIndex === editorContext.mainBreakpointIndex;\r\n\r\n  const uniqueFieldValues = getUniqueValues(scalarFieldValues);\r\n\r\n  const autoLabelChildren =\r\n    uniqueFieldValues.length > 1 && uniqueFieldValues.includes(undefined)\r\n      ? \"Mixed\"\r\n      : getAutoLabelButtonLabel(value);\r\n\r\n  const isExternalField = field.subComponent === \"external\";\r\n\r\n  const { isOpen, arrowProps, tooltipProps, triggerProps } = useTooltip({\r\n    isDisabled: !isValueDifferentFromMainBreakpoint,\r\n    onClick: () => {\r\n      controller.reset();\r\n    },\r\n  });\r\n\r\n  return (\r\n    <FieldMetaWrapper\r\n      {...props}\r\n      layout={isExternalField ? \"column\" : \"row\"}\r\n      renderLabel={\r\n        isValueDifferentFromMainBreakpoint\r\n          ? ({ label }) => (\r\n              <ResetButton aria-label=\"Revert to auto\" {...triggerProps}>\r\n                <Icons.Reset />\r\n                <ResetButtonLabel>{label}</ResetButtonLabel>\r\n                {isOpen && (\r\n                  <Tooltip {...tooltipProps}>\r\n                    <TooltipArrow {...arrowProps} />\r\n                    <TooltipBody>Revert to auto</TooltipBody>\r\n                  </Tooltip>\r\n                )}\r\n              </ResetButton>\r\n            )\r\n          : undefined\r\n      }\r\n    >\r\n      <div style={{ width: \"100%\" }}>\r\n        {isFieldVisible ? (\r\n          <FieldBuilder\r\n            form={tinaForm}\r\n            field={controller.field}\r\n            noWrap={true}\r\n          />\r\n        ) : (\r\n          <AutoLabel\r\n            align={isExternalField ? \"left\" : \"right\"}\r\n            onClick={() => {\r\n              controller.toggleOffAuto();\r\n            }}\r\n          >\r\n            {autoLabelChildren}\r\n          </AutoLabel>\r\n        )}\r\n      </div>\r\n    </FieldMetaWrapper>\r\n  );\r\n};\r\n\r\nexport const ResponsiveFieldPlugin = {\r\n  name: \"responsive2\" as const,\r\n  Component: ResponsiveField,\r\n};\r\n\r\nconst AutoLabel = styled.div<{ align: \"left\" | \"right\" }>`\r\n  ${Fonts.body};\r\n  color: ${Colors.black40};\r\n  text-align: ${(props) => props.align};\r\n\r\n  &:hover {\r\n    color: black;\r\n    cursor: pointer;\r\n    text-decoration: underline;\r\n  }\r\n`;\r\n\r\nconst ResetButton = styled.button`\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 4px;\r\n\r\n  background-color: transparent;\r\n  border: 0;\r\n  padding: 0;\r\n\r\n  color: ${Colors.purple};\r\n\r\n  cursor: pointer;\r\n`;\r\n\r\nconst ResetButtonLabel = styled.span`\r\n  ${Fonts.body};\r\n  line-height: 16px;\r\n`;\r\n\r\nfunction getAutoLabelButtonLabel(value: any): string {\r\n  if (value === MIXED_VALUE) {\r\n    return \"auto: Mixed\";\r\n  }\r\n\r\n  /**\r\n   * This piece of code is crap\r\n   */\r\n  if (typeof value === \"object\") {\r\n    if (value.tokenId !== undefined && value.value !== undefined) {\r\n      const refNameParts = value.tokenId.split(\".\");\r\n      return `auto: ${refNameParts[refNameParts.length - 1]}`;\r\n    } else if (value.value !== undefined && value.id === undefined) {\r\n      // just value field -> token\r\n      return `auto: ${\r\n        typeof value.value === \"number\"\r\n          ? Math.round(value.value * 100) / 100\r\n          : value.value\r\n      }`;\r\n    }\r\n    return \"auto\";\r\n  }\r\n\r\n  if (typeof value === \"boolean\") {\r\n    return `auto: ${JSON.stringify(value)}`;\r\n  }\r\n\r\n  return `auto: ${value}`;\r\n}\r\n","import React, { useEffect, useRef } from \"react\";\r\nimport { wrapFieldsWithMeta } from \"../wrapFieldWithMeta\";\r\n\r\ntype SVGPickerProps = {\r\n  min: number;\r\n  max: number;\r\n  step?: number;\r\n};\r\n\r\nfunction transformStrokeAndFill(node: Element) {\r\n  const fill = node.getAttribute(\"fill\");\r\n  const stroke = node.getAttribute(\"stroke\");\r\n\r\n  if (fill && fill !== \"none\") {\r\n    node.setAttribute(\"fill\", \"currentColor\");\r\n  }\r\n  if (stroke && stroke !== \"none\") {\r\n    node.setAttribute(\"stroke\", \"currentColor\");\r\n  }\r\n\r\n  Array.from(node.children).forEach((child) => transformStrokeAndFill(child));\r\n}\r\n\r\nconst SVGPicker = wrapFieldsWithMeta<any, SVGPickerProps>(\r\n  ({ input, meta, field }) => {\r\n    const svgString = input.value.value;\r\n    const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n    useEffect(() => {\r\n      function readFileAsString() {\r\n        // @ts-ignore\r\n        const files = this.files;\r\n        if (files.length === 0) {\r\n          return;\r\n        }\r\n\r\n        const reader = new FileReader();\r\n        reader.onload = function (event) {\r\n          // @ts-ignore to explore\r\n          const trimmed = event.target?.result.trim();\r\n\r\n          const emptyDiv = document.createElement(\"div\");\r\n          emptyDiv.innerHTML = trimmed;\r\n          const svg = emptyDiv.children[0];\r\n\r\n          svg.removeAttribute(\"width\");\r\n          svg.removeAttribute(\"height\");\r\n\r\n          svg.setAttribute(\r\n            \"style\",\r\n            \"position: absolute; width: 100%;height: 100%;\"\r\n          );\r\n\r\n          transformStrokeAndFill(svg);\r\n\r\n          if (svg.tagName.toLowerCase() !== \"svg\") {\r\n            alert(\"incorrect file\");\r\n            return;\r\n          }\r\n\r\n          input.onChange({\r\n            value: emptyDiv.innerHTML,\r\n          });\r\n        };\r\n        reader.readAsText(files[0]);\r\n      }\r\n\r\n      inputRef.current!.addEventListener(\"change\", readFileAsString);\r\n\r\n      return () => {\r\n        inputRef.current!.removeEventListener(\"change\", readFileAsString);\r\n      };\r\n    }, []);\r\n\r\n    return (\r\n      <div>\r\n        <div\r\n          style={{\r\n            width: 24,\r\n            height: 24,\r\n            position: \"relative\",\r\n            color: \"black\",\r\n            marginBottom: 16,\r\n          }}\r\n        >\r\n          <div dangerouslySetInnerHTML={{ __html: svgString }} />\r\n        </div>\r\n\r\n        <input type=\"file\" id=\"upload\" accept={\".svg\"} ref={inputRef} />\r\n      </div>\r\n    );\r\n  }\r\n);\r\n\r\nexport const SVGPickerFieldPlugin = {\r\n  __type: \"field\",\r\n  name: \"icon\",\r\n  Component: SVGPicker,\r\n};\r\n","import { RangeSlider } from \"@redsun-vn/easyblocks-design-system\";\r\nimport React from \"react\";\r\nimport { wrapFieldsWithMeta } from \"./wrapFieldWithMeta\";\r\n\r\ntype SliderProps = {\r\n  min: number;\r\n  max: number;\r\n  step?: number;\r\n};\r\n\r\nconst Slider = wrapFieldsWithMeta<any, SliderProps>(({ input, field }) => {\r\n  return (\r\n    <RangeSlider {...input} max={field.max} min={field.min} step={field.step} />\r\n  );\r\n});\r\n\r\nexport const SliderFieldPlugin = {\r\n  __type: \"field\",\r\n  name: \"slider\",\r\n  Component: Slider,\r\n};\r\n","import { LocalValue } from \"@redsun-vn/easyblocks-core\";\r\nimport { InternalField } from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport React from \"react\";\r\nimport { FieldRenderProps } from \"react-final-form\";\r\nimport { EditorContextType, useEditorContext } from \"../../../EditorContext\";\r\nimport { MissingWidget } from \"./MissingWidget\";\r\nimport { wrapFieldsWithMeta } from \"./wrapFieldWithMeta\";\r\n\r\ntype InlineTypesResult = Record<\r\n  string,\r\n  Extract<EditorContextType[\"types\"][string], { type: \"inline\" }>\r\n>;\r\n\r\nfunction useInlineTypes(): InlineTypesResult {\r\n  const editorContext = useEditorContext();\r\n\r\n  const tokenTypes = Object.fromEntries(\r\n    Object.entries(editorContext.types).filter<\r\n      [string, InlineTypesResult[string]]\r\n    >(\r\n      (\r\n        typeDefinitionEntry\r\n      ): typeDefinitionEntry is [string, InlineTypesResult[string]] => {\r\n        return typeDefinitionEntry[1].type === \"inline\";\r\n      }\r\n    )\r\n  );\r\n\r\n  return tokenTypes;\r\n}\r\n\r\nconst LocalFieldPlugin = {\r\n  name: \"local\",\r\n  Component: wrapFieldsWithMeta(function LocalField({\r\n    field,\r\n    input,\r\n  }: FieldRenderProps<LocalValue<any>> & {\r\n    field: InternalField;\r\n  }) {\r\n    const inlineTypes = useInlineTypes();\r\n    const inlineTypeDefinition = inlineTypes[field.schemaProp.type];\r\n    const WidgetComponent = inlineTypeDefinition?.widget.component;\r\n\r\n    if (!WidgetComponent) {\r\n      return <MissingWidget type={field.schemaProp.type} />;\r\n    }\r\n\r\n    return (\r\n      <WidgetComponent\r\n        value={input.value.value}\r\n        onChange={(value) => {\r\n          input.onChange({\r\n            value,\r\n            widgetId: input.value.widgetId,\r\n          });\r\n        }}\r\n        params={\r\n          \"params\" in field.schemaProp ? field.schemaProp.params : undefined\r\n        }\r\n      />\r\n    );\r\n  }),\r\n};\r\n\r\nexport { LocalFieldPlugin };\r\n","import {\r\n  Position,\r\n  PositionHorizontal,\r\n  PositionVertical,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport { Colors } from \"@redsun-vn/easyblocks-design-system\";\r\nimport * as RadixRadioGroup from \"@radix-ui/react-radio-group\";\r\nimport React from \"react\";\r\nimport { styled } from \"styled-components\";\r\n\r\nconst StyledRadioItem = styled(RadixRadioGroup.Item)<{\r\n  horizontal: PositionHorizontal;\r\n  vertical: PositionVertical;\r\n  position: Position;\r\n  p: { value: Position };\r\n}>`\r\n  all: unset;\r\n  position: relative;\r\n  display: flex;\r\n  justify-content: ${(props) =>\r\n    horizontalPositionToFlexJustifyContentValue(props.horizontal)};\r\n  align-items: ${(props) =>\r\n    verticalPositionToFlexAlignItemsValue(props.vertical)};\r\n  box-sizing: border-box;\r\n  width: 20px;\r\n  height: 20px;\r\n  padding: 8px;\r\n\r\n  &:hover > div {\r\n    opacity: ${(props) => (props.p.value === props.position ? 1 : 0.5)};\r\n  }\r\n`;\r\n\r\nconst positions: ReadonlyArray<{ label: string; value: Position }> = [\r\n  { label: \"Top Left\", value: \"top-left\" },\r\n  { label: \"Top Center\", value: \"top-center\" },\r\n  { label: \"Top Right\", value: \"top-right\" },\r\n  { label: \"Center Left\", value: \"center-left\" },\r\n  { label: \"Center Center\", value: \"center-center\" },\r\n  { label: \"Center Right\", value: \"center-right\" },\r\n  { label: \"Bottom Left\", value: \"bottom-left\" },\r\n  { label: \"Bottom Center\", value: \"bottom-center\" },\r\n  { label: \"Bottom Right\", value: \"bottom-right\" },\r\n];\r\n\r\nfunction horizontalPositionToFlexJustifyContentValue(\r\n  position: \"left\" | \"center\" | \"right\"\r\n) {\r\n  switch (position) {\r\n    case \"left\":\r\n      return \"flex-start\";\r\n    case \"center\":\r\n      return \"center\";\r\n    case \"right\":\r\n      return \"flex-end\";\r\n  }\r\n}\r\n\r\nfunction verticalPositionToFlexAlignItemsValue(\r\n  position: \"top\" | \"center\" | \"bottom\"\r\n) {\r\n  switch (position) {\r\n    case \"top\":\r\n      return \"flex-start\";\r\n    case \"center\":\r\n      return \"center\";\r\n    case \"bottom\":\r\n      return \"flex-end\";\r\n  }\r\n}\r\nfunction PositionPickerInput({\r\n  position,\r\n  onPositionChange,\r\n}: {\r\n  position: Position;\r\n  onPositionChange: (position: Position) => void;\r\n}) {\r\n  return (\r\n    <RadixRadioGroup.Root\r\n      value={position}\r\n      onValueChange={(newPosition) => {\r\n        onPositionChange(newPosition as Position);\r\n      }}\r\n      style={{\r\n        display: \"grid\",\r\n        gridTemplateRows: \"repeat(3, 1fr)\",\r\n        gridTemplateColumns: \"repeat(3, 1fr)\",\r\n        gap: \"0\",\r\n        borderRadius: \"2px\",\r\n        border: `1px solid ${Colors.black10}`,\r\n      }}\r\n    >\r\n      {positions.map((p) => {\r\n        const [vertical, horizontal] = p.value.split(\"-\") as [\r\n          PositionVertical,\r\n          PositionHorizontal\r\n        ];\r\n\r\n        return (\r\n          <StyledRadioItem\r\n            value={p.value}\r\n            key={p.value}\r\n            aria-label={p.label}\r\n            horizontal={horizontal}\r\n            vertical={vertical}\r\n            p={p}\r\n            position={position}\r\n          >\r\n            <div\r\n              style={{\r\n                width: \"2px\",\r\n                height: \"2px\",\r\n                backgroundColor: \"#d9d9d9\",\r\n              }}\r\n            ></div>\r\n            <div\r\n              style={{\r\n                position: \"absolute\",\r\n                top: \"2px\",\r\n                left: \"2px\",\r\n                display: \"flex\",\r\n                flexDirection: \"column\",\r\n                justifyContent: \"center\",\r\n                alignItems:\r\n                  horizontalPositionToFlexJustifyContentValue(horizontal),\r\n                gap: \"2px\",\r\n                width: \"16px\",\r\n                height: \"16px\",\r\n                opacity: p.value === position ? 1 : 0,\r\n              }}\r\n            >\r\n              <PositionIndicator\r\n                $size={vertical === \"top\" ? \"full\" : \"normal\"}\r\n              />\r\n              <PositionIndicator\r\n                $size={vertical === \"center\" ? \"full\" : \"normal\"}\r\n              />\r\n              <PositionIndicator\r\n                $size={vertical === \"bottom\" ? \"full\" : \"normal\"}\r\n              />\r\n            </div>\r\n          </StyledRadioItem>\r\n        );\r\n      })}\r\n    </RadixRadioGroup.Root>\r\n  );\r\n}\r\n\r\nexport { PositionPickerInput };\r\nexport type { Position };\r\n\r\nconst PositionIndicator = styled.div<{ $size?: \"normal\" | \"full\" }>`\r\n  width: ${(p) => (p.$size === \"full\" ? \"100%\" : \"75%\")};\r\n  height: 4px;\r\n  background-color: #202123;\r\n`;\r\n","import { InternalField } from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport React from \"react\";\r\nimport { FieldRenderProps } from \"react-final-form\";\r\nimport {\r\n  Position,\r\n  PositionPickerInput,\r\n} from \"../../../sidebar/PositionPickerInput\";\r\nimport { wrapFieldsWithMeta } from \"./wrapFieldWithMeta\";\r\n\r\nfunction PositionField(\r\n  props: FieldRenderProps<Position, HTMLInputElement> & { field: InternalField }\r\n) {\r\n  return (\r\n    <PositionPickerInput\r\n      position={props.input.value}\r\n      onPositionChange={(position) => {\r\n        props.input.onChange(position);\r\n      }}\r\n    />\r\n  );\r\n}\r\n\r\nexport const PositionFieldPlugin = {\r\n  name: \"position\",\r\n  Component: wrapFieldsWithMeta(PositionField),\r\n};\r\n","import {\r\n  getDevicesWidths,\r\n  getFallbackLocaleForLocale,\r\n  isTrulyResponsiveValue,\r\n  responsiveValueGetDefinedValue,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  CompilationCache,\r\n  InternalAnyTinaField,\r\n  InternalField,\r\n  duplicateConfig,\r\n  findComponentDefinitionById,\r\n  findPathOfFirstAncestorOfType,\r\n  getSchemaDefinition,\r\n  parsePath,\r\n  richTextChangedEvent,\r\n  traverseComponents,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { dotNotationGet, last, toArray } from \"@/utils\";\r\nimport { EditorContextType } from \"../../../EditorContext\";\r\nimport { getUniqueValues } from \"../../fields/components/getUniqueValues\";\r\nimport { isConfigPathRichTextPart } from \"../../../utils/isConfigPathRichTextPart\";\r\n\r\n// \"any\" here is on purpose (although doesn't make sense from TS perspective).\r\n// It suggests that in onChange you can pass event OR any value. It's a bit confusing and should be cleaned up in the future.\r\ntype FieldValue = React.ChangeEvent<HTMLSelectElement | HTMLInputElement> | any;\r\n\r\nfunction createFieldController({\r\n  field,\r\n  editorContext,\r\n  format = (v) => v,\r\n  parse = (v) => v,\r\n}: {\r\n  field: InternalField;\r\n  editorContext: EditorContextType;\r\n  format?:\r\n  | ((value: any, name: string, field: InternalAnyTinaField) => any)\r\n  | undefined;\r\n  parse?: (value: any, name: string, field: InternalAnyTinaField) => any;\r\n}) {\r\n  const { actions, contextParams, form, locales, focussedField } =\r\n    editorContext;\r\n  const normalizedFieldName = toArray(field.name);\r\n\r\n  return {\r\n    onChange(mainNewValue: FieldValue, ...extraNewValues: FieldValue[]) {\r\n      /**\r\n       * There are 2 modes of onChange: single param and multiple params\r\n       *\r\n       * 1. single param mode is when onChange is given ONE value (1 parameter). It means: \"apply this value for all selected fields\"\r\n       * 2. multiple param mode is when onChange is given more than one value. It means: \"apply each value for respective selected field\".\r\n       */\r\n\r\n      const newValue: FieldValue | FieldValue[] =\r\n        extraNewValues.length === 0\r\n          ? mainNewValue\r\n          : [mainNewValue, ...extraNewValues];\r\n\r\n      if (\r\n        !Array.isArray(mainNewValue) &&\r\n        Array.isArray(newValue) &&\r\n        newValue.length !== normalizedFieldName.length\r\n      ) {\r\n        throw new Error(\r\n          \"onChange in multiple param mode was given wrong number of values\"\r\n        );\r\n      }\r\n\r\n      if (focussedField.some(isConfigPathRichTextPart)) {\r\n        // For editor selection we can safely pick a first field name because:\r\n        // * we only can select fields that are children of @easyblocks/rich-text-part\r\n        // * we only can update only single property\r\n        const { templateId } = parsePath(normalizedFieldName[0], form);\r\n\r\n        invalidateCache(normalizedFieldName[0], editorContext);\r\n\r\n        if (templateId === \"@easyblocks/rich-text-part\") {\r\n          const schemaPropNameToUpdate = last(\r\n            normalizedFieldName[0].split(\".\")\r\n          );\r\n\r\n          const canvasIframe = document.getElementById(\r\n            \"shopstory-canvas\"\r\n          ) as HTMLIFrameElement | null;\r\n\r\n          if (canvasIframe === null || canvasIframe.contentWindow === null) {\r\n            throw new Error(\"No Shopstory canvas\");\r\n          }\r\n\r\n          if (extraNewValues.length > 0) {\r\n            const parsedValues = (newValue as Array<any>).map((value) =>\r\n              parse(getValue(value), normalizedFieldName[0], field)\r\n            );\r\n\r\n            canvasIframe.contentWindow.postMessage(\r\n              richTextChangedEvent({\r\n                prop: schemaPropNameToUpdate as any,\r\n                schemaProp: field.schemaProp,\r\n                values: parsedValues,\r\n              }),\r\n              \"*\"\r\n            );\r\n          } else {\r\n            const parsedValue = parse(\r\n              getValue(newValue),\r\n              normalizedFieldName[0],\r\n              field\r\n            );\r\n\r\n            canvasIframe.contentWindow.postMessage(\r\n              richTextChangedEvent({\r\n                prop: schemaPropNameToUpdate as any,\r\n                schemaProp: field.schemaProp,\r\n                values: [parsedValue],\r\n              }),\r\n              \"*\"\r\n            );\r\n          }\r\n\r\n          return;\r\n        }\r\n      }\r\n\r\n      actions.runChange(() => {\r\n        normalizedFieldName.forEach((path, fieldIndex) => {\r\n          const inputValue = Array.isArray(newValue)\r\n            ? getValue(newValue[fieldIndex])\r\n            : getValue(newValue);\r\n\r\n          const customTypeDefinition =\r\n            editorContext.types[field.schemaProp.type];\r\n\r\n          if (\r\n            customTypeDefinition &&\r\n            \"validate\" in customTypeDefinition &&\r\n            customTypeDefinition.validate &&\r\n            \"value\" in inputValue &&\r\n            (customTypeDefinition.type === \"token\"\r\n              ? !(\"tokenId\" in inputValue)\r\n              : true)\r\n          ) {\r\n            const isInputValueValid = customTypeDefinition.validate(\r\n              inputValue.value\r\n            );\r\n\r\n            if (!isInputValueValid) {\r\n              return;\r\n            }\r\n          }\r\n\r\n          let parsedValue = parse(inputValue, path, field);\r\n\r\n          // If path has locale token [locale] (component-collection-localised) then we must first replace it with correct token\r\n          if (hasLocaleToken(path)) {\r\n            const currentLocaleFieldName = replaceLocaleToken(\r\n              path,\r\n              contextParams.locale\r\n            );\r\n\r\n            const currentLocaleValue = dotNotationGet(\r\n              form.values,\r\n              currentLocaleFieldName\r\n            );\r\n\r\n            parsedValue = parse(inputValue, currentLocaleFieldName, field);\r\n\r\n            // If the path doesn't exist it means that there is no config for path for current locale. It means we must create it!\r\n            if (currentLocaleValue === undefined) {\r\n              const fallbackLocale = getFallbackLocaleForLocale(\r\n                contextParams.locale,\r\n                locales\r\n              )!;\r\n\r\n              const fieldNameSegments = path.split(\".\");\r\n              const localeTokenIndex = fieldNameSegments.indexOf(\"[locale]\");\r\n              const localisedConfigPath = [\r\n                ...fieldNameSegments.slice(0, localeTokenIndex + 1),\r\n                \"0\",\r\n              ].join(\".\");\r\n\r\n              const fallbackLocaleFieldName = replaceLocaleToken(\r\n                localisedConfigPath,\r\n                fallbackLocale\r\n              );\r\n\r\n              const localeConfigPath = replaceLocaleToken(\r\n                localisedConfigPath,\r\n                contextParams.locale\r\n              );\r\n\r\n              form.change(\r\n                localeConfigPath,\r\n                duplicateConfig(\r\n                  dotNotationGet(form.values, fallbackLocaleFieldName),\r\n                  editorContext\r\n                )\r\n              );\r\n            }\r\n\r\n            path = currentLocaleFieldName;\r\n          }\r\n\r\n          invalidateCache(path, editorContext);\r\n\r\n          // At this point we have correct fieldName and correct parsedValue after all [locale] issues solved\r\n\r\n          /**\r\n           * Below we're trying to see whether there is a custom change function for specific EditableComponent\r\n           */\r\n\r\n          const split = path.split(\".\");\r\n          const propName = last(split);\r\n\r\n          // TODO: here we can have either a component or component field. parsePath should take this into account!\r\n          const componentPath = split.slice(0, split.length - 1).join(\".\");\r\n          const { templateId } = parsePath(componentPath, editorContext.form);\r\n\r\n          const parentDefinition = findComponentDefinitionById(\r\n            templateId,\r\n            editorContext\r\n          )!;\r\n          const config = dotNotationGet(\r\n            editorContext.form.values,\r\n            componentPath\r\n          );\r\n\r\n          if (parentDefinition && parentDefinition.change) {\r\n            const values: Record<string, any> = {};\r\n            const closestDefinedValues: Record<string, any> = {};\r\n\r\n            parentDefinition.schema.forEach((schemaProp) => {\r\n              const val = config[schemaProp.prop];\r\n\r\n              values[schemaProp.prop] = isTrulyResponsiveValue(val)\r\n                ? val[editorContext.breakpointIndex]\r\n                : val;\r\n\r\n              closestDefinedValues[schemaProp.prop] =\r\n                responsiveValueGetDefinedValue(\r\n                  val,\r\n                  editorContext.breakpointIndex,\r\n                  editorContext.devices,\r\n                  getDevicesWidths(editorContext.devices)\r\n                );\r\n            });\r\n\r\n            const inputValue = isTrulyResponsiveValue(parsedValue)\r\n              ? parsedValue[editorContext.breakpointIndex]\r\n              : parsedValue;\r\n\r\n            const result = parentDefinition.change({\r\n              newValue: inputValue,\r\n              prop: propName,\r\n              values,\r\n\r\n              /**\r\n               * IMPORTANT!!!\r\n               *\r\n               * valuesAfterAuto are an approximation for now, they're not real auto values, they just have closest defined values.\r\n               *\r\n               */\r\n              valuesAfterAuto: closestDefinedValues,\r\n            }) ?? {\r\n              [propName]: inputValue,\r\n            };\r\n\r\n            parentDefinition.schema.forEach((schemaProp) => {\r\n              if (!result.hasOwnProperty(schemaProp.prop)) {\r\n                return;\r\n              }\r\n\r\n              let pathPrefix = `${componentPath}.${schemaProp.prop}`;\r\n              if (pathPrefix[0] === \".\") {\r\n                pathPrefix = pathPrefix.substring(1);\r\n              }\r\n\r\n              if (isTrulyResponsiveValue(config[schemaProp.prop])) {\r\n                form.change(\r\n                  `${pathPrefix}.${editorContext.breakpointIndex}`,\r\n                  result[schemaProp.prop]\r\n                );\r\n              } else {\r\n                form.change(`${pathPrefix}`, result[schemaProp.prop]);\r\n              }\r\n            });\r\n          } else {\r\n            form.change(path, parsedValue);\r\n          }\r\n        });\r\n      });\r\n    },\r\n    getValue() {\r\n      const fieldValues = normalizedFieldName.map((fieldName) => {\r\n        const propName = last(fieldName.split(\".\"));\r\n\r\n        if (propName.startsWith(\"$\") && \"defaultValue\" in field.schemaProp) {\r\n          return field.schemaProp.defaultValue;\r\n        }\r\n\r\n        if (hasLocaleToken(fieldName)) {\r\n          const resolvedFieldName = replaceLocaleToken(\r\n            fieldName,\r\n            editorContext.contextParams.locale\r\n          );\r\n\r\n          const fieldValue = dotNotationGet(form.values, resolvedFieldName);\r\n\r\n          if (fieldValue) {\r\n            return fieldValue;\r\n          }\r\n\r\n          const fallbackLocale = getFallbackLocaleForLocale(\r\n            editorContext.contextParams.locale,\r\n            editorContext.locales\r\n          )!;\r\n\r\n          const resolvedFieldFallbackName = replaceLocaleToken(\r\n            fieldName,\r\n            fallbackLocale\r\n          );\r\n\r\n          const fieldFallbackValue = dotNotationGet(\r\n            form.values,\r\n            resolvedFieldFallbackName\r\n          );\r\n\r\n          return fieldFallbackValue;\r\n        }\r\n\r\n        return dotNotationGet(form.values, fieldName);\r\n      });\r\n\r\n      const uniqueFieldValues = getUniqueValues(fieldValues, (fieldValue) => {\r\n        const { getHash } = getSchemaDefinition(\r\n          field.schemaProp,\r\n          editorContext\r\n        );\r\n\r\n        return getHash(\r\n          fieldValue,\r\n          editorContext.breakpointIndex,\r\n          editorContext.devices\r\n        );\r\n      });\r\n\r\n      if (uniqueFieldValues.length > 1) {\r\n        return { __mixed__: true };\r\n      }\r\n\r\n      return format(uniqueFieldValues[0], normalizedFieldName[0], field);\r\n    },\r\n  };\r\n}\r\n\r\nexport { createFieldController };\r\n\r\nfunction hasLocaleToken(configPath: string) {\r\n  return configPath.includes(\"[locale]\");\r\n}\r\n\r\nfunction replaceLocaleToken(configPath: string, locale: string) {\r\n  const localisedFieldName = configPath.replace(\"[locale]\", locale);\r\n  return localisedFieldName;\r\n}\r\n\r\nfunction getValue(\r\n  eventOrValue: React.ChangeEvent<HTMLSelectElement | HTMLInputElement> | any\r\n) {\r\n  // Event of course has more properties or methods, but for this case\r\n  // checking only for `currentTarget` is sufficient\r\n  const isEventObject =\r\n    typeof eventOrValue === \"object\" &&\r\n    eventOrValue !== null &&\r\n    \"currentTarget\" in eventOrValue;\r\n\r\n  if (isEventObject) {\r\n    if (\r\n      \"checked\" in eventOrValue.currentTarget &&\r\n      eventOrValue.currentTarget.type === \"checkbox\"\r\n    ) {\r\n      return eventOrValue.currentTarget.checked;\r\n    }\r\n\r\n    return eventOrValue.currentTarget.value;\r\n  } else {\r\n    return eventOrValue;\r\n  }\r\n}\r\n\r\ntype CacheInvalidator = (\r\n  cache: CompilationCache,\r\n  changedPath: string,\r\n  context: EditorContextType\r\n) => Array<string>;\r\n\r\n// $richText and @easyblocks/rich-text-part uses a lot of portals to display correct fields within sidebar\r\n// Changing value through portal won't trigger the recompilation of component using that portal.\r\n// When we change any $richText related component we remove cache for that component (if it is $richText)\r\n// and for all of its ancestors.\r\nconst richTextCacheInvalidator: CacheInvalidator = (\r\n  cache,\r\n  changedPath,\r\n  context\r\n) => {\r\n  const cacheKeysToRemove: Array<string> = [];\r\n  const { templateId, fieldName, parent } = parsePath(\r\n    changedPath,\r\n    context.form\r\n  );\r\n\r\n  const isRichTextOrRichTextAncestorComponent =\r\n    templateId.startsWith(\"@easyblocks/rich-text\") ||\r\n    parent?.templateId.startsWith(\"@easyblocks/rich-text\");\r\n\r\n  if (isRichTextOrRichTextAncestorComponent) {\r\n    const richTextPath =\r\n      templateId === \"@easyblocks/rich-text\" && fieldName\r\n        ? changedPath.replace(`.${fieldName}`, \"\")\r\n        : findPathOfFirstAncestorOfType(\r\n          changedPath,\r\n          \"@easyblocks/rich-text\",\r\n          context.form\r\n        );\r\n\r\n    const richTextConfig = dotNotationGet(context.form.values, richTextPath);\r\n\r\n    traverseComponents(richTextConfig, context, ({ componentConfig }) => {\r\n      if (\r\n        componentConfig &&\r\n        componentConfig._component.startsWith(\"@easyblocks/rich-text\")\r\n      ) {\r\n        cacheKeysToRemove.push(componentConfig._id!);\r\n      }\r\n    });\r\n  }\r\n\r\n  return cacheKeysToRemove;\r\n};\r\n\r\nconst cacheInvalidators: Array<CacheInvalidator> = [richTextCacheInvalidator];\r\n\r\nfunction invalidateCache(changedPath: string, context: EditorContextType) {\r\n  const cacheKeysToRemove = new Set(\r\n    cacheInvalidators.flatMap((invalidator) => {\r\n      return invalidator(context.compilationCache, changedPath, context);\r\n    })\r\n  );\r\n\r\n  cacheKeysToRemove.forEach((cacheKey) => {\r\n    context.compilationCache.remove(cacheKey);\r\n  });\r\n}\r\n","import { InternalField } from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { Colors, Fonts, Typography } from \"@redsun-vn/easyblocks-design-system\";\r\nimport { toArray } from \"@/utils\";\r\nimport React, { useContext } from \"react\";\r\nimport { styled, css } from \"styled-components\";\r\nimport { useEditorContext } from \"../../EditorContext\";\r\nimport { Form } from \"../../form\";\r\nimport {\r\n  BlockFieldPlugin,\r\n  ExternalFieldPlugin,\r\n  FieldMetaWrapper,\r\n  IdentityFieldPlugin,\r\n  NumberFieldPlugin,\r\n  RadioGroupFieldPlugin,\r\n  ResponsiveFieldPlugin,\r\n  SVGPickerFieldPlugin,\r\n  SelectFieldPlugin,\r\n  SliderFieldPlugin,\r\n  TextFieldPlugin,\r\n  ToggleFieldPlugin,\r\n  TokenFieldPlugin,\r\n} from \"../fields\";\r\nimport { PanelContext } from \"../fields/plugins/BlockFieldPlugin\";\r\nimport { LocalFieldPlugin } from \"../fields/plugins/LocalFIeld\";\r\nimport { PositionFieldPlugin } from \"../fields/plugins/PositionFieldPlugin\";\r\nimport { FieldPlugin } from \"./field-plugin\";\r\nimport { createFieldController } from \"./utils/createFieldController\";\r\n\r\nexport interface FieldBuilderProps {\r\n  form: Form;\r\n  field: InternalField;\r\n  noWrap?: boolean;\r\n  isLabelHidden?: boolean;\r\n}\r\n\r\nfunction shouldFieldBeDisplayed(field: InternalField): boolean {\r\n  if (field.component === null) return false;\r\n\r\n  if (Array.isArray(field.name)) {\r\n    return true;\r\n  }\r\n\r\n  if (field.hidden) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nconst FIELD_COMPONENTS: Array<FieldPlugin> = [\r\n  TextFieldPlugin,\r\n  NumberFieldPlugin,\r\n  ToggleFieldPlugin,\r\n  SelectFieldPlugin,\r\n  RadioGroupFieldPlugin,\r\n  PositionFieldPlugin,\r\n  BlockFieldPlugin,\r\n  SliderFieldPlugin,\r\n  SVGPickerFieldPlugin,\r\n  ResponsiveFieldPlugin,\r\n  ExternalFieldPlugin,\r\n  TokenFieldPlugin,\r\n  IdentityFieldPlugin,\r\n  LocalFieldPlugin,\r\n];\r\n\r\nexport function FieldBuilder({\r\n  form,\r\n  field,\r\n  noWrap,\r\n  isLabelHidden,\r\n}: FieldBuilderProps) {\r\n  const editorContext = useEditorContext();\r\n\r\n  if (!shouldFieldBeDisplayed(field)) {\r\n    return null;\r\n  }\r\n\r\n  const fieldComponent = FIELD_COMPONENTS.find(\r\n    (component) => component.name === (field.component as string)\r\n  );\r\n\r\n  const { onChange, getValue } = createFieldController({\r\n    field,\r\n    editorContext,\r\n    format: field.format ?? fieldComponent?.format,\r\n    parse: field.parse ?? fieldComponent?.parse,\r\n  });\r\n\r\n  if (fieldComponent) {\r\n    return (\r\n      <fieldComponent.Component\r\n        // Let's talk about this code\r\n        // This branch of code is created to display single input and label that handles multiple inputs under the hood\r\n        // To make this work, we had to skip usage of `Field` from `Final Form` because it requires a single field object with single name\r\n        // Moreover, since we don't use `Field` anymore we have to pretend that it still exists to make fields works as it was there.\r\n        // In the future, this code should become a part of new component (ex. FieldWrapper)\r\n        // and new controller should be introduced (ex. fieldWrapperController) to have single source of truth about behaviour of responsive field.\r\n        input={{\r\n          value: getValue(),\r\n          onChange,\r\n        }}\r\n        // MetaFieldWrapper accesses `error` property of this object, it's needed to prevent runtime error\r\n        meta={{}}\r\n        tinaForm={form}\r\n        form={form.finalForm}\r\n        field={field}\r\n        noWrap={noWrap}\r\n        isLabelHidden={isLabelHidden}\r\n      />\r\n    );\r\n  }\r\n\r\n  if (typeof field.component !== \"string\" && field.component !== null) {\r\n    console.log(\"not a string\");\r\n\r\n    return (\r\n      <field.component\r\n        input={{\r\n          value: getValue(),\r\n          onChange,\r\n        }}\r\n        meta={{}}\r\n        tinaForm={form}\r\n        form={form.finalForm}\r\n        field={field}\r\n        noWrap={noWrap}\r\n        isLabelHidden={isLabelHidden}\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <FieldMetaWrapper\r\n      input={{\r\n        value: getValue(),\r\n        onChange,\r\n      }}\r\n      field={field}\r\n      layout=\"column\"\r\n    >\r\n      <Typography>Unrecognized field type</Typography>\r\n    </FieldMetaWrapper>\r\n  );\r\n}\r\n\r\nexport interface FieldsBuilderProps {\r\n  form: Form;\r\n  fields: InternalField[];\r\n}\r\n\r\nconst HorizontalLine = styled.div`\r\n  height: 1px;\r\n  margin-top: -1px;\r\n  background-color: ${Colors.black10};\r\n`;\r\n\r\nexport function FieldsBuilder({ form, fields }: FieldsBuilderProps) {\r\n  const editorContext = useEditorContext();\r\n  const panelContext = useContext(PanelContext);\r\n  const grouped: Record<string, Array<InternalField>> = {};\r\n  const ungrouped: Array<InternalField> = [];\r\n\r\n  fields.forEach((field) => {\r\n    if (!shouldFieldBeDisplayed(field)) {\r\n      return;\r\n    }\r\n\r\n    if (field.group) {\r\n      grouped[field.group] = grouped[field.group] || [];\r\n      grouped[field.group].push(field);\r\n    } else {\r\n      if (field.component === \"identity\") {\r\n        return;\r\n      }\r\n\r\n      ungrouped.push(field);\r\n    }\r\n  });\r\n\r\n  const horizontalLine = <HorizontalLine />;\r\n\r\n  const identityField = fields.find((field) => field.component === \"identity\");\r\n\r\n  const breakpointIndex = panelContext\r\n    ? editorContext.breakpointIndex\r\n    : undefined;\r\n\r\n  return (\r\n    <FieldsGroup>\r\n      {identityField !== undefined && (\r\n        <React.Fragment>\r\n          <FieldBuilder field={identityField} form={form} />\r\n          {horizontalLine}\r\n        </React.Fragment>\r\n      )}\r\n      {Object.keys(grouped).map((groupName) => (\r\n        <div key={groupName}>\r\n          <FieldsGroupLabel>{groupName}</FieldsGroupLabel>\r\n          {grouped[groupName].map((field, index, fields) => (\r\n            <FieldWrapper\r\n              key={generateFieldKey(field, breakpointIndex)}\r\n              isLast={index === fields.length - 1}\r\n            >\r\n              <FieldBuilder\r\n                field={field}\r\n                form={form}\r\n                isLabelHidden={field.schemaProp.isLabelHidden}\r\n              />\r\n            </FieldWrapper>\r\n          ))}\r\n          {horizontalLine}\r\n        </div>\r\n      ))}\r\n      {ungrouped.map((field, index, fields) => (\r\n        <FieldWrapper\r\n          key={generateFieldKey(field, breakpointIndex)}\r\n          isLast={index === fields.length - 1}\r\n        >\r\n          <FieldBuilder\r\n            field={field}\r\n            form={form}\r\n            isLabelHidden={field.schemaProp.isLabelHidden}\r\n          />\r\n        </FieldWrapper>\r\n      ))}\r\n      {horizontalLine}\r\n    </FieldsGroup>\r\n  );\r\n}\r\n\r\nfunction generateFieldKey(\r\n  field: InternalField,\r\n  breakpointIndex: string | undefined\r\n) {\r\n  const key = `${toArray(field.name).join(\"_\")}_${field.schemaProp.type}${\r\n    breakpointIndex ? `_${breakpointIndex}` : \"\"\r\n  }`;\r\n  return key;\r\n}\r\n\r\nconst FieldWrapper = styled.div<{ isLast: boolean }>`\r\n  margin-bottom: ${(props) => (props.isLast ? \"8px\" : 0)};\r\n`;\r\n\r\nconst FieldsGroupLabel = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n\r\n  padding: 20px 16px 10px 16px;\r\n\r\n  ${Fonts.label};\r\n  color: #000;\r\n`;\r\n\r\nconst FieldsGroup = styled.div`\r\n  position: relative;\r\n  display: block;\r\n  width: 100%;\r\n  padding: 0;\r\n  white-space: nowrap;\r\n  overflow-x: hidden;\r\n  overflow-y: auto !important;\r\n`;\r\n","import { styled, createGlobalStyle, css } from \"styled-components\";\r\n\r\nconst theme = css`\r\n  :root {\r\n    --tina-color-primary-light: #2296fe;\r\n    --tina-color-primary: #2296fe;\r\n    --tina-color-primary-dark: #0574e4;\r\n    --tina-color-error-light: #eb6337;\r\n    --tina-color-error: #ec4815;\r\n    --tina-color-error-dark: #dc4419;\r\n    --tina-color-warning-light: #f5e06e;\r\n    --tina-color-warning: #e9d050;\r\n    --tina-color-warning-dark: #d3ba38;\r\n    --tina-color-success-light: #57c355;\r\n    --tina-color-success: #3cad3a;\r\n    --tina-color-success-dark: #249a21;\r\n    --tina-color-grey-0: #ffffff;\r\n    --tina-color-grey-1: #f6f6f9;\r\n    --tina-color-grey-2: #edecf3;\r\n    --tina-color-grey-3: #e1ddec;\r\n    --tina-color-grey-4: #b2adbe;\r\n    --tina-color-grey-5: #918c9e;\r\n    --tina-color-grey-6: #716c7f;\r\n    --tina-color-grey-7: #565165;\r\n    --tina-color-grey-8: #433e52;\r\n    --tina-color-grey-9: #363145;\r\n    --tina-color-grey-10: #282828;\r\n\r\n    --tina-radius-small: 5px;\r\n    --tina-radius-big: 24px;\r\n\r\n    --tina-padding-small: 12px;\r\n    --tina-padding-big: 20px;\r\n\r\n    --tina-font-size-0: 12px;\r\n    --tina-font-size-1: 13px;\r\n    --tina-font-size-2: 15px;\r\n    --tina-font-size-3: 16px;\r\n    --tina-font-size-4: 18px;\r\n    --tina-font-size-5: 20px;\r\n    --tina-font-size-6: 22px;\r\n    --tina-font-size-7: 26px;\r\n    --tina-font-size-8: 32px;\r\n\r\n    --tina-font-family: \"Inter\", sans-serif;\r\n\r\n    --tina-font-weight-regular: 400;\r\n    --tina-font-weight-bold: 600;\r\n\r\n    --tina-shadow-big: 0px 2px 3px rgba(0, 0, 0, 0.05),\r\n      0 4px 12px rgba(0, 0, 0, 0.1);\r\n    --tina-shadow-small: 0px 2px 3px rgba(0, 0, 0, 0.12);\r\n\r\n    --tina-timing-short: 85ms;\r\n    --tina-timing-medium: 150ms;\r\n    --tina-timing-long: 250ms;\r\n\r\n    --tina-z-index-0: 500;\r\n    --tina-z-index-1: 1000;\r\n    --tina-z-index-2: 1500;\r\n    --tina-z-index-3: 2000;\r\n    --tina-z-index-4: 2500;\r\n    --tina-z-index-5: 3000;\r\n\r\n    --tina-sidebar-width: 340px;\r\n    --tina-sidebar-header-height: 60px;\r\n    --tina-toolbar-height: 62px;\r\n  }\r\n`;\r\n\r\nexport const GlobalStyles = createGlobalStyle`\r\n  ${theme};\r\n`;\r\n\r\nconst tina_reset_styles = css`\r\n  * {\r\n    font-family: \"Inter\", sans-serif;\r\n    &::-webkit-scrollbar {\r\n      width: 8px;\r\n    }\r\n    ::-webkit-scrollbar-track {\r\n      background: transparent;\r\n      border-left: 1px solid var(--tina-color-grey-2);\r\n    }\r\n    &::-webkit-scrollbar-thumb {\r\n      background-color: var(--tina-color-grey-3);\r\n      border-radius: 0;\r\n      border: none;\r\n    }\r\n  }\r\n\r\n  *,\r\n  *:before,\r\n  *:after {\r\n    box-sizing: border-box;\r\n  }\r\n\r\n  hr {\r\n    border-color: var(--tina-color-grey-2);\r\n    color: var(--tina-color-grey-2);\r\n    margin-bottom: var(--tina-padding-big);\r\n    margin-left: calc(var(--tina-padding-big) * -1);\r\n    margin-right: calc(var(--tina-padding-big) * -1);\r\n    border-top: 1px solid var(--tina-color-grey-2);\r\n    border-bottom: none;\r\n    height: 0;\r\n    box-sizing: content-box;\r\n  }\r\n  h1,\r\n  h2,\r\n  h3,\r\n  h4,\r\n  h5,\r\n  h6,\r\n  p {\r\n    :not([class]) {\r\n      font-family: \"Inter\", sans-serif;\r\n      &:first-child {\r\n        margin-top: 0;\r\n      }\r\n      &:last-child {\r\n        margin-bottom: 0;\r\n      }\r\n    }\r\n  }\r\n  td,\r\n  th {\r\n    padding: 0;\r\n    width: auto;\r\n    height: auto;\r\n    border: inherit;\r\n    margin: 0;\r\n  }\r\n  h1,\r\n  h2,\r\n  h3,\r\n  h4,\r\n  h5,\r\n  h6 {\r\n    :not([class]) {\r\n      font-weight: var(--tina-font-weight-bold);\r\n    }\r\n  }\r\n  h1:not([class]) {\r\n    font-size: var(--tina-font-size-8);\r\n  }\r\n  h2:not([class]) {\r\n    font-size: var(--tina-font-size-7);\r\n  }\r\n  h3:not([class]) {\r\n    font-size: var(--tina-font-size-5);\r\n  }\r\n  h4:not([class]) {\r\n    font-size: var(--tina-font-size-4);\r\n  }\r\n  h5:not([class]) {\r\n    font-size: var(--tina-font-size-3);\r\n  }\r\n  h6:not([class]) {\r\n    font-size: var(--tina-font-size-2);\r\n  }\r\n`;\r\n\r\nexport const StyleReset = styled.div`\r\n  ${tina_reset_styles}\r\n`;\r\n","import { styled, css } from \"styled-components\";\r\n\r\ninterface ButtonProps {\r\n  primary?: boolean;\r\n  small?: boolean;\r\n  margin?: boolean;\r\n  grow?: boolean;\r\n  open?: boolean;\r\n  busy?: boolean;\r\n  disabled?: boolean;\r\n}\r\n\r\nconst Button = styled.button<ButtonProps>`\r\n  text-align: center;\r\n  border: 0;\r\n  border-radius: var(--tina-radius-big);\r\n  box-shadow: var(--tina-shadow-small);\r\n  background-color: var(--tina-color-grey-0);\r\n  border: 1px solid var(--tina-color-grey-2);\r\n  color: var(--tina-color-primary);\r\n  fill: var(--tina-color-primary);\r\n  font-weight: var(--tina-font-weight-regular);\r\n  cursor: pointer;\r\n  font-size: var(--tina-font-size-1);\r\n  height: 40px;\r\n  padding: 0 var(--tina-padding-big);\r\n  transition: all 85ms ease-out;\r\n\r\n  &:hover {\r\n    background-color: var(--tina-color-grey-1);\r\n  }\r\n  &:active {\r\n    background-color: var(--tina-color-grey-2);\r\n    outline: none;\r\n  }\r\n\r\n  ${(p) =>\r\n    p.disabled &&\r\n    css`\r\n      opacity: 0.3;\r\n      pointer: not-allowed;\r\n      pointer-events: none;\r\n    `};\r\n\r\n  ${(p) =>\r\n    p.primary &&\r\n    css`\r\n      background-color: var(--tina-color-primary);\r\n      color: var(--tina-color-grey-0);\r\n      fill: var(--tina-color-grey-0);\r\n      border: none;\r\n      &:hover {\r\n        background-color: var(--tina-color-primary-light);\r\n      }\r\n      &:active {\r\n        background-color: var(--tina-color-primary-dark);\r\n      }\r\n    `};\r\n\r\n  ${(p) =>\r\n    p.small &&\r\n    css`\r\n      height: 32px;\r\n      font-size: var(--tina-font-size-0);\r\n      padding: 0 var(--tina-padding-big);\r\n    `};\r\n\r\n  ${(p) =>\r\n    p.margin &&\r\n    css`\r\n      &:not(:first-child) {\r\n        margin-left: 8px;\r\n      }\r\n    `};\r\n\r\n  ${(p) =>\r\n    p.grow &&\r\n    css`\r\n      flex-grow: 1;\r\n    `};\r\n\r\n  ${(p) =>\r\n    p.busy &&\r\n    css`\r\n      cursor: wait;\r\n    `};\r\n`;\r\n\r\nexport const ICON_BUTTON_SIZE = 18;\r\nconst ICON_SIZE = 18;\r\n\r\nexport const IconButton = styled(Button)`\r\n  padding: 0;\r\n  width: ${ICON_BUTTON_SIZE}px;\r\n  height: ${ICON_BUTTON_SIZE}px;\r\n  margin: 0;\r\n  position: relative;\r\n  transform-origin: 50% 50%;\r\n  transition: all 150ms ease-out;\r\n  padding: 0;\r\n  display: flex;\r\n  flex-shrink: 0;\r\n  justify-content: center;\r\n  align-items: center;\r\n\r\n  svg {\r\n    width: ${ICON_SIZE}px;\r\n    height: ${ICON_SIZE}px;\r\n    transition: all 150ms ease-out;\r\n  }\r\n\r\n  ${(props) =>\r\n    props.open &&\r\n    css`\r\n      background-color: var(--tina-color-grey-0);\r\n      border-color: var(--tina-color-grey-2);\r\n      outline: none;\r\n      fill: var(--tina-color-primary);\r\n      svg {\r\n        transform: rotate(45deg);\r\n      }\r\n      &:hover {\r\n        background-color: var(--tina-color-grey-1);\r\n      }\r\n      &:active {\r\n        background-color: var(--tina-color-grey-2);\r\n      }\r\n    `};\r\n`;\r\n","import { InternalField } from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport React, { MouseEvent } from \"react\";\r\nimport { styled } from \"styled-components\";\r\nimport { useEditorContext } from \"./EditorContext\";\r\nimport { SidebarFooter } from \"./SidebarFooter\";\r\nimport { FieldsBuilder } from \"./tinacms/form-builder\";\r\nimport { StyleReset } from \"./tinacms/styles\";\r\n\r\ninterface InlineSettingsProps {\r\n  fields: InternalField[];\r\n}\r\n\r\nexport function InlineSettings({ fields }: InlineSettingsProps) {\r\n  const hasNoExtraFields = !(fields && fields.length);\r\n\r\n  if (hasNoExtraFields) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <StyleReset\r\n      onClick={(e: MouseEvent) => {\r\n        e.stopPropagation();\r\n      }}\r\n      style={{ height: \"100%\" }}\r\n    >\r\n      {/* IMPORTANT: This stop propagation fixes issues with toggle unclicking */}\r\n      <SettingsContent fields={fields} />\r\n    </StyleReset>\r\n  );\r\n}\r\ninterface SettingsContentProps {\r\n  title?: string;\r\n  fields: InternalField[];\r\n}\r\n\r\nfunction SettingsContent({ fields }: SettingsContentProps) {\r\n  const { form, focussedField } = useEditorContext();\r\n\r\n  return (\r\n    <FormBody id={\"sidebar-panels-root\"}>\r\n      <Wrapper>\r\n        <FieldsBuilder form={form} fields={fields} />\r\n        <SidebarFooter paths={focussedField} />\r\n      </Wrapper>\r\n    </FormBody>\r\n  );\r\n}\r\n\r\nconst FormBody = styled.div`\r\n  position: relative;\r\n  flex: 1 1 auto;\r\n  display: flex;\r\n  flex-direction: column;\r\n  width: 100%;\r\n  height: 100%;\r\n  border-top: 1px solid var(--tina-color-grey-2);\r\n  background-color: white;\r\n`;\r\n\r\nconst Wrapper = styled.div`\r\n  display: block;\r\n  margin: 0 auto;\r\n  width: 100%;\r\n  height: 100%;\r\n  overflow-y: auto;\r\n`;\r\n","import { CompiledComponentConfig } from \"@redsun-vn/easyblocks-core\";\r\nimport { Fonts } from \"@redsun-vn/easyblocks-design-system\";\r\nimport { dotNotationGet } from \"@/utils\";\r\nimport React from \"react\";\r\nimport { styled } from \"styled-components\";\r\nimport { buildTinaFields } from \"./buildTinaFields\";\r\nimport { useEditorContext } from \"./EditorContext\";\r\nimport { InlineSettings } from \"./inline-settings\";\r\nimport { mergeCommonFields } from \"./tinacms/form-builder/utils/mergeCommonFields\";\r\nimport { Form } from \"./form\";\r\n\r\ntype EditorSidebarProps = {\r\n  focussedField: Array<string>;\r\n  form: Form;\r\n};\r\n\r\nconst Error = styled.div`\r\n  ${Fonts.body}\r\n  padding: 7px 6px 7px;\r\n  color: hsl(0deg 0% 50% / 0.8);\r\n  white-space: normal;\r\n  background: hsl(0deg 100% 50% / 0.2);\r\n  margin-right: 10px;\r\n  border-radius: 2px;\r\n  margin: 16px;\r\n`;\r\n\r\nexport const EditorSidebar: React.FC<EditorSidebarProps> = (props) => {\r\n  const { focussedField, form } = props;\r\n  const editorContext = useEditorContext();\r\n\r\n  const error = (() => {\r\n    if (focussedField.length === 1) {\r\n      const path = focussedField[0];\r\n      const compiledComponent: CompiledComponentConfig = dotNotationGet(\r\n        editorContext.compiledComponentConfig,\r\n        path\r\n      );\r\n      const editableComponent = dotNotationGet(form.values, path);\r\n      if (compiledComponent?._component === \"@easyblocks/missing-component\") {\r\n        return `Cant find definition for component: ${editableComponent._component} in your project. Please contact your developers to resolve this issue.`;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  })();\r\n\r\n  const areMultipleFieldsSelected = focussedField.length > 1;\r\n  const focusedFields = focussedField.length === 0 ? [\"\"] : focussedField;\r\n  const fieldsPerFocusedField = focusedFields.map((focusedField) => {\r\n    return buildTinaFields(focusedField, editorContext);\r\n  });\r\n\r\n  const mergedFields = areMultipleFieldsSelected\r\n    ? mergeCommonFields({\r\n        fields: fieldsPerFocusedField,\r\n      })\r\n    : fieldsPerFocusedField.flat();\r\n\r\n  return (\r\n    <>\r\n      {error && <Error>{error}</Error>}\r\n      <InlineSettings fields={mergedFields} />\r\n    </>\r\n  );\r\n};\r\n","import { Devices, Locale } from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  ButtonGhost,\r\n  ButtonPrimary,\r\n  ButtonDanger,\r\n  Colors,\r\n  Fonts,\r\n  Icons,\r\n  Select,\r\n  SelectItem,\r\n  Toggle,\r\n  ToggleGroup,\r\n  ToggleGroupItem,\r\n  Tooltip,\r\n  TooltipContent,\r\n  TooltipTrigger,\r\n  Typography,\r\n} from \"@redsun-vn/easyblocks-design-system\";\r\nimport React, { ReactNode, useRef } from \"react\";\r\nimport { styled } from \"styled-components\";\r\n\r\nexport const TOP_BAR_HEIGHT = 40;\r\n\r\nconst TopBar = styled.div`\r\n  position: relative;\r\n  box-sizing: border-box;\r\n  background-color: white;\r\n  border-bottom: 1px solid #eaeaea;\r\n  padding: 0 64px;\r\n  min-height: ${TOP_BAR_HEIGHT}px;\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: center;\r\n  align-items: center;\r\n`;\r\n\r\nconst Label = styled.div`\r\n  background: ${Colors.purple};\r\n  height: 24px;\r\n  ${Fonts.label}\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  padding-left: 12px;\r\n  padding-right: 12px;\r\n  border-radius: 12px;\r\n  color: white;\r\n`;\r\n\r\nconst TopBarLeft = styled.div`\r\n  position: absolute;\r\n  top: 0;\r\n  left: 4px;\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: row;\r\n  align-items: center;\r\n  gap: 4px;\r\n`;\r\n\r\nconst TopBarRight = styled.div`\r\n  position: absolute;\r\n  top: 0;\r\n  right: 8px;\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: row;\r\n  align-items: center;\r\n  gap: 16px;\r\n`;\r\n\r\nconst TopBarCenter = styled.div`\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n`;\r\n\r\nconst ImageContainer = styled.div`\r\n  position: relative;\r\n  width: 20px;\r\n  height: 20px;\r\n`;\r\n\r\nconst Image = styled.img`\r\n  width: 100%;\r\n  height: 100%;\r\n  object-fit: contain;\r\n`;\r\n\r\nexport const EditorTopBar: React.FC<{\r\n  saveLabel: string;\r\n  onClose?: () => void;\r\n  onSaveDocument?: () => void;\r\n  onIsEditingChange: () => void;\r\n  viewport: string;\r\n  onViewportChange: (viewport: string) => void;\r\n  devices: Devices;\r\n  isEditing: boolean;\r\n  onUndo: () => void;\r\n  onRedo: () => void;\r\n  locales: Locale[];\r\n  locale: string;\r\n  onLocaleChange: (locale: string) => void;\r\n  hideCloseButton: boolean;\r\n  readOnly: boolean;\r\n}> = ({\r\n  onClose,\r\n  onSaveDocument,\r\n  onViewportChange,\r\n  devices,\r\n  viewport,\r\n  onIsEditingChange,\r\n  isEditing,\r\n  onUndo,\r\n  onRedo,\r\n  locales,\r\n  locale,\r\n  onLocaleChange,\r\n  hideCloseButton,\r\n  readOnly\r\n}) => {\r\n    const headingRef = useRef<HTMLDivElement>(null);\r\n    const router = new URLSearchParams(window.location.search);\r\n    const themeId = router.get(\"themeId\");\r\n    const shopId = router.get(\"shopId\");\r\n\r\n    return (\r\n      <TopBar ref={headingRef}>\r\n        <TopBarLeft>\r\n          {!hideCloseButton && (\r\n            <>\r\n              <ButtonGhost icon={Icons.Close} hideLabel onClick={onClose}>\r\n                Close\r\n              </ButtonGhost>\r\n\r\n              <div\r\n                style={{ height: \"100%\", background: Colors.black10, width: 1 }}\r\n              />\r\n            </>\r\n          )}\r\n          <ButtonGhost\r\n            icon={Icons.Undo}\r\n            hideLabel\r\n            onClick={() => {\r\n              onUndo();\r\n            }}\r\n          >\r\n            Undo\r\n          </ButtonGhost>\r\n          <ButtonGhost\r\n            icon={Icons.Redo}\r\n            hideLabel\r\n            onClick={() => {\r\n              onRedo();\r\n            }}\r\n          >\r\n            Redo\r\n          </ButtonGhost>\r\n\r\n          {readOnly && <Label>Read-Only</Label>}\r\n\r\n          <ButtonDanger\r\n            className=\"cursor-pointer\"\r\n            component=\"label\"\r\n            onClick={() => onSaveDocument?.()}\r\n          >\r\n            Save\r\n          </ButtonDanger>\r\n\r\n        </TopBarLeft>\r\n\r\n        <TopBarCenter>\r\n          <DeviceSwitch\r\n            devices={devices}\r\n            deviceId={viewport}\r\n            onDeviceChange={onViewportChange}\r\n          />\r\n        </TopBarCenter>\r\n\r\n        <TopBarRight>\r\n          <div\r\n            style={{\r\n              display: \"flex\",\r\n              flexDirection: \"row\",\r\n              gap: \"6px\",\r\n              alignItems: \"center\",\r\n            }}\r\n          >\r\n            <Select value={locale} onChange={onLocaleChange}>\r\n              {locales.map((l) => (\r\n                <SelectItem key={l.code} value={l.code}>\r\n                  <div\r\n                    style={{\r\n                      display: \"flex\",\r\n                      alignItems: \"center\",\r\n                      justifyContent: \"center\",\r\n                      cursor: \"pointer\",\r\n                      gap: 4,\r\n                    }}\r\n                  >\r\n                    {l.icon ? (\r\n                      <ImageContainer>\r\n                        <Image src={l.icon} alt={l.name} />\r\n                      </ImageContainer>\r\n                    ) : null}\r\n                    {l.name}\r\n                  </div>\r\n                </SelectItem>\r\n              ))}\r\n            </Select>\r\n\r\n            <a href={`/?previewId=${themeId}&shopId=${shopId}`} target=\"_blank\">\r\n              <ButtonPrimary component=\"label\" className=\"cursor-pointer\">\r\n                Preview\r\n              </ButtonPrimary>\r\n            </a>\r\n\r\n            <Typography\r\n              variant={\"body\"}\r\n              component=\"label\"\r\n              htmlFor=\"easyblocks-edit-mode-button\"\r\n            >\r\n              Edit mode\r\n            </Typography>{\" \"}\r\n\r\n            <Toggle\r\n              name=\"easyblocks-edit-mode-button\"\r\n              checked={isEditing}\r\n              onChange={() => {\r\n                onIsEditingChange();\r\n              }}\r\n            />\r\n          </div>\r\n        </TopBarRight>\r\n      </TopBar>\r\n    );\r\n  };\r\n\r\nconst DEVICE_ID_TO_ICON: Record<\r\n  Devices[number][\"id\"] | \"fit-screen\",\r\n  ReactNode\r\n> = {\r\n  xs: (\r\n    <svg\r\n      width=\"16\"\r\n      height=\"16\"\r\n      viewBox=\"0 0 16 16\"\r\n      fill=\"none\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n    >\r\n      <path\r\n        fillRule=\"evenodd\"\r\n        clipRule=\"evenodd\"\r\n        d=\"M10 2.51691H6C5.44772 2.51691 5 2.96463 5 3.51691L5.00005 12.483C5.00005 13.0353 5.44777 13.483 6.00005 13.483H10.0001C10.5523 13.483 11.0001 13.0353 11.0001 12.483L11 3.51691C11 2.96463 10.5523 2.51691 10 2.51691ZM6 1.51691C4.89543 1.51691 4 2.41234 4 3.51691L4.00005 12.483C4.00005 13.5876 4.89548 14.483 6.00005 14.483H10.0001C11.1046 14.483 12.0001 13.5876 12.0001 12.483L12 3.51691C12 2.41234 11.1046 1.51691 10 1.51691H6Z\"\r\n        fill=\"black\"\r\n      />\r\n      <path\r\n        fillRule=\"evenodd\"\r\n        clipRule=\"evenodd\"\r\n        d=\"M8.99548 12.5H7.00452V11.5H8.99548V12.5Z\"\r\n        fill=\"black\"\r\n      />\r\n    </svg>\r\n  ),\r\n  sm: (\r\n    <svg\r\n      width=\"16\"\r\n      height=\"16\"\r\n      viewBox=\"0 0 16 16\"\r\n      fill=\"none\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n    >\r\n      <path\r\n        fillRule=\"evenodd\"\r\n        clipRule=\"evenodd\"\r\n        d=\"M2.51694 6.00005L2.51694 10C2.51694 10.5523 2.96466 11 3.51694 11L12.4831 11C13.0353 11 13.4831 10.5523 13.4831 9.99999L13.4831 5.99999C13.4831 5.44771 13.0353 4.99999 12.4831 4.99999L3.51694 5.00005C2.96466 5.00005 2.51694 5.44776 2.51694 6.00005ZM1.51694 10C1.51694 11.1046 2.41238 12 3.51694 12L12.4831 12C13.5876 12 14.4831 11.1046 14.4831 9.99999L14.4831 5.99999C14.4831 4.89542 13.5876 3.99999 12.4831 3.99999L3.51694 4.00005C2.41237 4.00005 1.51694 4.89548 1.51694 6.00005L1.51694 10Z\"\r\n        fill=\"black\"\r\n      />\r\n      <path\r\n        fillRule=\"evenodd\"\r\n        clipRule=\"evenodd\"\r\n        d=\"M12.5 7.00452L12.5 8.99548L11.5 8.99548L11.5 7.00452L12.5 7.00452Z\"\r\n        fill=\"black\"\r\n      />\r\n    </svg>\r\n  ),\r\n  md: (\r\n    <svg\r\n      width=\"16\"\r\n      height=\"18\"\r\n      viewBox=\"0 0 16 18\"\r\n      fill=\"none\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n    >\r\n      <path\r\n        fillRule=\"evenodd\"\r\n        clipRule=\"evenodd\"\r\n        d=\"M12.4918 1.97229L3.50793 1.9723C2.95565 1.9723 2.50793 2.42001 2.50793 2.9723L2.50797 15.0277C2.50797 15.58 2.95569 16.0277 3.50797 16.0277L12.4918 16.0277C13.0441 16.0277 13.4918 15.58 13.4918 15.0277L13.4918 2.97229C13.4918 2.42001 13.0441 1.97229 12.4918 1.97229ZM3.50793 0.972299C2.40337 0.972299 1.50793 1.86773 1.50793 2.9723L1.50797 15.0277C1.50797 16.1323 2.4034 17.0277 3.50797 17.0277L12.4918 17.0277C13.5964 17.0277 14.4918 16.1323 14.4918 15.0277L14.4918 2.97229C14.4918 1.86772 13.5964 0.97229 12.4918 0.97229L3.50793 0.972299Z\"\r\n        fill=\"black\"\r\n      />\r\n      <path\r\n        fillRule=\"evenodd\"\r\n        clipRule=\"evenodd\"\r\n        d=\"M10 14.9777H6V13.9777H10V14.9777Z\"\r\n        fill=\"black\"\r\n      />\r\n    </svg>\r\n  ),\r\n  lg: (\r\n    <svg\r\n      width=\"18\"\r\n      height=\"16\"\r\n      viewBox=\"0 0 18 16\"\r\n      fill=\"none\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n    >\r\n      <path\r\n        fillRule=\"evenodd\"\r\n        clipRule=\"evenodd\"\r\n        d=\"M1.97229 3.50815L1.9723 12.492C1.9723 13.0443 2.42001 13.492 2.9723 13.492L15.0277 13.492C15.58 13.492 16.0277 13.0443 16.0277 12.492L16.0277 3.50812C16.0277 2.95583 15.58 2.50812 15.0277 2.50812L2.97229 2.50815C2.42 2.50815 1.97229 2.95587 1.97229 3.50815ZM0.972299 12.492C0.972299 13.5966 1.86773 14.492 2.9723 14.492L15.0277 14.492C16.1323 14.492 17.0277 13.5965 17.0277 12.492L17.0277 3.50812C17.0277 2.40355 16.1323 1.50812 15.0277 1.50812L2.97229 1.50815C1.86772 1.50815 0.97229 2.40359 0.97229 3.50815L0.972299 12.492Z\"\r\n        fill=\"black\"\r\n      />\r\n      <path\r\n        fillRule=\"evenodd\"\r\n        clipRule=\"evenodd\"\r\n        d=\"M14.9778 6L14.9778 10L13.9778 10L13.9778 6L14.9778 6Z\"\r\n        fill=\"black\"\r\n      />\r\n    </svg>\r\n  ),\r\n  xl: (\r\n    <svg\r\n      width=\"16\"\r\n      height=\"16\"\r\n      viewBox=\"0 0 16 16\"\r\n      fill=\"none\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n    >\r\n      <path\r\n        fillRule=\"evenodd\"\r\n        clipRule=\"evenodd\"\r\n        d=\"M14.5111 13.0004L1.48889 13.0004L1.48889 12.0004L14.5111 12.0004V13.0004Z\"\r\n        fill=\"black\"\r\n      />\r\n      <path\r\n        fillRule=\"evenodd\"\r\n        clipRule=\"evenodd\"\r\n        d=\"M12.5828 3.99961H3.41723V9.91598H12.5828V3.99961ZM2.5 2.99961V10.916H13.5V2.99961H2.5Z\"\r\n        fill=\"black\"\r\n      />\r\n    </svg>\r\n  ),\r\n  \"2xl\": (\r\n    <svg\r\n      width=\"16\"\r\n      height=\"16\"\r\n      viewBox=\"0 0 16 16\"\r\n      fill=\"none\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n    >\r\n      <path\r\n        fillRule=\"evenodd\"\r\n        clipRule=\"evenodd\"\r\n        d=\"M14 3.00213H2V10.9979H14V3.00213ZM1 2.00213V11.9979H15V2.00213H1Z\"\r\n        fill=\"black\"\r\n      />\r\n      <path\r\n        fillRule=\"evenodd\"\r\n        clipRule=\"evenodd\"\r\n        d=\"M11 13.9979L5 13.9979V12.9979L11 12.9979V13.9979Z\"\r\n        fill=\"black\"\r\n      />\r\n    </svg>\r\n  ),\r\n  \"fit-screen\": (\r\n    <svg\r\n      width=\"16\"\r\n      height=\"16\"\r\n      viewBox=\"0 0 16 16\"\r\n      fill=\"none\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n    >\r\n      <path\r\n        d=\"M14.2872 7.97504L12.2872 5.79322M14.2872 7.97504C14.2872 7.97504 13.0683 9.30481 12.2872 10.1569M14.2872 7.97504L10.0372 7.97504\"\r\n        stroke=\"black\"\r\n      />\r\n      <path\r\n        d=\"M1.79272 7.97503L3.79272 10.1568M1.79272 7.97503C1.79272 7.97503 3.01168 6.64527 3.79272 5.79321M1.79272 7.97503L6.04272 7.97503\"\r\n        stroke=\"black\"\r\n      />\r\n      <path\r\n        fillRule=\"evenodd\"\r\n        clipRule=\"evenodd\"\r\n        d=\"M3.96777 2.52881H12.0323V4.49858H13.0323V1.52881H2.96777V4.49858H3.96777V2.52881ZM3.96777 11.5014H2.96777V14.4712H13.0323V11.5014H12.0323V13.4712H3.96777V11.5014Z\"\r\n        fill=\"black\"\r\n      />\r\n    </svg>\r\n  ),\r\n};\r\n\r\nfunction DeviceSwitch({\r\n  deviceId,\r\n  devices,\r\n  onDeviceChange,\r\n}: {\r\n  devices: Devices;\r\n  deviceId: string;\r\n  onDeviceChange: (deviceId: string) => void;\r\n}) {\r\n  return (\r\n    <ToggleGroup\r\n      value={deviceId}\r\n      onChange={(deviceId) => {\r\n        if (deviceId === \"\") {\r\n          return;\r\n        }\r\n\r\n        onDeviceChange(deviceId);\r\n      }}\r\n    >\r\n      {devices.map((d) => {\r\n        if (d.hidden) {\r\n          return null;\r\n        }\r\n\r\n        return (\r\n          <Tooltip key={d.id}>\r\n            <TooltipTrigger>\r\n              <ToggleGroupItem value={d.id}>\r\n                {DEVICE_ID_TO_ICON[d.id]}\r\n              </ToggleGroupItem>\r\n            </TooltipTrigger>\r\n\r\n            <TooltipContent>\r\n              <Typography color=\"white\">{d.label ?? d.id}</Typography>\r\n            </TooltipContent>\r\n          </Tooltip>\r\n        );\r\n      })}\r\n\r\n      <Tooltip>\r\n        <TooltipTrigger>\r\n          <ToggleGroupItem value=\"fit-screen\">\r\n            {DEVICE_ID_TO_ICON[\"fit-screen\"]}\r\n          </ToggleGroupItem>\r\n        </TooltipTrigger>\r\n\r\n        <TooltipContent>\r\n          <Typography color=\"white\">Fit screen</Typography>\r\n        </TooltipContent>\r\n      </Tooltip>\r\n    </ToggleGroup>\r\n  );\r\n}\r\n","export function normalizeToStringArray(arg: string | string[] | undefined) {\r\n  return typeof arg === \"string\" ? [arg] : Array.isArray(arg) ? arg : [];\r\n}\r\n","import { EditorContextType } from \"./EditorContext\";\r\nimport { ComponentDefinitionShared } from \"@redsun-vn/easyblocks-core\";\r\nimport { normalizeToStringArray } from \"./normalizeToStringArray\";\r\n\r\nexport function getAllComponentTypes(editorContext: EditorContextType) {\r\n  const componentTypes = getComponentTypesFromDefinitions(\r\n    editorContext.definitions.components\r\n  );\r\n  return Array.from(new Set([...componentTypes]));\r\n}\r\n\r\nfunction getComponentTypesFromDefinitions(\r\n  definitions: ComponentDefinitionShared[]\r\n) {\r\n  const types = new Set<string>();\r\n\r\n  definitions.forEach(({ type }) => {\r\n    normalizeToStringArray(type).forEach((componentType) => {\r\n      types.add(componentType);\r\n    });\r\n  });\r\n\r\n  return Array.from(types);\r\n}\r\n","import { EditorContextType } from \"./EditorContext\";\r\nimport {\r\n  ComponentDefinitionShared,\r\n  isNoCodeComponentOfType,\r\n} from \"@redsun-vn/easyblocks-core\";\r\n\r\nexport function getAllComponentsOfType(\r\n  type: string,\r\n  editorContext: EditorContextType\r\n) {\r\n  return getAllComponentsOfTypeFromDefinitionsArray(\r\n    type,\r\n    editorContext.definitions.components\r\n  );\r\n}\r\n\r\nfunction getAllComponentsOfTypeFromDefinitionsArray(\r\n  type: string,\r\n  definitions: ComponentDefinitionShared[]\r\n) {\r\n  return definitions.filter((definition) =>\r\n    isNoCodeComponentOfType(definition, type)\r\n  );\r\n}\r\n","import { EditorContextType } from \"./EditorContext\";\r\nimport { getAllComponentTypes } from \"./getAllComponentTypes\";\r\nimport { normalizeToStringArray } from \"./normalizeToStringArray\";\r\nimport { getAllComponentsOfType } from \"./getAllComponentsOfType\";\r\nimport { findComponentDefinitionById } from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { ComponentDefinitionShared } from \"@redsun-vn/easyblocks-core\";\r\n\r\nexport function unrollAcceptsFieldIntoComponents(\r\n  accepts: string | string[] | undefined,\r\n  editorContext: EditorContextType\r\n) {\r\n  const allComponentTypes = getAllComponentTypes(editorContext);\r\n  const idsSet = new Set<ComponentDefinitionShared>();\r\n\r\n  normalizeToStringArray(accepts).forEach((acceptsEntry) => {\r\n    if (allComponentTypes.includes(acceptsEntry)) {\r\n      const componentType = acceptsEntry;\r\n      const components = getAllComponentsOfType(componentType, editorContext);\r\n\r\n      components.forEach((component) => {\r\n        idsSet.add(component);\r\n      });\r\n    } else {\r\n      const componentId = acceptsEntry;\r\n      const component = findComponentDefinitionById(componentId, editorContext);\r\n      if (component) {\r\n        idsSet.add(component);\r\n      }\r\n    }\r\n  });\r\n\r\n  return Array.from(idsSet);\r\n}\r\n","import {\r\n  NoCodeComponentEntry,\r\n  ComponentSchemaProp,\r\n  Template,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  duplicateConfig,\r\n  findComponentDefinition,\r\n  normalize,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { dotNotationGet } from \"@/utils\";\r\nimport React, { FC } from \"react\";\r\nimport { useEditorContext } from \"./EditorContext\";\r\nimport { SearchableSmallPickerModal } from \"./SearchableSmallPickerModal\";\r\nimport { SectionPickerModal } from \"./SectionPicker\";\r\nimport { TemplatePicker, TemplatesDictionary } from \"./TemplatePicker\";\r\nimport { OpenComponentPickerConfig } from \"./types\";\r\nimport { unrollAcceptsFieldIntoComponents } from \"./unrollAcceptsFieldIntoComponents\";\r\n\r\ntype ModalProps = {\r\n  config: OpenComponentPickerConfig;\r\n  onClose: (config?: NoCodeComponentEntry) => void;\r\n  pickers?: Record<string, TemplatePicker>;\r\n};\r\n\r\nexport const ModalPicker: FC<ModalProps> = ({ config, onClose, pickers }) => {\r\n  const editorContext = useEditorContext();\r\n  const { form } = editorContext;\r\n\r\n  const split = config.path.split(\".\"); // TODO: right now only for collections\r\n  const parentPath = split.slice(0, split.length - 1).join(\".\");\r\n  const fieldName = split[split.length - 1];\r\n\r\n  const parentData: NoCodeComponentEntry = dotNotationGet(\r\n    form.values,\r\n    parentPath\r\n  );\r\n  const schemaProp = findComponentDefinition(\r\n    parentData,\r\n    editorContext\r\n  )!.schema.find((x) => x.prop === fieldName) as ComponentSchemaProp;\r\n\r\n  const componentTypes = config.componentTypes ?? schemaProp.accepts;\r\n  const components = unrollAcceptsFieldIntoComponents(\r\n    componentTypes,\r\n    editorContext\r\n  );\r\n\r\n  let templatesDictionary: TemplatesDictionary | undefined = undefined;\r\n\r\n  if (editorContext.templates) {\r\n    templatesDictionary = {};\r\n\r\n    components.forEach((component) => {\r\n      templatesDictionary![component.id] = {\r\n        component,\r\n        templates: [],\r\n      };\r\n\r\n      editorContext.templates!.forEach((template) => {\r\n        if (component.id === template.entry._component) {\r\n          templatesDictionary![component.id].templates.push(template);\r\n        }\r\n      });\r\n\r\n      if (templatesDictionary![component.id].templates.length === 0) {\r\n        delete templatesDictionary![component.id];\r\n      }\r\n    });\r\n  }\r\n\r\n  const picker = schemaProp.picker ?? \"compact\";\r\n\r\n  // const defaultPickerMode =\r\n  //   accepts.includes(\"section\") || componentTypes.includes(\"card\")\r\n  //     ? \"big\"\r\n  //     : \"small\";\r\n  //\r\n  // const pickerMode = schemaProp.picker || defaultPickerMode;\r\n\r\n  const close = (config: NoCodeComponentEntry) => {\r\n    const _itemProps = {\r\n      [parentData._component]: {\r\n        [fieldName]: {},\r\n      },\r\n    };\r\n\r\n    const newComponent = fieldName.startsWith(\"$\")\r\n      ? config\r\n      : duplicateConfig(\r\n          normalize(\r\n            {\r\n              ...config,\r\n              _itemProps,\r\n            },\r\n            editorContext\r\n          ),\r\n          editorContext\r\n        );\r\n\r\n    onClose(newComponent);\r\n  };\r\n\r\n  const onModalClose = (template?: Template) => {\r\n    if (template) {\r\n      close(normalize(template.entry, editorContext));\r\n    } else {\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  return pickers?.[picker] ? (\r\n    pickers[picker]({\r\n      isOpen: true,\r\n      onClose: onModalClose,\r\n      templates: templatesDictionary,\r\n      mode: picker,\r\n    })\r\n  ) : (\r\n    <div>Unknown picker: {picker}</div>\r\n  );\r\n};\r\n","import React, { MouseEvent, useEffect, useState } from \"react\";\r\nimport {\r\n  OpenTemplateModalAction,\r\n  OpenTemplateModalActionCreate,\r\n} from \"./types\";\r\nimport {\r\n  FormElement,\r\n  ButtonDanger,\r\n  ButtonPrimary,\r\n  Input,\r\n  Modal,\r\n  useToaster,\r\n} from \"@redsun-vn/easyblocks-design-system\";\r\nimport { useEditorContext } from \"./EditorContext\";\r\nimport { Backend, Template } from \"@redsun-vn/easyblocks-core\";\r\n\r\ntype TemplateModalProps = {\r\n  action: OpenTemplateModalAction;\r\n  onClose: () => void;\r\n  backend: Backend;\r\n};\r\n\r\nexport const TemplateModal: React.FC<TemplateModalProps> = (props) => {\r\n  const [error, setError] = useState<null | string>(null);\r\n  const mode = props.action.mode;\r\n  const backend = props.backend;\r\n\r\n  const editorContext = useEditorContext();\r\n  const [isLoadingEdit, setLoadingEdit] = useState(false);\r\n  const [isLoadingDelete, setLoadingDelete] = useState(false);\r\n\r\n  const toaster = useToaster();\r\n  const [template, setTemplate] = useState(() => {\r\n    if (props.action.mode === \"edit\") {\r\n      return props.action.template;\r\n    } else {\r\n      return {\r\n        label: \"\",\r\n        group: \"\",\r\n        thumbnail: \"\",\r\n        thumbnailLabel: \"\",\r\n        entry: props.action.config,\r\n      };\r\n    }\r\n  });\r\n\r\n  const {\r\n    label = \"\",\r\n    group = \"\",\r\n    thumbnail = \"\",\r\n    thumbnailLabel = \"\",\r\n  } = template as Template;\r\n  const open = props.action !== undefined;\r\n  const canSend = label.trim() !== \"\";\r\n  const ctaLabel = \"Save\";\r\n\r\n  useEffect(() => {\r\n    if (open) {\r\n      setError(null);\r\n    }\r\n  }, [open]);\r\n\r\n  return (\r\n    <Modal\r\n      title={`Template details`}\r\n      isOpen={true}\r\n      onRequestClose={() => {\r\n        props.onClose();\r\n      }}\r\n      mode={\"center-small\"}\r\n      headerLine={true}\r\n    >\r\n      <form\r\n        onSubmit={(e) => {\r\n          e.preventDefault();\r\n\r\n          setError(null);\r\n\r\n          if (!canSend) {\r\n            return;\r\n          }\r\n\r\n          setLoadingEdit(true);\r\n\r\n          if (mode === \"create\") {\r\n            const createAction = props.action as OpenTemplateModalActionCreate;\r\n\r\n            backend.templates\r\n              .create({\r\n                label,\r\n                group,\r\n                thumbnail,\r\n                thumbnailLabel,\r\n                entry: createAction.config,\r\n                width: createAction.width,\r\n                widthAuto: createAction.widthAuto,\r\n              })\r\n              .then((newTemplate) => {\r\n                editorContext.syncTemplates({\r\n                  mode: \"create\",\r\n                  template: {\r\n                    id: newTemplate.id,\r\n                    ...template,\r\n                  },\r\n                });\r\n                toaster.success(\"Template created!\");\r\n                props.onClose();\r\n              })\r\n              .catch(() => {\r\n                toaster.error(\"Couldn't save template\");\r\n              })\r\n              .finally(() => {\r\n                setLoadingEdit(false);\r\n              });\r\n          } else {\r\n            backend.templates\r\n              .update({\r\n                label,\r\n                group,\r\n                thumbnail,\r\n                thumbnailLabel,\r\n                id: (template as Template).id!,\r\n              })\r\n              .then(() => {\r\n                editorContext.syncTemplates({\r\n                  mode: \"edit\",\r\n                  template: template as Template,\r\n                });\r\n                toaster.success(\"Template updated!\");\r\n                props.onClose();\r\n              })\r\n              .catch(() => {\r\n                toaster.error(\"Couldn't update template\");\r\n              })\r\n              .finally(() => {\r\n                setLoadingEdit(false);\r\n              });\r\n          }\r\n        }}\r\n      >\r\n        {error && <div>{error}</div>}\r\n\r\n        <div\r\n          style={{\r\n            display: \"flex\",\r\n            flexDirection: \"column\",\r\n            gap: \"12px\",\r\n            marginTop: \"8px\",\r\n          }}\r\n        >\r\n          <FormElement name=\"label\" label=\"Name\">\r\n            <Input\r\n              placeholder=\"My template name\"\r\n              required={true}\r\n              value={label}\r\n              onChange={(e) => {\r\n                setTemplate({\r\n                  ...template,\r\n                  label: e.target.value,\r\n                });\r\n              }}\r\n              withBorder={true}\r\n              autoFocus\r\n            />\r\n          </FormElement>\r\n\r\n          <FormElement name=\"group\" label=\"Group\">\r\n            <Input\r\n              placeholder=\"My template group\"\r\n              value={group}\r\n              onChange={(e) => {\r\n                setTemplate({\r\n                  ...template,\r\n                  group: e.target.value,\r\n                });\r\n              }}\r\n              withBorder={true}\r\n              autoFocus\r\n            />\r\n          </FormElement>\r\n\r\n          <FormElement name=\"thumbnail\" label=\"Thumbnail url\">\r\n            <Input\r\n              placeholder=\"My template thumbnail url\"\r\n              value={thumbnail}\r\n              onChange={(e) => {\r\n                setTemplate({\r\n                  ...template,\r\n                  thumbnail: e.target.value,\r\n                });\r\n              }}\r\n              withBorder={true}\r\n              autoFocus\r\n            />\r\n          </FormElement>\r\n\r\n          <FormElement name=\"thumbnailLabel\" label=\"Thumbnail label\">\r\n            <Input\r\n              placeholder=\"My template thumbnail label\"\r\n              value={thumbnailLabel}\r\n              onChange={(e) => {\r\n                setTemplate({\r\n                  ...template,\r\n                  thumbnailLabel: e.target.value,\r\n                });\r\n              }}\r\n              withBorder={true}\r\n              autoFocus\r\n            />\r\n          </FormElement>\r\n\r\n          <div\r\n            style={{\r\n              display: \"flex\",\r\n              flexDirection: \"row\",\r\n              justifyContent: \"space-between\",\r\n              marginTop: 8,\r\n            }}\r\n          >\r\n            <div>\r\n              {mode === \"edit\" && (\r\n                <ButtonDanger\r\n                  onClick={(e: MouseEvent) => {\r\n                    e.preventDefault();\r\n\r\n                    setLoadingDelete(true);\r\n\r\n                    backend.templates\r\n                      .delete({ id: (template as Template).id! })\r\n                      .then(() => {\r\n                        editorContext.syncTemplates({\r\n                          mode: \"delete\",\r\n                          template: template as Template,\r\n                        });\r\n                        toaster.success(\"Template deleted\");\r\n                        props.onClose();\r\n                      })\r\n                      .catch(() => {\r\n                        toaster.error(\"Couldn't delete template\");\r\n                      })\r\n                      .finally(() => {\r\n                        setLoadingDelete(false);\r\n                      });\r\n                  }}\r\n                  isLoading={isLoadingDelete}\r\n                >\r\n                  Delete\r\n                </ButtonDanger>\r\n              )}\r\n            </div>\r\n\r\n            <ButtonPrimary\r\n              type={\"submit\"}\r\n              disabled={!canSend}\r\n              isLoading={isLoadingEdit}\r\n            >\r\n              {ctaLabel}\r\n            </ButtonPrimary>\r\n          </div>\r\n        </div>\r\n      </form>\r\n    </Modal>\r\n  );\r\n};\r\n","import {\r\n  NoCodeComponentEntry,\r\n  ComponentSchemaProp,\r\n  isNoCodeComponentOfType,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  CompilationContextType,\r\n  duplicateConfig,\r\n  findComponentDefinitionById,\r\n  parsePath,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport {\r\n  dotNotationGet,\r\n  last,\r\n  preOrderPathComparator,\r\n} from \"@/utils\";\r\nimport { EditorContextType } from \"./EditorContext\";\r\nimport { Form } from \"./form\";\r\nimport { ResolveDestination } from \"./paste/destinationResolver\";\r\nimport { PasteCommand } from \"./paste/manager\";\r\nimport {\r\n  DuplicateItemActionType,\r\n  MoveItemActionType,\r\n  RemoveItemActionType,\r\n} from \"./types\";\r\n\r\nfunction duplicateItem(\r\n  form: Form,\r\n  { name, sourceIndex, targetIndex }: DuplicateItemActionType,\r\n  compilationContext: CompilationContextType\r\n) {\r\n  // Placeholders are not copyable\r\n  if (isPlaceholder(name + \".\" + sourceIndex, form.values)) {\r\n    return;\r\n  }\r\n\r\n  const configToDuplicate = dotNotationGet(\r\n    form.values,\r\n    name + \".\" + sourceIndex\r\n  );\r\n\r\n  form.mutators.insert(\r\n    name,\r\n    targetIndex,\r\n    duplicateConfig(configToDuplicate, compilationContext)\r\n  );\r\n}\r\n\r\nfunction pasteItems({\r\n  what,\r\n  where,\r\n  resolveDestination,\r\n  pasteCommand,\r\n}: {\r\n  what: Array<NoCodeComponentEntry>;\r\n  where: Array<string>;\r\n  resolveDestination: ResolveDestination;\r\n  pasteCommand: PasteCommand;\r\n}): Array<string> | undefined {\r\n  const successfulInsertsPaths: string[] = [];\r\n\r\n  takeLastOfEachParent(where)\r\n    .sort(preOrderPathComparator())\r\n    .map((initialDestination) => {\r\n      const destination = successfulInsertsPaths.reduce(\r\n        (acc, current) => shiftPath(acc, current, \"downward\"),\r\n        initialDestination\r\n      );\r\n\r\n      const resolvedDestinations = resolveDestination(destination);\r\n\r\n      return pasteCommand(resolvedDestinations);\r\n    })\r\n    .forEach((paste) => {\r\n      what.forEach((item) => {\r\n        const insertedPath = paste(item);\r\n        if (insertedPath) {\r\n          successfulInsertsPaths.push(insertedPath);\r\n        }\r\n      });\r\n    });\r\n\r\n  return successfulInsertsPaths.length !== 0 ? successfulInsertsPaths : where;\r\n}\r\n\r\n/**\r\n * Duplicates fields given in `fieldNames` within given `form`.\r\n * `compilationContext` is used to properly duplicate elements associated with given names.\r\n * @returns Array of fields to focus\r\n */\r\nfunction duplicateItems(\r\n  form: Form,\r\n  fieldNames: Array<string>,\r\n  compilationContext: CompilationContextType\r\n): Array<string> | undefined {\r\n  const duplicatableFieldNames = fieldNames.filter((fieldName) =>\r\n    isFieldDuplicatable(fieldName, form, compilationContext)\r\n  );\r\n\r\n  if (duplicatableFieldNames.length === 0) {\r\n    return;\r\n  }\r\n\r\n  const fieldsGroupedByParentPath = groupFieldsByParentPath(\r\n    duplicatableFieldNames,\r\n    \"ascending\"\r\n  );\r\n\r\n  const nextFocusedFieldsPerGroup: Array<Array<string>> = [];\r\n\r\n  Object.values(fieldsGroupedByParentPath).forEach(\r\n    (sortedFields, fieldsGroupIndex) => {\r\n      nextFocusedFieldsPerGroup.push([]);\r\n\r\n      const lastFieldIndex = getFieldPathIndex(last(sortedFields));\r\n\r\n      sortedFields.forEach((focusedField, fieldIndex) => {\r\n        const sourceIndex = getFieldPathIndex(focusedField);\r\n        const targetIndex = lastFieldIndex + 1 + fieldIndex;\r\n        const parentPath = getParentPath(focusedField);\r\n\r\n        duplicateItem(\r\n          form,\r\n          {\r\n            name: parentPath,\r\n            sourceIndex,\r\n            targetIndex,\r\n          },\r\n          compilationContext\r\n        );\r\n\r\n        nextFocusedFieldsPerGroup[fieldsGroupIndex].push(\r\n          `${parentPath}.${lastFieldIndex + 1 + fieldIndex}`\r\n        );\r\n      });\r\n    }\r\n  );\r\n\r\n  return nextFocusedFieldsPerGroup.flat();\r\n}\r\n\r\nfunction moveItem(form: Form, { from, to, name }: MoveItemActionType) {\r\n  // Placeholders are not movable\r\n  if (isPlaceholder(name + \".\" + from, form.values)) {\r\n    return;\r\n  }\r\n\r\n  form.mutators.move(name, from, to);\r\n}\r\n\r\n/**\r\n * Moves fields given in `fieldNamesToRemove` within given `form` in given `direction`.\r\n * @returns Array of fields to focus.\r\n */\r\nfunction moveItems(\r\n  form: Form,\r\n  fieldsToMove: Array<string>,\r\n  direction: \"top\" | \"right\" | \"bottom\" | \"left\"\r\n): Array<string> | undefined {\r\n  const nextFocusedFields: Array<string> = [];\r\n  const isMovingMultipleFields = fieldsToMove.length > 1;\r\n\r\n  if (direction === \"top\" || direction === \"left\") {\r\n    const fieldsGroupedByParentPath = groupFieldsByParentPath(\r\n      fieldsToMove,\r\n      \"ascending\"\r\n    );\r\n\r\n    Object.values(fieldsGroupedByParentPath).forEach((sortedFields) => {\r\n      let wasAnyFieldWithinCurrentGroupMoved = false;\r\n\r\n      sortedFields.forEach((fieldName, fieldNameIndex) => {\r\n        const index = getFieldPathIndex(fieldName);\r\n        const parentPath = getParentPath(fieldName);\r\n\r\n        if (isFirst(fieldName)) {\r\n          if (isMovingMultipleFields) {\r\n            nextFocusedFields.push(fieldName);\r\n          }\r\n\r\n          return;\r\n        }\r\n\r\n        if (\r\n          isMovingMultipleFields &&\r\n          fieldNameIndex > 0 &&\r\n          !wasAnyFieldWithinCurrentGroupMoved\r\n        ) {\r\n          nextFocusedFields.push(fieldName);\r\n          return;\r\n        }\r\n\r\n        moveItem(form, {\r\n          from: index,\r\n          name: parentPath,\r\n          to: index - 1,\r\n        });\r\n\r\n        if (!wasAnyFieldWithinCurrentGroupMoved) {\r\n          wasAnyFieldWithinCurrentGroupMoved = true;\r\n        }\r\n\r\n        nextFocusedFields.push(`${parentPath}.${index - 1}`);\r\n      });\r\n    });\r\n\r\n    if (nextFocusedFields.length > 0) {\r\n      return nextFocusedFields;\r\n    }\r\n  } else {\r\n    const fieldsGroupedByParentPath = groupFieldsByParentPath(\r\n      fieldsToMove,\r\n      \"descending\"\r\n    );\r\n\r\n    Object.values(fieldsGroupedByParentPath).forEach((sortedFields) => {\r\n      let wasAnyFieldWithinCurrentGroupMoved = false;\r\n\r\n      sortedFields.forEach((fieldName, fieldNameIndex) => {\r\n        if (isLast(fieldName, form)) {\r\n          if (isMovingMultipleFields) {\r\n            nextFocusedFields.push(fieldName);\r\n          }\r\n\r\n          return;\r\n        }\r\n\r\n        if (\r\n          isMovingMultipleFields &&\r\n          fieldNameIndex > 0 &&\r\n          !wasAnyFieldWithinCurrentGroupMoved\r\n        ) {\r\n          nextFocusedFields.push(fieldName);\r\n          return;\r\n        }\r\n\r\n        const index = getFieldPathIndex(fieldName);\r\n        const parentPath = getParentPath(fieldName);\r\n\r\n        moveItem(form, {\r\n          name: parentPath,\r\n          from: index,\r\n          to: index + 1,\r\n        });\r\n\r\n        if (!wasAnyFieldWithinCurrentGroupMoved) {\r\n          wasAnyFieldWithinCurrentGroupMoved = true;\r\n        }\r\n\r\n        nextFocusedFields.push(`${parentPath}.${index + 1}`);\r\n      });\r\n    });\r\n\r\n    if (nextFocusedFields.length > 0) {\r\n      return nextFocusedFields;\r\n    }\r\n  }\r\n}\r\n\r\nfunction removeItem(form: Form, { index, name }: RemoveItemActionType) {\r\n  const configPathToRemove = name + \".\" + index;\r\n\r\n  // Placeholders are not removable\r\n  if (isPlaceholder(configPathToRemove, form.values)) {\r\n    return;\r\n  }\r\n\r\n  const componentConfigValue = dotNotationGet(form.values, name);\r\n\r\n  if (componentConfigValue.length === 1) {\r\n    form.change(name, []);\r\n  } else {\r\n    form.mutators.remove(name, index);\r\n  }\r\n}\r\n\r\n/**\r\n * Removes fields given in `fieldNamesToRemove` from given `form`.\r\n * @returns Array of fields to focus\r\n */\r\nfunction removeItems(\r\n  form: Form,\r\n  fieldNamesToRemove: Array<string>,\r\n  compilationContext: CompilationContextType\r\n): Array<string> | undefined {\r\n  const removableFieldNames = fieldNamesToRemove.filter((fieldName) =>\r\n    isFieldRemovable(fieldName, form, compilationContext)\r\n  );\r\n\r\n  if (removableFieldNames.length === 0) {\r\n    return;\r\n  }\r\n\r\n  const isRemovingMultipleFields = removableFieldNames.length > 1;\r\n\r\n  const fieldsGroupedByParentPath = groupFieldsByParentPath(\r\n    removableFieldNames,\r\n    \"descending\"\r\n  );\r\n\r\n  if (!isRemovingMultipleFields) {\r\n    const { index, parent, templateId } = parsePath(\r\n      removableFieldNames[0],\r\n      form\r\n    );\r\n\r\n    if (index === undefined || !parent) {\r\n      throw new Error(\"Invalid path\");\r\n    }\r\n\r\n    const fieldPath = `${parent.path}${parent.path === \"\" ? \"\" : \".\"}${parent.fieldName\r\n      }`;\r\n    const itemsLength = dotNotationGet(form.values, fieldPath).length;\r\n    const isOnlyItem = itemsLength === 1;\r\n    const isLastItem = itemsLength - 1 === index;\r\n\r\n    removeItem(form, {\r\n      index,\r\n      name: fieldPath,\r\n    });\r\n\r\n    const definition = findComponentDefinitionById(\r\n      templateId,\r\n      compilationContext\r\n    );\r\n    const isTextWrapper =\r\n      definition &&\r\n      isNoCodeComponentOfType(definition, \"@easyblocks/text-wrapper\");\r\n\r\n    // If we're removing item from the text wrapper field let's focus the component holding that field for better UX\r\n    // TODO: We shouldn't decide based on the component type but rather on the source of the removal (canvas vs sidebar)\r\n    if (isTextWrapper) {\r\n      return [parent.path];\r\n    }\r\n\r\n    if (isOnlyItem) {\r\n      return [];\r\n    } else if (isLastItem) {\r\n      return [`${fieldPath}.${index - 1}`];\r\n    } else {\r\n      return [`${fieldPath}.${index}`];\r\n    }\r\n  }\r\n\r\n  Object.values(fieldsGroupedByParentPath).forEach((sortedFields) => {\r\n    sortedFields.forEach((focusedField) => {\r\n      const field = dotNotationGet(form.values, focusedField);\r\n\r\n      // Field could be already removed if its parent element was also selected\r\n      if (!field) {\r\n        return;\r\n      }\r\n\r\n      const index = getFieldPathIndex(focusedField);\r\n      const parentPath = getParentPath(focusedField);\r\n\r\n      removeItem(form, {\r\n        index,\r\n        name: parentPath,\r\n      });\r\n    });\r\n  });\r\n\r\n  return [];\r\n}\r\n\r\nfunction replaceItems(\r\n  paths: string[],\r\n  newConfig: NoCodeComponentEntry,\r\n  editorContext: EditorContextType\r\n) {\r\n  paths.forEach((path) => {\r\n    const oldConfig: NoCodeComponentEntry = dotNotationGet(\r\n      editorContext.form.values,\r\n      path\r\n    );\r\n\r\n    editorContext.form.change(\r\n      path,\r\n      duplicateConfig(\r\n        // newConfig && oldConfig\r\n        //   ? changeComponentConfig(oldConfig, newConfig, editorContext)\r\n        //   : newConfig,\r\n        newConfig,\r\n        editorContext\r\n      )\r\n    );\r\n  });\r\n}\r\n\r\nfunction logItems(form: Form, configPaths: Array<string>) {\r\n  const configValues = configPaths.map((configPath) => {\r\n    return dotNotationGet(form.values, configPath);\r\n  });\r\n\r\n  configValues.forEach((config, index) => {\r\n    console.log(\"Config for\", configPaths[index], config);\r\n  });\r\n}\r\n\r\nexport {\r\n  duplicateItems,\r\n  logItems,\r\n  moveItems,\r\n  pasteItems,\r\n  removeItems,\r\n  replaceItems,\r\n};\r\n\r\nfunction groupFieldsByParentPath(\r\n  fields: Array<string>,\r\n  sortDirection: \"ascending\" | \"descending\"\r\n): Record<string, Array<string>> {\r\n  const fieldsIndicesGroupedByParentPath = fields.reduce(\r\n    (accumulator, currentField) => {\r\n      const index = getFieldPathIndex(currentField);\r\n      const parentPath = getParentPath(currentField);\r\n\r\n      const indices = accumulator[parentPath];\r\n\r\n      if (indices) {\r\n        accumulator[parentPath] = [...indices, index].sort((a, b) => {\r\n          return sortDirection === \"descending\" ? b - a : a - b;\r\n        });\r\n        return accumulator;\r\n      }\r\n\r\n      accumulator[parentPath] = [index];\r\n\r\n      return accumulator;\r\n    },\r\n    {} as Record<string, Array<number>>\r\n  );\r\n\r\n  return Object.fromEntries(\r\n    Object.entries(fieldsIndicesGroupedByParentPath).map(\r\n      ([parentPath, indices]) => {\r\n        return [parentPath, indices.map((index) => parentPath + \".\" + index)];\r\n      }\r\n    )\r\n  );\r\n}\r\n\r\nfunction getFieldPathIndex(fieldPath: string): number {\r\n  const index = +last(fieldPath.split(\".\"));\r\n\r\n  if (Number.isNaN(index)) {\r\n    return -1;\r\n  }\r\n\r\n  return index;\r\n}\r\n\r\nfunction getParentPath(fieldPath: string): string {\r\n  const fieldPathParts = fieldPath.split(\".\");\r\n\r\n  return fieldPathParts.slice(0, -1).join(\".\");\r\n}\r\n\r\nfunction isFirst(fieldPath: string): boolean {\r\n  const index = getFieldPathIndex(fieldPath);\r\n\r\n  return index === 0;\r\n}\r\n\r\nfunction isLast(fieldPath: string, form: Form): boolean {\r\n  const index = getFieldPathIndex(fieldPath);\r\n  const parentPath = getParentPath(fieldPath);\r\n  const parentFieldElementsCount = dotNotationGet(\r\n    form.values,\r\n    parentPath\r\n  ).length;\r\n\r\n  return index === parentFieldElementsCount - 1;\r\n}\r\n\r\nfunction isPlaceholder(path: string, values: any) {\r\n  const templateId = dotNotationGet(values, path)._component;\r\n  return templateId.startsWith(\"$Placeholder\");\r\n}\r\n\r\nfunction isFieldRemovable(\r\n  fieldName: string,\r\n  form: Form,\r\n  compilationContext: CompilationContextType\r\n): boolean {\r\n  const { parent } = parsePath(fieldName, form);\r\n\r\n  if (parent) {\r\n    const parentComponentDefinition = findComponentDefinitionById(\r\n      parent.templateId,\r\n      compilationContext\r\n    );\r\n\r\n    const fieldNameParent = last(getParentPath(fieldName).split(\".\"));\r\n    const fieldSchema = parentComponentDefinition?.schema.find(\r\n      (schema) => schema.prop === fieldNameParent\r\n    );\r\n\r\n    if (\r\n      fieldSchema &&\r\n      fieldSchema.type === \"component\" &&\r\n      (fieldSchema as ComponentSchemaProp).required\r\n    ) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction isFieldDuplicatable(\r\n  fieldName: string,\r\n  form: Form,\r\n  compilationContext: CompilationContextType\r\n): boolean {\r\n  return isFieldRemovable(fieldName, form, compilationContext);\r\n}\r\n\r\nexport const shiftPath = (\r\n  originalPath: string,\r\n  shiftingPath: string,\r\n  direction: \"upward\" | \"downward\" = \"downward\"\r\n) => {\r\n  const directionFactor = direction === \"downward\" ? 1 : -1;\r\n\r\n  const original = shiftingPath.split(\".\");\r\n  const shifting = originalPath.split(\".\");\r\n\r\n  if (original.length < 2) {\r\n    return originalPath;\r\n  }\r\n\r\n  let index = 0;\r\n\r\n  while (index < original.length - 1 && index < shifting.length - 1) {\r\n    if (shifting[index] !== original[index]) {\r\n      return originalPath;\r\n    }\r\n\r\n    if (shifting[index + 1] !== original[index + 1]) {\r\n      const numberA = Number(original[index + 1]);\r\n      const numberB = Number(shifting[index + 1]);\r\n\r\n      if (\r\n        numberA < numberB &&\r\n        (index + 1 == original.length - 1 || index + 1 === shifting.length - 1)\r\n      ) {\r\n        shifting.splice(index + 1, 1, String(numberB + directionFactor));\r\n        return shifting.join(\".\");\r\n      } else {\r\n        return originalPath;\r\n      }\r\n    }\r\n    index += 2;\r\n  }\r\n\r\n  return originalPath;\r\n};\r\n\r\nexport function takeLastOfEachParent(where: string[]) {\r\n  const lastOfEachParent = where.reduce((acc, curr) => {\r\n    const trimmed = getParentPath(curr);\r\n    const index = getFieldPathIndex(curr);\r\n\r\n    acc[trimmed] = Math.max(index, acc[trimmed] ?? Number.MIN_SAFE_INTEGER);\r\n\r\n    return acc;\r\n  }, {} as Record<string, number>);\r\n\r\n  return Object.entries(lastOfEachParent).map(\r\n    ([key, value]) => `${key}.${value}`\r\n  );\r\n}\r\n","import { CompilationContextType } from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { normalize } from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { NoCodeComponentEntry } from \"@redsun-vn/easyblocks-core\";\r\n\r\nexport function reconcile({\r\n  context,\r\n  templateId,\r\n  fieldName,\r\n}: {\r\n  context: CompilationContextType;\r\n  templateId?: string;\r\n  fieldName?: string;\r\n}) {\r\n  return (item: NoCodeComponentEntry) => {\r\n    if (!fieldName || !templateId) {\r\n      return item;\r\n    }\r\n\r\n    const contextMatches =\r\n      item._itemProps?.[templateId]?.[fieldName] !== undefined;\r\n\r\n    if (contextMatches) {\r\n      return item;\r\n    }\r\n\r\n    return normalize(\r\n      {\r\n        ...item,\r\n        _itemProps: {\r\n          [templateId]: {\r\n            [fieldName]: {},\r\n          },\r\n        },\r\n      },\r\n      context\r\n    );\r\n  };\r\n}\r\n","import {\r\n  ComponentCollectionSchemaProp,\r\n  NoCodeComponentEntry,\r\n  ComponentSchemaProp,\r\n  SchemaProp,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  CompilationContextType,\r\n  duplicateConfig,\r\n  findComponentDefinition,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { includesAny } from \"@/utils\";\r\nimport { Form } from \"../form\";\r\nimport { normalizeToStringArray } from \"../normalizeToStringArray\";\r\nimport { reconcile } from \"./reconcile\";\r\n\r\nconst getTypes = (schema?: SchemaProp) => {\r\n  if (schema?.type === \"component-collection\" || schema?.type === \"component\") {\r\n    return (schema as ComponentCollectionSchemaProp | ComponentSchemaProp)\r\n      .accepts;\r\n  }\r\n  return [];\r\n};\r\n\r\nconst insertCommand = ({\r\n  context,\r\n  form,\r\n  schema,\r\n  templateId,\r\n}: {\r\n  context: CompilationContextType;\r\n  form: Form;\r\n  schema?: SchemaProp;\r\n  templateId?: string;\r\n}) => {\r\n  const types = getTypes(schema);\r\n\r\n  const reconcileItem = reconcile({\r\n    context,\r\n    templateId,\r\n    fieldName: schema?.prop,\r\n  });\r\n\r\n  return (path: string, index: number, item: NoCodeComponentEntry) => {\r\n    const itemDefinition = findComponentDefinition(item, context);\r\n    if (!itemDefinition) {\r\n      return null;\r\n    }\r\n\r\n    const itemTypes = [\r\n      itemDefinition.id,\r\n      ...normalizeToStringArray(itemDefinition.type),\r\n    ];\r\n    if (!includesAny(types, itemTypes)) {\r\n      return null;\r\n    }\r\n\r\n    const reconciledItem = reconcileItem(item);\r\n    const duplicatedItem = duplicateConfig(reconciledItem, context);\r\n\r\n    form.mutators.insert(path, index, duplicatedItem);\r\n\r\n    return `${path}.${index}`;\r\n  };\r\n};\r\n\r\nexport { insertCommand };\r\n","import { SchemaProp } from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  CompilationContextType,\r\n  InternalRenderableComponentDefinition,\r\n  PathInfo,\r\n  findComponentDefinitionById,\r\n  parsePath,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { dotNotationGet } from \"@/utils\";\r\nimport { Form } from \"../form\";\r\nimport { insertCommand } from \"./insert\";\r\n\r\nexport interface Destination {\r\n  name: string;\r\n  index: number;\r\n  insert: ReturnType<typeof insertCommand>;\r\n}\r\n\r\nexport type ResolveDestination = ReturnType<typeof destinationResolver>;\r\n\r\nfunction getSchema(path: PathInfo, context: CompilationContextType) {\r\n  const parentDefinition = findComponentDefinitionById(\r\n    path.parent?.templateId ?? \"\",\r\n    context\r\n  );\r\n\r\n  const schema = (parentDefinition?.schema ?? []).find(\r\n    (s) => s.prop === path.parent?.fieldName\r\n  );\r\n\r\n  return schema;\r\n}\r\n\r\nconst toName = (destination: PathInfo) =>\r\n  [destination.parent?.path, destination.parent?.fieldName]\r\n    .filter(Boolean)\r\n    .join(\".\");\r\n\r\nconst fixIndexInCollection = (index = 0, schema?: SchemaProp) => {\r\n  if (schema?.type === \"component-collection\") {\r\n    return index + 1;\r\n  }\r\n  return index;\r\n};\r\n\r\nfunction destinationResolver({\r\n  form,\r\n  context,\r\n}: {\r\n  context: CompilationContextType;\r\n  form: Form;\r\n}) {\r\n  return function (initialDestinationPath: string) {\r\n    const resolvedDestinations: Destination[] = [];\r\n\r\n    const resolvedPaths = new Set<string>();\r\n    const pathsQueue = [initialDestinationPath];\r\n\r\n    while (pathsQueue.length > 0) {\r\n      const path = pathsQueue.shift();\r\n      if (!path) {\r\n        continue;\r\n      }\r\n\r\n      if (resolvedPaths.has(path)) {\r\n        continue;\r\n      }\r\n\r\n      if (!dotNotationGet(form.values, path)) {\r\n        continue;\r\n      }\r\n\r\n      const parsed = parsePath(path, form);\r\n\r\n      const definition = findComponentDefinitionById(\r\n        parsed.templateId ?? \"\",\r\n        context\r\n      );\r\n\r\n      if (!definition) {\r\n        continue;\r\n      }\r\n\r\n      const schema = getSchema(parsed, context);\r\n\r\n      resolvedDestinations.push({\r\n        index: fixIndexInCollection(parsed.index, schema),\r\n        name: toName(parsed),\r\n        insert: insertCommand({\r\n          context,\r\n          form,\r\n          schema,\r\n          templateId: parsed.parent?.templateId,\r\n        }),\r\n      });\r\n\r\n      for (const slot of (definition as InternalRenderableComponentDefinition)\r\n        .pasteSlots ?? []) {\r\n        const slotSchema = definition.schema.find(({ prop }) => prop === slot);\r\n\r\n        if (!slotSchema) {\r\n          continue;\r\n        }\r\n\r\n        const slotPath = `${path}.${slot}`;\r\n\r\n        const slotValues = dotNotationGet(form.values, slotPath) ?? [];\r\n\r\n        if (slotValues.length === 0) {\r\n          resolvedDestinations.push({\r\n            name: slotPath,\r\n            index: 0,\r\n            insert: insertCommand({\r\n              context,\r\n              form,\r\n              schema: slotSchema,\r\n              templateId: definition.id,\r\n            }),\r\n          });\r\n        } else if (slotSchema.type === \"component\") {\r\n          pathsQueue.push(`${slotPath}.0`);\r\n        } else if (slotSchema.type === \"component-collection\") {\r\n          pathsQueue.push(\r\n            ...Array.from(Array(slotValues.length).keys())\r\n              .map((idx) => `${slotPath}.${idx}`)\r\n              .reverse()\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    return resolvedDestinations;\r\n  };\r\n}\r\n\r\nexport { destinationResolver };\r\n","import { NoCodeComponentEntry } from \"@redsun-vn/easyblocks-core\";\r\nimport { Destination } from \"./destinationResolver\";\r\n\r\nfunction pasteManager() {\r\n  const inserts = new Map<string, number>();\r\n  return (destinations: Destination[]) => (item: NoCodeComponentEntry) => {\r\n    let i = 0;\r\n\r\n    while (i < destinations.length) {\r\n      const { index, name, insert } = destinations[i];\r\n\r\n      const path = `${name}.${index}`;\r\n      const latestDestinationInserts = inserts.get(path) ?? 0;\r\n\r\n      const result = insert(name, index + latestDestinationInserts, item);\r\n\r\n      if (result) {\r\n        inserts.set(path, latestDestinationInserts + 1);\r\n        return result;\r\n      }\r\n\r\n      i++;\r\n    }\r\n\r\n    return null;\r\n  };\r\n}\r\n\r\nexport type PasteCommand = ReturnType<typeof pasteManager>;\r\n\r\nexport { pasteManager };\r\n","function editorVariable<T extends string>(name: T): `--shopstory-editor-${T}` {\r\n  return `--shopstory-editor-${name}`;\r\n}\r\n\r\nconst BEFORE_ADD_BUTTON_DISPLAY = editorVariable(\"before-add-button-display\");\r\nconst BEFORE_ADD_BUTTON_TOP = editorVariable(\"before-add-button-top\");\r\nconst BEFORE_ADD_BUTTON_LEFT = editorVariable(\"before-add-button-left\");\r\n\r\nconst AFTER_ADD_BUTTON_DISPLAY = editorVariable(\"after-add-button-display\");\r\nconst AFTER_ADD_BUTTON_TOP = editorVariable(\"after-add-button-top\");\r\nconst AFTER_ADD_BUTTON_LEFT = editorVariable(\"after-add-button-left\");\r\n\r\nexport {\r\n  BEFORE_ADD_BUTTON_DISPLAY,\r\n  BEFORE_ADD_BUTTON_TOP,\r\n  BEFORE_ADD_BUTTON_LEFT,\r\n  AFTER_ADD_BUTTON_DISPLAY,\r\n  AFTER_ADD_BUTTON_TOP,\r\n  AFTER_ADD_BUTTON_LEFT,\r\n};\r\n","import React from \"react\";\r\nimport { styled, css } from \"styled-components\";\r\nimport { IconButton, ICON_BUTTON_SIZE } from \"../tinacms/styles\";\r\nimport {\r\n  AFTER_ADD_BUTTON_DISPLAY,\r\n  AFTER_ADD_BUTTON_LEFT,\r\n  AFTER_ADD_BUTTON_TOP,\r\n  BEFORE_ADD_BUTTON_DISPLAY,\r\n  BEFORE_ADD_BUTTON_LEFT,\r\n  BEFORE_ADD_BUTTON_TOP,\r\n} from \"./cssVariables\";\r\n\r\ninterface AddButtonProps {\r\n  position: \"before\" | \"after\";\r\n  index?: number;\r\n  offset?: number | { x: number; y: number };\r\n  onClick?: () => void;\r\n}\r\n\r\nfunction AddButton({ position, index, offset, onClick }: AddButtonProps) {\r\n  const [isOpen, setIsOpen] = React.useState(false);\r\n  const addBlockButtonRef = React.useRef<HTMLButtonElement>(null);\r\n\r\n  const handleOpenBlockMenu = (event: React.MouseEvent) => {\r\n    event.stopPropagation();\r\n    event.preventDefault();\r\n\r\n    // Custom add action\r\n    if (onClick) {\r\n      onClick();\r\n      return;\r\n    }\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    const inactivateBlockMenu = () => setIsOpen(false);\r\n    document.addEventListener(\"mouseup\", inactivateBlockMenu, false);\r\n    return () => document.removeEventListener(\"mouseup\", inactivateBlockMenu);\r\n  }, []);\r\n\r\n  return (\r\n    <AddButtonWrapper\r\n      index={index}\r\n      offset={offset}\r\n      position={position}\r\n      isOpen={isOpen}\r\n    >\r\n      <AddIconButton\r\n        ref={addBlockButtonRef}\r\n        onClick={handleOpenBlockMenu}\r\n        isOpen={isOpen}\r\n        primary\r\n        small\r\n      >\r\n        <svg\r\n          xmlns=\"http://www.w3.org/2000/svg\"\r\n          width=\"18\"\r\n          height=\"18\"\r\n          viewBox=\"0 0 23 23\"\r\n          fill=\"none\"\r\n        >\r\n          <line x1=\"11.5\" y1=\"4\" x2=\"11.5\" y2=\"19\" stroke=\"currentColor\" />\r\n          <line x1=\"4\" y1=\"11.5\" x2=\"19\" y2=\"11.5\" stroke=\"currentColor\" />\r\n        </svg>\r\n      </AddIconButton>\r\n    </AddButtonWrapper>\r\n  );\r\n}\r\n\r\nexport { AddButton, ICON_BUTTON_SIZE as ADD_BUTTON_SIZE };\r\n\r\ninterface AddMenuProps {\r\n  isOpen?: boolean;\r\n  active?: boolean;\r\n  openTop?: boolean;\r\n}\r\n\r\nconst AddIconButton = styled(IconButton)<AddMenuProps>`\r\n  display: flex;\r\n  align-items: center;\r\n\r\n  &:focus {\r\n    outline: none !important;\r\n  }\r\n\r\n  ${(props) =>\r\n    props.isOpen &&\r\n    css`\r\n      pointer-events: none;\r\n    `};\r\n`;\r\n\r\ninterface AddButtonWrapperProps {\r\n  index?: number;\r\n  offset?: number | { x: number; y: number };\r\n  position: \"before\" | \"after\";\r\n  isOpen: boolean;\r\n}\r\n\r\nconst AddButtonWrapper = styled.div<AddButtonWrapperProps>`\r\n  position: absolute;\r\n\r\n  top: var(\r\n    ${({ position }) =>\r\n      position === \"before\" ? BEFORE_ADD_BUTTON_TOP : AFTER_ADD_BUTTON_TOP}\r\n  );\r\n  left: var(\r\n    ${({ position }) =>\r\n      position === \"before\" ? BEFORE_ADD_BUTTON_LEFT : AFTER_ADD_BUTTON_LEFT}\r\n  );\r\n\r\n  display: var(\r\n    ${({ position }) =>\r\n      position === \"before\"\r\n        ? BEFORE_ADD_BUTTON_DISPLAY\r\n        : AFTER_ADD_BUTTON_DISPLAY},\r\n    none\r\n  );\r\n\r\n  pointer-events: all;\r\n`;\r\n","import { styled } from \"styled-components\";\r\n\r\nconst Wrapper = styled.div`\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  bottom: 0;\r\n  right: 0;\r\n  display: grid;\r\n  place-items: center;\r\n  pointer-events: none;\r\n`;\r\n\r\ntype FrameWrapperProps = {\r\n  width: number;\r\n  height: number;\r\n  transform: string;\r\n};\r\n\r\nconst FrameWrapper = styled.div.attrs<FrameWrapperProps>(\r\n  ({ width, height, transform }) => {\r\n    return {\r\n      style: {\r\n        width,\r\n        height,\r\n        transform,\r\n      },\r\n    };\r\n  }\r\n)`\r\n  position: relative;\r\n  z-index: 1;\r\n\r\n  display: grid;\r\n  place-items: center;\r\n\r\n  transform-origin: left;\r\n`;\r\n\r\nexport { Wrapper, FrameWrapper };\r\n","import type { EditingInfoBase } from \"@redsun-vn/easyblocks-core\";\r\nimport { ADD_BUTTON_SIZE } from \"./AddButton\";\r\n\r\nfunction calculateAddButtonsProperties(\r\n  direction: Required<EditingInfoBase>[\"direction\"],\r\n  targetElementRect: DOMRect,\r\n  viewport: {\r\n    width: number;\r\n    height: number;\r\n  },\r\n  containerElementRect?: DOMRect\r\n): {\r\n  before: { top: number; left: number; display: \"block\" | \"none\" };\r\n  after: { top: number; left: number; display: \"block\" | \"none\" };\r\n} {\r\n  const halfButtonSize = Math.floor(ADD_BUTTON_SIZE / 2);\r\n\r\n  if (direction === \"vertical\") {\r\n    const beforeButtonTopOffset = Math.floor(\r\n      targetElementRect.top - halfButtonSize\r\n    );\r\n    const afterButtonTopOffset = Math.floor(\r\n      targetElementRect.top + targetElementRect.height - halfButtonSize\r\n    );\r\n    const buttonsLeftOffset = Math.floor(\r\n      targetElementRect.left + targetElementRect.width / 2 - halfButtonSize\r\n    );\r\n\r\n    const isBeforeButtonWithinViewport = isButtonWithinViewport(\r\n      {\r\n        top: beforeButtonTopOffset + halfButtonSize,\r\n        left: buttonsLeftOffset + halfButtonSize,\r\n      },\r\n      viewport\r\n    );\r\n\r\n    const isAfterButtonWithinViewport = isButtonWithinViewport(\r\n      {\r\n        top: afterButtonTopOffset + halfButtonSize,\r\n        left: buttonsLeftOffset + halfButtonSize,\r\n      },\r\n      viewport\r\n    );\r\n\r\n    if (containerElementRect) {\r\n      return {\r\n        before: {\r\n          top: beforeButtonTopOffset,\r\n          left: buttonsLeftOffset,\r\n          display:\r\n            isBeforeButtonWithinViewport\r\n              ? \"block\"\r\n              : \"none\",\r\n        },\r\n        after: {\r\n          top: afterButtonTopOffset,\r\n          left: buttonsLeftOffset,\r\n          display:\r\n            isAfterButtonWithinViewport\r\n              ? \"block\"\r\n              : \"none\",\r\n        },\r\n      };\r\n    } else {\r\n      return {\r\n        before: {\r\n          top: beforeButtonTopOffset,\r\n          left: buttonsLeftOffset,\r\n          display: isBeforeButtonWithinViewport ? \"block\" : \"none\",\r\n        },\r\n        after: {\r\n          top: afterButtonTopOffset,\r\n          left: buttonsLeftOffset,\r\n          display: isAfterButtonWithinViewport ? \"block\" : \"none\",\r\n        },\r\n      };\r\n    }\r\n  } else {\r\n    const buttonsTopOffset = Math.floor(\r\n      targetElementRect.top + targetElementRect.height / 2 - halfButtonSize\r\n    );\r\n    const beforeButtonLeftOffset = Math.floor(\r\n      targetElementRect.left - halfButtonSize\r\n    );\r\n    const afterButtonLeftOffset = Math.floor(\r\n      targetElementRect.left + targetElementRect.width - halfButtonSize\r\n    );\r\n\r\n    const isBeforeButtonWithinViewport = isButtonWithinViewport(\r\n      {\r\n        top: buttonsTopOffset + halfButtonSize,\r\n        left: beforeButtonLeftOffset + halfButtonSize,\r\n      },\r\n      viewport\r\n    );\r\n    const isAfterButtonWithinViewport = isButtonWithinViewport(\r\n      {\r\n        top: buttonsTopOffset + halfButtonSize,\r\n        left: afterButtonLeftOffset + halfButtonSize,\r\n      },\r\n      viewport\r\n    );\r\n\r\n    if (containerElementRect) {\r\n      return {\r\n        before: {\r\n          top: buttonsTopOffset,\r\n          left: beforeButtonLeftOffset,\r\n          display: isBeforeButtonWithinViewport ? \"block\" : \"none\",\r\n        },\r\n        after: {\r\n          top: buttonsTopOffset,\r\n          left: afterButtonLeftOffset,\r\n          display: isAfterButtonWithinViewport ? \"block\" : \"none\",\r\n        },\r\n      };\r\n    } else {\r\n      return {\r\n        before: {\r\n          top: buttonsTopOffset,\r\n          left: beforeButtonLeftOffset,\r\n          display: isBeforeButtonWithinViewport ? \"block\" : \"none\",\r\n        },\r\n        after: {\r\n          top: buttonsTopOffset,\r\n          left: afterButtonLeftOffset,\r\n          display: isAfterButtonWithinViewport ? \"block\" : \"none\",\r\n        },\r\n      };\r\n    }\r\n  }\r\n}\r\n\r\nexport { calculateAddButtonsProperties };\r\n\r\nfunction isButtonWithinViewport(\r\n  target: { top: number; left: number },\r\n  viewport: { width: number; height: number }\r\n) {\r\n  return (\r\n    target.top >= 0 &&\r\n    target.top <= viewport.height &&\r\n    target.left >= 0 &&\r\n    target.left <= viewport.width\r\n  );\r\n}\r\n\r\nfunction isButtonWithinContainer(\r\n  target: { top: number; left: number },\r\n  container: DOMRect\r\n) {\r\n  return (\r\n    target.top >= container.top &&\r\n    target.top <= container.bottom &&\r\n    target.left >= container.left &&\r\n    target.left <= container.right\r\n  );\r\n}\r\n","import {\r\n  CompiledShopstoryComponentConfig,\r\n  EditingInfoBase,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  SelectionFramePositionChangedEvent,\r\n  findComponentDefinitionById,\r\n  isSchemaPropCollection,\r\n  parsePath,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { dotNotationGet } from \"@/utils\";\r\nimport React, { useLayoutEffect } from \"react\";\r\nimport { EditorContextType, useEditorContext } from \"../EditorContext\";\r\nimport { pathToCompiledPath } from \"../pathToCompiledPath\";\r\nimport { AddButton } from \"./AddButton\";\r\nimport { FrameWrapper, Wrapper } from \"./SelectionFrame.styles\";\r\nimport { calculateAddButtonsProperties } from \"./calculateAddButtonProperties\";\r\nimport {\r\n  AFTER_ADD_BUTTON_DISPLAY,\r\n  AFTER_ADD_BUTTON_LEFT,\r\n  AFTER_ADD_BUTTON_TOP,\r\n  BEFORE_ADD_BUTTON_DISPLAY,\r\n  BEFORE_ADD_BUTTON_LEFT,\r\n  BEFORE_ADD_BUTTON_TOP,\r\n} from \"./cssVariables\";\r\nimport {\r\n  isConfigPathRichTextPart,\r\n  RICH_TEXT_PART_CONFIG_PATH_REGEXP,\r\n} from \"../utils/isConfigPathRichTextPart\";\r\n\r\ntype SelectionFrameProps = {\r\n  width: number;\r\n  height: number;\r\n  transform: string;\r\n};\r\n\r\nfunction SelectionFrame({ width, height, transform }: SelectionFrameProps) {\r\n  const editorContext = useEditorContext();\r\n  const { focussedField, form, actions } = editorContext;\r\n\r\n  const compiledFocusedField =\r\n    focussedField.length === 1\r\n      ? pathToCompiledPath(focussedField[0], editorContext)\r\n      : undefined;\r\n\r\n  const compiledComponentConfig: CompiledShopstoryComponentConfig =\r\n    compiledFocusedField\r\n      ? dotNotationGet(\r\n          editorContext.compiledComponentConfig,\r\n          compiledFocusedField\r\n        )\r\n      : undefined;\r\n\r\n  const { direction = \"vertical\" } = compiledComponentConfig?.__editing ?? {};\r\n\r\n  const isAddingEnabled = isAddingEnabledForSelectedFields(\r\n    focussedField,\r\n    editorContext\r\n  );\r\n\r\n  useLayoutEffect(() => {\r\n    if (focussedField.length === 0) {\r\n      hideAddButtons();\r\n    }\r\n  }, [focussedField]);\r\n\r\n  useLayoutEffect(() => {\r\n    function handleSelectionFrameMessages(\r\n      event: SelectionFramePositionChangedEvent\r\n    ) {\r\n      if (!isAddingEnabled) {\r\n        hideAddButtons();\r\n        return;\r\n      }\r\n\r\n      if (\r\n        event.data.type ===\r\n        \"@easyblocks-editor/selection-frame-position-changed\"\r\n      ) {\r\n        updateAddButtons(\r\n          direction,\r\n          event.data.payload.target,\r\n          {\r\n            width,\r\n            height,\r\n          },\r\n          event.data.payload.container\r\n        );\r\n      }\r\n    }\r\n\r\n    window.addEventListener(\"message\", handleSelectionFrameMessages);\r\n\r\n    return () => {\r\n      window.removeEventListener(\"message\", handleSelectionFrameMessages);\r\n    };\r\n  }, [direction, height, isAddingEnabled, width]);\r\n\r\n  async function handleAddButtonClick(which: \"before\" | \"after\") {\r\n    let path = focussedField.length === 1 ? focussedField[0] : undefined;\r\n\r\n    if (!path) {\r\n      return;\r\n    }\r\n\r\n    if (isConfigPathRichTextPart(path)) {\r\n      path = path.replace(RICH_TEXT_PART_CONFIG_PATH_REGEXP, \"\");\r\n    }\r\n\r\n    const { parent, index } = parsePath(path, form);\r\n\r\n    if (!parent || index === undefined) {\r\n      return;\r\n    }\r\n\r\n    const definition = findComponentDefinitionById(\r\n      parent.templateId,\r\n      editorContext\r\n    );\r\n\r\n    const schemaProp = definition?.schema.find(\r\n      (schemaProp) => schemaProp.prop === parent.fieldName\r\n    );\r\n\r\n    if (!schemaProp) {\r\n      return;\r\n    }\r\n\r\n    const parentPath =\r\n      parent.path + (parent.path === \"\" ? \"\" : \".\") + parent.fieldName;\r\n\r\n    const config = await actions.openComponentPicker({ path: parentPath });\r\n\r\n    if (config) {\r\n      actions.insertItem({\r\n        name:\r\n          schemaProp.type === \"component-collection-localised\"\r\n            ? `${parentPath}.${editorContext.contextParams.locale}`\r\n            : parentPath,\r\n        index: which === \"before\" ? index : index + 1,\r\n        block: config,\r\n      });\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Wrapper>\r\n      <FrameWrapper width={width} height={height} transform={transform}>\r\n        <AddButton\r\n          position=\"before\"\r\n          onClick={() => handleAddButtonClick(\"before\")}\r\n        />\r\n        <AddButton\r\n          position=\"after\"\r\n          onClick={() => handleAddButtonClick(\"after\")}\r\n        />\r\n      </FrameWrapper>\r\n    </Wrapper>\r\n  );\r\n}\r\n\r\nexport { SelectionFrame };\r\n\r\nfunction updateAddButtons(\r\n  direction: Required<EditingInfoBase>[\"direction\"],\r\n  targetElementRect: DOMRect,\r\n  viewport: {\r\n    width: number;\r\n    height: number;\r\n  },\r\n  containerElementRect?: DOMRect\r\n) {\r\n  const { after, before } = calculateAddButtonsProperties(\r\n    direction,\r\n    targetElementRect,\r\n    viewport,\r\n    containerElementRect\r\n  );\r\n\r\n  setCssVariable(BEFORE_ADD_BUTTON_TOP, before.top + \"px\");\r\n  setCssVariable(BEFORE_ADD_BUTTON_LEFT, before.left + \"px\");\r\n  setCssVariable(AFTER_ADD_BUTTON_TOP, after.top + \"px\");\r\n  setCssVariable(AFTER_ADD_BUTTON_LEFT, after.left + \"px\");\r\n  setCssVariable(BEFORE_ADD_BUTTON_DISPLAY, before.display);\r\n  setCssVariable(AFTER_ADD_BUTTON_DISPLAY, after.display);\r\n}\r\n\r\nfunction hideAddButtons() {\r\n  setCssVariable(BEFORE_ADD_BUTTON_DISPLAY, \"none\");\r\n  setCssVariable(AFTER_ADD_BUTTON_DISPLAY, \"none\");\r\n}\r\n\r\nfunction setCssVariable(name: string, value: number | string) {\r\n  document.documentElement.style.setProperty(name, value.toString());\r\n}\r\n\r\nfunction isAddingEnabledForSelectedFields(\r\n  focusedFields: Array<string>,\r\n  editorContext: EditorContextType\r\n) {\r\n  if (focusedFields.length === 0) {\r\n    return false;\r\n  } else if (focusedFields.length === 1) {\r\n    if (isConfigPathRichTextPart(focusedFields[0])) {\r\n      return false;\r\n    }\r\n\r\n    const { parent } = parsePath(focusedFields[0], editorContext.form);\r\n\r\n    if (!parent) return false;\r\n\r\n    const parentDefinition = findComponentDefinitionById(\r\n      parent.templateId,\r\n      editorContext\r\n    );\r\n\r\n    const schemaProp = parentDefinition?.schema.find(\r\n      (schemaProp) => schemaProp.prop === parent.fieldName\r\n    );\r\n\r\n    if (!schemaProp) return false;\r\n\r\n    return isSchemaPropCollection(schemaProp);\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\n","import {\r\n  NoCodeComponentEntry,\r\n  SchemaProp,\r\n  TrulyResponsiveValue,\r\n  isTrulyResponsiveValue,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  CompilationContextType,\r\n  findComponentDefinition,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\n\r\n/**\r\n * Traverses recursively the config tree (similar to traverseConfig) but behaves like \"Array.map\". It returns new tree with elements mapped to new ones.\r\n * Responsive values are mapped \"per breakpoint\", it smells a bit, maybe in the future we'll have to apply some flag to have option whether we want to disassemble responsives or not.\r\n */\r\n\r\ntype ConfigMapCallback = (arg: {\r\n  value: any;\r\n  schemaProp: SchemaProp;\r\n  path: string;\r\n}) => any;\r\n\r\nfunction configMapArray(\r\n  configArray: NoCodeComponentEntry[] | undefined,\r\n  context: CompilationContextType,\r\n  callback: ConfigMapCallback,\r\n  prefix: string\r\n) {\r\n  /**\r\n   * Why this?\r\n   *\r\n   * Sometimes you might need configMap for config that have not yet been normalized. Such config still can be considered correct if it has a component that have a new schema property. Example of this is mergeSingleLocaleConfigsIntoConfig.\r\n   */\r\n  if (configArray === undefined) {\r\n    return;\r\n  }\r\n\r\n  if (!Array.isArray(configArray)) {\r\n    return;\r\n  }\r\n\r\n  return configArray.map((x, index) =>\r\n    configMapInternal(x, context, callback, `${prefix}.${index}`)\r\n  );\r\n}\r\n\r\nfunction configMap(\r\n  config: NoCodeComponentEntry,\r\n  context: CompilationContextType,\r\n  callback: ConfigMapCallback\r\n): NoCodeComponentEntry {\r\n  return configMapInternal(config, context, callback, \"\");\r\n}\r\n\r\nfunction configMapInternal(\r\n  config: NoCodeComponentEntry,\r\n  context: CompilationContextType,\r\n  callback: ConfigMapCallback,\r\n  prefix?: string\r\n): NoCodeComponentEntry {\r\n  const componentDefinition = findComponentDefinition(config, context);\r\n\r\n  const result: NoCodeComponentEntry = { ...config };\r\n\r\n  if (!componentDefinition) {\r\n    return result;\r\n  }\r\n\r\n  prefix = prefix === undefined || prefix === \"\" ? \"\" : `${prefix}.`;\r\n\r\n  componentDefinition.schema.forEach((schemaProp) => {\r\n    if (schemaProp.type === \"component-collection-localised\") {\r\n      if (config[schemaProp.prop] === undefined) {\r\n        return;\r\n      }\r\n\r\n      result[schemaProp.prop] = {};\r\n\r\n      for (const locale in config[schemaProp.prop]) {\r\n        if (locale === \"__fallback\") {\r\n          continue;\r\n        }\r\n\r\n        result[schemaProp.prop][locale] = configMapArray(\r\n          config[schemaProp.prop][locale],\r\n          context,\r\n          callback,\r\n          `${prefix}${schemaProp.prop}.${locale}`\r\n        );\r\n      }\r\n\r\n      result[schemaProp.prop] = callback({\r\n        value: result[schemaProp.prop],\r\n        path: `${prefix}${schemaProp.prop}`,\r\n        schemaProp,\r\n      });\r\n    } else if (\r\n      schemaProp.type === \"component\" ||\r\n      schemaProp.type === \"component-collection\"\r\n    ) {\r\n      result[schemaProp.prop] = configMapArray(\r\n        config[schemaProp.prop],\r\n        context,\r\n        callback,\r\n        `${prefix}${schemaProp.prop}`\r\n      );\r\n\r\n      result[schemaProp.prop] = callback({\r\n        value: result[schemaProp.prop],\r\n        path: `${prefix}${schemaProp.prop}`,\r\n        schemaProp,\r\n      });\r\n    } else {\r\n      if (isTrulyResponsiveValue(result[schemaProp.prop])) {\r\n        const mappedVal: TrulyResponsiveValue<any> = { $res: true };\r\n\r\n        for (const key in result[schemaProp.prop]) {\r\n          if (key === \"$res\") {\r\n            continue;\r\n          }\r\n          mappedVal[key] = callback({\r\n            value: result[schemaProp.prop][key],\r\n            schemaProp,\r\n            path: `${prefix}${schemaProp.prop}.${key}`,\r\n          });\r\n        }\r\n        result[schemaProp.prop] = mappedVal;\r\n      } else {\r\n        result[schemaProp.prop] = callback({\r\n          value: result[schemaProp.prop],\r\n          schemaProp,\r\n          path: `${prefix}${schemaProp.prop}`,\r\n        });\r\n      }\r\n    }\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\nexport { configMap };\r\n","import {\r\n  buildRichTextNoCodeEntry,\r\n  NoCodeComponentEntry,\r\n  InternalTemplate,\r\n  Template,\r\n  UserDefinedTemplate,\r\n  getDefaultLocale,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  InternalComponentDefinition,\r\n  findComponentDefinitionById,\r\n  normalize,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { uniqueId } from \"@/utils\";\r\nimport { EditorContextType } from \"../EditorContext\";\r\nimport { configMap } from \"../utils/config/configMap\";\r\n\r\nfunction getDefaultTemplateForDefinition(\r\n  def: InternalComponentDefinition,\r\n  editorContext: EditorContextType\r\n): InternalTemplate {\r\n  // Text has different way of building a default config\r\n  const config: NoCodeComponentEntry =\r\n    def.id === \"@easyblocks/rich-text\"\r\n      ? buildRichTextNoCodeEntry({\r\n        color: getDefaultTokenId(editorContext.theme.colors),\r\n        font: getDefaultTokenId(editorContext.theme.fonts),\r\n      })\r\n      : {\r\n        _component: def.id,\r\n        _id: uniqueId(),\r\n      };\r\n\r\n  return {\r\n    id: `${def.id}_default`,\r\n    label: def.label ?? def.id,\r\n    entry: config,\r\n    isUserDefined: false,\r\n  };\r\n}\r\n\r\nfunction getDefaultTokenId(tokens: EditorContextType[\"theme\"][string]) {\r\n  return Object.entries(tokens).find(([, value]) => value.isDefault)?.[0];\r\n}\r\n\r\nexport async function getTemplates(\r\n  editorContext: EditorContextType,\r\n  configTemplates: InternalTemplate[] = []\r\n): Promise<Template[]> {\r\n  const remoteUserDefinedTemplates: UserDefinedTemplate[] =\r\n    !editorContext.disableCustomTemplates\r\n      ? await editorContext.backend.templates.getAll()\r\n      : [];\r\n\r\n  return getTemplatesInternal(\r\n    editorContext,\r\n    configTemplates,\r\n    remoteUserDefinedTemplates\r\n  );\r\n}\r\n\r\nfunction getNecessaryDefaultTemplates(\r\n  components: InternalComponentDefinition[],\r\n  templates: Template[],\r\n  editorContext: EditorContextType\r\n) {\r\n  const result: InternalTemplate[] = [];\r\n\r\n  components.forEach((component) => {\r\n    const componentTemplates = templates.filter(\r\n      (template) => template.entry._component === component.id\r\n    );\r\n    if (componentTemplates.length === 0) {\r\n      result.push(getDefaultTemplateForDefinition(component, editorContext));\r\n    }\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\nfunction normalizeTextLocales(\r\n  config: NoCodeComponentEntry,\r\n  editorContext: EditorContextType\r\n) {\r\n  return configMap(config, editorContext, ({ value, schemaProp }) => {\r\n    if (schemaProp.type === \"text\") {\r\n      const firstDefinedValue = Object.values(value.value).filter(\r\n        (x) => x !== null && x !== undefined\r\n      )[0];\r\n\r\n      return {\r\n        ...value,\r\n        value: {\r\n          [getDefaultLocale(editorContext.locales).code]: firstDefinedValue,\r\n        },\r\n      };\r\n    } else if (schemaProp.type === \"component-collection-localised\") {\r\n      const firstDefinedValue = Object.values(value).filter(\r\n        (x) => x !== null && x !== undefined\r\n      )[0];\r\n\r\n      return {\r\n        [getDefaultLocale(editorContext.locales).code]: firstDefinedValue,\r\n      };\r\n    }\r\n\r\n    return value;\r\n  });\r\n}\r\n\r\nfunction getTemplatesInternal(\r\n  editorContext: EditorContextType,\r\n  configTemplates: InternalTemplate[],\r\n  remoteUserDefinedTemplates: UserDefinedTemplate[]\r\n): Template[] {\r\n  // If a component doesn't have a template, here's one added\r\n  const allBuiltinTemplates = [\r\n    ...configTemplates,\r\n    ...getNecessaryDefaultTemplates(\r\n      editorContext.definitions.components,\r\n      configTemplates,\r\n      editorContext\r\n    ),\r\n  ];\r\n\r\n  const allUserTemplates = [\r\n    ...remoteUserDefinedTemplates,\r\n    ...allBuiltinTemplates,\r\n  ];\r\n\r\n  const result = allUserTemplates\r\n    .filter((template) => {\r\n      const definition = findComponentDefinitionById(\r\n        template.entry._component,\r\n        editorContext\r\n      );\r\n\r\n      if (!definition || definition.hideTemplates) {\r\n        return false;\r\n      }\r\n      return true;\r\n    })\r\n    // .filter((template) => {\r\n    //\r\n    //   const result = template.entry._itemProps\r\n    //     ? Object.keys(template.entry._itemProps).every((componentId) =>\r\n    //       findComponentDefinitionById(componentId, editorContext)\r\n    //     )\r\n    //     : true;\r\n    //\r\n    //   if (template.entry._component === \"ProductCard\") {\r\n    //     console.log('WOW2222!!!', result);\r\n    //   }\r\n    //\r\n    //   return result;\r\n    // })\r\n    .map((template) => {\r\n      const newTemplate: Template = {\r\n        ...template,\r\n        entry: normalizeTextLocales(\r\n          normalize({ ...template.entry, _itemProps: {} }, editorContext),\r\n          editorContext\r\n        ),\r\n      };\r\n\r\n      return newTemplate;\r\n    });\r\n\r\n  return result;\r\n}\r\n","import {\r\n  InternalAnyField,\r\n  InternalField,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { dotNotationGet } from \"@/utils\";\r\nimport { Config, FORM_ERROR, FormApi, FormState, createForm } from \"final-form\";\r\nimport arrayMutators from \"final-form-arrays\";\r\n\r\nexport interface FormOptions<S, F extends InternalField = InternalAnyField>\r\n  extends Config<S> {\r\n  id: any;\r\n  label: string;\r\n  fields?: F[];\r\n  __type?: string;\r\n  reset?(): void;\r\n  actions?: any[];\r\n  buttons?: {\r\n    save: string;\r\n    reset: string;\r\n  };\r\n  loadInitialValues?: () => Promise<S>;\r\n  onChange?(values: FormState<S>): void;\r\n}\r\n\r\nexport class Form<\r\n  S extends Record<string, any> = any,\r\n  F extends InternalField = InternalAnyField\r\n> {\r\n  private _reset?(): void;\r\n\r\n  __type: string;\r\n  id: any;\r\n  label: string;\r\n  fields: F[];\r\n  finalForm: FormApi<S>;\r\n  actions: any[];\r\n  buttons: {\r\n    save: string;\r\n    reset: string;\r\n  };\r\n  loading = false;\r\n\r\n  constructor({\r\n    id,\r\n    label,\r\n    fields,\r\n    actions,\r\n    buttons,\r\n    reset,\r\n    loadInitialValues,\r\n    onChange,\r\n    ...options\r\n  }: FormOptions<S, F>) {\r\n    const initialValues = options.initialValues || ({} as S);\r\n    this.__type = options.__type || \"form\";\r\n    this.id = id;\r\n    this.label = label;\r\n    this.fields = fields || [];\r\n    this.onSubmit = options.onSubmit;\r\n    this.finalForm = createForm<S>({\r\n      ...options,\r\n      initialValues,\r\n      onSubmit: this.handleSubmit,\r\n      mutators: {\r\n        ...arrayMutators,\r\n        ...options.mutators,\r\n      },\r\n    });\r\n\r\n    this._reset = reset;\r\n    this.actions = actions || [];\r\n    this.buttons = buttons || {\r\n      save: \"Save\",\r\n      reset: \"Reset\",\r\n    };\r\n    this.updateFields(this.fields);\r\n\r\n    if (loadInitialValues) {\r\n      this.loading = true;\r\n      loadInitialValues()\r\n        .then((initialValues) => {\r\n          this.updateInitialValues(initialValues);\r\n        })\r\n        .finally(() => {\r\n          this.loading = false;\r\n        });\r\n    }\r\n\r\n    if (onChange) {\r\n      let firstUpdate = true;\r\n      this.subscribe(\r\n        (formState) => {\r\n          if (firstUpdate) {\r\n            firstUpdate = false;\r\n          } else {\r\n            onChange(formState);\r\n          }\r\n        },\r\n        { values: true }\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the current values of the form.\r\n   *\r\n   * if the form is still loading it returns `undefined`.\r\n   */\r\n  get values(): S | undefined {\r\n    if (this.loading) {\r\n      return undefined;\r\n    }\r\n    return this.finalForm.getState().values || (this.initialValues as S);\r\n  }\r\n\r\n  /**\r\n   * The values the form was initialized with.\r\n   */\r\n  get initialValues() {\r\n    return this.finalForm.getState().initialValues;\r\n  }\r\n\r\n  /**\r\n   * @deprecated Unnecessary indirection\r\n   */\r\n  updateFields(fields: F[]) {\r\n    this.fields = fields;\r\n  }\r\n\r\n  /**\r\n   * Subscribes to changes to the form. The subscriber will only be called when\r\n   * values specified in subscription change. A form can have many subscribers.\r\n   */\r\n  subscribe: FormApi<S>[\"subscribe\"] = (cb, options) => {\r\n    return this.finalForm.subscribe(cb, options);\r\n  };\r\n\r\n  onSubmit: Config<S>[\"onSubmit\"];\r\n\r\n  private handleSubmit: Config<S>[\"onSubmit\"] = async (values, form, cb) => {\r\n    try {\r\n      const response = await this.onSubmit(values, form, cb);\r\n      form.initialize(values);\r\n      return response;\r\n    } catch (error) {\r\n      return { [FORM_ERROR]: error };\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Changes the value of the given field.\r\n   *\r\n   * @param name\r\n   * @param value\r\n   */\r\n  change(name: string, value?: any) {\r\n    if (process.env.NODE_ENV === \"development\") {\r\n      console.groupCollapsed(\"Change to\", name === \"\" ? '\"\"' : `\"${name}\"`);\r\n      console.log(\"Old config\", this.values);\r\n      console.log(\"Old value\", dotNotationGet(this.values, name));\r\n      this.finalForm.change(name as keyof S, value);\r\n      console.log(\"New config\", this.values);\r\n      console.log(\"New value\", value);\r\n      console.groupEnd();\r\n      return;\r\n    }\r\n\r\n    return this.finalForm.change(name as keyof S, value);\r\n  }\r\n\r\n  get mutators() {\r\n    return this.finalForm.mutators;\r\n  }\r\n\r\n  /**\r\n   * Updates multiple fields in the form.\r\n   *\r\n   * The updates are batched so that it only triggers one `onChange` event.\r\n   *\r\n   * In order to prevent disruptions to the user's editing experience this\r\n   * function will _not_ update the value of any field that is currently\r\n   * being edited.\r\n   *\r\n   * @param values\r\n   */\r\n  updateValues(values: S) {\r\n    this.finalForm.batch(() => {\r\n      const activePath: any = this.finalForm.getState().active;\r\n\r\n      if (!activePath) {\r\n        updateEverything<S>(this.finalForm, values);\r\n      } else {\r\n        updateSelectively<S>(this.finalForm, values);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Replaces the initialValues of the form without deleting the current values.\r\n   *\r\n   * This function is helpful when the initialValues are loaded asynchronously.\r\n   *\r\n   * @param initialValues\r\n   */\r\n  updateInitialValues(initialValues: S) {\r\n    this.finalForm.batch(() => {\r\n      const values = this.values || ({} as S);\r\n      this.finalForm.initialize(initialValues);\r\n      const activePath: any = this.finalForm.getState().active;\r\n\r\n      if (!activePath) {\r\n        updateEverything<S>(this.finalForm, values);\r\n      } else {\r\n        updateSelectively<S>(this.finalForm, values);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction updateEverything<S extends Record<string, any>>(\r\n  form: FormApi<any>,\r\n  values: S\r\n) {\r\n  Object.entries(values).forEach(([path, value]) => {\r\n    form.change(path, value);\r\n  });\r\n}\r\n\r\nfunction updateSelectively<S extends Record<string, any>>(\r\n  form: FormApi<any>,\r\n  values: S,\r\n  prefix?: string\r\n) {\r\n  const activePath: any = form.getState().active!;\r\n\r\n  Object.entries(values).forEach(([name, value]) => {\r\n    const path = prefix ? `${prefix}.${name}` : name;\r\n\r\n    if (typeof value === \"object\") {\r\n      if (activePath.startsWith(path)) {\r\n        updateSelectively(form, value, path);\r\n      } else {\r\n        form.change(path, value);\r\n      }\r\n    } else if (path !== activePath) {\r\n      form.change(path, value);\r\n    }\r\n  });\r\n}\r\n","import { InternalField } from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport React from \"react\";\r\nimport { Form, FormOptions } from \"../../form\";\r\n\r\ninterface WatchableFormValue {\r\n  values: any;\r\n  label: FormOptions<any>[\"label\"];\r\n  fields: FormOptions<any>[\"fields\"];\r\n}\r\n\r\n/**\r\n * A hook that creates a form and updates it's watched properties.\r\n */\r\nexport function useForm<FormShape = any>(\r\n  { loadInitialValues, ...options }: FormOptions<any>,\r\n  watch: Partial<WatchableFormValue> = {}\r\n): [FormShape, Form, boolean] {\r\n  /**\r\n   * `initialValues` will be usually be undefined if `loadInitialValues` is used.\r\n   *\r\n   * If the form helper is using `watch.values`, which would contain\r\n   * the current state of the form, then we set that to the `initialValues`\r\n   * so the form is initialized with some state.\r\n   *\r\n   * This is beneficial for SSR and will hopefully not be noticeable\r\n   * when editing the site as the actual `initialValues` will be set\r\n   * behind the scenes.\r\n   */\r\n  options.initialValues = options.initialValues || watch.values;\r\n\r\n  const [, setValues] = React.useState(options.initialValues);\r\n  const [form, setForm] = React.useState<Form>(() => {\r\n    return createForm(options, (form: any) => {\r\n      setValues(form.values);\r\n    });\r\n  });\r\n\r\n  React.useEffect(\r\n    function () {\r\n      if (form.id === options.id) return;\r\n      setForm(\r\n        createForm(options, (form: any) => {\r\n          setValues(form.values);\r\n        })\r\n      );\r\n    },\r\n    [options.id]\r\n  );\r\n\r\n  const [formIsLoading, setFormIsLoading] = React.useState(() =>\r\n    loadInitialValues ? true : false\r\n  );\r\n  const loadFormData = React.useCallback(async () => {\r\n    if (loadInitialValues) {\r\n      setFormIsLoading(true);\r\n      await loadInitialValues()\r\n        .then((values: any) => {\r\n          form.updateInitialValues(values);\r\n        })\r\n        .finally(() => {\r\n          setFormIsLoading(false);\r\n        });\r\n    }\r\n  }, [form, setFormIsLoading]);\r\n  React.useEffect(() => {\r\n    loadFormData();\r\n  }, [form, loadFormData]);\r\n\r\n  useUpdateFormFields(form, watch.fields);\r\n  useUpdateFormLabel(form, watch.label);\r\n  useUpdateFormValues(form, watch.values);\r\n\r\n  return [form ? form.values : options.initialValues, form, formIsLoading];\r\n}\r\n\r\nfunction createForm(options: FormOptions<any>, handleChange: any): Form {\r\n  const form = new Form(options);\r\n  form.subscribe(handleChange, { values: true });\r\n  return form;\r\n}\r\n\r\n/**\r\n * A React Hook that update's the `Form` if `fields` are changed.\r\n *\r\n * This hook is useful when dynamically creating fields, or updating\r\n * them via hot module replacement.\r\n */\r\nfunction useUpdateFormFields(form: Form, fields?: InternalField[]) {\r\n  React.useEffect(() => {\r\n    if (typeof fields === \"undefined\") return;\r\n    form.updateFields(fields);\r\n  }, [form, fields]);\r\n}\r\n\r\n/**\r\n * A React Hook that update's the `Form` if the `label` is changed.\r\n *\r\n * This hook is useful when dynamically creating creating the label,\r\n * or updating it via hot module replacement.\r\n */\r\nfunction useUpdateFormLabel(form: Form, label?: string) {\r\n  React.useEffect(() => {\r\n    if (typeof label === \"undefined\") return;\r\n    form.label = label;\r\n  }, [form, label]);\r\n}\r\n\r\n/**\r\n * Updates the Form with new values.\r\n *\r\n * Only updates fields that are:\r\n *\r\n * 1. registered with the form\r\n * 2. not currently [active](https://final-form.org/docs/final-form/types/FieldState#active)\r\n *\r\n * This hook is useful when the form must be kept in sync with the data source.\r\n */\r\nfunction useUpdateFormValues(form: Form, values?: any) {\r\n  React.useEffect(() => {\r\n    if (typeof values === \"undefined\") return;\r\n    form.updateValues(values);\r\n  }, [form, values]);\r\n}\r\n","import { NoCodeComponentEntry } from \"@redsun-vn/easyblocks-core\";\r\nimport { deepClone } from \"@/utils\";\r\n\r\n/**\r\n * Outputs comparable config that is FULL COPY of config\r\n */\r\nfunction getConfigSnapshot(config: NoCodeComponentEntry): NoCodeComponentEntry {\r\n  const strippedConfig = deepClone(config);\r\n  return strippedConfig;\r\n}\r\nexport { getConfigSnapshot };\r\n","import { NoCodeComponentEntry } from \"@redsun-vn/easyblocks-core\";\r\nimport { CompilationContextType } from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { configMap } from \"../config/configMap\";\r\n\r\nexport function addLocalizedFlag(\r\n  config: NoCodeComponentEntry,\r\n  context: CompilationContextType\r\n) {\r\n  return configMap(config, context, ({ value, schemaProp }) => {\r\n    if (\r\n      (schemaProp.type === \"text\" && value.id?.startsWith(\"local.\")) ||\r\n      schemaProp.type === \"component-collection-localised\"\r\n    ) {\r\n      return {\r\n        __localized: true,\r\n        ...value,\r\n      };\r\n    }\r\n\r\n    return value;\r\n  });\r\n}\r\n","import { NoCodeComponentEntry } from \"@redsun-vn/easyblocks-core\";\r\nimport { CompilationContextType } from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { configMap } from \"../config/configMap\";\r\n\r\nexport function removeLocalizedFlag(\r\n  config: NoCodeComponentEntry,\r\n  context: CompilationContextType\r\n) {\r\n  return configMap(config, context, ({ value, schemaProp }) => {\r\n    if (\r\n      (schemaProp.type === \"text\" && value?.id.startsWith(\"local.\")) ||\r\n      schemaProp.type === \"component-collection-localised\"\r\n    ) {\r\n      delete value.__localized;\r\n    }\r\n\r\n    return value;\r\n  });\r\n}\r\n","import { NoCodeComponentEntry, Document } from \"@redsun-vn/easyblocks-core\";\r\nimport { deepClone, deepCompare, sleep } from \"@/utils\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { EditorContextType } from \"./EditorContext\";\r\nimport { getConfigSnapshot } from \"./utils/config/getConfigSnapshot\";\r\nimport { addLocalizedFlag } from \"./utils/locales/addLocalizedFlag\";\r\nimport { removeLocalizedFlag } from \"./utils/locales/removeLocalizedFlag\";\r\nimport { useToaster, Toaster } from \"@redsun-vn/easyblocks-design-system\";\r\n\r\n/**\r\n * useDataSaver works in a realm of SINGLE CONFIG.\r\n * @param initialDocument\r\n * Data saver will use this document as a starting point. It can be `null` if there is no document yet.\r\n * Data saver will perform first save when any local change is detected.\r\n */\r\nexport function useDataSaver(\r\n  initialDocument: Document | null,\r\n  editorContext: EditorContextType\r\n) {\r\n  const remoteDocument = useRef<Document | null>(initialDocument);\r\n  const toaster = useToaster();\r\n\r\n  /**\r\n   * This state variable is going to be used ONLY for comparison with local config in case of missing document.\r\n   * It's not going to change at any time during the lifecycle of this hook.\r\n   */\r\n  const [initialConfigInCaseOfMissingDocument] = useState<NoCodeComponentEntry>(\r\n    deepClone(editorContext.form.values)\r\n  );\r\n  const onTickRef = useRef<() => Promise<void>>(() => Promise.resolve());\r\n\r\n  const onTick = async () => {\r\n    // Playground mode is a special case, we don't want to save anything\r\n    if (editorContext.readOnly) {\r\n      return;\r\n    }\r\n\r\n    const localConfig = editorContext.form.values;\r\n    const localConfigSnapshot = getConfigSnapshot(localConfig);\r\n\r\n    const previousConfig = remoteDocument.current\r\n      ? remoteDocument.current.entry\r\n      : initialConfigInCaseOfMissingDocument;\r\n    const previousConfigSnapshot = getConfigSnapshot(previousConfig);\r\n\r\n    const isConfigTheSame = deepCompare(\r\n      localConfigSnapshot,\r\n      previousConfigSnapshot\r\n    );\r\n\r\n    const configToSaveWithLocalisedFlag = addLocalizedFlag(\r\n      localConfigSnapshot,\r\n      editorContext\r\n    );\r\n\r\n    async function runSaveCallback() {\r\n      await editorContext.save(remoteDocument.current!);\r\n    }\r\n\r\n    // New document\r\n    if (remoteDocument.current === null) {\r\n      console.debug(\"New document\");\r\n\r\n      // There must be at least one change in order to create a new document, we're not storing empty temporary documents\r\n      if (isConfigTheSame) {\r\n        console.debug(\"no change -> bye\");\r\n        return;\r\n      }\r\n\r\n      console.debug(\"change detected! -> create\");\r\n\r\n      const newDocument = await editorContext.backend.documents.create({\r\n        entry: configToSaveWithLocalisedFlag,\r\n      });\r\n\r\n      remoteDocument.current = {\r\n        ...newDocument,\r\n        // @ts-ignore\r\n        config: {\r\n          config: configToSaveWithLocalisedFlag,\r\n        },\r\n      };\r\n\r\n      await runSaveCallback();\r\n    }\r\n    // Document update\r\n    else {\r\n      console.debug(\"Existing document\");\r\n\r\n      try {\r\n        const latestDocument = await editorContext.backend.documents.get({\r\n          id: remoteDocument.current.id,\r\n        });\r\n        const latestRemoteDocumentVersion = latestDocument.version ?? -1;\r\n\r\n        const isNewerDocumentVersionAvailable =\r\n          remoteDocument.current.version < latestRemoteDocumentVersion;\r\n\r\n        // Newer version of document is available\r\n        if (isNewerDocumentVersionAvailable) {\r\n          console.debug(\"new remote version detected, updating\");\r\n\r\n          if (!latestDocument) {\r\n            throw new Error(\"unexpected error\");\r\n          }\r\n\r\n          const latestConfig = removeLocalizedFlag(\r\n            latestDocument.entry,\r\n            editorContext\r\n          );\r\n\r\n          editorContext.actions.runChange(() => {\r\n            editorContext.form.change(\"\", latestConfig);\r\n            return [];\r\n          });\r\n\r\n          remoteDocument.current = latestDocument;\r\n\r\n          // Notify when local config was modified\r\n          if (!isConfigTheSame) {\r\n            console.debug(\"there were local changes -> notify\");\r\n\r\n            editorContext.actions.notify(\r\n              \"Remote changes detected, local changes have been overwritten.\"\r\n            );\r\n          }\r\n\r\n          return;\r\n        }\r\n        // No remote change occurred\r\n        else {\r\n          if (isConfigTheSame) {\r\n            console.debug(\"no local changes -> bye\");\r\n            // Let's do nothing, no remote and local change\r\n          } else {\r\n            console.debug(\"updating the document\", remoteDocument.current.id);\r\n\r\n            const updatedDocument =\r\n              await editorContext.backend.documents.update({\r\n                id: remoteDocument.current.id,\r\n                entry: configToSaveWithLocalisedFlag,\r\n                version: remoteDocument.current.version,\r\n              });\r\n\r\n            if (updatedDocument?.id) {\r\n              toaster.success(\"Saved.\");\r\n            } else {\r\n              toaster.error(\"Error saving... Please try again.\");\r\n            }\r\n\r\n            remoteDocument.current.entry = localConfigSnapshot;\r\n            remoteDocument.current.version = updatedDocument.version;\r\n\r\n            await runSaveCallback();\r\n          }\r\n        }\r\n      } catch (error) {\r\n        toaster.error(\"Error saving... Please try again!\");\r\n      }\r\n    }\r\n  };\r\n\r\n  // We're keeping this in ref, because of setInterval keeping initial closure\r\n  onTickRef.current = onTick;\r\n\r\n  const inProgress = useRef<boolean>(false);\r\n  const wasSaveNowCalled = useRef<boolean>(false);\r\n\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      // We ignore ticks when previous requests are in progress\r\n      if (inProgress.current || wasSaveNowCalled.current) {\r\n        return;\r\n      }\r\n\r\n      inProgress.current = true;\r\n      onTickRef.current().finally(() => {\r\n        inProgress.current = false;\r\n      });\r\n    }, 5000);\r\n\r\n    return () => {\r\n      clearInterval(interval);\r\n    };\r\n  }, []);\r\n\r\n  return {\r\n    saveNow: async () => {\r\n      wasSaveNowCalled.current = true;\r\n\r\n      // Wait until inProgress is false\r\n      while (true) {\r\n        if (inProgress.current) {\r\n          console.debug(\"waiting...\");\r\n          await sleep(500);\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n\r\n      console.debug(\"Last save!\");\r\n      await onTick();\r\n    }\r\n  };\r\n}\r\n","import {\r\n  EditorContextType,\r\n  duplicateConfig,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { dotNotationGet, preOrderPathComparator } from \"@/utils\";\r\nimport { useEffect } from \"react\";\r\n\r\nconst GLOBAL_SHORTCUTS_KEYS = [\r\n  \"Delete\",\r\n  \"Backspace\",\r\n  \"ArrowUp\",\r\n  \"ArrowDown\",\r\n  \"ArrowLeft\",\r\n  \"ArrowRight\",\r\n  \"l\",\r\n  \"L\",\r\n];\r\n\r\nconst DATA_TRANSFER_FORMAT = \"text/x-shopstory\";\r\n\r\nfunction useEditorGlobalKeyboardShortcuts(editorContext: EditorContextType) {\r\n  let isDeleting = false;\r\n  useEffect(() => {\r\n    const { focussedField: focusedFields, actions } = editorContext;\r\n\r\n    function handleKeydown(event: KeyboardEvent): void {\r\n      if (isTargetInputElement(event.target)) {\r\n        return;\r\n      }\r\n\r\n      if (!isGlobalShortcut(event) || !isAnyFieldSelected(focusedFields)) {\r\n        return;\r\n      }\r\n\r\n      if (\r\n        (event.key === \"Delete\" || event.key === \"Backspace\") &&\r\n        !isDeleting\r\n      ) {\r\n        isDeleting = true;\r\n\r\n        actions.removeItems(focusedFields);\r\n\r\n        setTimeout(() => {\r\n          isDeleting = false;\r\n        }, 2000);\r\n      } else if (event.key === \"ArrowUp\" || event.key === \"ArrowLeft\") {\r\n        actions.moveItems(focusedFields, \"top\");\r\n      } else if (event.key === \"ArrowDown\" || event.key === \"ArrowRight\") {\r\n        actions.moveItems(focusedFields, \"bottom\");\r\n      } else if (event.key.toUpperCase() === \"L\") {\r\n        actions.logSelectedItems();\r\n      }\r\n    }\r\n\r\n    function handleCopy(event: ClipboardEvent): void {\r\n      if (!canHandleCopyPaste(focusedFields, event)) {\r\n        return;\r\n      }\r\n\r\n      const configs = getConfigsToCopy(focusedFields, editorContext);\r\n\r\n      event.preventDefault();\r\n      event.clipboardData?.setData(\r\n        DATA_TRANSFER_FORMAT,\r\n        JSON.stringify(configs)\r\n      );\r\n    }\r\n\r\n    function handleCut(event: ClipboardEvent): void {\r\n      if (!canHandleCopyPaste(focusedFields, event)) {\r\n        return;\r\n      }\r\n\r\n      const configs = getConfigsToCopy(focusedFields, editorContext);\r\n\r\n      event.preventDefault();\r\n      event.clipboardData?.setData(\r\n        DATA_TRANSFER_FORMAT,\r\n        JSON.stringify(configs)\r\n      );\r\n\r\n      actions.removeItems(focusedFields);\r\n    }\r\n\r\n    function handlePaste(event: ClipboardEvent): void {\r\n      if (!canHandleCopyPaste(focusedFields, event)) {\r\n        return;\r\n      }\r\n\r\n      const rawData = event.clipboardData?.getData(DATA_TRANSFER_FORMAT);\r\n\r\n      if (!rawData || rawData === \"\") {\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const parsedData = JSON.parse(rawData);\r\n\r\n        const data = Array.isArray(parsedData) ? parsedData : [parsedData];\r\n\r\n        actions.pasteItems(data);\r\n        event.preventDefault();\r\n      } catch (e) {\r\n        console.error(e);\r\n        return;\r\n      }\r\n    }\r\n\r\n    window.document.addEventListener(\"keydown\", handleKeydown);\r\n    window.document.addEventListener(\"copy\", handleCopy);\r\n    window.document.addEventListener(\"cut\", handleCut);\r\n    window.document.addEventListener(\"paste\", handlePaste);\r\n\r\n    return () => {\r\n      window.document.removeEventListener(\"keydown\", handleKeydown);\r\n      window.document.removeEventListener(\"copy\", handleCopy);\r\n      window.document.removeEventListener(\"cut\", handleCut);\r\n      window.document.removeEventListener(\"paste\", handlePaste);\r\n    };\r\n  });\r\n}\r\n\r\nfunction isTargetInputElement(target: EventTarget | null): boolean {\r\n  return (\r\n    isTargetHtmlElement(target) &&\r\n    ([\"INPUT\", \"TEXTAREA\", \"SELECT\"].includes(target.tagName) ||\r\n      (target.tagName === \"DIV\" && target.getAttribute(\"role\") === \"textbox\"))\r\n  );\r\n}\r\n\r\nfunction isTargetHtmlElement(\r\n  element: EventTarget | null\r\n): element is HTMLElement {\r\n  return element !== null;\r\n}\r\n\r\nfunction getConfigsToCopy(paths: string[], editorContext: EditorContextType) {\r\n  const sortedPaths = [...paths].sort(preOrderPathComparator(\"ascending\"));\r\n  return sortedPaths.map((path) => {\r\n    const config = dotNotationGet(editorContext.form.values, path);\r\n    return duplicateConfig(config, editorContext);\r\n  });\r\n}\r\n\r\nfunction canHandleCopyPaste(focusedFields: string[], event: ClipboardEvent) {\r\n  const notInsideInputElement = !(\r\n    isTargetInputElement(event.target) ||\r\n    isTargetInputElement(document.activeElement)\r\n  );\r\n\r\n  const insideEditorIFrame = window.frameElement;\r\n  const focusedFieldsSelected = isAnyFieldSelected(focusedFields);\r\n\r\n  return notInsideInputElement && insideEditorIFrame && focusedFieldsSelected;\r\n}\r\n\r\nfunction isGlobalShortcut(event: KeyboardEvent): boolean {\r\n  return GLOBAL_SHORTCUTS_KEYS.includes(event.key);\r\n}\r\n\r\n// FIXME: This is my mistake, because I was lazy at the beginning and it was easier for me to introduce changes\r\n// by assuming that non empty array with empty string means no fields selected.\r\n// IMO this is stupid and can lead to confusion.\r\nfunction isAnyFieldSelected(focusedFields: string[]) {\r\n  return focusedFields.length > 0 && focusedFields[0] !== \"\";\r\n}\r\n\r\nexport { useEditorGlobalKeyboardShortcuts };\r\n","import { NoCodeComponentEntry } from \"@redsun-vn/easyblocks-core\";\r\nimport { deepCompare } from \"@/utils\";\r\n\r\nconst HISTORY_SIZE = 50;\r\n\r\nexport interface HistoryEntry {\r\n  focussedField: Array<string>;\r\n  config: NoCodeComponentEntry;\r\n}\r\n\r\nclass EditorHistory {\r\n  private values: HistoryEntry[];\r\n  private currentIndex: number;\r\n\r\n  constructor() {\r\n    this.values = [];\r\n    this.currentIndex = -1;\r\n  }\r\n\r\n  push(value: HistoryEntry) {\r\n    const isCurrentIndexLastEntry =\r\n      this.values.length - 1 === this.currentIndex;\r\n\r\n    // If we push to history while `currentIndex` is not set on latest history entry\r\n    // our history would me messed up. We need to rewrite our history by removing all\r\n    // entries after the current index.\r\n    if (!isCurrentIndexLastEntry) {\r\n      this.values.splice(\r\n        this.currentIndex + 1,\r\n        this.values.length - 1 - this.currentIndex\r\n      );\r\n    }\r\n\r\n    const isAboutToReachSizeLimit = this.values.length + 1 > HISTORY_SIZE;\r\n\r\n    if (isAboutToReachSizeLimit) {\r\n      this.values.shift();\r\n    }\r\n\r\n    this.values.push(value);\r\n    this.currentIndex = this.values.length - 1;\r\n  }\r\n\r\n  replace(value: HistoryEntry) {\r\n    this.values[this.currentIndex] = value;\r\n  }\r\n\r\n  replaceAt(oldValue: HistoryEntry, newValue: HistoryEntry) {\r\n    const entryIndex = this.values.findIndex(\r\n      (value) => value.config === oldValue.config\r\n    );\r\n\r\n    if (entryIndex !== -1) {\r\n      this.values[entryIndex] = newValue;\r\n    }\r\n  }\r\n\r\n  forward() {\r\n    if (!this.canGoForward()) {\r\n      this.currentIndex = this.values.length - 1;\r\n      return null;\r\n    }\r\n\r\n    const currentEntry = this.values[this.currentIndex];\r\n\r\n    while (this.canGoForward()) {\r\n      this.currentIndex += 1;\r\n      const nextEntry = this.values[this.currentIndex];\r\n\r\n      if (!deepCompare(nextEntry.config, currentEntry.config)) {\r\n        return nextEntry;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  back() {\r\n    if (!this.canGoBack()) {\r\n      return null;\r\n    }\r\n\r\n    const currentEntry = this.values[this.currentIndex];\r\n\r\n    while (this.canGoBack()) {\r\n      this.currentIndex -= 1;\r\n      const previousEntry = this.values[this.currentIndex];\r\n\r\n      if (!deepCompare(previousEntry.config, currentEntry.config)) {\r\n        return previousEntry;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  getEntries(): Array<HistoryEntry> {\r\n    return this.values.map((value) => ({\r\n      ...value,\r\n    }));\r\n  }\r\n\r\n  private canGoForward() {\r\n    return this.currentIndex < this.values.length - 1;\r\n  }\r\n\r\n  private canGoBack() {\r\n    return this.currentIndex > 0;\r\n  }\r\n}\r\n\r\nexport { EditorHistory };\r\n","import type { NoCodeComponentEntry } from \"@redsun-vn/easyblocks-core\";\r\nimport { useRef } from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport { EditorHistory, HistoryEntry } from \"./EditorHistory\";\r\n\r\ninterface UseEditorHistoryParameters {\r\n  onChange: (editorHistoryChange: EditorHistoryChange) => void;\r\n}\r\n\r\ninterface EditorHistoryChange {\r\n  config?: NoCodeComponentEntry;\r\n  focusedField: Array<string>;\r\n  type: \"undo\" | \"redo\";\r\n}\r\n\r\nfunction useEditorHistory({ onChange }: UseEditorHistoryParameters) {\r\n  const editorHistory = useRef<EditorHistory>(new EditorHistory()).current;\r\n\r\n  function undo(): void {\r\n    ReactDOM.unstable_batchedUpdates(() => {\r\n      const entry = editorHistory.back();\r\n\r\n      if (entry === null) {\r\n        return;\r\n      }\r\n\r\n      const { focussedField, ...rest } = entry;\r\n      onChange({\r\n        focusedField: focussedField,\r\n        ...rest,\r\n        type: \"undo\",\r\n      });\r\n    });\r\n  }\r\n\r\n  function redo() {\r\n    ReactDOM.unstable_batchedUpdates(() => {\r\n      const entry = editorHistory.forward();\r\n\r\n      if (!entry) {\r\n        return null;\r\n      }\r\n\r\n      const { focussedField, ...rest } = entry;\r\n\r\n      onChange({\r\n        focusedField: focussedField,\r\n        ...rest,\r\n        type: \"redo\",\r\n      });\r\n    });\r\n  }\r\n\r\n  function push(entry: HistoryEntry) {\r\n    editorHistory.push(entry);\r\n  }\r\n\r\n  return {\r\n    push,\r\n    redo,\r\n    undo,\r\n    editorHistoryInstance: editorHistory,\r\n  };\r\n}\r\n\r\nexport { useEditorHistory };\r\n","import { getDefaultLocale, Locale } from \"@redsun-vn/easyblocks-core\";\r\n\r\nexport function checkLocalesCorrectness(locales: Locale[]): boolean {\r\n  if (locales.length === 0) {\r\n    throw new Error(\"Locales array can't be empty\");\r\n  }\r\n\r\n  const defaultLocales = locales.filter((l) => l.isDefault);\r\n  if (defaultLocales.length === 0) {\r\n    throw new Error(\"One locale must be set as default, you didn't set any\");\r\n  }\r\n\r\n  if (defaultLocales.length > 1) {\r\n    throw new Error(\r\n      \"Only one locale must be set as default, you set more than one\"\r\n    );\r\n  }\r\n\r\n  const defaultLocale = defaultLocales[0];\r\n\r\n  if (defaultLocale.fallback) {\r\n    throw new Error(\"Default locale can't have fallback\");\r\n  }\r\n\r\n  // Check for incorrect fallbacks\r\n  locales.forEach((locale) => {\r\n    if (locale.fallback) {\r\n      const fallback = locales.find((x) => x.code === locale.fallback);\r\n\r\n      if (!fallback) {\r\n        throw new Error(\r\n          `Locale ${locale} has a fallback ${locale.fallback} which doesn't exist in the locales list.`\r\n        );\r\n      }\r\n    }\r\n    // If there is no fallback, then we treat default locale as a fallback!\r\n  });\r\n\r\n  // Let's check for circulars\r\n  locales.forEach((locale) => {\r\n    const localeChain: string[] = [];\r\n\r\n    let currentLocale = locale;\r\n\r\n    do {\r\n      localeChain.push(currentLocale.code);\r\n      const fallbackId =\r\n        currentLocale.fallback ?? getDefaultLocale(locales).code;\r\n\r\n      // If we got to the default locale then we're fine\r\n      if (fallbackId === getDefaultLocale(locales).code) {\r\n        break;\r\n      }\r\n\r\n      // If fallbackId does already exists in localeChain then it means we have circular!\r\n      if (localeChain.includes(fallbackId)) {\r\n        throw new Error(\r\n          `There is circular reference in locales: ${[\r\n            ...localeChain,\r\n            fallbackId,\r\n          ].join(\",\")}`\r\n        );\r\n      }\r\n\r\n      currentLocale = locales.find((x) => x.code === fallbackId)!;\r\n    } while (true);\r\n  });\r\n\r\n  return true;\r\n}\r\n","import { dotNotationGet, sleep, uniqueId, useForceRerender } from \"@/utils\";\r\nimport {\r\n  CompilationCache,\r\n  CompilationMetadata,\r\n  Config,\r\n  DeviceRange,\r\n  Document,\r\n  ExternalData,\r\n  FetchOutputResources,\r\n  InlineTypeWidgetComponentProps,\r\n  NoCodeComponentEntry,\r\n  NonEmptyRenderableContent,\r\n  Template,\r\n  TokenTypeWidgetComponentProps,\r\n  UserDefinedTemplate,\r\n  WidgetComponentProps,\r\n  buildEntry,\r\n  compileInternal,\r\n  createCompilationContext,\r\n  findExternals,\r\n  getDefaultLocale,\r\n  mergeCompilationMeta,\r\n  normalize,\r\n  normalizeInput,\r\n  responsiveValueGet,\r\n  validate,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  CompilationContextType,\r\n  ComponentPickerOpenedEvent,\r\n  ItemInsertedEvent,\r\n  ItemMovedEvent,\r\n  componentPickerClosed,\r\n  duplicateConfig,\r\n  findComponentDefinitionById,\r\n  parsePath,\r\n  traverseComponents,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { Colors, Fonts, useToaster } from \"@redsun-vn/easyblocks-design-system\";\r\nimport throttle from \"lodash.throttle\";\r\nimport React, {\r\n  ComponentType,\r\n  memo,\r\n  useCallback,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport Modal from \"react-modal\";\r\nimport { styled } from \"styled-components\";\r\nimport { ConfigAfterAutoContext } from \"./ConfigAfterAutoContext\";\r\nimport { ExternalDataChangeHandler } from \"./EasyblocksEditorProps\";\r\nimport { EditorContext, EditorContextType } from \"./EditorContext\";\r\nimport { EditorExternalDataProvider } from \"./EditorExternalDataProvider\";\r\nimport { EditorIframe } from \"./EditorIframe\";\r\nimport { EditorSidebar } from \"./EditorSidebar\";\r\nimport { EditorTopBar, TOP_BAR_HEIGHT } from \"./EditorTopBar\";\r\nimport { ModalPicker } from \"./ModalPicker\";\r\nimport { TemplateModal } from \"./TemplateModal\";\r\nimport { TemplatePicker } from \"./TemplatePicker\";\r\nimport {\r\n  duplicateItems,\r\n  logItems,\r\n  moveItems,\r\n  pasteItems,\r\n  removeItems,\r\n  replaceItems,\r\n} from \"./editorActions\";\r\nimport { Form } from \"./form\";\r\nimport { destinationResolver } from \"./paste/destinationResolver\";\r\nimport { pasteManager } from \"./paste/manager\";\r\nimport { SelectionFrame } from \"./selectionFrame/SelectionFrame\";\r\nimport { getTemplates } from \"./templates/getTemplates\";\r\nimport { useForm } from \"./tinacms/react-core\";\r\nimport {\r\n  ActionsType,\r\n  OpenComponentPickerConfig,\r\n  OpenTemplateModalAction,\r\n} from \"./types\";\r\nimport { useDataSaver } from \"./useDataSaver\";\r\nimport { useEditorGlobalKeyboardShortcuts } from \"./useEditorGlobalKeyboardShortcuts\";\r\nimport { useEditorHistory } from \"./useEditorHistory\";\r\nimport { checkLocalesCorrectness } from \"./utils/locales/checkLocalesCorrectness\";\r\nimport { removeLocalizedFlag } from \"./utils/locales/removeLocalizedFlag\";\r\n\r\ndeclare global {\r\n  interface Window {\r\n    editorWindowAPI?: {\r\n      editorContext?: EditorContextType;\r\n      meta?: CompilationMetadata;\r\n      compiled?: NonEmptyRenderableContent;\r\n      externalData?: ExternalData;\r\n      onUpdate?: () => void;\r\n    };\r\n  }\r\n}\r\n\r\nconst ContentContainer = styled.div`\r\n  position: relative;\r\n  flex: 1 1 auto;\r\n  display: flex;\r\n  flex-direction: column;\r\n`;\r\n\r\nconst SidebarAndContentContainer = styled.div<{ height: \"100vh\" | \"100%\" }>`\r\n  height: ${(props) => `calc(${props.height} - ${TOP_BAR_HEIGHT}px)`};\r\n  width: 100%;\r\n  background: #fafafa;\r\n  display: flex;\r\n  flex-direction: row;\r\n  align-items: stretch;\r\n`;\r\n\r\nconst SidebarContainer = styled.div`\r\n  flex: 0 0 240px;\r\n  background: ${Colors.white};\r\n  border-left: 1px solid ${Colors.black100};\r\n  box-sizing: border-box;\r\n\r\n  > * {\r\n    box-sizing: border-box;\r\n  }\r\n\r\n  overflow-y: auto;\r\n`;\r\n\r\nconst DataSaverRoot = styled.div`\r\n  position: fixed;\r\n  width: 100%;\r\n  height: 100%;\r\n  z-index: 100000;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n`;\r\n\r\nconst DataSaverOverlay = styled.div`\r\n  z-index: -1;\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  background: rgba(0, 0, 0, 0.25);\r\n`;\r\n\r\nconst DataSaverModal = styled.div`\r\n  background: white;\r\n  padding: 32px;\r\n  border-radius: 8px;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  ${Fonts.body}\r\n  font-size: 16px;\r\n`;\r\n\r\nconst AuthenticationScreen = styled.div`\r\n  width: 100vw;\r\n  height: 100vh;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n  gap: 24px;\r\n  text-align: center;\r\n  ${Fonts.bodyLarge}\r\n`;\r\n\r\ntype EditorProps = {\r\n  config: Config;\r\n  locale?: string;\r\n  readOnly: boolean;\r\n  isAdminMode?: boolean;\r\n  documentId: string | null;\r\n  rootComponentId: string | null;\r\n  rootTemplateId: string | null;\r\n  save?: (document: Document) => Promise<void>;\r\n  onClose?: () => void;\r\n  externalData: FetchOutputResources;\r\n  onExternalDataChange: ExternalDataChangeHandler;\r\n  widgets?: Record<\r\n    string,\r\n    | ComponentType<WidgetComponentProps<any>>\r\n    | ComponentType<InlineTypeWidgetComponentProps<any>>\r\n    | ComponentType<TokenTypeWidgetComponentProps<any>>\r\n  >;\r\n  components?: Record<string, ComponentType<any>>;\r\n  pickers?: Record<string, TemplatePicker>;\r\n};\r\n\r\nexport const Editor = EditorBackendInitializer;\r\n\r\nfunction EditorBackendInitializer(props: EditorProps) {\r\n  const [enabled, setEnabled] = useState<boolean>(false);\r\n  const [error, setError] = useState<string | undefined>(undefined);\r\n  const [document, setDocument] = useState<Document | null>(null);\r\n\r\n  useEffect(() => {\r\n    async function run() {\r\n      try {\r\n        if (props.documentId) {\r\n          const document = await props.config.backend.documents.get({\r\n            id: props.documentId,\r\n          });\r\n\r\n          if (!document) {\r\n            throw new Error(\r\n              `Can't fetch document with id: ${props.documentId}`\r\n            );\r\n          }\r\n\r\n          setDocument(document);\r\n        }\r\n      } catch (error) {\r\n        console.error(error);\r\n        setError(\r\n          `Backend initialization error, check out console for more details.`\r\n        );\r\n        return;\r\n      }\r\n\r\n      setEnabled(true);\r\n    }\r\n\r\n    run();\r\n  }, []);\r\n\r\n  if (!enabled) {\r\n    return <AuthenticationScreen>Loading...</AuthenticationScreen>;\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <DataSaverRoot>\r\n        <DataSaverOverlay></DataSaverOverlay>\r\n        <DataSaverModal>{error}</DataSaverModal>\r\n      </DataSaverRoot>\r\n    );\r\n  }\r\n\r\n  return <EditorWrapper {...props} document={document} />;\r\n}\r\n\r\nconst EditorWrapper = memo(\r\n  (props: EditorProps & { document: Document | null }) => {\r\n    if (!props.document) {\r\n      if (props.rootTemplateId) {\r\n        if (props.rootComponentId) {\r\n          throw new Error(\r\n            \"You can't pass both 'rootContainer' and 'rootTemplate' parameters to the editor\"\r\n          );\r\n        }\r\n\r\n        const template = props.config.templates?.find(\r\n          (template) => template.id === props.rootTemplateId\r\n        );\r\n\r\n        if (!template) {\r\n          throw new Error(\r\n            `The template given in \"rootTemplate\" (\"${props.rootTemplateId}\") doesn't exist in Config.templates`\r\n          );\r\n        }\r\n      } else {\r\n        if (props.rootComponentId === null) {\r\n          throw new Error(\r\n            \"When you create a new document you must pass a 'rootContainer' or 'rootTemplate' parameter to the editor\"\r\n          );\r\n        }\r\n\r\n        if (\r\n          !props.config.components?.find(\r\n            (component) => component.id === props.rootComponentId\r\n          )\r\n        ) {\r\n          throw new Error(\r\n            `The component given in rootContainer (\"${props.rootComponentId}\") doesn't exist in Config.components`\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    // Locales\r\n    if (!props.config.locales) {\r\n      throw new Error(\"Required property Config.locales is empty\");\r\n    }\r\n\r\n    checkLocalesCorrectness(props.config.locales); // very important to check locales correctness, circular references etc. Other functions\r\n    const locale = props.locale ?? getDefaultLocale(props.config.locales).code;\r\n\r\n    const rootTemplateEntry = props.rootTemplateId\r\n      ? props.config.templates?.find((t) => t.id === props.rootTemplateId)\r\n        ?.entry\r\n      : null;\r\n\r\n    const rootComponentId = props.document\r\n      ? props.document.entry._component\r\n      : rootTemplateEntry?._component ?? props.rootComponentId;\r\n\r\n    const compilationContext = createCompilationContext(\r\n      props.config,\r\n      {\r\n        locale,\r\n      },\r\n      rootComponentId!\r\n    );\r\n\r\n    const initialEntry = props.document\r\n      ? adaptRemoteConfig(props.document.entry, compilationContext)\r\n      : normalize(\r\n        rootTemplateEntry ?? {\r\n          _id: uniqueId(),\r\n          _component: rootComponentId!,\r\n        },\r\n        compilationContext\r\n      );\r\n\r\n    return (\r\n      <EditorContent\r\n        {...props}\r\n        compilationContext={compilationContext}\r\n        initialDocument={props.document}\r\n        initialEntry={initialEntry}\r\n      />\r\n    );\r\n  }\r\n);\r\n\r\ntype EditorContentProps = EditorProps & {\r\n  compilationContext: CompilationContextType;\r\n  initialDocument: Document | null;\r\n  initialEntry: NoCodeComponentEntry;\r\n  heightMode?: \"viewport\" | \"full\";\r\n};\r\n\r\nfunction parseExternalDataId(externalDataId: string): {\r\n  configId: string;\r\n  fieldName: string;\r\n  breakpointIndex: string | undefined;\r\n} {\r\n  const [configId, fieldName, breakpointIndex] = externalDataId.split(\".\");\r\n\r\n  return {\r\n    configId,\r\n    fieldName,\r\n    breakpointIndex,\r\n  };\r\n}\r\n\r\nfunction useBuiltContent(\r\n  editorContext: EditorContextType,\r\n  config: Config,\r\n  rawContent: NoCodeComponentEntry,\r\n  externalData: ExternalData,\r\n  onExternalDataChange: ExternalDataChangeHandler\r\n): NonEmptyRenderableContent & {\r\n  meta: CompilationMetadata;\r\n} {\r\n  const buildEntryResult = useRef<ReturnType<typeof buildEntry>>();\r\n\r\n  // cached inputs (needed to calculated \"inputChanged\")\r\n  const inputRawContent = useRef<NoCodeComponentEntry>();\r\n  const inputIsEditing = useRef<boolean>();\r\n  const inputBreakpointIndex = useRef<string>();\r\n\r\n  const inputChanged =\r\n    inputRawContent.current !== rawContent ||\r\n    inputIsEditing.current !== editorContext.isEditing ||\r\n    inputBreakpointIndex.current !== editorContext.breakpointIndex;\r\n\r\n  if (!buildEntryResult.current || inputChanged) {\r\n    /*\r\n     * Why do we merge meta instead of overriding?\r\n     * It might seem redundant. We could only take the newest meta and re-render, right?\r\n     *\r\n     * The problem is when we have nested Shopstory content.\r\n     * The first call \"buildSync\" only compiles 1 level deep, doesn't compile deeper nested items.\r\n     * Deeper nested items are compiled only when fetch is finished.\r\n     *\r\n     * Because of that, when we switch isEditing from true to false following thing will happen:\r\n     * 1. We'll get only Metadata from 1 level compile.\r\n     * 2. Shopstory Editor will try to re-render everything.\r\n     * 3. It will remember old RenderableContent in the resources.\r\n     * 4. But the metadata from old RenderableContent is not yet added.\r\n     * 5. This will cause errors because there won't be enough definitions in the metadata.\r\n     *\r\n     * The solution is merging. Metadata code + definitions is growing incrementally in the editor.\r\n     * There is no performance overhead of this operation and we might be sure that any definitions\r\n     * that were added at any point will be available later.\r\n     *\r\n     */\r\n\r\n    buildEntryResult.current = buildEntry({\r\n      entry: rawContent,\r\n      config,\r\n      locale: editorContext.contextParams.locale,\r\n      externalData,\r\n      compiler: {\r\n        findExternals,\r\n        validate,\r\n        compile: (content) => {\r\n          let resultMeta: CompilationMetadata = {\r\n            vars: {\r\n              devices: editorContext.devices,\r\n              locale: editorContext.contextParams.locale,\r\n              definitions: {\r\n                actions: [],\r\n                components: [],\r\n                links: [],\r\n                textModifiers: [],\r\n              },\r\n            },\r\n          };\r\n\r\n          const normalizedContent = normalizeInput(content);\r\n\r\n          const { meta, ...rest } = compileInternal(\r\n            normalizedContent,\r\n            editorContext,\r\n            editorContext.compilationCache\r\n          );\r\n\r\n          resultMeta = mergeCompilationMeta(resultMeta, meta);\r\n\r\n          return {\r\n            ...rest,\r\n            meta: resultMeta,\r\n          };\r\n        },\r\n      },\r\n      isExternalDataChanged(externalDataValue, defaultIsExternalDataChanged) {\r\n        // When editing, we consider external data to be changed in more ways.\r\n        const storedExternalData = externalData[externalDataValue.id];\r\n\r\n        // If external data for given id is already stored, but now the external id is empty it means that the user\r\n        // has removed that external value and thus the user of editor has to remove it from its external data.\r\n        if (storedExternalData && externalDataValue.externalId === null) {\r\n          return true;\r\n        }\r\n\r\n        // If external data for given is is already stored, but now the external id is different it means that the user\r\n        // has changed the selected external value and thus the user of editor has to update it in its external data.\r\n        if (\r\n          storedExternalData &&\r\n          externalDataValue.externalId &&\r\n          inputRawContent.current\r\n        ) {\r\n          const { breakpointIndex, configId, fieldName } = parseExternalDataId(\r\n            externalDataValue.id\r\n          );\r\n\r\n          const config = findConfigById(\r\n            inputRawContent.current,\r\n            editorContext,\r\n            configId === \"$\" ? inputRawContent.current._id : configId\r\n          );\r\n\r\n          if (!config) {\r\n            return false;\r\n          }\r\n\r\n          const value = breakpointIndex\r\n            ? responsiveValueGet(config[fieldName], breakpointIndex)\r\n            : config[fieldName];\r\n\r\n          const hasExternalIdChanged =\r\n            value === undefined || value.id !== externalDataValue.externalId;\r\n\r\n          return hasExternalIdChanged;\r\n        }\r\n\r\n        return defaultIsExternalDataChanged(externalDataValue);\r\n      },\r\n    });\r\n\r\n    if (Object.keys(buildEntryResult.current.externalData).length > 0) {\r\n      onExternalDataChange(\r\n        buildEntryResult.current.externalData,\r\n        editorContext.contextParams\r\n      );\r\n    }\r\n  }\r\n\r\n  inputRawContent.current = rawContent;\r\n  inputIsEditing.current = editorContext.isEditing;\r\n  inputBreakpointIndex.current = editorContext.breakpointIndex;\r\n\r\n  return {\r\n    renderableContent: (buildEntryResult.current as NonEmptyRenderableContent)\r\n      .renderableContent,\r\n    configAfterAuto: (buildEntryResult.current as NonEmptyRenderableContent)\r\n      .configAfterAuto,\r\n    meta: buildEntryResult.current.meta,\r\n  };\r\n}\r\n\r\nfunction calculateViewportRelatedStuff(\r\n  viewport: string,\r\n  devices: DeviceRange[],\r\n  mainBreakpointIndex: string,\r\n  availableSize?: { width: number; height: number }\r\n) {\r\n  let activeDevice: DeviceRange;\r\n\r\n  // Calculate active device\r\n  if (viewport === \"fit-screen\") {\r\n    if (!availableSize) {\r\n      activeDevice = devices.find(\r\n        (device) => device.id === mainBreakpointIndex\r\n      )!;\r\n    } else {\r\n      const matchingDevice = getMatchingDevice(devices, availableSize.width);\r\n      if (!matchingDevice) {\r\n        throw new Error(\"can't find matching device\");\r\n      }\r\n\r\n      activeDevice = matchingDevice;\r\n    }\r\n  } else {\r\n    activeDevice = devices.find((device) => device.id === viewport)!;\r\n  }\r\n\r\n  const activeDeviceindex = devices.findIndex(\r\n    (device) => device.id === activeDevice.id\r\n  );\r\n\r\n  // Calculate width, height and scale\r\n  let width, height: number;\r\n  let scaleFactor: number | null = null;\r\n  let offsetY = 0;\r\n\r\n  if (!availableSize) {\r\n    // lack of available size (first render) should wait until size is available to perform calculations\r\n    width = 0;\r\n    height = 0;\r\n  } else {\r\n    if (viewport === \"fit-screen\") {\r\n      width = availableSize.width;\r\n      height = availableSize.height;\r\n    } else {\r\n      const smallestNonScaledWidth =\r\n        activeDeviceindex === 0\r\n          ? 0\r\n          : devices[activeDeviceindex - 1].breakpoint!;\r\n\r\n      width = activeDevice.w;\r\n      height =\r\n        activeDevice.h === null\r\n          ? availableSize.height\r\n          : Math.min(activeDevice.h, availableSize.height);\r\n\r\n      if (activeDevice.w <= availableSize.width) {\r\n        // fits\r\n      } else if (smallestNonScaledWidth <= availableSize.width) {\r\n        // fits currently selected device range\r\n        width = availableSize.width;\r\n      } else {\r\n        // we must scale\r\n        scaleFactor = availableSize.width / activeDevice.w;\r\n\r\n        if (activeDevice.h === null) {\r\n          height = availableSize.height / scaleFactor;\r\n          offsetY = (availableSize.height - height) / 2;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    breakpointIndex: activeDevice.id,\r\n    iframeSize: {\r\n      width,\r\n      height,\r\n      transform:\r\n        scaleFactor === null\r\n          ? \"none\"\r\n          : `translateY(${offsetY}px) scale(${scaleFactor})`,\r\n    },\r\n  };\r\n}\r\n\r\nfunction useRerenderOnIframeResize(iframe?: HTMLIFrameElement | null) {\r\n  const { forceRerender } = useForceRerender();\r\n\r\n  const resizeObserver = useRef(\r\n    new ResizeObserver(\r\n      throttle(() => {\r\n        forceRerender();\r\n      }, 100)\r\n    )\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (!iframe) {\r\n      return;\r\n    }\r\n\r\n    resizeObserver.current.observe(iframe);\r\n\r\n    return () => {\r\n      resizeObserver.current.unobserve(iframe);\r\n    };\r\n  }, [iframe]);\r\n}\r\n\r\nconst EditorContent = ({\r\n  compilationContext,\r\n  heightMode = \"viewport\",\r\n  initialDocument,\r\n  initialEntry,\r\n  externalData,\r\n  isAdminMode = false,\r\n  ...props\r\n}: EditorContentProps) => {\r\n  const [currentViewport, setCurrentViewport] = useState<string>(\r\n    compilationContext.mainBreakpointIndex\r\n  ); // \"{ breakpoint }\" or \"fit-screen\"\r\n\r\n  const iframeContainerRef = useRef<HTMLIFrameElement>(null);\r\n  const availableSize = iframeContainerRef.current\r\n    ? {\r\n      width: iframeContainerRef.current.clientWidth,\r\n      height: iframeContainerRef.current.clientHeight,\r\n    }\r\n    : undefined;\r\n\r\n  const { breakpointIndex, iframeSize } = calculateViewportRelatedStuff(\r\n    currentViewport,\r\n    compilationContext.devices,\r\n    compilationContext.mainBreakpointIndex,\r\n    availableSize\r\n  );\r\n\r\n  useRerenderOnIframeResize(iframeContainerRef.current); // re-render on resize (recalculates viewport size, active breakpoint for fit-screen etc);\r\n\r\n  const compilationCache = useRef(new CompilationCache());\r\n  const [isEditing, setEditing] = useState(true);\r\n  const [currentLocale, setCurrentLocale] = useState(\r\n    compilationContext.contextParams.locale\r\n  );\r\n  const prevLocale = useRef<string>(\"\");\r\n  const [componentPickerData, setComponentPickerData] = useState<\r\n    | {\r\n      promiseResolve: (config: NoCodeComponentEntry | undefined) => void;\r\n      config: OpenComponentPickerConfig;\r\n    }\r\n    | undefined\r\n  >(undefined);\r\n  const [focussedField, setFocussedField] = useState<Array<string>>([]);\r\n\r\n  const handleSetFocussedField = React.useRef(\r\n    (field: Array<string> | string) => {\r\n      const nextFocusedField = Array.isArray(field) ? field : [field];\r\n      setFocussedField(nextFocusedField);\r\n    }\r\n  ).current;\r\n\r\n  const isEditMode = useMemo(() => {\r\n    if (!prevLocale.current || prevLocale.current === currentLocale) {\r\n      return isEditing;\r\n    }\r\n    return !isEditing;\r\n  }, [currentLocale, isEditing]);\r\n\r\n  const handleSetEditing = useCallback(() => {\r\n    compilationCache.current.clear();\r\n    setEditing(!isEditing);\r\n  }, [isEditing]);\r\n\r\n  const closeComponentPickerModal = (config?: NoCodeComponentEntry) => {\r\n    setComponentPickerData(undefined);\r\n    componentPickerData!.promiseResolve(config);\r\n  };\r\n\r\n  const sidebarNodeRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  const [editableData, form] = useForm({\r\n    id: \"easyblocks-editor\",\r\n    label: \"Edit entry\",\r\n    fields: [],\r\n    initialValues: initialEntry,\r\n    onSubmit: async () => { },\r\n  });\r\n\r\n  const { undo, redo, push } = useEditorHistory({\r\n    onChange: ({ config, focusedField }) => {\r\n      setFocussedField(focusedField);\r\n      form.finalForm.change(\"\", config);\r\n    },\r\n  });\r\n\r\n  const [templates, setTemplates] = useState<Template[] | undefined>(undefined);\r\n\r\n  const [openTemplateModalAction, setOpenTemplateModalAction] = useState<\r\n    OpenTemplateModalAction | undefined\r\n  >(undefined);\r\n\r\n  const { notify } = useToaster();\r\n\r\n  const actions: ActionsType = {\r\n    openTemplateModal: setOpenTemplateModalAction,\r\n    notify: (message) => {\r\n      notify(message);\r\n    },\r\n    openComponentPicker: function (config) {\r\n      return new Promise((resolve) => {\r\n        setComponentPickerData({\r\n          promiseResolve: resolve,\r\n          config,\r\n        });\r\n      });\r\n    },\r\n    replaceItems: (paths, newConfig) => {\r\n      actions.runChange(() => {\r\n        replaceItems(paths, newConfig, editorContext);\r\n      });\r\n    },\r\n    moveItems: (fieldNames, direction) => {\r\n      actions.runChange(() => {\r\n        return moveItems(form, fieldNames, direction);\r\n      });\r\n    },\r\n    removeItems: (fieldNames) => {\r\n      actions.runChange(() => {\r\n        return removeItems(form, fieldNames, editorContext);\r\n      });\r\n    },\r\n    insertItem: ({ name, index, block }) => {\r\n      actions.runChange(() => {\r\n        form.mutators.insert(\r\n          name,\r\n          index,\r\n          duplicateConfig(block, compilationContext)\r\n        );\r\n\r\n        return [`${name}.${index}`];\r\n      });\r\n    },\r\n    duplicateItems: (fieldNames) => {\r\n      actions.runChange(() => {\r\n        return duplicateItems(form, fieldNames, compilationContext);\r\n      });\r\n    },\r\n    pasteItems: (what) => {\r\n      actions.runChange(() =>\r\n        pasteItems({\r\n          what,\r\n          where: focussedField,\r\n          resolveDestination: destinationResolver({\r\n            form,\r\n            context: compilationContext,\r\n          }),\r\n          pasteCommand: pasteManager(),\r\n        })\r\n      );\r\n    },\r\n    runChange: (configChangeCallback) => {\r\n      let fieldsToFocus!: Array<string>;\r\n\r\n      // When multiple fields are selected, the update could probably invoke `form.change` multiple times.\r\n      // To avoid multiple rerenders, we batch them to trigger single update.\r\n      form.finalForm.batch(() => {\r\n        // This shallow copy of `focussedField` array is SUPER IMPORTANT!\r\n        // Here is why...\r\n        //\r\n        // We invoke `configChangeCallback`, but since we are in batch, changes made to form state won't notify\r\n        // any listeners that there were any changes. This means `window.editorWindowAPI.onUpdate` won't be invoked.\r\n        //\r\n        // Next, update of `focussedField` is going to be queued up. React's heuristics will treat this update\r\n        // as update with high priority and synchronously rerender. `EditorContent` is going to rerender with updated\r\n        // `focussedField` state, but also with updated `editableData` because it's a result of **getter**!\r\n        // `useEffect` that is responsible for invoking `window.editorWindowAPI.onUpdate` will receive new dependencies,\r\n        // save them as the the latest, but it won't be immediately invoked after component have returned.\r\n        // Then the batch ends and all form listeners are going to be notified. `EditorContent` will rerender again,\r\n        // but `editableData` and `focussedField` are the same! `useEffect` will be invoked again, it will compare its dependencies\r\n        // and finds that the haven't changed.\r\n        //\r\n        // Making a shallow copy of `focussedField` will make the second invocation of `useEffect` different from the first\r\n        // triggered by calling `setFocussedField`.\r\n        fieldsToFocus = configChangeCallback() ?? [...focussedField];\r\n\r\n        push({\r\n          config: form.values,\r\n          focussedField: fieldsToFocus,\r\n        });\r\n\r\n        setFocussedField(fieldsToFocus);\r\n      });\r\n    },\r\n    logSelectedItems: () => {\r\n      logItems(editorContext.form, focussedField);\r\n    },\r\n  };\r\n\r\n  const syncTemplates = ({\r\n    mode,\r\n    template,\r\n  }: { mode?: \"create\" | \"edit\" | \"delete\"; template?: Template } = {}) => {\r\n    let templateDefined;\r\n    if (template) {\r\n      templateDefined = {\r\n        ...(template as UserDefinedTemplate),\r\n        isUserDefined: true,\r\n      };\r\n    }\r\n\r\n    switch (mode) {\r\n      case \"create\": {\r\n        if (templateDefined) {\r\n          setTemplates((prev) => {\r\n            if (!prev) {\r\n              return [templateDefined];\r\n            }\r\n\r\n            return [...prev, templateDefined];\r\n          });\r\n        }\r\n        break;\r\n      }\r\n\r\n      case \"edit\": {\r\n        if (templateDefined) {\r\n          setTemplates((prev) => {\r\n            if (!prev) {\r\n              return [templateDefined];\r\n            }\r\n\r\n            const templateIndex = prev.findIndex(\r\n              (t) => t.id === templateDefined.id\r\n            );\r\n\r\n            if (templateIndex === -1) {\r\n              return prev;\r\n            }\r\n\r\n            const newTemplates = [...prev];\r\n            newTemplates[templateIndex] = templateDefined;\r\n\r\n            return newTemplates;\r\n          });\r\n        }\r\n        break;\r\n      }\r\n\r\n      case \"delete\": {\r\n        if (templateDefined) {\r\n          setTemplates((prev) => {\r\n            if (!prev) {\r\n              return [];\r\n            }\r\n\r\n            const templateIndex = prev.findIndex(\r\n              (t) => t.id === templateDefined.id\r\n            );\r\n\r\n            if (templateIndex === -1) {\r\n              return prev;\r\n            }\r\n\r\n            const newTemplates = [...prev];\r\n            newTemplates.splice(templateIndex, 1);\r\n\r\n            return newTemplates;\r\n          });\r\n        }\r\n        break;\r\n      }\r\n\r\n      default: {\r\n        getTemplates(editorContext, (props.config.templates as any) ?? []).then(\r\n          (newTemplates) => {\r\n            setTemplates(newTemplates);\r\n          }\r\n        );\r\n        break;\r\n      }\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    prevLocale.current = currentLocale;\r\n  }, [currentLocale]);\r\n\r\n  useEffect(() => {\r\n    syncTemplates();\r\n  }, [props.config.components, props.config.templates]);\r\n\r\n  const editorTypes: EditorContextType[\"types\"] = Object.fromEntries(\r\n    Object.entries(compilationContext.types).map(\r\n      ([typeName, typeDefinition]) => {\r\n        return [\r\n          typeName,\r\n          {\r\n            ...typeDefinition,\r\n            ...(typeDefinition.type === \"external\"\r\n              ? {\r\n                widgets: typeDefinition.widgets.map((w) => {\r\n                  return {\r\n                    ...w,\r\n                    component: props.widgets?.[w.id] as any,\r\n                  };\r\n                }),\r\n              }\r\n              : typeDefinition.widget\r\n                ? {\r\n                  widget: {\r\n                    ...typeDefinition.widget,\r\n                    component: props.widgets?.[typeDefinition.widget.id] as any,\r\n                  },\r\n                }\r\n                : {}),\r\n          },\r\n        ];\r\n      }\r\n    )\r\n  );\r\n\r\n  const editorContext: EditorContextType = {\r\n    ...compilationContext,\r\n    backend: props.config.backend,\r\n    types: editorTypes,\r\n    isAdminMode,\r\n    templates,\r\n    syncTemplates,\r\n    breakpointIndex,\r\n    focussedField,\r\n    form,\r\n    setFocussedField: handleSetFocussedField,\r\n    isEditing,\r\n    actions,\r\n    save: async (documentData) => {\r\n      window.postMessage({\r\n        type: \"@easyblocks/content-saved\",\r\n        document: documentData,\r\n      });\r\n    },\r\n    compilationCache: compilationCache.current,\r\n    readOnly: props.readOnly,\r\n    disableCustomTemplates: props.config.disableCustomTemplates ?? false,\r\n    rootComponent: findComponentDefinitionById(\r\n      initialEntry._component,\r\n      compilationContext\r\n    )!,\r\n    components: props.components ?? {},\r\n  };\r\n\r\n  const { configAfterAuto, renderableContent, meta } = useBuiltContent(\r\n    editorContext,\r\n    props.config,\r\n    editableData,\r\n    externalData,\r\n    props.onExternalDataChange\r\n  );\r\n\r\n  editorContext.compiledComponentConfig = renderableContent;\r\n  editorContext.configAfterAuto = configAfterAuto;\r\n\r\n  console.debug(\"editable data\", editableData);\r\n  console.debug(\"focused field\", focussedField);\r\n  console.debug(\"meta\", meta);\r\n  console.debug(\"compiled config\", {\r\n    configAfterAuto,\r\n    renderableContent,\r\n  });\r\n  console.debug(\"external data\", externalData);\r\n\r\n  window.editorWindowAPI = window.editorWindowAPI || {};\r\n  window.editorWindowAPI.editorContext = editorContext;\r\n  window.editorWindowAPI.meta = meta;\r\n  window.editorWindowAPI.compiled =\r\n    renderableContent as unknown as NonEmptyRenderableContent;\r\n  window.editorWindowAPI.externalData = externalData;\r\n\r\n  const onLocaleChange = async (localeValue: string) => {\r\n    compilationCache.current.clear();\r\n    compilationContext.contextParams.locale = localeValue;\r\n    setCurrentLocale(localeValue);\r\n    compilationCache.current.clear();\r\n    setEditing((prev) => !prev);\r\n\r\n    await sleep(1);\r\n\r\n    compilationCache.current.clear();\r\n    setEditing((prev) => !prev);\r\n  };\r\n\r\n  useEffect(() => {\r\n    push({\r\n      config: initialEntry,\r\n      focussedField: [],\r\n    });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (window.editorWindowAPI?.onUpdate) {\r\n      window.editorWindowAPI.onUpdate();\r\n    }\r\n  }, [\r\n    renderableContent,\r\n    focussedField,\r\n    isEditing,\r\n    currentViewport,\r\n    externalData,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    function handleEditorEvents(\r\n      event: ComponentPickerOpenedEvent | ItemInsertedEvent | ItemMovedEvent\r\n    ) {\r\n      if (event.data.type === \"@easyblocks-editor/component-picker-opened\") {\r\n        actions\r\n          .openComponentPicker({ path: event.data.payload.path })\r\n          .then((config) => {\r\n            const shopstoryCanvasIframe = window.document.getElementById(\r\n              \"shopstory-canvas\"\r\n            ) as HTMLIFrameElement | undefined;\r\n\r\n            shopstoryCanvasIframe?.contentWindow?.postMessage(\r\n              componentPickerClosed(config)\r\n            );\r\n          });\r\n      }\r\n\r\n      if (event.data.type === \"@easyblocks-editor/item-inserted\") {\r\n        actions.insertItem(event.data.payload);\r\n      }\r\n\r\n      if (event.data.type === \"@easyblocks-editor/item-moved\") {\r\n        const { fromPath, toPath, placement } = event.data.payload;\r\n\r\n        const fromPathParseResult = parsePath(fromPath, editorContext.form);\r\n        const toPathParseResult = parsePath(toPath, editorContext.form);\r\n\r\n        if (\r\n          !fromPathParseResult.parent ||\r\n          !toPathParseResult.parent ||\r\n          fromPathParseResult.index === undefined ||\r\n          toPathParseResult === undefined\r\n        ) {\r\n          return;\r\n        }\r\n\r\n        if (fromPathParseResult.parent.path === toPathParseResult.parent.path) {\r\n          const pathToMove = `${fromPathParseResult.parent.path\r\n            ? fromPathParseResult.parent.path + \".\"\r\n            : \"\"\r\n            }${fromPathParseResult.parent.fieldName}`;\r\n\r\n          actions.runChange(() => {\r\n            form.mutators.move(\r\n              pathToMove,\r\n              fromPathParseResult.index,\r\n              toPathParseResult.index\r\n            );\r\n\r\n            return [toPath];\r\n          });\r\n        } else {\r\n          // TODO: We should reuse logic of pasting items here, but we need to handle the case of pasting into placeholder (empty array)\r\n          const isToPathPlaceholder = toPathParseResult.fieldName !== undefined;\r\n\r\n          const insertionPath = `${toPathParseResult.parent.path === \"\"\r\n            ? \"\"\r\n            : toPathParseResult.parent.path + \".\"\r\n            }${toPathParseResult.parent.fieldName}${isToPathPlaceholder\r\n              ? `.${toPathParseResult.index}.${toPathParseResult.fieldName}`\r\n              : \"\"\r\n            }`;\r\n\r\n          actions.runChange(() => {\r\n            const newConfig = duplicateConfig(\r\n              dotNotationGet(form.values, fromPath),\r\n              editorContext\r\n            );\r\n\r\n            const insertionIndex = calculateInsertionIndex(\r\n              fromPath,\r\n              toPath,\r\n              placement,\r\n              form\r\n            );\r\n\r\n            form.mutators.insert(insertionPath, insertionIndex, newConfig);\r\n\r\n            actions.removeItems([fromPath]);\r\n\r\n            return [\r\n              isToPathPlaceholder\r\n                ? `${insertionPath}.0`\r\n                : `${insertionPath}.${insertionIndex}`,\r\n            ];\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n    window.addEventListener(\"message\", handleEditorEvents);\r\n\r\n    return () => window.removeEventListener(\"message\", handleEditorEvents);\r\n  }, []);\r\n\r\n  const [isDataSaverOverlayOpen, setDataSaverOverlayOpen] = useState(false);\r\n\r\n  useEditorGlobalKeyboardShortcuts(editorContext);\r\n\r\n  const { saveNow } = useDataSaver(\r\n    initialDocument,\r\n    editorContext\r\n  );\r\n\r\n  const appHeight = heightMode === \"viewport\" ? \"100vh\" : \"100%\";\r\n\r\n  useEffect(() => {\r\n    Modal.setAppElement(\"#shopstory-app\");\r\n  }, []);\r\n\r\n  const EditorSidebarRight = ({\r\n    sidebarNodeRef,\r\n    focussedField,\r\n    form\r\n  }: {\r\n    sidebarNodeRef: React.MutableRefObject<HTMLDivElement | null>,\r\n    focussedField: Array<string>,\r\n    form: Form\r\n  }) => {\r\n\r\n    return (\r\n      <SidebarContainer ref={sidebarNodeRef}>\r\n        <EditorSidebar focussedField={focussedField} form={form} />\r\n      </SidebarContainer>\r\n    )\r\n  };\r\n  const MemoEditorSidebarRight = React.memo(EditorSidebarRight)\r\n\r\n  return (\r\n    <div id={\"shopstory-app\"} style={{ height: appHeight, overflow: \"hidden\" }}>\r\n      {isDataSaverOverlayOpen && (\r\n        <DataSaverRoot>\r\n          <DataSaverOverlay></DataSaverOverlay>\r\n\r\n          <DataSaverModal>\r\n            Saving data, please do not close the window...\r\n          </DataSaverModal>\r\n        </DataSaverRoot>\r\n      )}\r\n      <EditorContext.Provider value={editorContext}>\r\n        <ConfigAfterAutoContext.Provider value={configAfterAuto}>\r\n          <EditorExternalDataProvider externalData={externalData}>\r\n            <div id=\"rootContainer\" />\r\n            <EditorTopBar\r\n              onUndo={undo}\r\n              onRedo={redo}\r\n              onSaveDocument={saveNow}\r\n              onClose={() => {\r\n                setDataSaverOverlayOpen(true);\r\n                saveNow().finally(() => {\r\n                  setDataSaverOverlayOpen(false);\r\n\r\n                  window.postMessage(\r\n                    {\r\n                      type: \"@easyblocks/closed\",\r\n                    },\r\n                    \"*\"\r\n                  );\r\n\r\n                  if (props.onClose) {\r\n                    props.onClose();\r\n                  }\r\n                });\r\n              }}\r\n              devices={compilationContext.devices}\r\n              viewport={currentViewport}\r\n              onViewportChange={setCurrentViewport}\r\n              onIsEditingChange={handleSetEditing}\r\n              isEditing={isEditMode}\r\n              saveLabel=\"Save\"\r\n              locale={currentLocale}\r\n              locales={editorContext.locales}\r\n              onLocaleChange={onLocaleChange}\r\n              hideCloseButton={props.config.hideCloseButton ?? false}\r\n              readOnly={editorContext.readOnly}\r\n            />\r\n            <SidebarAndContentContainer height={appHeight}>\r\n              <ContentContainer\r\n                onClick={() => {\r\n                  setFocussedField([]);\r\n                }}\r\n              >\r\n                <EditorIframe\r\n                  onEditorHistoryUndo={undo}\r\n                  onEditorHistoryRedo={redo}\r\n                  width={iframeSize.width}\r\n                  height={iframeSize.height}\r\n                  transform={iframeSize.transform}\r\n                  containerRef={iframeContainerRef}\r\n                />\r\n                {isEditMode && (\r\n                  <SelectionFrame\r\n                    width={iframeSize.width}\r\n                    height={iframeSize.height}\r\n                    transform={iframeSize.transform}\r\n                  />\r\n                )}\r\n              </ContentContainer>\r\n              {isEditMode && (\r\n                <MemoEditorSidebarRight\r\n                  sidebarNodeRef={sidebarNodeRef}\r\n                  focussedField={focussedField}\r\n                  form={form}\r\n                />\r\n                // <SidebarContainer ref={sidebarNodeRef}>\r\n                //   <EditorSidebar focussedField={focussedField} form={form} />\r\n                // </SidebarContainer>\r\n              )}\r\n              {componentPickerData && (\r\n                <ModalPicker\r\n                  onClose={closeComponentPickerModal}\r\n                  config={componentPickerData.config}\r\n                  pickers={props.pickers}\r\n                />\r\n              )}\r\n            </SidebarAndContentContainer>\r\n\r\n            {openTemplateModalAction && (\r\n              <TemplateModal\r\n                action={openTemplateModalAction}\r\n                onClose={() => {\r\n                  setOpenTemplateModalAction(undefined);\r\n                }}\r\n                backend={editorContext.backend}\r\n              />\r\n            )}\r\n          </EditorExternalDataProvider>\r\n        </ConfigAfterAutoContext.Provider>\r\n      </EditorContext.Provider>\r\n    </div>\r\n  );\r\n};\r\n\r\nfunction adaptRemoteConfig(\r\n  config: NoCodeComponentEntry,\r\n  compilationContext: CompilationContextType\r\n) {\r\n  const withoutLocalizedFlag = removeLocalizedFlag(config, compilationContext);\r\n  const normalized = normalize(withoutLocalizedFlag, compilationContext);\r\n  return normalized;\r\n}\r\n\r\nfunction calculateInsertionIndex(\r\n  fromPath: string,\r\n  toPath: string,\r\n  placement: \"before\" | \"after\" | undefined,\r\n  form: Form\r\n) {\r\n  const mostCommonPath = getMostCommonSubPath(fromPath, toPath);\r\n  const mostCommonPathParseResult = parsePath(mostCommonPath ?? \"\", form);\r\n  const toPathParseResult = parsePath(toPath, form);\r\n  const toPathNoCodeEntry = dotNotationGet(form.values, toPath);\r\n\r\n  if (toPathNoCodeEntry.length === 0) {\r\n    return 0;\r\n  }\r\n\r\n  // If there is no index in common path, it means that we're moving items between two sections\r\n  if (mostCommonPathParseResult.index === undefined) {\r\n    const fromPathRootSectionIndex = +fromPath.split(\".\")[1];\r\n    const toPathRootSectionIndex = +toPath.split(\".\")[1];\r\n\r\n    if (fromPathRootSectionIndex > toPathRootSectionIndex) {\r\n      if (placement) {\r\n        if (placement === \"before\") {\r\n          return toPathParseResult.index!;\r\n        }\r\n\r\n        return toPathParseResult.index! + 1;\r\n      }\r\n\r\n      return toPathParseResult.index!;\r\n    }\r\n\r\n    if (placement) {\r\n      if (placement === \"before\") {\r\n        return toPathParseResult.index!;\r\n      }\r\n\r\n      return toPathParseResult.index! + 1;\r\n    }\r\n\r\n    return toPathParseResult.index! + 1;\r\n  }\r\n\r\n  return toPathParseResult.index! + 1;\r\n}\r\n\r\nfunction getMostCommonSubPath(path1: string, path2: string) {\r\n  const fromPathParts = path1.split(\".\");\r\n  const toPathParts = path2.split(\".\");\r\n\r\n  let mostCommonPathParts: Array<string> | undefined = undefined;\r\n\r\n  for (let i = 0; i < Math.min(fromPathParts.length, toPathParts.length); i++) {\r\n    const currentFromPathPart = fromPathParts[i];\r\n    const currentToPathPart = toPathParts[i];\r\n\r\n    if (currentFromPathPart !== currentToPathPart) {\r\n      break;\r\n    }\r\n\r\n    if (!mostCommonPathParts) {\r\n      mostCommonPathParts = [currentFromPathPart];\r\n      continue;\r\n    }\r\n\r\n    mostCommonPathParts.push(currentFromPathPart);\r\n  }\r\n\r\n  return mostCommonPathParts?.join(\".\");\r\n}\r\n\r\nfunction findConfigById(\r\n  config: NoCodeComponentEntry,\r\n  context: CompilationContextType,\r\n  configId: string\r\n): NoCodeComponentEntry | undefined {\r\n  let foundConfig: NoCodeComponentEntry | undefined;\r\n\r\n  traverseComponents(config, context, ({ componentConfig }) => {\r\n    if (foundConfig) {\r\n      return;\r\n    }\r\n\r\n    if (componentConfig._id === configId) {\r\n      foundConfig = componentConfig;\r\n    }\r\n  });\r\n\r\n  return foundConfig;\r\n}\r\n\r\nfunction getMatchingDevice(devices: Array<DeviceRange>, width: number) {\r\n  const highestDevice = devices.find((d) => d.breakpoint === null);\r\n\r\n  const visibleDevices = devices.filter(\r\n    (d) => !d.hidden && d.breakpoint !== null\r\n  );\r\n\r\n  for (let i = 0; i < visibleDevices.length; i++) {\r\n    const currentDevice = visibleDevices[i];\r\n\r\n    if (currentDevice.breakpoint! > width) {\r\n      return currentDevice;\r\n    }\r\n  }\r\n\r\n  if (highestDevice) {\r\n    return highestDevice;\r\n  }\r\n\r\n  return null;\r\n}\r\n","/**\r\n * This is a copy of validate-color function from validate-color npm package. This package has problem with bundling, so I copied it here. It was modified 100 years ago anyway and had 32 stars, so nothing fancy really.\r\n */\r\n\r\n// Good article on HTML Colors:\r\n// https://dev.to/alvaromontoro/the-ultimate-guide-to-css-colors-2020-edition-1bh1#hsl\r\n\r\n// Check if parameter is defined and a string\r\nconst isString = (color: string) => color && typeof color === \"string\";\r\n// All existing HTML color names\r\nconst htmlColorNames = [\r\n  \"AliceBlue\",\r\n  \"AntiqueWhite\",\r\n  \"Aqua\",\r\n  \"Aquamarine\",\r\n  \"Azure\",\r\n  \"Beige\",\r\n  \"Bisque\",\r\n  \"Black\",\r\n  \"BlanchedAlmond\",\r\n  \"Blue\",\r\n  \"BlueViolet\",\r\n  \"Brown\",\r\n  \"BurlyWood\",\r\n  \"CadetBlue\",\r\n  \"Chartreuse\",\r\n  \"Chocolate\",\r\n  \"Coral\",\r\n  \"CornflowerBlue\",\r\n  \"Cornsilk\",\r\n  \"Crimson\",\r\n  \"Cyan\",\r\n  \"DarkBlue\",\r\n  \"DarkCyan\",\r\n  \"DarkGoldenrod\",\r\n  \"DarkGray\",\r\n  \"DarkGreen\",\r\n  \"DarkKhaki\",\r\n  \"DarkMagenta\",\r\n  \"DarkOliveGreen\",\r\n  \"DarkOrange\",\r\n  \"DarkOrchid\",\r\n  \"DarkRed\",\r\n  \"DarkSalmon\",\r\n  \"DarkSeaGreen\",\r\n  \"DarkSlateBlue\",\r\n  \"DarkSlateGray\",\r\n  \"DarkTurquoise\",\r\n  \"DarkViolet\",\r\n  \"DeepPink\",\r\n  \"DeepSkyBlue\",\r\n  \"DimGray\",\r\n  \"DodgerBlue\",\r\n  \"FireBrick\",\r\n  \"FloralWhite\",\r\n  \"ForestGreen\",\r\n  \"Fuchsia\",\r\n  \"Gainsboro\",\r\n  \"GhostWhite\",\r\n  \"Gold\",\r\n  \"Goldenrod\",\r\n  \"Gray\",\r\n  \"Green\",\r\n  \"GreenYellow\",\r\n  \"HoneyDew\",\r\n  \"HotPink\",\r\n  \"IndianRed\",\r\n  \"Indigo\",\r\n  \"Ivory\",\r\n  \"Khaki\",\r\n  \"Lavender\",\r\n  \"LavenderBlush\",\r\n  \"LawnGreen\",\r\n  \"LemonChiffon\",\r\n  \"LightBlue\",\r\n  \"LightCoral\",\r\n  \"LightCyan\",\r\n  \"LightGoldenrodYellow\",\r\n  \"LightGray\",\r\n  \"LightGreen\",\r\n  \"LightPink\",\r\n  \"LightSalmon\",\r\n  \"LightSalmon\",\r\n  \"LightSeaGreen\",\r\n  \"LightSkyBlue\",\r\n  \"LightSlateGray\",\r\n  \"LightSteelBlue\",\r\n  \"LightYellow\",\r\n  \"Lime\",\r\n  \"LimeGreen\",\r\n  \"Linen\",\r\n  \"Magenta\",\r\n  \"Maroon\",\r\n  \"MediumAquamarine\",\r\n  \"MediumBlue\",\r\n  \"MediumOrchid\",\r\n  \"MediumPurple\",\r\n  \"MediumSeaGreen\",\r\n  \"MediumSlateBlue\",\r\n  \"MediumSlateBlue\",\r\n  \"MediumSpringGreen\",\r\n  \"MediumTurquoise\",\r\n  \"MediumVioletRed\",\r\n  \"MidnightBlue\",\r\n  \"MintCream\",\r\n  \"MistyRose\",\r\n  \"Moccasin\",\r\n  \"NavajoWhite\",\r\n  \"Navy\",\r\n  \"OldLace\",\r\n  \"Olive\",\r\n  \"OliveDrab\",\r\n  \"Orange\",\r\n  \"OrangeRed\",\r\n  \"Orchid\",\r\n  \"PaleGoldenrod\",\r\n  \"PaleGreen\",\r\n  \"PaleTurquoise\",\r\n  \"PaleVioletRed\",\r\n  \"PapayaWhip\",\r\n  \"PeachPuff\",\r\n  \"Peru\",\r\n  \"Pink\",\r\n  \"Plum\",\r\n  \"PowderBlue\",\r\n  \"Purple\",\r\n  \"RebeccaPurple\",\r\n  \"Red\",\r\n  \"RosyBrown\",\r\n  \"RoyalBlue\",\r\n  \"SaddleBrown\",\r\n  \"Salmon\",\r\n  \"SandyBrown\",\r\n  \"SeaGreen\",\r\n  \"SeaShell\",\r\n  \"Sienna\",\r\n  \"Silver\",\r\n  \"SkyBlue\",\r\n  \"SlateBlue\",\r\n  \"SlateGray\",\r\n  \"Snow\",\r\n  \"SpringGreen\",\r\n  \"SteelBlue\",\r\n  \"Tan\",\r\n  \"Teal\",\r\n  \"Thistle\",\r\n  \"Tomato\",\r\n  \"Turquoise\",\r\n  \"Violet\",\r\n  \"Wheat\",\r\n  \"White\",\r\n  \"WhiteSmoke\",\r\n  \"Yellow\",\r\n  \"YellowGreen\",\r\n];\r\n// These 3 values are valid, usable color names, which are special in their own way\r\nconst htmlColorNamesSpecial = [\"currentColor\", \"inherit\", \"transparent\"];\r\n\r\n// Validate HTML color name (red, yellow, etc)\r\nexport const validateHTMLColorName = (color: string): boolean => {\r\n  let status = false;\r\n  if (isString(color)) {\r\n    htmlColorNames.map((c) => {\r\n      if (color.toLowerCase() === c.toLowerCase()) {\r\n        status = true;\r\n      }\r\n      return null;\r\n    });\r\n  }\r\n  return status;\r\n};\r\n\r\n// Validate HTML color special name (currentColor, inherit, etc)\r\nexport const validateHTMLColorSpecialName = (color: string): boolean => {\r\n  let status = false;\r\n  if (isString(color)) {\r\n    htmlColorNamesSpecial.map((c) => {\r\n      if (color.toLowerCase() === c.toLowerCase()) {\r\n        status = true;\r\n      }\r\n      return null;\r\n    });\r\n  }\r\n  return status;\r\n};\r\n\r\n// Validate HTML color 'hex'\r\nexport const validateHTMLColorHex = (color: string): boolean => {\r\n  if (isString(color)) {\r\n    const regex = /^#([\\da-f]{3}){1,2}$|^#([\\da-f]{4}){1,2}$/i;\r\n    return !!color && regex.test(color);\r\n  }\r\n  return false;\r\n};\r\n\r\n// Validate HTML color 'rgb'\r\n// -- legacy notation\r\n// color: rgb(255, 255, 255);\r\n// color: rgba(255, 255, 255, 1);\r\n// -- new notation\r\n// color: rgb(255 255 255);\r\n// color: rgb(255 255 255 / 1);\r\n// Note that 'rgba()' is now merged into 'rgb()'\r\nexport const validateHTMLColorRgb = (color: string): boolean => {\r\n  if (isString(color)) {\r\n    const regex =\r\n      /(rgb)a?\\((\\s*\\d+%?\\s*?,?\\s*){2}(\\s*\\d+%?\\s*?,?\\s*\\)?)(\\s*,?\\s*\\/?\\s*(0?\\.?\\d+%?\\s*)?|1|0)?\\)$/i;\r\n    return !!color && regex.test(color);\r\n  }\r\n  return false;\r\n};\r\n\r\nconst optionalCommaOrRequiredSpace = `((\\\\s*,\\\\s*)|(\\\\s+))`;\r\nconst optionalDecimals = `(\\\\.\\\\d+)?`;\r\nconst anyPercentage = `((\\\\d*${optionalDecimals})%)`;\r\nconst hundredPercent = `(([0-9]|[1-9][0-9]|100)%)`;\r\nconst alphaPercentage = `(((${hundredPercent}))|(0?${optionalDecimals})|1))?`;\r\nconst endingWithAlphaPercentage = `\\\\s*?\\\\)?)(\\\\s*?(\\\\/?)\\\\s+${alphaPercentage}\\\\s*?\\\\)$`;\r\n\r\n// Validate HTML color 'hsl'\r\n// -- These units are valid for the first parameter\r\n// 'deg': degrees | full circle = 360\r\n// 'gra': gradians | full circle = 400\r\n// 'radians': radians | full circle = 2 (approx. 6.28)\r\n// 'turn': turns | full circle = 1\r\nexport const validateHTMLColorHsl = (color: string): boolean => {\r\n  if (isString(color)) {\r\n    // Validate each possible unit value separately, as their values differ\r\n    const degRegex = `(-?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-9][0-9]|3[0-5][0-9]|360)(deg)?)`;\r\n    const graRegex = `(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-9][0-9]|3[0-9][0-9]|400)gra)`;\r\n    const radRegex = `((([0-5])?\\\\.\\\\d+|6\\\\.([0-9]|1[0-9]|2[0-8])|[0-6])rad)`;\r\n    const turnRegex = `((0?${optionalDecimals}|1)turn)`;\r\n    const regexLogic = `(hsl)a?\\\\((\\\\s*?(${degRegex}|${graRegex}|${radRegex}|${turnRegex})${optionalCommaOrRequiredSpace})(\\\\s*?(0|${hundredPercent})${optionalCommaOrRequiredSpace})(\\\\s*?(0|${hundredPercent})\\\\s*?\\\\)?)(\\\\s*?(\\\\/?|,?)\\\\s*?(((${hundredPercent}))|(0?${optionalDecimals})|1))?\\\\)$`;\r\n    const regex = new RegExp(regexLogic);\r\n    return !!color && regex.test(color);\r\n  }\r\n  return false;\r\n};\r\n\r\n// Validate HTML color 'hwb'\r\n// -- 'hwb' accepts 'deg' as unit in its 1st property, which stands for 'hue'\r\n// 'deg': degrees | full circle = 360\r\nexport const validateHTMLColorHwb = (color: string): boolean => {\r\n  if (isString(color)) {\r\n    const degRegex = `(-?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-9][0-9]|3[0-5][0-9]|360)(deg)?)`;\r\n    const regexLogic = `(hwb\\\\(\\\\s*?${degRegex}\\\\s+)((0|${hundredPercent})\\\\s+)((0|${hundredPercent})${endingWithAlphaPercentage}`;\r\n    const regex = new RegExp(regexLogic);\r\n    return !!color && regex.test(color);\r\n  }\r\n  return false;\r\n};\r\n\r\n// Validate HTML color 'lab'\r\n// -- 'lab' 2nd & 3rd parameters are any number between -160 & 160\r\nexport const validateHTMLColorLab = (color: string): boolean => {\r\n  if (isString(color)) {\r\n    const labParam = `(-?(([0-9]|[1-9][0-9]|1[0-5][0-9])${optionalDecimals}?|160))`;\r\n    const regexLogic = `(lab\\\\(\\\\s*?${anyPercentage}\\\\s+${labParam}\\\\s+${labParam}${endingWithAlphaPercentage}`;\r\n    const regex = new RegExp(regexLogic);\r\n    return !!color && regex.test(color);\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\n// Validate only HTML colors (`hex`, `rgb`, `rgba`, `hsl`, `hsla`, `hwb`, `lab`), without `name` og `special name`**\r\nexport const validateHTMLColor = (color: string): boolean => {\r\n  if (\r\n    (color && validateHTMLColorHex(color)) ||\r\n    validateHTMLColorRgb(color) ||\r\n    validateHTMLColorHsl(color) ||\r\n    validateHTMLColorHwb(color) ||\r\n    validateHTMLColorLab(color)\r\n  ) {\r\n    return true;\r\n  }\r\n  return false;\r\n};\r\n\r\nconst validateColor = (color: string) => {\r\n  // Former validation - source: https://www.regextester.com/103656\r\n  // if (isString(color)) {\r\n  //   const regex = /^#([\\da-f]{3}){1,2}$|^#([\\da-f]{4}){1,2}$|(rgb|hsl)a?\\((\\s*-?\\d+%?\\s*,){2}(\\s*-?\\d+%?\\s*,?\\s*\\)?)(,\\s*(0?\\.\\d+)?|1|0)?\\)$/i;\r\n  //   return color && regex.test(color);\r\n  // }\r\n  // New validation\r\n  if (\r\n    (color && validateHTMLColorHex(color)) ||\r\n    validateHTMLColorName(color) ||\r\n    validateHTMLColorSpecialName(color) ||\r\n    validateHTMLColorRgb(color) ||\r\n    validateHTMLColorHsl(color) ||\r\n    validateHTMLColorHwb(color) ||\r\n    validateHTMLColorLab(color)\r\n  ) {\r\n    return true;\r\n  }\r\n  return false;\r\n};\r\n\r\nexport { validateColor };\r\n","import type { TokenTypeWidgetComponentProps } from \"@redsun-vn/easyblocks-core\";\r\nimport { Input } from \"@redsun-vn/easyblocks-design-system\";\r\nimport React, { useState } from \"react\";\r\nimport { validateColor } from \"./validate-color\";\r\n\r\nfunction ColorTokenWidget(props: TokenTypeWidgetComponentProps<string>) {\r\n  const [inputValue, setInputValue] = useState(props.value);\r\n\r\n  return (\r\n    <Input\r\n      value={inputValue}\r\n      onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\r\n        setInputValue(e.target.value);\r\n      }}\r\n      onBlur={() => {\r\n        if (validateColor(inputValue)) {\r\n          props.onChange(inputValue);\r\n          return;\r\n        }\r\n\r\n        if (validateColor(\"#\" + inputValue)) {\r\n          props.onChange(\"#\" + inputValue);\r\n          return;\r\n        }\r\n\r\n        props.onChange(props.value);\r\n      }}\r\n      align={\"right\"}\r\n    />\r\n  );\r\n}\r\n\r\nexport { ColorTokenWidget };\r\n","import type { TokenTypeWidgetComponentProps } from \"@redsun-vn/easyblocks-core\";\r\nimport { Input } from \"@redsun-vn/easyblocks-design-system\";\r\nimport React, { useState } from \"react\";\r\n\r\nfunction SpaceTokenWidget(props: TokenTypeWidgetComponentProps<string>) {\r\n  const [inputValue, setInputValue] = useState(props.value);\r\n\r\n  return (\r\n    <Input\r\n      value={inputValue}\r\n      onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\r\n        setInputValue(e.target.value);\r\n      }}\r\n      onBlur={() => {\r\n        const int = Math.round(parseInt(inputValue));\r\n\r\n        if (isNaN(int) || int < 0) {\r\n          props.onChange(\"0px\");\r\n          return;\r\n        }\r\n\r\n        props.onChange(`${int}px`);\r\n      }}\r\n      align={\"right\"}\r\n    />\r\n  );\r\n}\r\n\r\nexport { SpaceTokenWidget };\r\n","type EditorSearchParams = {\r\n  readOnly: boolean | null;\r\n  documentId: string | null;\r\n  templateId: string | null;\r\n  rootComponentId: string | null;\r\n  rootTemplateId: string | null;\r\n  locale: string | null;\r\n  preview: boolean;\r\n  debug: boolean;\r\n};\r\n\r\nexport function parseQueryParams() {\r\n  const searchParams = new URLSearchParams(window.location.search);\r\n\r\n  const readOnly =\r\n    searchParams.get(\"readOnly\") === \"true\"\r\n      ? true\r\n      : searchParams.get(\"readOnly\") === \"false\"\r\n      ? false\r\n      : null;\r\n  const documentId = searchParams.get(\"document\");\r\n  const templateId = searchParams.get(\"template\");\r\n  const rootComponentId = searchParams.get(\"rootComponent\");\r\n  const rootTemplateId = searchParams.get(\"rootTemplate\");\r\n  const locale = searchParams.get(\"locale\");\r\n  const debug = searchParams.get(\"debug\") === \"true\";\r\n\r\n  const preview = searchParams.get(\"preview\") === \"true\";\r\n\r\n  const editorSearchParams: EditorSearchParams = {\r\n    readOnly,\r\n    documentId,\r\n    templateId,\r\n    rootComponentId,\r\n    rootTemplateId,\r\n    locale,\r\n    preview,\r\n    debug,\r\n  };\r\n\r\n  return editorSearchParams;\r\n}\r\n","import {\r\n  getExternalReferenceLocationKey,\r\n  isResolvedCompoundExternalDataValue,\r\n  type ExternalDataCompoundResourceResolvedResult,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport { findComponentDefinitionById } from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { Typography } from \"@redsun-vn/easyblocks-design-system\";\r\nimport { assertDefined, dotNotationGet } from \"@/utils\";\r\nimport React from \"react\";\r\nimport {\r\n  CompoundResourceValueSelect,\r\n  getBasicResourcesOfType,\r\n} from \"../tinacms/fields/plugins/ExternalField/ExternalField\";\r\nimport type { InternalWidgetComponentProps } from \"../types\";\r\n\r\nfunction DocumentDataWidgetComponent({\r\n  id,\r\n  onChange,\r\n  resourceKey,\r\n  path,\r\n}: InternalWidgetComponentProps & { type: string }) {\r\n  if (id !== null && typeof id !== \"string\") {\r\n    return (\r\n      <Typography\r\n        style={{\r\n          whiteSpace: \"normal\",\r\n        }}\r\n      >\r\n        Unsupported type of identifier for document data widget. Expected\r\n        \"string\", but got \"{typeof id}\".\r\n      </Typography>\r\n    );\r\n  }\r\n\r\n  const { editorContext, externalData }: any = window.editorWindowAPI ?? {};\r\n\r\n  const schema = editorContext.rootComponent.rootParams;\r\n\r\n  const documentExternalLocationKeys = assertDefined(schema).map((s: any) =>\r\n    getExternalReferenceLocationKey(\"$\", s.prop)\r\n  );\r\n\r\n  const documentCompoundResources = Object.entries(externalData).filter<\r\n    [string, ExternalDataCompoundResourceResolvedResult]\r\n  >((r): r is [string, ExternalDataCompoundResourceResolvedResult] => {\r\n    const [externalId, externalDataValue] = r;\r\n    return (\r\n      documentExternalLocationKeys.includes(externalId) &&\r\n      isResolvedCompoundExternalDataValue(\r\n        externalDataValue as ExternalDataCompoundResourceResolvedResult\r\n      )\r\n    );\r\n  });\r\n\r\n  const entry = dotNotationGet(\r\n    editorContext.form.values,\r\n    path.slice(0, path.lastIndexOf(\".\"))\r\n  );\r\n  const definition = findComponentDefinitionById(\r\n    entry._component,\r\n    editorContext\r\n  );\r\n  const schemaProp = definition!.schema.find(\r\n    (s) => s.prop === path.split(\".\").pop()\r\n  )!;\r\n\r\n  const options = documentCompoundResources.flatMap(\r\n    ([externalId, externalDataValue]) =>\r\n      getBasicResourcesOfType(externalDataValue.value, schemaProp.type).map(\r\n        (r) => {\r\n          const resourceSchemaProp = assertDefined(\r\n            schema?.find(\r\n              (s: { prop: string }) => s.prop === externalId.split(\".\")[1]\r\n            )\r\n          );\r\n\r\n          return {\r\n            id: externalId,\r\n            key: r.key,\r\n            label: `${resourceSchemaProp.label ?? resourceSchemaProp.prop} > ${\r\n              r.label ?? r.key\r\n            }`,\r\n          };\r\n        }\r\n      )\r\n  );\r\n\r\n  if (options.length === 1 && !id && path) {\r\n    // We perform form change manually to avoid storing this change in editor's history\r\n    editorContext.form.change(path, {\r\n      id: options[0].id,\r\n      key: options[0].key,\r\n      widgetId: \"@easyblocks/document-data\",\r\n    });\r\n  }\r\n\r\n  if (!documentCompoundResources.length) {\r\n    return (\r\n      <Typography\r\n        style={{\r\n          whiteSpace: \"normal\",\r\n        }}\r\n      >\r\n        Please select at least one non optional external data for document.\r\n      </Typography>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <CompoundResourceValueSelect\r\n      options={options}\r\n      resource={\r\n        id === null\r\n          ? {\r\n              id,\r\n              key: undefined,\r\n            }\r\n          : {\r\n              id,\r\n              key: resourceKey,\r\n            }\r\n      }\r\n      onResourceKeyChange={(newId, newKey) => {\r\n        onChange(newId, newKey);\r\n      }}\r\n    />\r\n  );\r\n}\r\n\r\nexport { DocumentDataWidgetComponent };\r\n","import { Template } from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  ButtonGhostColor,\r\n  Colors,\r\n  Fonts,\r\n  Modal,\r\n} from \"@redsun-vn/easyblocks-design-system\";\r\nimport React, { useRef } from \"react\";\r\nimport { styled } from \"styled-components\";\r\nimport { EditorContextType, useEditorContext } from \"./EditorContext\";\r\nimport { TemplatePicker } from \"./TemplatePicker\";\r\n\r\ntype VisualProps = {\r\n  mode: string;\r\n};\r\n\r\n/**\r\n * CARD\r\n */\r\n\r\nconst CardRoot = styled.div`\r\n  &:hover {\r\n    outline: 1px solid ${Colors.black10};\r\n    outline-offset: 8px;\r\n  }\r\n\r\n  .editButton {\r\n    opacity: 0;\r\n  }\r\n\r\n  &:hover {\r\n    .editButton {\r\n      opacity: 1;\r\n    }\r\n  }\r\n`;\r\n\r\nconst ImageContainer = styled.div<VisualProps>`\r\n  position: relative;\r\n  background-color: ${Colors.black10};\r\n  margin-bottom: 8px;\r\n  padding-bottom: ${(p) => (p.mode === \"large-3\" ? \"90%\" : \"60%\")};\r\n  cursor: pointer;\r\n`;\r\n\r\nconst CardImg = styled.img`\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  object-fit: contain;\r\n  padding: 24px;\r\n  box-sizing: border-box;\r\n`;\r\n\r\nconst CardImgPlaceholder = styled.div`\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n`;\r\n\r\nconst CardFooter = styled.div`\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-top: 8px;\r\n`;\r\n\r\nconst CardLabelContainer = styled.div`\r\n  display: flex;\r\n  flex-direction: row;\r\n  align-items: center;\r\n`;\r\n\r\nconst CardLabelTemplateName = styled.div`\r\n  ${Fonts.body};\r\n  color: black;\r\n`;\r\n\r\nconst Title = styled.div`\r\n  ${Fonts.label}\r\n`;\r\n\r\nconst TitleContainer = styled.div`\r\n  display: flex;\r\n  flex-direction: row;\r\n  gap: 8px;\r\n  align-items: center;\r\n  margin-bottom: 24px;\r\n`;\r\n\r\nconst Message = styled.div`\r\n  padding-top: 32px;\r\n  ${Fonts.body};\r\n`;\r\n\r\ntype SectionCardProps = {\r\n  template: Template;\r\n  onSelect: () => void;\r\n  mode: string;\r\n};\r\n\r\nfunction getTemplatePreviewImage(\r\n  template: Template,\r\n  editorContext: EditorContextType\r\n): string | undefined {\r\n  // template.previewImage is always most important and overrides other sources of preview\r\n  if (template.thumbnail) {\r\n    return template.thumbnail;\r\n  }\r\n\r\n  return;\r\n\r\n  // if (template.configId) {\r\n  //   return getComponentConfigPreviewImageURL({\r\n  //     configId: template.configId,\r\n  //     contextParams: editorContext.contextParams,\r\n  //     locales: editorContext.locales,\r\n  //     project: editorContext.project,\r\n  //   });\r\n  // }\r\n}\r\n\r\nconst SectionCard: React.FC<SectionCardProps> = ({\r\n  template,\r\n  onSelect,\r\n  mode,\r\n}) => {\r\n  const imageRef = useRef(null);\r\n  const editorContext = useEditorContext();\r\n\r\n  const previewImage = getTemplatePreviewImage(template, editorContext);\r\n\r\n  return (\r\n    <CardRoot>\r\n      <ImageContainer ref={imageRef} onClick={onSelect} mode={mode}>\r\n        {previewImage && <CardImg src={previewImage} />}\r\n        {!previewImage && template.thumbnailLabel && (\r\n          <CardImgPlaceholder>\r\n            <span style={{ color: \"#6c6c6c\" }}>{template.thumbnailLabel}</span>\r\n          </CardImgPlaceholder>\r\n        )}\r\n        {!previewImage && !template.thumbnailLabel && (\r\n          <CardImgPlaceholder>\r\n            <svg\r\n              xmlns=\"http://www.w3.org/2000/svg\"\r\n              width=\"64\"\r\n              height=\"64\"\r\n              viewBox=\"0 0 16 16\"\r\n              fill=\"none\"\r\n            >\r\n              <path\r\n                d=\"M8.18102 5.39789L6.89683 10.3512L7.86482 10.6022L9.14901 5.64885L8.18102 5.39789Z\"\r\n                fill={Colors.black20}\r\n              />\r\n              <path\r\n                d=\"M9.38171 6.1215L11.1837 7.92352L9.38172 9.72549L10.0888 10.4326L12.5979 7.92353L10.0888 5.4144L9.38171 6.1215Z\"\r\n                fill={Colors.black20}\r\n              />\r\n              <path\r\n                d=\"M6.54828 6.11507L4.80393 7.92352L6.54828 9.73192L5.82854 10.4262L3.41455 7.92353L5.82853 5.42083L6.54828 6.11507Z\"\r\n                fill={Colors.black20}\r\n              />\r\n              <path\r\n                fillRule=\"evenodd\"\r\n                clipRule=\"evenodd\"\r\n                d=\"M2 3C2 2.44772 2.44772 2 3 2H13C13.5523 2 14 2.44772 14 3V13C14 13.5523 13.5523 14 13 14H3C2.44772 14 2 13.5523 2 13V3ZM3 3H13V13H3L3 3Z\"\r\n                fill={Colors.black20}\r\n              />\r\n            </svg>\r\n          </CardImgPlaceholder>\r\n        )}\r\n      </ImageContainer>\r\n\r\n      <CardFooter>\r\n        <CardLabelContainer>\r\n          <>\r\n            {template.label && (\r\n              <>\r\n                <CardLabelTemplateName>{template.label}</CardLabelTemplateName>\r\n              </>\r\n            )}\r\n          </>\r\n        </CardLabelContainer>\r\n\r\n        <div></div>\r\n\r\n        {template.isUserDefined && !editorContext.readOnly && (\r\n          <ButtonGhostColor\r\n            className={\"editButton\"}\r\n            onClick={() => {\r\n              editorContext.actions.openTemplateModal({\r\n                mode: \"edit\",\r\n                template: template as Template,\r\n              });\r\n            }}\r\n          >\r\n            Edit\r\n          </ButtonGhostColor>\r\n        )}\r\n      </CardFooter>\r\n    </CardRoot>\r\n  );\r\n};\r\n\r\n/**\r\n * MODAL\r\n */\r\n\r\nconst ModalRoot = styled.div`\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  display: grid;\r\n  grid-template-columns: 200px 1fr;\r\n`;\r\n\r\nconst ModalGridRoot = styled.div<VisualProps>`\r\n  display: grid;\r\n  grid-template-columns: ${(p) =>\r\n    p.mode === \"large-3\" ? \"1fr 1fr 1fr\" : \"1fr 1fr\"};\r\n  grid-column-gap: 16px;\r\n  grid-row-gap: 30px;\r\n`;\r\n\r\nconst Sidebar = styled.div`\r\n  overflow-y: hidden;\r\n  overflow-x: hidden;\r\n  border-right: 1px solid ${Colors.black5};\r\n  height: 100%;\r\n`;\r\n\r\nconst SidebarContent = styled.div`\r\n  padding: 24px 4px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 8px;\r\n`;\r\n\r\nconst SidebarButton = styled.button`\r\n  all: unset;\r\n  height: 38px;\r\n  ${Fonts.body}\r\n  display: flex;\r\n  padding-left: 16px;\r\n  align-items: center;\r\n  &:hover {\r\n    background: ${Colors.black5};\r\n  }\r\n  cursor: pointer;\r\n`;\r\n\r\nconst GridRoot = styled.div`\r\n  padding: 0px 16px;\r\n  height: 100%;\r\n  overflow-x: hidden;\r\n  overflow-y: auto;\r\n`;\r\n\r\nexport const SectionPickerModal: TemplatePicker = ({\r\n  isOpen,\r\n  onClose,\r\n  templates,\r\n  mode = \"large\",\r\n}) => {\r\n  const templateGroups = templates;\r\n\r\n  const gridRootRef = useRef<HTMLDivElement>(null);\r\n\r\n  const templateSelected = (template: Template) => {\r\n    if (onClose) {\r\n      onClose(template);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      noPadding={true}\r\n      title={\"Pick section\"}\r\n      isOpen={isOpen}\r\n      onRequestClose={() => {\r\n        if (onClose) {\r\n          onClose();\r\n        }\r\n      }}\r\n      mode={\"center-huge\"}\r\n      headerLine={true}\r\n    >\r\n      <ModalRoot>\r\n        <Sidebar>\r\n          {templateGroups && (\r\n            <SidebarContent>\r\n              {Object.entries(templateGroups).map(\r\n                ([\r\n                  componentId,\r\n                  {\r\n                    component: { label },\r\n                  },\r\n                ]) => (\r\n                  <SidebarButton\r\n                    key={`sectionPicker__group__${componentId}`}\r\n                    onClick={() => {\r\n                      const groupNode = document.getElementById(\r\n                        `sectionPicker__group__${componentId}`\r\n                      );\r\n                      const groupOffsetTop = groupNode!.offsetTop;\r\n                      gridRootRef.current!.scrollTo({\r\n                        top: groupOffsetTop,\r\n                        behavior: \"smooth\",\r\n                      });\r\n                    }}\r\n                  >\r\n                    {label ?? componentId}\r\n                  </SidebarButton>\r\n                )\r\n              )}\r\n            </SidebarContent>\r\n          )}\r\n        </Sidebar>\r\n        <GridRoot ref={gridRootRef}>\r\n          {templates === undefined && <Message>Loading...</Message>}\r\n\r\n          {templateGroups &&\r\n            Object.entries(templateGroups).map(\r\n              (\r\n                [\r\n                  componentId,\r\n                  {\r\n                    component: { label },\r\n                    templates,\r\n                  },\r\n                ],\r\n                index\r\n              ) => (\r\n                <div\r\n                  style={{ paddingTop: \"32px\", paddingBottom: \"32px\" }}\r\n                  id={`sectionPicker__group__${componentId}`}\r\n                  key={`sectionPicker__group__${componentId}`}\r\n                >\r\n                  <TitleContainer>\r\n                    <Title>{label ?? componentId}</Title>\r\n                  </TitleContainer>\r\n                  <ModalGridRoot mode={mode}>\r\n                    {templates.map((template, index) => (\r\n                      <SectionCard\r\n                        key={index}\r\n                        template={template}\r\n                        onSelect={() => {\r\n                          templateSelected(template);\r\n                        }}\r\n                        mode={mode}\r\n                      />\r\n                    ))}\r\n                  </ModalGridRoot>\r\n                </div>\r\n              )\r\n            )}\r\n        </GridRoot>\r\n      </ModalRoot>\r\n    </Modal>\r\n  );\r\n};\r\n","import { BasicRow, Modal } from \"@redsun-vn/easyblocks-design-system\";\r\nimport React, { ChangeEvent, useState } from \"react\";\r\nimport { useEditorContext } from \"./EditorContext\";\r\nimport { Template } from \"./types\";\r\nimport { TemplatePicker, TemplatesDictionary } from \"./TemplatePicker\";\r\nimport { ComponentDefinitionShared } from \"@redsun-vn/easyblocks-core\";\r\n\r\nfunction checkQueryForTemplate(\r\n  query: string,\r\n  template: Template,\r\n  component: ComponentDefinitionShared\r\n) {\r\n  return `${template.label ?? \"\"}${component.label ?? component.id}`\r\n    .toLocaleLowerCase()\r\n    .includes(query.trim().toLocaleLowerCase());\r\n}\r\n\r\nexport const SearchableSmallPickerModal: TemplatePicker = ({\r\n  onClose,\r\n  templates,\r\n  isOpen,\r\n}) => {\r\n  const editorContext = useEditorContext();\r\n\r\n  const templatesDict = templates;\r\n\r\n  const [query, setQuery] = useState(\"\");\r\n\r\n  const trimmedQuery = query.trim().toLocaleLowerCase();\r\n\r\n  const filteredTemplatesDict: TemplatesDictionary = {};\r\n\r\n  if (templatesDict) {\r\n    Object.values(templatesDict).forEach(({ templates, component }) => {\r\n      const filteredTemplates =\r\n        trimmedQuery === \"\"\r\n          ? templates\r\n          : templates.filter((template) =>\r\n              checkQueryForTemplate(trimmedQuery, template, component)\r\n            );\r\n\r\n      if (filteredTemplates.length > 0) {\r\n        filteredTemplatesDict[component.id] = {\r\n          component,\r\n          templates: filteredTemplates,\r\n        };\r\n      }\r\n    });\r\n  }\r\n\r\n  const close = (template?: Template) => {\r\n    setQuery(\"\");\r\n\r\n    if (!template) {\r\n      onClose();\r\n    } else {\r\n      // @ts-expect-error\r\n      onClose(template);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      mode={\"center-small\"}\r\n      isOpen={isOpen}\r\n      onRequestClose={() => {\r\n        close(undefined);\r\n      }}\r\n      noPadding={true}\r\n      headerLine={true}\r\n      searchProps={{\r\n        value: query,\r\n        placeholder: \"Search...\",\r\n        onChange: (e: ChangeEvent<HTMLInputElement>) => {\r\n          setQuery(e.target.value);\r\n        },\r\n      }}\r\n      headerSymbol={\"S\"}\r\n    >\r\n      {templatesDict === undefined && \"Loading...\"}\r\n      {templatesDict !== undefined &&\r\n        Object.entries(filteredTemplatesDict).map(\r\n          ([, { templates, component }]) => {\r\n            const isOnlyOne = templates.length === 1;\r\n            const componentLabel = component.label ?? component.id;\r\n\r\n            return templates.map((template) => {\r\n              const templateLabel = template.label ?? template.id;\r\n\r\n              const title = isOnlyOne ? componentLabel : templateLabel;\r\n              const thumbnail = template.thumbnail ?? component.thumbnail;\r\n              const description = isOnlyOne ? undefined : componentLabel;\r\n\r\n              return (\r\n                <BasicRow\r\n                  key={template.id!}\r\n                  title={title}\r\n                  description={description}\r\n                  onClick={() => {\r\n                    close(template);\r\n                  }}\r\n                  image={thumbnail}\r\n                  tinyDescription={true}\r\n                  onEdit={\r\n                    template.isUserDefined\r\n                      ? () => {\r\n                          editorContext.actions.openTemplateModal({\r\n                            mode: \"edit\",\r\n                            template: template as Template,\r\n                          });\r\n                        }\r\n                      : undefined\r\n                  }\r\n                />\r\n              );\r\n            });\r\n          }\r\n        )}\r\n    </Modal>\r\n  );\r\n};\r\n","import {\r\n  Config,\r\n  FetchOutputResources,\r\n  InlineTypeWidgetComponentProps,\r\n  WidgetComponentProps,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  ModalContext,\r\n  GlobalModalStyles,\r\n  Toaster,\r\n  TooltipProvider,\r\n} from \"@redsun-vn/easyblocks-design-system\";\r\nimport isPropValid from \"@emotion/is-prop-valid\";\r\nimport React, { ComponentType } from \"react\";\r\nimport { ShouldForwardProp, StyleSheetManager } from \"styled-components\";\r\nimport { Editor } from \"./Editor\";\r\nimport { ColorTokenWidget } from \"./sidebar/ColorTokenWidget\";\r\nimport { GlobalStyles } from \"./tinacms/styles\";\r\nimport { SpaceTokenWidget } from \"./sidebar/SpaceTokenWidget\";\r\nimport { parseQueryParams } from \"./parseQueryParams\";\r\nimport { DocumentDataWidgetComponent } from \"./sidebar/DocumentDataWidget\";\r\nimport { ExternalDataChangeHandler } from \"./EasyblocksEditorProps\";\r\nimport { TemplatePicker } from \"./TemplatePicker\";\r\nimport { SectionPickerModal } from \"./SectionPicker\";\r\nimport { SearchableSmallPickerModal } from \"./SearchableSmallPickerModal\";\r\n\r\ntype EasyblocksParentProps = {\r\n  config: Config;\r\n  externalData: FetchOutputResources;\r\n  onExternalDataChange: ExternalDataChangeHandler;\r\n  widgets?: Record<\r\n    string,\r\n    | ComponentType<WidgetComponentProps<any>>\r\n    | ComponentType<InlineTypeWidgetComponentProps<any>>\r\n  >;\r\n  components?: Record<string, ComponentType<any>>;\r\n  pickers?: Record<string, TemplatePicker>;\r\n  isAdminMode?: boolean;\r\n};\r\n\r\nconst shouldForwardProp: ShouldForwardProp<\"web\"> = (propName, target) => {\r\n  if (typeof target === \"string\") {\r\n    // For HTML elements, forward the prop if it is a valid HTML attribute\r\n    return isPropValid(propName);\r\n  }\r\n  // For other elements, forward all props\r\n  return true;\r\n};\r\n\r\nconst builtinWidgets: EasyblocksParentProps[\"widgets\"] = {\r\n  color: ColorTokenWidget,\r\n  space: SpaceTokenWidget,\r\n  \"@easyblocks/document-data\": DocumentDataWidgetComponent as any,\r\n};\r\n\r\nconst builinPickers: EasyblocksParentProps[\"pickers\"] = {\r\n  large: SectionPickerModal,\r\n  compact: SearchableSmallPickerModal,\r\n  \"large-3\": SectionPickerModal,\r\n};\r\n\r\nexport function EasyblocksParent(props: EasyblocksParentProps) {\r\n  const editorSearchParams = parseQueryParams();\r\n\r\n  return (\r\n    <StyleSheetManager\r\n      shouldForwardProp={shouldForwardProp}\r\n      enableVendorPrefixes\r\n    >\r\n      <ModalContext.Provider\r\n        value={() => {\r\n          return document.querySelector(\"#modalContainer\");\r\n        }}\r\n      >\r\n        <GlobalStyles />\r\n        <GlobalModalStyles />\r\n        <TooltipProvider>\r\n          <div\r\n            id={\"modalContainer\"}\r\n            style={{ position: \"fixed\", left: 0, top: 0, zIndex: 100000 }}\r\n          />\r\n          <Editor\r\n            config={props.config}\r\n            locale={editorSearchParams.locale ?? undefined}\r\n            readOnly={editorSearchParams.readOnly ?? true}\r\n            documentId={editorSearchParams.documentId}\r\n            rootComponentId={editorSearchParams.rootComponentId ?? null}\r\n            rootTemplateId={editorSearchParams.rootTemplateId}\r\n            externalData={props.externalData}\r\n            onExternalDataChange={props.onExternalDataChange}\r\n            widgets={{\r\n              ...builtinWidgets,\r\n              ...props.widgets,\r\n            }}\r\n            components={props.components}\r\n            pickers={{\r\n              ...builinPickers,\r\n              ...props.pickers,\r\n            }}\r\n            isAdminMode={props.isAdminMode}\r\n          />\r\n        </TooltipProvider>\r\n        <Toaster containerStyle={{ zIndex: 100100 }} />\r\n      </ModalContext.Provider>\r\n    </StyleSheetManager>\r\n  );\r\n}\r\n","import React, { ReactNode } from \"react\";\r\nimport { useEditorGlobalKeyboardShortcuts } from \"../useEditorGlobalKeyboardShortcuts\";\r\n\r\ntype CanvasRootProps = {\r\n  children: ReactNode;\r\n};\r\n\r\nfunction CanvasRoot(props: CanvasRootProps) {\r\n  const editorContext = window.parent.editorWindowAPI?.editorContext;\r\n\r\n  if (!editorContext) {\r\n    throw new Error(\"editorContext is not available.\");\r\n  }\r\n\r\n  useEditorGlobalKeyboardShortcuts(editorContext);\r\n\r\n  return (\r\n    <div\r\n      onClick={() => {\r\n        if (editorContext.isEditing) {\r\n          editorContext.setFocussedField([]);\r\n        }\r\n      }}\r\n    >\r\n      {editorContext.isEditing && (\r\n        <div style={{ minHeight: \"100vh\" }}>\r\n          <style\r\n            dangerouslySetInnerHTML={{\r\n              __html: globalEditorRendererStyles,\r\n            }}\r\n          />\r\n          {props.children}\r\n        </div>\r\n      )}\r\n      {!editorContext.isEditing && props.children}\r\n    </div>\r\n  );\r\n}\r\n\r\nconst globalEditorRendererStyles = `\r\n    /*\r\n        We don't use Tina native blocksmenu and they make page higher than document height (on the last section). So this is quick fix\r\n    */\r\n    [class^=BlocksMenu] {\r\n        display: none !important;\r\n    }\r\n    \r\n    body {\r\n        margin: 0;\r\n        padding: 0;\r\n        overflow-x: hidden;\r\n    }\r\n      \r\n  :root {\r\n    --tina-color-primary-light: #2296fe;\r\n    --tina-color-primary: #2296fe;\r\n    --tina-color-primary-dark: #0574e4;\r\n    --tina-color-error-light: #eb6337;\r\n    --tina-color-error: #ec4815;\r\n    --tina-color-error-dark: #dc4419;\r\n    --tina-color-warning-light: #f5e06e;\r\n    --tina-color-warning: #e9d050;\r\n    --tina-color-warning-dark: #d3ba38;\r\n    --tina-color-success-light: #57c355;\r\n    --tina-color-success: #3cad3a;\r\n    --tina-color-success-dark: #249a21;\r\n    --tina-color-grey-0: #ffffff;\r\n    --tina-color-grey-1: #f6f6f9;\r\n    --tina-color-grey-2: #edecf3;\r\n    --tina-color-grey-3: #e1ddec;\r\n    --tina-color-grey-4: #b2adbe;\r\n    --tina-color-grey-5: #918c9e;\r\n    --tina-color-grey-6: #716c7f;\r\n    --tina-color-grey-7: #565165;\r\n    --tina-color-grey-8: #433e52;\r\n    --tina-color-grey-9: #363145;\r\n    --tina-color-grey-10: #282828;\r\n    --tina-radius-small: 5px;\r\n    --tina-radius-big: 24px;\r\n    --tina-padding-small: 12px;\r\n    --tina-padding-big: 20px;\r\n    --tina-font-size-0: 12px;\r\n    --tina-font-size-1: 13px;\r\n    --tina-font-size-2: 15px;\r\n    --tina-font-size-3: 16px;\r\n    --tina-font-size-4: 18px;\r\n    --tina-font-size-5: 20px;\r\n    --tina-font-size-6: 22px;\r\n    --tina-font-size-7: 26px;\r\n    --tina-font-size-8: 32px;\r\n    --tina-font-family: 'Inter', sans-serif;\r\n    --tina-font-weight-regular: 400;\r\n    --tina-font-weight-bold: 600;\r\n    --tina-shadow-big: 0px 2px 3px rgba(0, 0, 0, 0.05),\r\n      0 4px 12px rgba(0, 0, 0, 0.1);\r\n    --tina-shadow-small: 0px 2px 3px rgba(0, 0, 0, 0.12);\r\n    --tina-timing-short: 85ms;\r\n    --tina-timing-medium: 150ms;\r\n    --tina-timing-long: 250ms;\r\n    --tina-z-index-0: 500;\r\n    --tina-z-index-1: 1000;\r\n    --tina-z-index-2: 1500;\r\n    --tina-z-index-3: 2000;\r\n    --tina-z-index-4: 2500;\r\n    --tina-z-index-5: 3000;\r\n    --tina-sidebar-width: 340px;\r\n    --tina-sidebar-header-height: 60px;\r\n    --tina-toolbar-height: 62px;\r\n    \r\n    \r\n  }\r\n  \r\n  .Shopstory__ReactModal__Overlay {\r\n    width: 100vw;\r\n    height: 100vh;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    \r\n  }\r\n  \r\n  .Shopstory__ReactModal__Overlay::before {\r\n      content: '';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      width: 100%;\r\n      height: 100%;\r\n      opacity: 0.2;\r\n      z-index: -1;\r\n      /* background-color: black; */\r\n  }\r\n  \r\n  .Shopstory__ReactModal__Overlay.background-shade::before {\r\n      background-color: black;\r\n  }\r\n  \r\n  .Shopstory__ReactModal__Content::focus {\r\n    border: none;\r\n    outline: none;\r\n  }\r\n  \r\n  \r\n  .Shopstory__ReactModal__Content__Left {\r\n    height: 100vh;\r\n    width: 70vw;\r\n    \r\n    transition: all 350ms cubic-bezier(0.16, 1, 0.3, 1);\r\n    transform: translateX(-100%);\r\n  }\r\n  \r\n  \r\n  .Shopstory__ReactModal__Content__Left::focus {\r\n    border: none;\r\n    outline: none;\r\n  }\r\n  \r\n  .Shopstory__ReactModal__Content__Left.Shopstory__ReactModal__Content__Left--after-open {\r\n      transform: none;\r\n  }\r\n  \r\n  .Shopstory__ReactModal__Content__Left.Shopstory__ReactModal__Content__Left--before-close{\r\n      transform: translateX(-100%);\r\n  }\r\n`;\r\n\r\nexport { CanvasRoot };\r\n","import type { useSortable } from \"@dnd-kit/sortable\";\r\nimport { selectionFramePositionChanged } from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { Colors } from \"@redsun-vn/easyblocks-design-system\";\r\nimport React, { MouseEvent, ReactNode, useEffect, useState } from \"react\";\r\n\r\ntype SelectionFrameControllerProps = {\r\n  isActive: boolean;\r\n  isChildrenSelectionDisabled: boolean;\r\n  onSelect: (event: MouseEvent<HTMLElement>) => void;\r\n  children: ReactNode;\r\n  stitches: any;\r\n  sortable: ReturnType<typeof useSortable>;\r\n  id: string;\r\n  direction: \"horizontal\" | \"vertical\";\r\n  path: string;\r\n};\r\n\r\nfunction SelectionFrameController({\r\n  isActive,\r\n  isChildrenSelectionDisabled,\r\n  children,\r\n  onSelect,\r\n  stitches,\r\n  sortable,\r\n  id,\r\n  direction,\r\n  path,\r\n}: SelectionFrameControllerProps) {\r\n  const [node, setNode] = useState<HTMLDivElement | null>(null);\r\n\r\n  useUpdateFramePosition({\r\n    node,\r\n    isDisabled: !isActive,\r\n  });\r\n\r\n  const isInsertingBefore = sortable.activeIndex > sortable.index;\r\n\r\n  const wrapperClassName = stitches.css({\r\n    position: \"relative\",\r\n    display: \"grid\",\r\n\r\n    \"&[data-children-selection-disabled=true] *\": {\r\n      pointerEvents: \"none !important\",\r\n      userSelect: \"none !important\",\r\n    },\r\n\r\n    \"&[data-draggable-active=false]::after\": {\r\n      content: `''`,\r\n      boxSizing: \"border-box\",\r\n      display: \"block\",\r\n      position: \"absolute\",\r\n      left: 0,\r\n      top: 0,\r\n      width: \"100%\",\r\n      height: \"100%\",\r\n      border: \"1px solid var(--tina-color-primary)\",\r\n      opacity: 0,\r\n      pointerEvents: \"none\",\r\n      userSelect: \"none\",\r\n      transition: \"all 100ms\",\r\n      boxShadow: \"var(--tina-shadow-big)\",\r\n      zIndex: \"var(--tina-z-index-2)\",\r\n    },\r\n\r\n    \"&[data-active=true]::after\": {\r\n      opacity: 1,\r\n    },\r\n\r\n    \"&:hover::after\": {\r\n      opacity: 0.5,\r\n    },\r\n\r\n    \"&[data-active=true]:hover::after\": {\r\n      opacity: 1,\r\n    },\r\n\r\n    \"&[data-draggable-over=true]::before\": {\r\n      position: \"absolute\",\r\n      ...(direction === \"horizontal\"\r\n        ? {\r\n            top: 0,\r\n            bottom: 0,\r\n            [isInsertingBefore ? \"left\" : \"right\"]: \"0px\",\r\n            height: \"100%\",\r\n            width: \"4px\",\r\n          }\r\n        : {\r\n            left: 0,\r\n            right: 0,\r\n            [isInsertingBefore ? \"top\" : \"bottom\"]: \"0px\",\r\n            width: \"100%\",\r\n            height: \"4px\",\r\n          }),\r\n\r\n      display: \"block\",\r\n      content: \"''\",\r\n      backgroundColor: Colors.blue50,\r\n      zIndex: 9999999,\r\n    },\r\n\r\n    \"&[data-draggable-active=true]\": {\r\n      opacity: 0.5,\r\n    },\r\n\r\n    \"&[data-draggable-dragging=true]\": {\r\n      cursor: \"grabbing\",\r\n    },\r\n  });\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      // If the the node of active element is not in the DOM anymore we want to deselect it to prevent showing\r\n      // add buttons on the not existing element.\r\n      if (\r\n        isActive &&\r\n        node &&\r\n        !window.document.contains(node) &&\r\n        path === window.parent.editorWindowAPI?.editorContext?.focussedField[0]\r\n      ) {\r\n        window.parent.editorWindowAPI.editorContext.setFocussedField([]);\r\n      }\r\n    };\r\n  });\r\n\r\n  return (\r\n    <div\r\n      data-active={isActive}\r\n      data-children-selection-disabled={isChildrenSelectionDisabled}\r\n      data-draggable-dragging={sortable.active !== null}\r\n      data-draggable-over={sortable.isOver}\r\n      data-draggable-active={\r\n        sortable.active !== null && sortable.active?.id === id\r\n      }\r\n      className={wrapperClassName().className}\r\n      ref={(node) => {\r\n        setNode(node);\r\n        sortable.setNodeRef(node);\r\n      }}\r\n      onClick={onSelect}\r\n      {...sortable.attributes}\r\n      {...sortable.listeners}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport { SelectionFrameController };\r\n\r\nfunction useUpdateFramePosition({\r\n  node,\r\n  isDisabled,\r\n}: {\r\n  node: HTMLElement | null;\r\n  isDisabled: boolean;\r\n}) {\r\n  const dispatch = window.parent.postMessage;\r\n\r\n  useEffect(() => {\r\n    if (isDisabled || !node) {\r\n      return;\r\n    }\r\n\r\n    const updateSelectionFramePosition = createThrottledHandler(() => {\r\n      const nodeRect = node.getBoundingClientRect();\r\n\r\n      dispatch(\r\n        selectionFramePositionChanged(\r\n          nodeRect,\r\n          window.document.documentElement.getBoundingClientRect()\r\n        )\r\n      );\r\n    });\r\n\r\n    window.addEventListener(\"scroll\", updateSelectionFramePosition, {\r\n      passive: true,\r\n    });\r\n\r\n    const handleResize = createThrottledHandler(() => {\r\n      const nodeRect = node.getBoundingClientRect();\r\n      dispatch(selectionFramePositionChanged(nodeRect));\r\n    });\r\n\r\n    window.addEventListener(\"resize\", handleResize, {\r\n      passive: true,\r\n    });\r\n\r\n    const updateSelectionFramePositionInScrollableContainer =\r\n      createThrottledHandler((event) => {\r\n        const nodeRect = node.getBoundingClientRect();\r\n        const containerRect = (\r\n          event.target as HTMLElement\r\n        ).getBoundingClientRect();\r\n\r\n        dispatch(selectionFramePositionChanged(nodeRect, containerRect));\r\n      });\r\n\r\n    const closestScrollableElement = node.closest(\r\n      \"[data-easyblocks-scrollable-root]\"\r\n    );\r\n\r\n    closestScrollableElement?.addEventListener(\r\n      \"scroll\",\r\n      updateSelectionFramePositionInScrollableContainer,\r\n      {\r\n        passive: true,\r\n      }\r\n    );\r\n\r\n    dispatch(\r\n      selectionFramePositionChanged(\r\n        node.getBoundingClientRect(),\r\n        closestScrollableElement?.getBoundingClientRect()\r\n      )\r\n    );\r\n\r\n    return () => {\r\n      window.removeEventListener(\"scroll\", updateSelectionFramePosition);\r\n      window.removeEventListener(\"resize\", handleResize);\r\n      closestScrollableElement?.removeEventListener(\r\n        \"scroll\",\r\n        updateSelectionFramePositionInScrollableContainer\r\n      );\r\n    };\r\n  });\r\n}\r\n\r\n/**\r\n * https://developer.mozilla.org/en-US/docs/Web/API/Element/scroll_event#scroll_event_throttling\r\n */\r\nfunction createThrottledHandler(callback: (event: Event) => void) {\r\n  let isTicking = false;\r\n\r\n  return (event: Event) => {\r\n    if (isTicking) {\r\n      return;\r\n    }\r\n\r\n    requestAnimationFrame(() => {\r\n      callback(event);\r\n      isTicking = false;\r\n    });\r\n\r\n    isTicking = true;\r\n  };\r\n}\r\n","import { useDndContext } from \"@dnd-kit/core\";\r\nimport {\r\n  horizontalListSortingStrategy,\r\n  useSortable,\r\n  verticalListSortingStrategy,\r\n} from \"@dnd-kit/sortable\";\r\nimport {\r\n  CompiledCustomComponentConfig,\r\n  CompiledShopstoryComponentConfig,\r\n  ComponentCollectionSchemaProp,\r\n  SerializedRenderableComponentDefinition,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  parsePath,\r\n  useEasyblocksMetadata,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { Colors } from \"@redsun-vn/easyblocks-design-system\";\r\nimport { toArray } from \"@/utils\";\r\nimport React, { Fragment } from \"react\";\r\nimport { SelectionFrameController } from \"./SelectionFrameController\";\r\nimport {\r\n  RICH_TEXT_PART_CONFIG_PATH_REGEXP,\r\n  isConfigPathRichTextPart,\r\n} from \"../utils/isConfigPathRichTextPart\";\r\n\r\ninterface BlocksControlsProps {\r\n  children: React.ReactNode;\r\n  path: string;\r\n  disabled?: boolean;\r\n  direction: \"horizontal\" | \"vertical\";\r\n  id: string;\r\n  templateId: string;\r\n  compiled: CompiledShopstoryComponentConfig | CompiledCustomComponentConfig;\r\n  index: number;\r\n  length: number;\r\n}\r\nexport function BlocksControls({\r\n  children,\r\n  path,\r\n  disabled,\r\n  direction,\r\n  id,\r\n  index,\r\n  length,\r\n}: BlocksControlsProps) {\r\n  const { focussedField, setFocussedField, form }: any =\r\n    window.parent.editorWindowAPI?.editorContext;\r\n\r\n  const meta = useEasyblocksMetadata();\r\n  const dndContext = useDndContext();\r\n\r\n  const isActive = focussedField\r\n    .map((focusedField: string) => {\r\n      // If the focused field is rich text part path, we want to show the frame around rich text parent component.\r\n      if (isConfigPathRichTextPart(focusedField)) {\r\n        return focusedField.replace(RICH_TEXT_PART_CONFIG_PATH_REGEXP, \"\");\r\n      }\r\n\r\n      return focusedField;\r\n    })\r\n    .includes(path);\r\n\r\n  const isChildComponentActive = focussedField.some((focusedField: string) =>\r\n    focusedField.startsWith(path)\r\n  );\r\n\r\n  const entryPathParseResult = parsePath(path, form);\r\n  const entryComponentDefinition = meta.vars.definitions.components.find(\r\n    (c) => c.id === entryPathParseResult.parent!.templateId\r\n  );\r\n\r\n  // component` could be draggable, but right now we only support collections.\r\n  const isEntryComponentOrComponentFixed =\r\n    entryComponentDefinition!.schema.some(\r\n      (s) =>\r\n        s.prop === entryPathParseResult.parent!.fieldName &&\r\n        s.type === \"component\"\r\n    );\r\n\r\n  const isAncestorComponentActive = focussedField.some((f: string) =>\r\n    entryPathParseResult.parent!.path.startsWith(f)\r\n  );\r\n\r\n  const isMultiSelection = focussedField.length > 1;\r\n\r\n  const isSiblingComponentActive = focussedField.some((f: string) => {\r\n    const pathWithoutIndexPart = path.split(\".\").slice(0, -1).join(\".\");\r\n    const regexp = new RegExp(`^${pathWithoutIndexPart}\\\\.\\\\d+$`);\r\n    return regexp.test(f);\r\n  });\r\n\r\n  const draggedEntryPathParseResult = dndContext.active\r\n    ? parsePath(dndContext.active.data.current!.path, form)\r\n    : null;\r\n\r\n  const draggedComponentDefinition = draggedEntryPathParseResult\r\n    ? meta.vars.definitions.components.find(\r\n        (c) => c.id === draggedEntryPathParseResult.templateId\r\n      )\r\n    : null;\r\n\r\n  const canDraggedComponentBeDropped =\r\n    entryComponentDefinition && draggedComponentDefinition\r\n      ? getAllowedComponentTypes(entryComponentDefinition).some((type) => {\r\n          return (\r\n            toArray(draggedComponentDefinition.type ?? []).includes(type) ||\r\n            draggedComponentDefinition.id === type\r\n          );\r\n        })\r\n      : true;\r\n\r\n  const isDroppableDisabled =\r\n    disabled ||\r\n    isEntryComponentOrComponentFixed ||\r\n    !canDraggedComponentBeDropped;\r\n\r\n  const sortable = useSortable({\r\n    id,\r\n    data: {\r\n      path,\r\n    },\r\n    disabled: {\r\n      draggable:\r\n        disabled ||\r\n        isMultiSelection ||\r\n        isEntryComponentOrComponentFixed ||\r\n        (!isActive &&\r\n          !isAncestorComponentActive &&\r\n          !isSiblingComponentActive &&\r\n          !isChildComponentActive),\r\n      droppable: isDroppableDisabled,\r\n    },\r\n    strategy:\r\n      direction === \"horizontal\"\r\n        ? horizontalListSortingStrategy\r\n        : verticalListSortingStrategy,\r\n  });\r\n\r\n  if (disabled) {\r\n    return <>{children}</>;\r\n  }\r\n\r\n  const focusOnBlock = (event: React.MouseEvent<HTMLElement>) => {\r\n    event.stopPropagation();\r\n\r\n    if (isActive) {\r\n      return;\r\n    } else {\r\n      event.preventDefault();\r\n    }\r\n\r\n    const closestEditableElementFromTarget = (\r\n      event.target as HTMLElement\r\n    ).closest('[contenteditable=\"true\"]');\r\n\r\n    const isActiveElementContentEditable =\r\n      document.activeElement?.getAttribute(\"contenteditable\") === \"true\";\r\n\r\n    // If target of event is within a content editable element we don't want to focus block.\r\n    // If active element is a content editable element, we also don't want to focus block.\r\n    // The latter is helpful when we start text selection within the content editable element\r\n    // and end selection outside of anchor element.\r\n    if (closestEditableElementFromTarget || isActiveElementContentEditable) {\r\n      return;\r\n    }\r\n\r\n    const isMultipleSelection = event.shiftKey;\r\n\r\n    function getNextFocusedField() {\r\n      if (isMultipleSelection) {\r\n        if (focussedField.includes(path)) {\r\n          const result = focussedField.filter(\r\n            (fieldName: string) => fieldName !== path\r\n          );\r\n\r\n          if (result.length > 0) {\r\n            return result;\r\n          }\r\n\r\n          return [];\r\n        }\r\n\r\n        return [...focussedField, path];\r\n      }\r\n\r\n      return path;\r\n    }\r\n\r\n    const nextFocusedField = getNextFocusedField();\r\n\r\n    setFocussedField(nextFocusedField);\r\n\r\n    if (isMultipleSelection) {\r\n      document.getSelection()?.removeAllRanges();\r\n    }\r\n  };\r\n\r\n  const isActivePathInDifferentCollection =\r\n    sortable.active &&\r\n    !isPathsParentEqual(sortable.active.data.current!.path, path);\r\n\r\n  return (\r\n    <Fragment>\r\n      {!isDroppableDisabled &&\r\n        isActivePathInDifferentCollection &&\r\n        sortable.activeIndex < sortable.index &&\r\n        index === 0 && (\r\n          <DroppablePlaceholder\r\n            id={id}\r\n            direction={direction}\r\n            path={path}\r\n            position=\"before\"\r\n          />\r\n        )}\r\n\r\n      <SelectionFrameController\r\n        isActive={isActive}\r\n        isChildrenSelectionDisabled={!isActive && !isChildComponentActive}\r\n        onSelect={focusOnBlock}\r\n        stitches={meta.stitches}\r\n        sortable={sortable}\r\n        id={id}\r\n        direction={direction}\r\n        path={path}\r\n      >\r\n        {children}\r\n      </SelectionFrameController>\r\n\r\n      {!isDroppableDisabled &&\r\n        isActivePathInDifferentCollection &&\r\n        sortable.activeIndex > sortable.index &&\r\n        index === length - 1 && (\r\n          <DroppablePlaceholder\r\n            id={id}\r\n            direction={direction}\r\n            path={path}\r\n            position=\"after\"\r\n          />\r\n        )}\r\n    </Fragment>\r\n  );\r\n}\r\n\r\nfunction getAllowedComponentTypes(\r\n  componentDefinition: SerializedRenderableComponentDefinition\r\n) {\r\n  const collectionSchemaProps =\r\n    componentDefinition.schema.filter<ComponentCollectionSchemaProp>(\r\n      (s): s is ComponentCollectionSchemaProp =>\r\n        s.type === \"component-collection\"\r\n    );\r\n\r\n  const allowedComponentTypes = collectionSchemaProps.flatMap((s) => s.accepts);\r\n  return Array.from(new Set(allowedComponentTypes));\r\n}\r\n\r\nfunction isPathsParentEqual(path1: string, path2: string) {\r\n  const activePathParts = path1.split(\".\");\r\n  const currentPathParts = path2.split(\".\");\r\n\r\n  return (\r\n    activePathParts.slice(0, -1).join(\".\") ===\r\n    currentPathParts.slice(0, -1).join(\".\")\r\n  );\r\n}\r\n\r\nfunction DroppablePlaceholder({\r\n  id,\r\n  direction,\r\n  path,\r\n  position,\r\n}: {\r\n  id: string;\r\n  direction: string;\r\n  path: string;\r\n  position: \"before\" | \"after\";\r\n}) {\r\n  const meta = useEasyblocksMetadata();\r\n\r\n  const sortable = useSortable({\r\n    id: `${id}.${position}`,\r\n    data: {\r\n      path,\r\n    },\r\n    disabled: {\r\n      draggable: true,\r\n      droppable: false,\r\n    },\r\n  });\r\n\r\n  const isInsertingBefore = sortable.activeIndex > sortable.index;\r\n\r\n  const wrapperStyles = meta.stitches.css({\r\n    position: \"absolute\",\r\n    [position === \"before\" ? \"top\" : \"bottom\"]:\r\n      direction === \"vertical\" ? \"-100%\" : 0,\r\n    [position === \"before\" ? \"left\" : \"right\"]:\r\n      direction === \"horizontal\" ? \"-100%\" : 0,\r\n    height: \"100%\",\r\n    background: \"transparent\",\r\n    width: \"100%\",\r\n\r\n    \"&::before\": {\r\n      display: \"block\",\r\n      content: \"''\",\r\n      backgroundColor: Colors.blue50,\r\n      zIndex: 9999999,\r\n      position: \"absolute\",\r\n      opacity: 0,\r\n    },\r\n    \"&[data-draggable-over=true]::before\": {\r\n      opacity: 1,\r\n      ...(direction === \"horizontal\"\r\n        ? {\r\n            top: 0,\r\n            bottom: 0,\r\n            [isInsertingBefore ? \"left\" : \"right\"]: \"0px\",\r\n            height: \"100%\",\r\n            width: \"4px\",\r\n          }\r\n        : {\r\n            left: 0,\r\n            right: 0,\r\n            [isInsertingBefore ? \"top\" : \"bottom\"]: \"0px\",\r\n            width: \"100%\",\r\n            height: \"4px\",\r\n          }),\r\n    },\r\n  });\r\n\r\n  return (\r\n    <div\r\n      data-draggable-over={sortable.isOver}\r\n      className={wrapperStyles().className}\r\n      ref={sortable.setNodeRef}\r\n      {...sortable.attributes}\r\n      {...sortable.listeners}\r\n    />\r\n  );\r\n}\r\n","import {\r\n  ComponentBuilder,\r\n  ComponentBuilderProps,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport React from \"react\";\r\nimport { BlocksControls } from \"./BlockControls\";\r\n\r\ntype EditableComponentBuilderProps = ComponentBuilderProps & {\r\n  index: number;\r\n  length: number;\r\n};\r\n\r\nfunction EditableComponentBuilder(props: EditableComponentBuilderProps) {\r\n  const { path, compiled, index, length, components, ...restPassedProps } =\r\n    props;\r\n\r\n  const content = (\r\n    <BlocksControls\r\n      path={path}\r\n      id={compiled._id}\r\n      templateId={compiled._component}\r\n      disabled={compiled.__editing?.noInline}\r\n      direction={compiled.__editing?.direction ?? \"vertical\"}\r\n      compiled={compiled}\r\n      index={index}\r\n      length={length}\r\n    >\r\n      <ComponentBuilder\r\n        compiled={compiled}\r\n        path={path}\r\n        passedProps={restPassedProps}\r\n        components={components}\r\n      />\r\n    </BlocksControls>\r\n  );\r\n\r\n  return content;\r\n}\r\n\r\nexport default EditableComponentBuilder;\r\n","import { useDndContext } from \"@dnd-kit/core\";\r\nimport { useSortable } from \"@dnd-kit/sortable\";\r\nimport { PlaceholderAppearance } from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  parsePath,\r\n  useEasyblocksMetadata,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { Colors, Fonts } from \"@redsun-vn/easyblocks-design-system\";\r\nimport { toArray } from \"@/utils\";\r\nimport React from \"react\";\r\nimport { EditorContextType } from \"./EditorContext\";\r\n\r\ntype PlaceholderProps = {\r\n  onClick: () => void;\r\n  appearance: PlaceholderAppearance;\r\n  meta: any;\r\n  sortable: ReturnType<typeof useSortable>;\r\n};\r\n\r\nfunction Placeholder(props: PlaceholderProps) {\r\n  const { stitches } = useEasyblocksMetadata();\r\n  const styles: Record<string, any> = {};\r\n\r\n  const { aspectRatio, width, height, label } = props.appearance;\r\n\r\n  if (height) {\r\n    styles.height = `${height}px`;\r\n  } else if (aspectRatio) {\r\n    styles.paddingBottom = `${(1 / aspectRatio) * 100}%`;\r\n  }\r\n\r\n  const rootClassName = stitches.css({\r\n    border: `1px dashed ${Colors.blue50}`,\r\n    position: \"relative\",\r\n    width: `${width ? `${width}px` : \"auto\"}`,\r\n    height: \"auto\",\r\n    transition: \"all 0.1s\",\r\n  });\r\n\r\n  const contentClassName = stitches.css({\r\n    position: \"absolute\",\r\n    top: 0,\r\n    left: 0,\r\n    width: \"100%\",\r\n    height: \"100%\",\r\n    display: \"flex\",\r\n    color: Colors.blue50,\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    cursor: \"pointer\",\r\n    ...Fonts.body,\r\n    \"&:hover\": {\r\n      backgroundColor: Colors.blue10,\r\n    },\r\n    \"&[data-draggable-over=true]\": {\r\n      backgroundColor: Colors.blue10,\r\n    },\r\n    \"&[data-draggable-dragging=true]\": {\r\n      cursor: \"grabbing\",\r\n    },\r\n  });\r\n\r\n  const content = (\r\n    <div\r\n      className={contentClassName()}\r\n      onClick={(event) => {\r\n        event.stopPropagation();\r\n        props.onClick();\r\n      }}\r\n      data-draggable-over={props.sortable.isOver}\r\n      data-draggable-dragging={props.sortable.active !== null}\r\n    >\r\n      <svg\r\n        width=\"15\"\r\n        height=\"15\"\r\n        viewBox=\"0 0 15 15\"\r\n        fill=\"none\"\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n        style={{ color: Colors.blue50 }}\r\n      >\r\n        <path\r\n          d=\"M8 2.75C8 2.47386 7.77614 2.25 7.5 2.25C7.22386 2.25 7 2.47386 7 2.75V7H2.75C2.47386 7 2.25 7.22386 2.25 7.5C2.25 7.77614 2.47386 8 2.75 8H7V12.25C7 12.5261 7.22386 12.75 7.5 12.75C7.77614 12.75 8 12.5261 8 12.25V8H12.25C12.5261 8 12.75 7.77614 12.75 7.5C12.75 7.22386 12.5261 7 12.25 7H8V2.75Z\"\r\n          fill=\"currentColor\"\r\n          fillRule=\"evenodd\"\r\n          clipRule=\"evenodd\"\r\n        ></path>\r\n      </svg>\r\n      {label && <span>&nbsp;&nbsp;{label}</span>}\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div\r\n      className={rootClassName()}\r\n      ref={props.sortable.setDroppableNodeRef}\r\n      {...props.sortable.attributes}\r\n      {...props.sortable.listeners}\r\n    >\r\n      <div\r\n        style={{\r\n          position: \"relative\",\r\n          width: \"100%\",\r\n          ...styles,\r\n        }}\r\n      ></div>\r\n      {content}\r\n    </div>\r\n  );\r\n}\r\n\r\ntype TypePlaceholderComponentBuilderProps = {\r\n  id: string;\r\n  path: string;\r\n  appearance?: PlaceholderAppearance;\r\n  type: string;\r\n  onClick: () => void;\r\n  meta: any;\r\n};\r\n\r\nexport default function TypePlaceholder(\r\n  props: TypePlaceholderComponentBuilderProps\r\n) {\r\n  const { form } =\r\n    (window.parent.editorWindowAPI?.editorContext as EditorContextType) || {};\r\n  const meta = useEasyblocksMetadata();\r\n  const dndContext = useDndContext();\r\n\r\n  const draggedEntryPathParseResult = dndContext.active\r\n    ? parsePath(dndContext.active.data.current!.path, form)\r\n    : null;\r\n\r\n  const draggedComponentDefinition = draggedEntryPathParseResult\r\n    ? meta.vars.definitions.components.find(\r\n        (c) => c.id === draggedEntryPathParseResult.templateId\r\n      )\r\n    : null;\r\n\r\n  const canDraggedComponentBeDropped = draggedComponentDefinition\r\n    ? toArray(draggedComponentDefinition.type ?? []).includes(props.type)\r\n    : true;\r\n\r\n  const sortable = useSortable({\r\n    id: `placeholder.${props.id}`,\r\n    data: {\r\n      path: props.path,\r\n    },\r\n    disabled: {\r\n      draggable: true,\r\n      droppable: !canDraggedComponentBeDropped,\r\n    },\r\n  });\r\n\r\n  const { type } = props;\r\n\r\n  let appearance: PlaceholderAppearance;\r\n\r\n  if (props.appearance) {\r\n    appearance = props.appearance;\r\n  } else {\r\n    if (type === \"section\") {\r\n      appearance = {\r\n        label: \"Add section\",\r\n        aspectRatio: 3.2,\r\n      };\r\n    } else if (type === \"card\") {\r\n      appearance = {\r\n        label: \"Add card\",\r\n        aspectRatio: 0.7,\r\n      };\r\n    } else if (type === \"button\") {\r\n      appearance = {\r\n        label: \"Add button\",\r\n        width: 250,\r\n        height: 50,\r\n      };\r\n    } else if (type === \"item\") {\r\n      appearance = {\r\n        label: \"Add item\",\r\n        // width: 250,\r\n        height: 50,\r\n      };\r\n    } else if (type === \"image\") {\r\n      appearance = {\r\n        label: \"Add image\",\r\n        aspectRatio: 1,\r\n      };\r\n    } else if (type === \"icon\") {\r\n      appearance = {\r\n        label: \"Pick icon\",\r\n        width: 50,\r\n        height: 50,\r\n      };\r\n    } else {\r\n      appearance = {\r\n        label: \"Add\",\r\n        width: 50,\r\n        aspectRatio: 1,\r\n      };\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Placeholder\r\n      appearance={appearance}\r\n      onClick={props.onClick}\r\n      meta={props.meta}\r\n      sortable={sortable}\r\n    />\r\n  );\r\n}\r\n","import {\r\n  CollisionDetection,\r\n  DndContext,\r\n  MouseSensor,\r\n  pointerWithin,\r\n  rectIntersection,\r\n  useSensor,\r\n} from \"@dnd-kit/core\";\r\nimport { SortableContext } from \"@dnd-kit/sortable\";\r\nimport { NoCodeComponentEntry, Easyblocks } from \"@redsun-vn/easyblocks-core\";\r\nimport {\r\n  EasyblocksMetadataProvider,\r\n  EditorContextType,\r\n  RichTextEditor,\r\n  TextEditor,\r\n  configTraverse,\r\n  itemMoved,\r\n} from \"@redsun-vn/easyblocks-core/_internals\";\r\nimport { useForceRerender } from \"@/utils\";\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport { z } from \"zod\";\r\nimport { CanvasRoot } from \"./CanvasRoot/CanvasRoot\";\r\nimport EditableComponentBuilder from \"./EditableComponentBuilder/EditableComponentBuilder.editor\";\r\nimport TypePlaceholder from \"./Placeholder\";\r\n\r\nconst dragDataSchema = z.object({\r\n  path: z.string(),\r\n  sortable: z.object({\r\n    index: z.number(),\r\n  }),\r\n});\r\n\r\nfunction customCollisionDetection(args: Parameters<CollisionDetection>[0]) {\r\n  // First, let's see if there are any collisions with the pointer\r\n  const pointerCollisions = pointerWithin(args);\r\n\r\n  // Collision detection algorithms return an array of collisions\r\n  if (pointerCollisions.length > 0) {\r\n    return pointerCollisions;\r\n  }\r\n\r\n  // If there are no collisions with the pointer, return rectangle intersections\r\n  return rectIntersection(args);\r\n}\r\n\r\nexport function EasyblocksCanvas({\r\n  components,\r\n}: {\r\n  components?: Record<string, React.ComponentType<any>>;\r\n}) {\r\n  const { meta, compiled, externalData, editorContext }: any =\r\n    window.parent.editorWindowAPI;\r\n\r\n  const [enabled, setEnabled] = useState(false);\r\n  const activeDraggedEntryPath = useRef<string | null>(null);\r\n  const { forceRerender } = useForceRerender();\r\n  const mouseSensor = useSensor(MouseSensor, {\r\n    activationConstraint: {\r\n      distance: 10,\r\n    },\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (window.self === window.top) {\r\n      throw new Error(\"No host\");\r\n    } else {\r\n      setEnabled(true);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (window.parent && window.parent.editorWindowAPI) {\r\n      window.parent.editorWindowAPI.onUpdate = () => {\r\n        // Force re-render when child gets info from parent that data changed\r\n        forceRerender();\r\n      };\r\n    }\r\n  });\r\n\r\n  const shouldNotRender = !enabled || !meta || !compiled || !externalData;\r\n\r\n  if (shouldNotRender) {\r\n    return <div>Loading...</div>;\r\n  }\r\n\r\n  const sortableItems = getSortableItems(\r\n    editorContext.form.values,\r\n    editorContext\r\n  );\r\n\r\n  return (\r\n    /* EasyblocksMetadataProvider must be defined in case of nested <Easyblocks /> components are used! */\r\n    <EasyblocksMetadataProvider meta={meta}>\r\n      <CanvasRoot>\r\n        <DndContext\r\n          sensors={[mouseSensor]}\r\n          collisionDetection={customCollisionDetection}\r\n          onDragStart={(event) => {\r\n            document.documentElement.style.cursor = \"grabbing\";\r\n            activeDraggedEntryPath.current = dragDataSchema.parse(\r\n              event.active.data.current\r\n            ).path;\r\n            window.parent.editorWindowAPI?.editorContext?.setFocussedField([]);\r\n          }}\r\n          onDragEnd={(event) => {\r\n            document.documentElement.style.cursor = \"\";\r\n            const activeData = dragDataSchema.parse(event.active.data.current);\r\n\r\n            if (event.over) {\r\n              const overData = dragDataSchema.parse(event.over.data.current);\r\n\r\n              if (event.over.id === event.active.id) {\r\n                // If the dragged item is dropped on itself, we want to refocus the dragged item.\r\n                window.parent.editorWindowAPI?.editorContext?.setFocussedField(\r\n                  activeData.path\r\n                );\r\n              } else {\r\n                const itemMovedEvent = itemMoved({\r\n                  fromPath: activeData.path,\r\n                  toPath: overData.path,\r\n                  placement: ifValidPlacement(\r\n                    event.over.id.toString().split(\".\")[1]\r\n                  ),\r\n                });\r\n\r\n                requestAnimationFrame(() => {\r\n                  window.parent.postMessage(itemMovedEvent);\r\n                });\r\n              }\r\n            } else {\r\n              // If there was no drop target, we want to refocus the dragged item.\r\n              window.parent.editorWindowAPI?.editorContext?.setFocussedField(\r\n                activeData.path\r\n              );\r\n            }\r\n          }}\r\n          onDragCancel={(event) => {\r\n            document.documentElement.style.cursor = \"\";\r\n            // If the drag was canceled, we want to refocus dragged item.\r\n            window.parent.editorWindowAPI?.editorContext?.setFocussedField(\r\n              dragDataSchema.parse(event.active.data.current).path\r\n            );\r\n          }}\r\n        >\r\n          <SortableContext items={sortableItems}>\r\n            <Easyblocks\r\n              renderableDocument={{\r\n                renderableContent: compiled,\r\n                meta,\r\n              }}\r\n              externalData={externalData}\r\n              components={{\r\n                ...components,\r\n                \"@easyblocks/rich-text.editor\": RichTextEditor,\r\n                \"@easyblocks/text.editor\": TextEditor,\r\n                \"EditableComponentBuilder.editor\": EditableComponentBuilder,\r\n                Placeholder: TypePlaceholder,\r\n              }}\r\n            />\r\n          </SortableContext>\r\n        </DndContext>\r\n      </CanvasRoot>\r\n    </EasyblocksMetadataProvider>\r\n  );\r\n}\r\n\r\nfunction getSortableItems(\r\n  rootNoCodeEntry: NoCodeComponentEntry,\r\n  editorContext: EditorContextType\r\n) {\r\n  const sortableItems: Array<string> = [];\r\n\r\n  configTraverse(\r\n    rootNoCodeEntry,\r\n    editorContext,\r\n    ({ value, schemaProp, config }) => {\r\n      if (schemaProp.type === \"component-collection\") {\r\n        if (value.length === 0) {\r\n          sortableItems.push(`placeholder.${config._id}`);\r\n          return;\r\n        }\r\n\r\n        sortableItems.push(`${value[0]._id}.before`);\r\n        sortableItems.push(\r\n          ...(value as Array<NoCodeComponentEntry>).map((v) => v._id)\r\n        );\r\n        sortableItems.push(`${value.at(-1)._id}.after`);\r\n      }\r\n    }\r\n  );\r\n\r\n  return sortableItems;\r\n}\r\nfunction ifValidPlacement(value: string): \"before\" | \"after\" | undefined {\r\n  if (value === \"before\" || value === \"after\") {\r\n    return value;\r\n  }\r\n\r\n  return;\r\n}\r\n","import {\r\n  RequestedExternalData,\r\n  Easyblocks,\r\n  getDefaultLocale,\r\n  type RenderableDocument,\r\n} from \"@redsun-vn/easyblocks-core\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { parseQueryParams } from \"./parseQueryParams\";\r\nimport { EasyblocksEditorProps } from \"./EasyblocksEditorProps\";\r\nimport { serialize } from \"@/utils\";\r\n\r\nexport const PreviewRenderer: React.FC<EasyblocksEditorProps> = (props) => {\r\n  const config = props.config;\r\n\r\n  const [data, setData] = useState<{\r\n    renderableDocument: RenderableDocument;\r\n    externalData: RequestedExternalData;\r\n  } | null>(null);\r\n\r\n  const [width, setWidth] = useState<number>(-1);\r\n  const [widthAuto, setWidthAuto] = useState<boolean>(false);\r\n\r\n  useEffect(() => {\r\n    const { documentId, templateId, locale } = parseQueryParams();\r\n\r\n    let mode: \"template\" | \"document\";\r\n\r\n    if (documentId && templateId) {\r\n      console.warn(\r\n        `'template' parameter ignored because 'document' parameter is specified`\r\n      );\r\n      mode = \"document\";\r\n    } else if (!documentId && templateId) {\r\n      mode = \"template\";\r\n    } else if (documentId && !templateId) {\r\n      mode = \"document\";\r\n    } else {\r\n      throw new Error(\r\n        \"You must specify 'document' or 'template' parameter in preview mode\"\r\n      );\r\n    }\r\n\r\n    const localeWithDefault =\r\n      locale ?? getDefaultLocale(config.locales ?? []).code;\r\n\r\n    (async () => {\r\n      const { buildDocument, buildEntry } = await import(\r\n        \"@redsun-vn/easyblocks-core\"\r\n      );\r\n\r\n      if (mode === \"document\") {\r\n        const { renderableDocument, externalData } = await buildDocument({\r\n          documentId: documentId!,\r\n          config,\r\n          locale: localeWithDefault,\r\n        });\r\n\r\n        props.onExternalDataChange?.(externalData, {\r\n          locale: localeWithDefault,\r\n        });\r\n\r\n        setData({\r\n          renderableDocument,\r\n          externalData,\r\n        });\r\n      } else {\r\n        const template = await config.backend.templates.get({\r\n          id: templateId!,\r\n        });\r\n\r\n        const { renderableContent, meta, externalData } = buildEntry({\r\n          entry: {\r\n            ...template.entry,\r\n            _itemProps: {},\r\n          },\r\n          config,\r\n          locale: localeWithDefault,\r\n        });\r\n\r\n        props.onExternalDataChange?.(externalData, {\r\n          locale: localeWithDefault,\r\n        });\r\n\r\n        setWidth(template.width ?? -1);\r\n        setWidthAuto(template.widthAuto ?? false);\r\n\r\n        setData({\r\n          renderableDocument: {\r\n            renderableContent,\r\n            meta: serialize(meta),\r\n          },\r\n          externalData,\r\n        });\r\n      }\r\n    })();\r\n  }, []);\r\n\r\n  if (!data) {\r\n    return null;\r\n  }\r\n\r\n  const requestedExternalDataLength = Object.keys(data.externalData).length;\r\n  const givenExternalDataLength = Object.keys(props.externalData ?? {}).length;\r\n\r\n  if (requestedExternalDataLength !== givenExternalDataLength) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        position: \"relative\",\r\n        display: widthAuto ? \"inline-flex\" : \"block\",\r\n        maxWidth: width === -1 ? \"auto\" : `${width}px`,\r\n      }}\r\n      id={\"__easyblocks-preview-container\"}\r\n    >\r\n      <Easyblocks\r\n        renderableDocument={data.renderableDocument}\r\n        externalData={props.externalData}\r\n        components={props.components}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n","import { Config } from \"@redsun-vn/easyblocks-core\";\r\n\r\nconst validate = (value: any) => {\r\n  return (\r\n    typeof value === \"string\" &&\r\n    (value.startsWith(\"http://\") || value.startsWith(\"https://\"))\r\n  );\r\n};\r\n\r\nexport const debugTypes: Config[\"types\"] = {\r\n  debug_url_inline_never: {\r\n    type: \"inline\",\r\n    defaultValue: \"https://google.com\",\r\n    responsiveness: \"never\",\r\n    widget: { id: \"debug_url\", label: \"Debug URL\" },\r\n    validate,\r\n  },\r\n  debug_url_inline_optional: {\r\n    type: \"inline\",\r\n    defaultValue: \"https://google.com\",\r\n    responsiveness: \"optional\",\r\n    widget: { id: \"debug_url\", label: \"Debug URL\" },\r\n    validate,\r\n  },\r\n  debug_url_inline_always: {\r\n    type: \"inline\",\r\n    defaultValue: \"https://google.com\",\r\n    responsiveness: \"always\",\r\n    widget: { id: \"debug_url\", label: \"Debug URL\" },\r\n    validate,\r\n  },\r\n  debug_url_token_never: {\r\n    type: \"token\",\r\n    token: \"debug_urls\",\r\n    responsiveness: \"never\",\r\n    defaultValue: { tokenId: \"google\" },\r\n    widget: { id: \"debug_url\", label: \"Debug URL\" },\r\n    allowCustom: false,\r\n    validate,\r\n  },\r\n  debug_url_token_optional_no_custom: {\r\n    type: \"token\",\r\n    token: \"debug_urls\",\r\n    responsiveness: \"optional\",\r\n    defaultValue: { tokenId: \"google\" },\r\n    widget: { id: \"debug_url\", label: \"Debug URL\" },\r\n    allowCustom: false,\r\n    validate,\r\n  },\r\n  debug_url_token_optional_custom: {\r\n    type: \"token\",\r\n    token: \"debug_urls\",\r\n    responsiveness: \"optional\",\r\n    defaultValue: { tokenId: \"google\" },\r\n    widget: { id: \"debug_url\", label: \"Debug URL\" },\r\n    allowCustom: true,\r\n    validate,\r\n  },\r\n  debug_url_token_always_no_custom: {\r\n    type: \"token\",\r\n    token: \"debug_urls\",\r\n    responsiveness: \"always\",\r\n    defaultValue: { tokenId: \"google\" },\r\n    widget: { id: \"debug_url\", label: \"Debug URL\" },\r\n    allowCustom: false,\r\n    validate,\r\n  },\r\n  debug_url_token_always_custom: {\r\n    type: \"token\",\r\n    token: \"debug_urls\",\r\n    responsiveness: \"always\",\r\n    defaultValue: { tokenId: \"google\" },\r\n    widget: { id: \"debug_url\", label: \"Debug URL\" },\r\n    allowCustom: true,\r\n    validate,\r\n  },\r\n};\r\n","import { NoCodeComponentDefinition } from \"@redsun-vn/easyblocks-core\";\r\n\r\nexport const debugSectionDefinition: NoCodeComponentDefinition = {\r\n  id: \"DebugSection\",\r\n  schema: [\r\n    {\r\n      prop: \"inline_never\",\r\n      label: \"Never\",\r\n      type: \"debug_url_inline_never\",\r\n      group: \"Inline\",\r\n    },\r\n    {\r\n      prop: \"inline_optional_disabled\",\r\n      label: \"Optional (off)\",\r\n      type: \"debug_url_inline_optional\",\r\n      responsive: false,\r\n      group: \"Inline\",\r\n    },\r\n    {\r\n      prop: \"inline_optional_enabled\",\r\n      label: \"Optional (on)\",\r\n      type: \"debug_url_inline_optional\",\r\n      responsive: true,\r\n      group: \"Inline\",\r\n    },\r\n    {\r\n      prop: \"inline_always\",\r\n      label: \"Always\",\r\n      type: \"debug_url_inline_always\",\r\n      group: \"Inline\",\r\n    },\r\n\r\n    {\r\n      prop: \"token_never\",\r\n      label: \"Never\",\r\n      type: \"debug_url_token_never\",\r\n      group: \"Token - custom\",\r\n    },\r\n    {\r\n      prop: \"token_optional_disabled_custom\",\r\n      label: \"Optional (off)\",\r\n      type: \"debug_url_token_optional_custom\",\r\n      responsive: false,\r\n      group: \"Token - custom\",\r\n    },\r\n    {\r\n      prop: \"token_optional_enabled_custom\",\r\n      label: \"Optional (on)\",\r\n      type: \"debug_url_token_optional_custom\",\r\n      responsive: true,\r\n      group: \"Token - custom\",\r\n    },\r\n    {\r\n      prop: \"token_always_custom\",\r\n      label: \"Always\",\r\n      type: \"debug_url_token_always_custom\",\r\n      group: \"Token - custom\",\r\n    },\r\n\r\n    {\r\n      prop: \"token_optional_disabled_no_custom\",\r\n      label: \"Optional (off)\",\r\n      type: \"debug_url_token_optional_no_custom\",\r\n      responsive: false,\r\n      group: \"Token - no custom\",\r\n    },\r\n    {\r\n      prop: \"token_optional_enabled_no_custom\",\r\n      label: \"Optional (on)\",\r\n      type: \"debug_url_token_optional_no_custom\",\r\n      responsive: true,\r\n      group: \"Token - no custom\",\r\n    },\r\n    {\r\n      prop: \"token_always_no_custom\",\r\n      label: \"Always\",\r\n      type: \"debug_url_token_always_no_custom\",\r\n      group: \"Token - no custom\",\r\n    },\r\n  ],\r\n  type: \"section\",\r\n};\r\n","import { Config } from \"@redsun-vn/easyblocks-core\";\r\n\r\nexport const debugTokens: Config[\"tokens\"] = {\r\n  debug_urls: [\r\n    {\r\n      id: \"google\",\r\n      value: \"https://google.com\",\r\n    },\r\n    {\r\n      id: \"bing\",\r\n      value: \"https://bing.com\",\r\n    },\r\n  ],\r\n};\r\n","import React from \"react\";\r\n\r\nfunction DebugSection({\r\n  inline_never,\r\n  inline_optional_disabled,\r\n  inline_optional_enabled,\r\n  inline_always,\r\n  token_never,\r\n  token_optional_disabled_no_custom,\r\n  token_optional_enabled_no_custom,\r\n  token_optional_disabled_custom,\r\n  token_optional_enabled_custom,\r\n  token_always_no_custom,\r\n  token_always_custom,\r\n}: Record<string, any>) {\r\n  return (\r\n    <div>\r\n      <pre>\r\n        {JSON.stringify(\r\n          {\r\n            inline_never,\r\n            inline_optional_disabled,\r\n            inline_optional_enabled,\r\n            inline_always,\r\n            token_never,\r\n            token_optional_disabled_no_custom,\r\n            token_optional_enabled_no_custom,\r\n            token_optional_disabled_custom,\r\n            token_optional_enabled_custom,\r\n            token_always_no_custom,\r\n            token_always_custom,\r\n          },\r\n          null,\r\n          2\r\n        )}\r\n      </pre>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport { DebugSection };\r\n","import React from \"react\";\r\nimport { InlineTypeWidgetComponentProps } from \"@redsun-vn/easyblocks-core\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { Input } from \"@redsun-vn/easyblocks-design-system\";\r\n\r\nexport function DebugUrlWidget(props: InlineTypeWidgetComponentProps<string>) {\r\n  const [active, setActive] = useState(false);\r\n  const [value, setValue] = useState(props.value);\r\n\r\n  useEffect(() => {\r\n    if (!active) {\r\n      setValue(props.value);\r\n    }\r\n  });\r\n\r\n  return (\r\n    <Input\r\n      value={value}\r\n      onChange={(event) => {\r\n        setActive(true);\r\n        setValue(event.target.value);\r\n      }}\r\n      onBlur={() => {\r\n        setActive(false);\r\n        props.onChange(value);\r\n      }}\r\n      align={\"right\"}\r\n    />\r\n  );\r\n}\r\n","import { EasyblocksEditorProps } from \"../EasyblocksEditorProps\";\r\nimport { debugTypes } from \"./debugTypes\";\r\nimport { debugSectionDefinition } from \"./DebugSection/DebugSection.definition\";\r\nimport { debugTokens } from \"./debugTokens\";\r\nimport { DebugSection } from \"./DebugSection/DebugSection\";\r\nimport { DebugUrlWidget } from \"./DebugUrlWidget\";\r\n\r\nexport function addDebugToEditorProps(\r\n  props: EasyblocksEditorProps\r\n): EasyblocksEditorProps {\r\n  return {\r\n    ...props,\r\n    config: {\r\n      ...props.config,\r\n      types: {\r\n        ...props.config.types,\r\n        ...debugTypes,\r\n      },\r\n      components: [...(props.config.components ?? []), debugSectionDefinition],\r\n      tokens: {\r\n        ...props.config.tokens,\r\n        ...debugTokens,\r\n      },\r\n    },\r\n    components: {\r\n      ...props.components,\r\n      DebugSection,\r\n    },\r\n    widgets: {\r\n      ...props.widgets,\r\n      debug_url: DebugUrlWidget,\r\n    },\r\n  };\r\n}\r\n","import React, { useEffect, useState } from \"react\";\r\nimport { EasyblocksEditorProps } from \"./EasyblocksEditorProps\";\r\nimport { EasyblocksParent } from \"./EasyblocksParent\";\r\nimport { EasyblocksCanvas } from \"./EditorChildWindow\";\r\nimport { PreviewRenderer } from \"./PreviewRenderer\";\r\nimport { addDebugToEditorProps } from \"./debug/addDebugToEditorProps\";\r\nimport { parseQueryParams } from \"./parseQueryParams\";\r\n\r\n// Extend the Window interface to include isShopstoryEditor\r\ndeclare global {\r\n  interface Window {\r\n    isShopstoryEditor?: boolean;\r\n  }\r\n}\r\n\r\nexport function EasyblocksEditor(props: EasyblocksEditorProps) {\r\n  const [selectedWindow, setSelectedWindow] = useState<\r\n    \"parent\" | \"child\" | \"preview\" | null\r\n  >(null);\r\n\r\n  const setSelectedWindowToParent = () => {\r\n    window.isShopstoryEditor = true;\r\n    setSelectedWindow(\"parent\");\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (parseQueryParams().preview) {\r\n      setSelectedWindow(\"preview\");\r\n      return;\r\n    }\r\n\r\n    const setSelectedWindowToChild = () => {\r\n      setSelectedWindow(\"child\");\r\n    };\r\n\r\n    if (selectedWindow === null) {\r\n      /**\r\n       * Why try catch?\r\n       *\r\n       * It's because window.parent.isShopstoryEditor might throw if window.parent is cross origin (when shopstory Launcher is run in iframe of CMS - like Contentful); In that case we're sure it's a parent window, not a child.\r\n       */\r\n      try {\r\n        // Parent window is always rendered first so `window.isShopstoryEditor` will always be set when <iframe /> with child is loading\r\n        if (window.parent !== window.self && window.parent.isShopstoryEditor) {\r\n          setSelectedWindowToChild();\r\n        } else {\r\n          setSelectedWindowToParent();\r\n        }\r\n      } catch (error) {\r\n        setSelectedWindowToParent();\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  if (!selectedWindow) {\r\n    return null;\r\n  }\r\n\r\n  if (parseQueryParams().debug) {\r\n    props = addDebugToEditorProps(props);\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {selectedWindow === \"parent\" && (\r\n        <EasyblocksParent\r\n          config={props.config}\r\n          externalData={props.externalData ?? {}}\r\n          onExternalDataChange={props.onExternalDataChange ?? (() => ({}))}\r\n          widgets={props.widgets}\r\n          components={props.components}\r\n          pickers={props.pickers}\r\n          isAdminMode={props.isAdminMode}\r\n        />\r\n      )}\r\n\r\n      {selectedWindow === \"child\" && (\r\n        <EasyblocksCanvas components={props.components} />\r\n      )}\r\n\r\n      {selectedWindow === \"preview\" && <PreviewRenderer {...props} />}\r\n    </>\r\n  );\r\n}\r\n"],"names":["EditorContext","React","createContext","useEditorContext","context","useContext","Error","last","collection","length","toArray","scalarOrCollection","Array","isArray","takeNumbers","path","split","map","x","parseInt","filter","Number","isNaN","preOrderPathComparator","direction","pathA","pathB","order","numbersA","numbersB","numberALength","numberBLength","shorterLength","Math","min","index","valueA","valueB","sign","includesAny","a","b","some","i","includes","deepClone","source","JSON","parse","stringify","deepCompare","objectsToCompare","currentObject","sortObject","nextObject","areObjectsHashesEqual","value","sort","sortedObject","objectKeys","Object","keys","forEach","key","useForceRerender","setDummyState","useState","forceRerender","useRef","current","dotNotationGet","obj","reduce","acc","curVal","serialize","getOwnPropertyNames","sleep","ms","Promise","resolve","setTimeout","uniqueId","id","replace","c","r","random","v","toString","assertDefined","message","undefined","ConfigAfterAutoContext","useConfigAfterAuto","configAfterAutoContext","ExternalDataContext","EditorExternalDataProvider","children","externalData","createElement","Provider","useEditorExternalData","ExtraKeys","actionKeys","ALT_KEY","CTRL_KEY","META_KEY","SHIFT_KEY","useWindowKeyDown","callback","extraKeys","isDisabled","downHandler","event","isExtraKeysPressed","every","k","extraKeysSet","Set","isOtherExtraKeysPressed","has","preventDefault","useEffect","document","getElementsByTagName","contentWindow","window","body","addEventListener","removeEventListener","EditorIframe","onEditorHistoryRedo","onEditorHistoryUndo","width","height","transform","containerRef","isIframeReady","setIframeReady","handleIframeLoaded","IframeContainer","ref","IframeInnerContainer","Iframe","src","location","href","onLoad","style","styled","div","withConfig","displayName","componentId","Colors","black100","iframe","pathToCompiledPath","editorContext","pathInfo","parsePath","form","parent","definition","findComponentDefinitionById","templateId","schemaProp","schema","find","prop","fieldName","result","getPropertyNameFromSchemaProp","startsWith","substring","isSchemaPropTextModifier","isSchemaPropActionTextModifier","isFieldPortal","buildTinaFields","internalBuildTinaFields","fieldsFilter","compiledPath","stripRichTextPartSelection","compiledComponent","compiledComponentConfig","allFields","__editing","fields","field","item","portal","portalComponentFields","push","includeHeader","groups","group","hidden","portalFieldFields","console","warn","_component","portalField","overrides","sources","flatMap","firstField","combinedField","name","nonAnalyticsFields","analyticsFields","copyToClipboard","textToCopy","navigator","clipboard","isSecureContext","writeText","textArea","position","left","prepend","select","execCommand","error","remove","IdWrapper","Fonts","black40","SidebarFooter","props","toaster","useToaster","isAdminMode","paths","values","compiledValue","widthInfo","xl","widthAuto","auto","findComponentDefinition","isSaveable","allowSave","showSaveAsTemplate","readOnly","disableCustomTemplates","_id","ButtonSecondary","onClick","actions","openTemplateModal","mode","config","paddingTop","ButtonPrimary","success","_master","Toggle","input","disabled","checked","toggleProps","labels","ToggleFieldWrapper","DesignSystemToggle","MIXED_VALUE","COMPONENTS_SUPPORTING_MIXED_VALUES","isMixedFieldValue","__mixed__","SelectFieldComponent","options","onChange","isMixedValue","selectOptions","normalizedSelectOptions","toProps","unshift","label","isDivider","inputValue","handleChange","Select","toComponent","option","SelectSeparator","SelectItem","RadioGroup","radioOptions","toggleButtonValue","radioOptionsMapped","SelectInline","_extends","Icon","icon","Icons","ToggleButton","hideLabel","NumberInput","step","max","Input","type","Tooltip","forwardRef","rest","createPortal","zIndex","TooltipBody","TooltipArrow","useTooltip","isOpen","setIsOpen","triggerElement","setTriggerElement","tooltipElement","setTooltipElement","arrowElement","setArrowElement","styles","attributes","usePopper","strategy","placement","modifiers","element","padding","tooltipTrigger","useTooltipTrigger","delay","open","close","triggerProps","tooltipProps","popper","arrowProps","arrow","FieldMetaWrapper","noWrap","layout","renderLabel","isLabelHidden","configAfterAuto","runChange","focussedField","isMixedValueSupported","isMixedValueSupportedByComponent","isResponsiveField","subComponent","component","fieldNames","handleButtonMixedClick","_","names","firstFieldValue","change","resolvedLayout","content","display","alignItems","flexDirection","TextButton","variant","color","isExternalField","isExternalSchemaProp","types","componentPaths","slice","join","fieldValues","f","configs","externalValues","getExternalReferenceLocationKey","isTrulyResponsiveValue","responsiveValueFindDeviceWithDefinedValue","breakpointIndex","devices","currentBreakpointFieldValues","responsiveValueForceGet","isLoadingExternalValue","isEmptyExternalReference","isIdReferenceToDocumentExternalValue","FieldWrapper","margin","FieldLabelWrapper","isFullWidth","FieldLabel","htmlFor","isError","lineHeight","overflow","textOverflow","description","marginLeft","Loader","WidgetsSelect","widgetId","newFieldValue","isRootComponent","FieldInputWrapper","FieldError","selectedWidgetId","setSelectedWidgetId","widgets","availableWidgets","w","FieldLabelIconWrapper","widget","Typography","wrapFieldsWithMeta","Field","extraProps","css","span","NumberField","BaseNumberField","NumberFieldPlugin","Component","SelectField","SelectFieldPlugin","RadioGroupField","RadioGroupFieldPlugin","TextField","restInputProperties","inputProps","useTextValue","contextParams","locale","locales","placeholder","normalize","isTextSchemaProp","controlSize","align","withBorder","TextFieldPlugin","ToggleField","ToggleFieldPlugin","CUSTOM_OPTION_VALUE","extraValuesIncludes","extraValues","extraValue","useTokenTypes","tokenTypes","fromEntries","entries","typeDefinitionEntry","TokenFieldComponent","tokenTypeDefinition","normalizeCustomValue","allowCustom","setInputValue","customValueTextFieldRef","tokens","tokenId","tokenValue","token","fontTokenLabel","getFontTokenLabel","isExtraValueSelected","responsiveValueGetDefinedValue","getDevicesWidths","shouldShowCustomValueInput","selectValue","onSelectChange","selectedValue","queueMicrotask","focus","CustomInputWidgetComponent","customInputElement","params","e","target","onBlur","normalizedValue","Fragment","SelectColorTokenItem","o","previewColor","Root","filledResponsiveFontValue","responsiveValueFill","currentDeviceFontValue","isValidFontTokenValue","stripPxUnit","fontSize","RegExp","TokenFieldPlugin","gap","xmlns","viewBox","fill","cx","cy","stroke","RICH_TEXT_PART_CONFIG_PATH_REGEXP","isConfigPathRichTextPart","configPath","test","getUniqueValues","mapper","uniqueValues","uniqueItems","mappedItem","add","from","mergeCommonFields","mergedCommonFields","fieldsGroupedByProperty","groupFieldsByPropertyName","flat","currentFields","visibleFields","fieldDefinitionIds","getFieldSchemaWithDefinition","uniqueDefinitionIds","firstVisibleField","repeatedFields","currentFieldPropertyName","getPropertyName","fieldNameParts","lastPart","BlockField","isSubcomponentPanelExpanded","setIsSubcomponentPanelExpanded","openComponentPicker","isMixed","normalizedName","componentPickerPath","minHeight","justifyContent","flex","minWidth","SubComponentPanelButton","isExpanded","onExpand","onCollapse","required","ButtonGhost","removeItems","Remove","ThumbnailButton","AddButton","onAdd","then","newConfig","replaceItems","paddingLeft","noPadding","placeItems","border","black20","borderRadius","Add","size","sidebarPanelsRoot","getElementById","entryAfterAuto","componentDefinition","showError","sidebarPreview","getSidebarPreview","defaultThumbnail","thumbnail","ReactDOM","Panel","previewValues","s","externalDataValue","resolveExternalValue","resolveLocalisedValue","preview","PanelContext","useMemo","fieldsPerName","mergedFields","onClose","GroupPanel","PanelBody","FieldsBuilder","BlockFieldPlugin","__type","GroupPanelKeyframes","keyframes","p","IdentityField","panelContext","configPaths","isWithinNestedPanel","parentComponentDefinition","parentSchemaProp","isNonRemovable","isNonChangable","rootComponent","handleChangeComponentType","selectedConfig","handleRemove","titleContent","fontWeight","ChevronDown","ChevronLeft","marginRight","opacity","pointerEvents","IdentityFieldPlugin","MissingWidget","ExternalFieldComponent","tinaForm","isSchemaPropRootParam","ExternalField","getWidgetComponentForRootParam","getWidgetComponentByType","configId","externalReferenceLocationKey","responsive","externalValue","isExternalValueResolvedCompoundExternalDataValue","isResolvedCompoundExternalDataValue","basicResources","getBasicResourcesOfType","isCompoundResourceValueSelectVisible","useLayoutEffect","resourceKey","newId","newKey","newValue","CompoundResourceValueSelect","resource","onResourceKeyChange","ExternalFieldPlugin","externalReference","t","compoundResourceValues","selectedOption","getSavedValue","previousValue","responsiveFieldController","formValues","valuesAfterAuto","originalFormat","format","originalParse","normalizedFieldName","isResponsive","fieldValue","isSet","valueAfterFormat","displayedValue","savedValue","reset","nextValues","defaultValue","toggleOffAuto","currentBreakpointValues","areAllFieldValuesAuto","isAnyFieldValueAuto","newFieldsValues","nextFieldValue","valueField","ResponsiveField","scalarFieldValues","controller","newValues","isValueDifferentFromMainBreakpoint","mainBreakpointIndex","isFieldVisible","uniqueFieldValues","autoLabelChildren","getAutoLabelButtonLabel","ResetButton","Reset","ResetButtonLabel","FieldBuilder","AutoLabel","ResponsiveFieldPlugin","button","purple","refNameParts","round","transformStrokeAndFill","node","getAttribute","setAttribute","child","SVGPicker","meta","svgString","inputRef","readFileAsString","files","reader","FileReader","onload","trimmed","trim","emptyDiv","innerHTML","svg","removeAttribute","tagName","toLowerCase","alert","readAsText","marginBottom","dangerouslySetInnerHTML","__html","accept","SVGPickerFieldPlugin","Slider","RangeSlider","SliderFieldPlugin","useInlineTypes","LocalFieldPlugin","LocalField","inlineTypes","inlineTypeDefinition","WidgetComponent","StyledRadioItem","RadixRadioGroup","Item","horizontalPositionToFlexJustifyContentValue","horizontal","verticalPositionToFlexAlignItemsValue","vertical","positions","PositionPickerInput","onPositionChange","onValueChange","newPosition","gridTemplateRows","gridTemplateColumns","black10","backgroundColor","top","PositionIndicator","$size","PositionField","PositionFieldPlugin","createFieldController","mainNewValue","extraNewValues","invalidateCache","schemaPropNameToUpdate","canvasIframe","parsedValues","getValue","postMessage","richTextChangedEvent","parsedValue","fieldIndex","customTypeDefinition","validate","isInputValueValid","hasLocaleToken","currentLocaleFieldName","replaceLocaleToken","currentLocaleValue","fallbackLocale","getFallbackLocaleForLocale","fieldNameSegments","localeTokenIndex","indexOf","localisedConfigPath","fallbackLocaleFieldName","localeConfigPath","duplicateConfig","propName","componentPath","parentDefinition","closestDefinedValues","val","hasOwnProperty","pathPrefix","resolvedFieldName","resolvedFieldFallbackName","fieldFallbackValue","getHash","getSchemaDefinition","localisedFieldName","eventOrValue","isEventObject","currentTarget","richTextCacheInvalidator","cache","changedPath","cacheKeysToRemove","isRichTextOrRichTextAncestorComponent","richTextPath","findPathOfFirstAncestorOfType","richTextConfig","traverseComponents","componentConfig","cacheInvalidators","invalidator","compilationCache","cacheKey","shouldFieldBeDisplayed","FIELD_COMPONENTS","fieldComponent","finalForm","log","HorizontalLine","grouped","ungrouped","horizontalLine","identityField","FieldsGroup","groupName","FieldsGroupLabel","generateFieldKey","isLast","theme","GlobalStyles","createGlobalStyle","tina_reset_styles","StyleReset","Button","primary","small","grow","busy","ICON_BUTTON_SIZE","ICON_SIZE","IconButton","InlineSettings","hasNoExtraFields","stopPropagation","SettingsContent","FormBody","Wrapper","EditorSidebar","editableComponent","areMultipleFieldsSelected","focusedFields","fieldsPerFocusedField","focusedField","TOP_BAR_HEIGHT","TopBar","Label","TopBarLeft","TopBarRight","TopBarCenter","ImageContainer","Image","img","EditorTopBar","onSaveDocument","onViewportChange","viewport","onIsEditingChange","isEditing","onUndo","onRedo","onLocaleChange","hideCloseButton","headingRef","router","URLSearchParams","search","themeId","get","shopId","Close","background","Undo","Redo","ButtonDanger","className","DeviceSwitch","deviceId","onDeviceChange","l","code","cursor","alt","DEVICE_ID_TO_ICON","xs","fillRule","clipRule","d","sm","md","lg","ToggleGroup","TooltipTrigger","ToggleGroupItem","TooltipContent","normalizeToStringArray","arg","getAllComponentTypes","componentTypes","getComponentTypesFromDefinitions","definitions","components","componentType","getAllComponentsOfType","getAllComponentsOfTypeFromDefinitionsArray","isNoCodeComponentOfType","unrollAcceptsFieldIntoComponents","accepts","allComponentTypes","idsSet","acceptsEntry","ModalPicker","pickers","parentPath","parentData","templatesDictionary","templates","template","entry","picker","_itemProps","newComponent","onModalClose","TemplateModal","setError","action","backend","isLoadingEdit","setLoadingEdit","isLoadingDelete","setLoadingDelete","setTemplate","thumbnailLabel","canSend","ctaLabel","Modal","title","onRequestClose","headerLine","onSubmit","createAction","create","newTemplate","syncTemplates","catch","finally","update","marginTop","FormElement","autoFocus","delete","isLoading","duplicateItem","sourceIndex","targetIndex","compilationContext","isPlaceholder","configToDuplicate","mutators","insert","pasteItems","what","where","resolveDestination","pasteCommand","successfulInsertsPaths","takeLastOfEachParent","initialDestination","destination","shiftPath","resolvedDestinations","paste","insertedPath","duplicateItems","duplicatableFieldNames","isFieldDuplicatable","fieldsGroupedByParentPath","groupFieldsByParentPath","nextFocusedFieldsPerGroup","sortedFields","fieldsGroupIndex","lastFieldIndex","getFieldPathIndex","getParentPath","moveItem","to","move","moveItems","fieldsToMove","nextFocusedFields","isMovingMultipleFields","wasAnyFieldWithinCurrentGroupMoved","fieldNameIndex","isFirst","removeItem","configPathToRemove","componentConfigValue","fieldNamesToRemove","removableFieldNames","isFieldRemovable","isRemovingMultipleFields","fieldPath","itemsLength","isOnlyItem","isLastItem","isTextWrapper","logItems","configValues","sortDirection","fieldsIndicesGroupedByParentPath","accumulator","currentField","indices","fieldPathParts","parentFieldElementsCount","fieldNameParent","fieldSchema","originalPath","shiftingPath","directionFactor","original","shifting","numberA","numberB","splice","String","lastOfEachParent","curr","MIN_SAFE_INTEGER","reconcile","contextMatches","getTypes","insertCommand","reconcileItem","itemDefinition","itemTypes","reconciledItem","duplicatedItem","getSchema","toName","Boolean","fixIndexInCollection","destinationResolver","initialDestinationPath","resolvedPaths","pathsQueue","shift","parsed","slot","pasteSlots","slotSchema","slotPath","slotValues","idx","reverse","pasteManager","inserts","Map","destinations","latestDestinationInserts","set","editorVariable","BEFORE_ADD_BUTTON_DISPLAY","BEFORE_ADD_BUTTON_TOP","BEFORE_ADD_BUTTON_LEFT","AFTER_ADD_BUTTON_DISPLAY","AFTER_ADD_BUTTON_TOP","AFTER_ADD_BUTTON_LEFT","offset","addBlockButtonRef","handleOpenBlockMenu","inactivateBlockMenu","AddButtonWrapper","AddIconButton","x1","y1","x2","y2","FrameWrapper","attrs","calculateAddButtonsProperties","targetElementRect","containerElementRect","halfButtonSize","floor","ADD_BUTTON_SIZE","beforeButtonTopOffset","afterButtonTopOffset","buttonsLeftOffset","isBeforeButtonWithinViewport","isButtonWithinViewport","isAfterButtonWithinViewport","before","after","buttonsTopOffset","beforeButtonLeftOffset","afterButtonLeftOffset","SelectionFrame","compiledFocusedField","isAddingEnabled","isAddingEnabledForSelectedFields","hideAddButtons","handleSelectionFrameMessages","data","updateAddButtons","payload","container","handleAddButtonClick","which","insertItem","block","setCssVariable","documentElement","setProperty","isSchemaPropCollection","configMapArray","configArray","prefix","configMapInternal","configMap","mappedVal","$res","getDefaultTemplateForDefinition","def","buildRichTextNoCodeEntry","getDefaultTokenId","colors","font","fonts","isUserDefined","isDefault","getTemplates","configTemplates","remoteUserDefinedTemplates","getAll","getTemplatesInternal","getNecessaryDefaultTemplates","componentTemplates","normalizeTextLocales","firstDefinedValue","getDefaultLocale","allBuiltinTemplates","allUserTemplates","hideTemplates","Form","loading","constructor","buttons","loadInitialValues","initialValues","createForm","handleSubmit","arrayMutators","_reset","save","updateFields","updateInitialValues","firstUpdate","subscribe","formState","getState","cb","response","initialize","FORM_ERROR","process","env","NODE_ENV","groupCollapsed","groupEnd","updateValues","batch","activePath","active","updateEverything","updateSelectively","useForm","watch","setValues","setForm","formIsLoading","setFormIsLoading","loadFormData","useCallback","useUpdateFormFields","useUpdateFormLabel","useUpdateFormValues","getConfigSnapshot","strippedConfig","addLocalizedFlag","__localized","removeLocalizedFlag","useDataSaver","initialDocument","remoteDocument","initialConfigInCaseOfMissingDocument","onTickRef","onTick","localConfig","localConfigSnapshot","previousConfig","previousConfigSnapshot","isConfigTheSame","configToSaveWithLocalisedFlag","runSaveCallback","debug","newDocument","documents","latestDocument","latestRemoteDocumentVersion","version","isNewerDocumentVersionAvailable","latestConfig","notify","updatedDocument","inProgress","wasSaveNowCalled","interval","setInterval","clearInterval","saveNow","GLOBAL_SHORTCUTS_KEYS","DATA_TRANSFER_FORMAT","useEditorGlobalKeyboardShortcuts","isDeleting","handleKeydown","isTargetInputElement","isGlobalShortcut","isAnyFieldSelected","toUpperCase","logSelectedItems","handleCopy","canHandleCopyPaste","getConfigsToCopy","clipboardData","setData","handleCut","handlePaste","rawData","getData","parsedData","isTargetHtmlElement","sortedPaths","notInsideInputElement","activeElement","insideEditorIFrame","frameElement","focusedFieldsSelected","HISTORY_SIZE","EditorHistory","currentIndex","isCurrentIndexLastEntry","isAboutToReachSizeLimit","replaceAt","oldValue","entryIndex","findIndex","forward","canGoForward","currentEntry","nextEntry","back","canGoBack","previousEntry","getEntries","useEditorHistory","editorHistory","undo","unstable_batchedUpdates","redo","editorHistoryInstance","checkLocalesCorrectness","defaultLocales","defaultLocale","fallback","localeChain","currentLocale","fallbackId","ContentContainer","SidebarAndContentContainer","SidebarContainer","white","DataSaverRoot","DataSaverOverlay","DataSaverModal","AuthenticationScreen","bodyLarge","Editor","EditorBackendInitializer","enabled","setEnabled","setDocument","run","documentId","EditorWrapper","memo","rootTemplateId","rootComponentId","rootTemplateEntry","createCompilationContext","initialEntry","adaptRemoteConfig","EditorContent","parseExternalDataId","externalDataId","useBuiltContent","rawContent","onExternalDataChange","buildEntryResult","inputRawContent","inputIsEditing","inputBreakpointIndex","inputChanged","buildEntry","compiler","findExternals","compile","resultMeta","vars","links","textModifiers","normalizedContent","normalizeInput","compileInternal","mergeCompilationMeta","isExternalDataChanged","defaultIsExternalDataChanged","storedExternalData","externalId","findConfigById","responsiveValueGet","hasExternalIdChanged","renderableContent","calculateViewportRelatedStuff","availableSize","activeDevice","device","matchingDevice","getMatchingDevice","activeDeviceindex","scaleFactor","offsetY","smallestNonScaledWidth","breakpoint","h","iframeSize","useRerenderOnIframeResize","resizeObserver","ResizeObserver","throttle","observe","unobserve","heightMode","currentViewport","setCurrentViewport","iframeContainerRef","clientWidth","clientHeight","CompilationCache","setEditing","setCurrentLocale","prevLocale","componentPickerData","setComponentPickerData","setFocussedField","handleSetFocussedField","nextFocusedField","isEditMode","handleSetEditing","clear","closeComponentPickerModal","promiseResolve","sidebarNodeRef","editableData","setTemplates","openTemplateModalAction","setOpenTemplateModalAction","configChangeCallback","fieldsToFocus","templateDefined","prev","templateIndex","newTemplates","editorTypes","typeName","typeDefinition","documentData","editorWindowAPI","compiled","localeValue","onUpdate","handleEditorEvents","shopstoryCanvasIframe","componentPickerClosed","fromPath","toPath","fromPathParseResult","toPathParseResult","pathToMove","isToPathPlaceholder","insertionPath","insertionIndex","calculateInsertionIndex","isDataSaverOverlayOpen","setDataSaverOverlayOpen","appHeight","setAppElement","EditorSidebarRight","MemoEditorSidebarRight","saveLabel","withoutLocalizedFlag","normalized","mostCommonPath","getMostCommonSubPath","mostCommonPathParseResult","toPathNoCodeEntry","fromPathRootSectionIndex","toPathRootSectionIndex","path1","path2","fromPathParts","toPathParts","mostCommonPathParts","currentFromPathPart","currentToPathPart","foundConfig","highestDevice","visibleDevices","currentDevice","isString","htmlColorNames","htmlColorNamesSpecial","validateHTMLColorName","status","validateHTMLColorSpecialName","validateHTMLColorHex","regex","validateHTMLColorRgb","optionalCommaOrRequiredSpace","optionalDecimals","anyPercentage","hundredPercent","alphaPercentage","endingWithAlphaPercentage","validateHTMLColorHsl","degRegex","graRegex","radRegex","turnRegex","regexLogic","validateHTMLColorHwb","validateHTMLColorLab","labParam","validateColor","ColorTokenWidget","SpaceTokenWidget","int","parseQueryParams","searchParams","editorSearchParams","DocumentDataWidgetComponent","whiteSpace","rootParams","documentExternalLocationKeys","documentCompoundResources","lastIndexOf","pop","resourceSchemaProp","CardRoot","CardImg","CardImgPlaceholder","CardFooter","CardLabelContainer","CardLabelTemplateName","Title","TitleContainer","Message","getTemplatePreviewImage","SectionCard","onSelect","imageRef","previewImage","ButtonGhostColor","ModalRoot","ModalGridRoot","Sidebar","black5","SidebarContent","SidebarButton","GridRoot","SectionPickerModal","templateGroups","gridRootRef","templateSelected","groupNode","groupOffsetTop","offsetTop","scrollTo","behavior","paddingBottom","checkQueryForTemplate","query","toLocaleLowerCase","SearchableSmallPickerModal","templatesDict","setQuery","trimmedQuery","filteredTemplatesDict","filteredTemplates","searchProps","headerSymbol","isOnlyOne","componentLabel","templateLabel","BasicRow","image","tinyDescription","onEdit","shouldForwardProp","isPropValid","builtinWidgets","space","builinPickers","large","compact","EasyblocksParent","StyleSheetManager","enableVendorPrefixes","ModalContext","querySelector","GlobalModalStyles","TooltipProvider","Toaster","containerStyle","CanvasRoot","globalEditorRendererStyles","SelectionFrameController","isActive","isChildrenSelectionDisabled","stitches","sortable","setNode","useUpdateFramePosition","isInsertingBefore","activeIndex","wrapperClassName","userSelect","boxSizing","transition","boxShadow","bottom","right","blue50","contains","isOver","setNodeRef","listeners","dispatch","updateSelectionFramePosition","createThrottledHandler","nodeRect","getBoundingClientRect","selectionFramePositionChanged","passive","handleResize","updateSelectionFramePositionInScrollableContainer","containerRect","closestScrollableElement","closest","isTicking","requestAnimationFrame","BlocksControls","useEasyblocksMetadata","dndContext","useDndContext","isChildComponentActive","entryPathParseResult","entryComponentDefinition","isEntryComponentOrComponentFixed","isAncestorComponentActive","isMultiSelection","isSiblingComponentActive","pathWithoutIndexPart","regexp","draggedEntryPathParseResult","draggedComponentDefinition","canDraggedComponentBeDropped","getAllowedComponentTypes","isDroppableDisabled","useSortable","draggable","droppable","horizontalListSortingStrategy","verticalListSortingStrategy","focusOnBlock","closestEditableElementFromTarget","isActiveElementContentEditable","isMultipleSelection","shiftKey","getNextFocusedField","getSelection","removeAllRanges","isActivePathInDifferentCollection","isPathsParentEqual","DroppablePlaceholder","collectionSchemaProps","allowedComponentTypes","activePathParts","currentPathParts","wrapperStyles","EditableComponentBuilder","restPassedProps","noInline","ComponentBuilder","passedProps","Placeholder","aspectRatio","appearance","rootClassName","contentClassName","blue10","setDroppableNodeRef","TypePlaceholder","dragDataSchema","z","object","string","number","customCollisionDetection","args","pointerCollisions","pointerWithin","rectIntersection","EasyblocksCanvas","activeDraggedEntryPath","mouseSensor","useSensor","MouseSensor","activationConstraint","distance","self","shouldNotRender","sortableItems","getSortableItems","EasyblocksMetadataProvider","DndContext","sensors","collisionDetection","onDragStart","onDragEnd","activeData","over","overData","itemMovedEvent","itemMoved","ifValidPlacement","onDragCancel","SortableContext","items","Easyblocks","renderableDocument","RichTextEditor","TextEditor","rootNoCodeEntry","configTraverse","at","PreviewRenderer","setWidth","setWidthAuto","localeWithDefault","buildDocument","requestedExternalDataLength","givenExternalDataLength","maxWidth","debugTypes","debug_url_inline_never","responsiveness","debug_url_inline_optional","debug_url_inline_always","debug_url_token_never","debug_url_token_optional_no_custom","debug_url_token_optional_custom","debug_url_token_always_no_custom","debug_url_token_always_custom","debugSectionDefinition","debugTokens","debug_urls","DebugSection","inline_never","inline_optional_disabled","inline_optional_enabled","inline_always","token_never","token_optional_disabled_no_custom","token_optional_enabled_no_custom","token_optional_disabled_custom","token_optional_enabled_custom","token_always_no_custom","token_always_custom","DebugUrlWidget","setActive","setValue","addDebugToEditorProps","debug_url","EasyblocksEditor","selectedWindow","setSelectedWindow","setSelectedWindowToParent","isShopstoryEditor","setSelectedWindowToChild"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsEO,MAAMA,aAAa,gBAAGC,yBAAK,CAACC,aAAa,CAC9C,IACF,EAAC;AAEM,SAASC,gBAAgBA,GAAG;AACjC,EAAA,MAAMC,OAAO,GAAGC,gBAAU,CAACL,aAAa,CAAC,CAAA;EACzC,IAAI,CAACI,OAAO,EAAE;AACZ,IAAA,MAAM,IAAIE,KAAK,CAAC,2BAA2B,CAAC,CAAA;AAC9C,GAAA;AACA,EAAA,OAAOF,OAAO,CAAA;AAChB;;AChFA,SAASG,IAAIA,CAAuBC,UAAa,EAAa;AAC5D,EAAA,OAAOA,UAAU,CAACA,UAAU,CAACC,MAAM,GAAG,CAAC,CAAC,CAAA;AAC1C;;ACFA;AACA,SAASC,OAAOA,CAAeC,kBAAgC,EAAY;AACzE,EAAA,IAAIC,KAAK,CAACC,OAAO,CAACF,kBAAkB,CAAC,EAAE;AACrC,IAAA,OAAOA,kBAAkB,CAAA;AAC3B,GAAA;EAEA,OAAO,CAACA,kBAAkB,CAAC,CAAA;AAC7B;;ACPA,MAAMG,WAAW,GAAIC,IAAY,IAC/BA,IAAI,CACDC,KAAK,CAAC,GAAG,CAAC,CACVC,GAAG,CAAEC,CAAC,IAAKC,QAAQ,CAACD,CAAC,EAAE,EAAE,CAAC,CAAC,CAC3BE,MAAM,CAAEF,CAAC,IAAK,CAACG,MAAM,CAACC,KAAK,CAACJ,CAAC,CAAC,CAAC,CAAA;AAEpC,MAAMK,sBAAsB,GAC1BA,CAACC,SAAqC,GAAG,WAAW,KACpD,CAACC,KAAa,EAAEC,KAAa,KAAK;EAChC,MAAMC,KAAK,GAAGH,SAAS,KAAK,WAAW,GAAG,CAAC,GAAG,CAAC,CAAC,CAAA;AAEhD,EAAA,MAAMI,QAAQ,GAAGd,WAAW,CAACW,KAAK,CAAC,CAAA;AACnC,EAAA,MAAMI,QAAQ,GAAGf,WAAW,CAACY,KAAK,CAAC,CAAA;AAEnC,EAAA,MAAMI,aAAa,GAAGF,QAAQ,CAACnB,MAAM,CAAA;AACrC,EAAA,MAAMsB,aAAa,GAAGF,QAAQ,CAACpB,MAAM,CAAA;AAErC,EAAA,IAAIqB,aAAa,KAAK,CAAC,IAAIC,aAAa,KAAK,CAAC,EAAE;IAC9C,MAAM,IAAIzB,KAAK,CAAC,CAAA,sBAAA,EAAyBmB,KAAK,CAAUC,OAAAA,EAAAA,KAAK,IAAI,CAAC,CAAA;AACpE,GAAA;EAEA,MAAMM,aAAa,GAAGC,IAAI,CAACC,GAAG,CAACJ,aAAa,EAAEC,aAAa,CAAC,CAAA;EAC5D,IAAII,KAAK,GAAG,CAAC,CAAA;EACb,OAAOA,KAAK,GAAGH,aAAa,EAAE;AAC5B,IAAA,MAAMI,MAAM,GAAGR,QAAQ,CAACO,KAAK,CAAC,CAAA;AAC9B,IAAA,MAAME,MAAM,GAAGR,QAAQ,CAACM,KAAK,CAAC,CAAA;IAC9B,IAAIC,MAAM,KAAKC,MAAM,EAAE;MACrB,OAAOV,KAAK,GAAGM,IAAI,CAACK,IAAI,CAACF,MAAM,GAAGC,MAAM,CAAC,CAAA;AAC3C,KAAA;AACAF,IAAAA,KAAK,EAAE,CAAA;AACT,GAAA;EAEA,OAAOR,KAAK,GAAGM,IAAI,CAACK,IAAI,CAACP,aAAa,GAAGD,aAAa,CAAC,CAAA;AACzD,CAAC;;ACjCH,SAASS,WAAWA,CAAIC,CAAM,EAAEC,CAAM,EAAE;AACtC,EAAA,OAAOD,CAAC,CAACE,IAAI,CAAEC,CAAC,IAAKF,CAAC,CAACG,QAAQ,CAACD,CAAC,CAAC,CAAC,CAAA;AACrC;;ACFA,SAASE,SAASA,CAAIC,MAAS,EAAK;EAClC,OAAOC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,SAAS,CAACH,MAAM,CAAC,CAAC,CAAA;AAC3C;;ACFA,SAASI,WAAWA,CAAC,GAAGC,gBAA4C,EAAW;AAC7E,EAAA,KAAK,IAAIhB,KAAK,GAAG,CAAC,EAAEA,KAAK,GAAGgB,gBAAgB,CAAC1C,MAAM,GAAG,CAAC,EAAE0B,KAAK,EAAE,EAAE;IAChE,MAAMiB,aAAa,GAAGC,UAAU,CAACF,gBAAgB,CAAChB,KAAK,CAAC,CAAC,CAAA;IACzD,MAAMmB,UAAU,GAAGD,UAAU,CAACF,gBAAgB,CAAChB,KAAK,GAAG,CAAC,CAAC,CAAC,CAAA;AAE1D,IAAA,MAAMoB,qBAAqB,GACzBR,IAAI,CAACE,SAAS,CAACG,aAAa,CAAC,KAAKL,IAAI,CAACE,SAAS,CAACK,UAAU,CAAC,CAAA;IAE9D,IAAI,CAACC,qBAAqB,EAAE;AAC1B,MAAA,OAAO,KAAK,CAAA;AACd,KAAA;AACF,GAAA;AAEA,EAAA,OAAO,IAAI,CAAA;AACb,CAAA;AAEA,SAASF,UAAUA,CAACG,KAAc,EAAE;AAClC,EAAA,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE;AAC7B,IAAA,OAAOA,KAAK,CAAA;AACd,GAAA;AAEA,EAAA,IAAI5C,KAAK,CAACC,OAAO,CAAC2C,KAAK,CAAC,EAAE;AACxB,IAAA,OAAO,CAAC,GAAGA,KAAK,CAAC,CAACC,IAAI,EAAE,CAAA;AAC1B,GAAA;EAEA,IAAID,KAAK,KAAK,IAAI,EAAE;AAClB,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;EAEA,MAAME,YAAiC,GAAG,EAAE,CAAA;EAC5C,MAAMC,UAAU,GAAGC,MAAM,CAACC,IAAI,CAACL,KAAK,CAAC,CAACC,IAAI,EAAE,CAAA;AAE5CE,EAAAA,UAAU,CAACG,OAAO,CAAEC,GAAG,IAAK;IAC1BL,YAAY,CAACK,GAAG,CAAC,GAAGV,UAAU,CAAEG,KAAK,CAAyBO,GAAG,CAAC,CAAC,CAAA;AACrE,GAAC,CAAC,CAAA;AAEF,EAAA,OAAOL,YAAY,CAAA;AACrB;;AClCA,SAASM,gBAAgBA,GAAG;EAC1B,MAAM,GAAGC,aAAa,CAAC,GAAGC,cAAQ,CAAC,EAAE,CAAC,CAAA;AAEtC,EAAA,MAAMC,aAAa,GAAGC,YAAM,CAAC,MAAM;IACjCH,aAAa,CAAC,EAAE,CAAC,CAAA;GAClB,CAAC,CAACI,OAAO,CAAA;EAEV,OAAO;AAAEF,IAAAA,aAAAA;GAAe,CAAA;AAC1B;;ACXO,SAASG,cAAcA,CAACC,GAAQ,EAAExD,IAAY,EAAE;EACrD,IAAIA,IAAI,KAAK,EAAE,EAAE;AACf,IAAA,OAAOwD,GAAG,CAAA;AACZ,GAAA;EACA,OAAOxD,IAAI,CAACC,KAAK,CAAC,GAAG,CAAC,CAACwD,MAAM,CAAC,CAACC,GAAG,EAAEC,MAAM,KAAKD,GAAG,IAAIA,GAAG,CAACC,MAAM,CAAC,EAAEH,GAAG,CAAC,CAAA;AACzE;;ACLA,SAASI,SAASA,CAACnB,KAAc,EAAE;EACjC,IAAIA,KAAK,YAAYlD,KAAK,EAAE;AAC1B,IAAA,OAAOyC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,SAAS,CAACO,KAAK,EAAEI,MAAM,CAACgB,mBAAmB,CAACpB,KAAK,CAAC,CAAC,CAAC,CAAA;AAC7E,GAAA;EAEA,OAAOT,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,SAAS,CAACO,KAAK,CAAC,CAAC,CAAA;AAC1C;;ACNO,SAASqB,KAAKA,CAACC,EAAU,EAAE;EAChC,OAAO,IAAIC,OAAO,CAAEC,OAAO,IAAKC,UAAU,CAACD,OAAO,EAAEF,EAAE,CAAC,CAAC,CAAA;AAC1D;;ACFA,SAASI,QAAQA,GAAW;EAC1B,MAAMC,EAAE,GAAG,sCAAsC,CAACC,OAAO,CACvD,OAAO,EACP,UAAUC,CAAC,EAAE;IACX,MAAMC,CAAC,GAAIrD,IAAI,CAACsD,MAAM,EAAE,GAAG,EAAE,GAAI,CAAC;MAChCC,CAAC,GAAGH,CAAC,IAAI,GAAG,GAAGC,CAAC,GAAIA,CAAC,GAAG,GAAG,GAAI,GAAG,CAAA;AACpC,IAAA,OAAOE,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAAA;AACvB,GACF,CAAC,CAAA;AAED,EAAA,OAAON,EAAE,CAAA;AACX;;ACXA,SAASO,aAAaA,CAAIlC,KAAQ,EAAEmC,OAAgB,EAAyB;EAC3E,IAAInC,KAAK,KAAKoC,SAAS,EAAE;AACvB,IAAA,MAAM,IAAItF,KAAK,CAACqF,OAAO,IAAI,oBAAoB,CAAC,CAAA;AAClD,GAAA;AAEA,EAAA,OAAOnC,KAAK,CAAA;AACd;;ACHO,MAAMqC,sBAAsB,gBACjC5F,yBAAK,CAACC,aAAa,CAA8B,IAAI,CAAC,CAAA;AAEjD,SAAS4F,kBAAkBA,GAAG;AACnC,EAAA,MAAMC,sBAAsB,GAAG1F,gBAAU,CAACwF,sBAAsB,CAAC,CAAA;EAEjE,IAAI,CAACE,sBAAsB,EAAE;AAC3B,IAAA,MAAM,IAAIzF,KAAK,CAAC,wDAAwD,CAAC,CAAA;AAC3E,GAAA;AAEA,EAAA,OAAOyF,sBAAsB,CAAA;AAC/B;;ACXA,MAAMC,mBAAmB,gBAAG9F,mBAAa,CAAe,EAAE,CAAC,CAAA;AAE3D,SAAS+F,0BAA0BA,CAAC;EAClCC,QAAQ;AACRC,EAAAA,YAAAA;AAIF,CAAC,EAAE;AACD,EAAA,oBACElG,yBAAA,CAAAmG,aAAA,CAACJ,mBAAmB,CAACK,QAAQ,EAAA;AAAC7C,IAAAA,KAAK,EAAE2C,YAAAA;AAAa,GAAA,EAC/CD,QAC2B,CAAC,CAAA;AAEnC,CAAA;AAEA,SAASI,qBAAqBA,GAAG;EAC/B,OAAOjG,gBAAU,CAAC2F,mBAAmB,CAAC,CAAA;AACxC;;ACnBYO,IAAAA,SAAS,0BAATA,SAAS,EAAA;EAATA,SAAS,CAAA,SAAA,CAAA,GAAA,QAAA,CAAA;EAATA,SAAS,CAAA,UAAA,CAAA,GAAA,SAAA,CAAA;EAATA,SAAS,CAAA,UAAA,CAAA,GAAA,SAAA,CAAA;EAATA,SAAS,CAAA,WAAA,CAAA,GAAA,UAAA,CAAA;AAAA,EAAA,OAATA,SAAS,CAAA;AAAA,CAAA,CAAA,EAAA,CAAA,CAAA;AAOrB,MAAMC,UAAuB,GAAG,CAC9BD,SAAS,CAACE,OAAO,EACjBF,SAAS,CAACG,QAAQ,EAClBH,SAAS,CAACI,QAAQ,EAClBJ,SAAS,CAACK,SAAS,CACpB,CAAA;AAOM,MAAMC,gBAAgB,GAAGA,CAC9B9C,GAAW,EACX+C,QAAqC,EACrC;EAAEC,SAAS;AAAEC,EAAAA,UAAAA;AAAgC,CAAC,GAAG;AAC/CD,EAAAA,SAAS,EAAE,EAAE;AACbC,EAAAA,UAAU,EAAE,KAAA;AACd,CAAC,KACE;EACH,MAAMC,WAAW,GAAIC,KAAoB,IAAK;AAC5C,IAAA,MAAMC,kBAAkB,GAAGJ,SAAS,CAACK,KAAK,CAAEC,CAAC,IAAKH,KAAK,CAACG,CAAC,CAAC,CAAC,CAAA;IAC3D,MAAMC,YAAY,GAAG,IAAIC,GAAG,CAAC,CAAC,GAAGR,SAAS,CAAC,CAAC,CAAA;IAE5C,MAAMS,uBAAuB,GAAGhB,UAAU,CACvCpF,MAAM,CAAEiG,CAAC,IAAK,CAACC,YAAY,CAACG,GAAG,CAACJ,CAAC,CAAC,CAAC,CACnC3E,IAAI,CAAE2E,CAAC,IAAKH,KAAK,CAACG,CAAC,CAAC,CAAC,CAAA;IAExB,IAAIH,KAAK,CAACnD,GAAG,KAAKA,GAAG,IAAIoD,kBAAkB,IAAI,CAACK,uBAAuB,EAAE;MACvEN,KAAK,CAACQ,cAAc,EAAE,CAAA;AACtBZ,MAAAA,QAAQ,EAAE,CAAA;AACZ,KAAA;GACD,CAAA;AAEDa,EAAAA,eAAS,CAAC,MAAM;IACd,IAAI,CAACX,UAAU,EAAE;MACfY,QAAQ,CACLC,oBAAoB,CAAC,QAAQ,CAAC,CAAE,CAAC,CAAC,CAClCC,aAAa,CAAEC,MAAM,CAACH,QAAQ,CAACI,IAAI,CAACC,gBAAgB,CACnD,SAAS,EACThB,WACF,CAAC,CAAA;AAEHc,MAAAA,MAAM,CAACE,gBAAgB,CAAC,SAAS,EAAEhB,WAAW,CAAC,CAAA;AAC/C,MAAA,OAAO,MAAM;AACXc,QAAAA,MAAM,CAACG,mBAAmB,CAAC,SAAS,EAAEjB,WAAW,CAAC,CAAA;OACnD,CAAA;AACH,KAAA;AACF,GAAC,EAAE,CAACD,UAAU,CAAC,CAAC,CAAA;AAClB,CAAC;;AC5CD,SAASmB,YAAYA,CAAC;EACpBC,mBAAmB;EACnBC,mBAAmB;EACnBC,KAAK;EACLC,MAAM;EACNC,SAAS;AACTC,EAAAA,YAAAA;AACwB,CAAC,EAAE;EAC3B,MAAM,CAACC,aAAa,EAAEC,cAAc,CAAC,GAAGzE,cAAQ,CAAC,KAAK,CAAC,CAAA;EAEvD,MAAM0E,kBAAkB,GAAGA,MAAM;IAC/BD,cAAc,CAAC,IAAI,CAAC,CAAA;GACrB,CAAA;AAED9B,EAAAA,gBAAgB,CAAC,GAAG,EAAEwB,mBAAmB,EAAE;AACzCtB,IAAAA,SAAS,EAAE,CAACR,SAAS,CAACI,QAAQ,CAAC;AAC/BK,IAAAA,UAAU,EAAE,CAAC0B,aAAAA;AACf,GAAC,CAAC,CAAA;AAEF7B,EAAAA,gBAAgB,CAAC,GAAG,EAAEuB,mBAAmB,EAAE;IACzCrB,SAAS,EAAE,CAACR,SAAS,CAACI,QAAQ,EAAEJ,SAAS,CAACK,SAAS,CAAC;AACpDI,IAAAA,UAAU,EAAE,CAAC0B,aAAAA;AACf,GAAC,CAAC,CAAA;AAEF7B,EAAAA,gBAAgB,CAAC,GAAG,EAAEwB,mBAAmB,EAAE;AACzCtB,IAAAA,SAAS,EAAE,CAACR,SAAS,CAACG,QAAQ,CAAC;AAC/BM,IAAAA,UAAU,EAAE,CAAC0B,aAAAA;AACf,GAAC,CAAC,CAAA;AAEF7B,EAAAA,gBAAgB,CAAC,GAAG,EAAEuB,mBAAmB,EAAE;AACzCrB,IAAAA,SAAS,EAAE,CAACR,SAAS,CAACG,QAAQ,CAAC;AAC/BM,IAAAA,UAAU,EAAE,CAAC0B,aAAAA;AACf,GAAC,CAAC,CAAA;AAEF,EAAA,oBACEzI,yBAAA,CAAAmG,aAAA,CAACyC,eAAe,EAAA;AAACC,IAAAA,GAAG,EAAEL,YAAAA;GACpBxI,eAAAA,yBAAA,CAAAmG,aAAA,CAAC2C,oBAAoB,qBACnB9I,yBAAA,CAAAmG,aAAA,CAAC4C,MAAM,EAAA;AACL7D,IAAAA,EAAE,EAAC,kBAAkB;AACrB8D,IAAAA,GAAG,EAAElB,MAAM,CAACmB,QAAQ,CAACC,IAAK;AAC1BC,IAAAA,MAAM,EAAER,kBAAmB;AAC3BS,IAAAA,KAAK,EAAE;AACL;AACA;MACAf,KAAK;MACLC,MAAM;AACNC,MAAAA,SAAAA;AACF,KAAA;GACD,CACmB,CACP,CAAC,CAAA;AAEtB,CAAA;AAIA,MAAMK,eAAe,GAAGS,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,+BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAGlBC,CAAAA,CAAAA,CAAAA,6CAAAA,EAAAA,GAAAA,CAAAA,EAAAA,6BAAM,CAACC,QAAQ,CAC9B,CAAA;AAED,MAAMb,oBAAoB,GAAGO,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,oCAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAStC,CAAA,CAAA,CAAA,+GAAA,CAAA,CAAA,CAAA;AAED,MAAMV,MAAM,GAAGM,uBAAM,CAACO,MAAM,CAAAL,UAAA,CAAA;EAAAC,WAAA,EAAA,sBAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAI3B,CAAA,CAAA,CAAA,uDAAA,CAAA,CAAA;;AClFM,SAASI,kBAAkBA,CAChC/I,IAAY,EACZgJ,aAAgC,EACxB;EACR,MAAMC,QAAQ,GAAGC,oBAAS,CAAClJ,IAAI,EAAEgJ,aAAa,CAACG,IAAI,CAAC,CAAA;EAEpD,IAAIF,QAAQ,CAACG,MAAM,EAAE;IACnB,MAAMC,UAAU,GAAGC,sCAA2B,CAC5CL,QAAQ,CAACG,MAAM,CAACG,UAAU,EAC1BP,aACF,CAAE,CAAA;AAEF,IAAA,MAAMQ,UAAU,GAAGH,UAAU,CAACI,MAAM,CAACC,IAAI,CACtCF,UAAU,IAAKA,UAAU,CAACG,IAAI,KAAKV,QAAQ,CAACG,MAAM,CAAEQ,SACvD,CAAE,CAAA;AAEF,IAAA,MAAMC,MAAM,GAAG,CAAGd,EAAAA,kBAAkB,CAClCE,QAAQ,CAACG,MAAM,CAACpJ,IAAI,EACpBgJ,aACF,CAAC,CAAA,CAAA,EAAIc,6BAA6B,CAACN,UAAU,CAAC,CAC5CP,CAAAA,EAAAA,QAAQ,CAACG,MAAM,CAACQ,SAAS,CACvBX,CAAAA,EAAAA,QAAQ,CAAC7H,KAAK,CAAG,CAAA,CAAA;AAErB,IAAA,IAAIyI,MAAM,CAACE,UAAU,CAAC,GAAG,CAAC,EAAE;AAC1B,MAAA,OAAOF,MAAM,CAACG,SAAS,CAAC,CAAC,CAAC,CAAA;AAC5B,KAAA;AAEA,IAAA,OAAOH,MAAM,CAAA;AACf,GAAA;AAEA,EAAA,OAAO,EAAE,CAAA;AACX,CAAA;AAEA,SAASC,6BAA6BA,CAACN,UAAsB,EAAE;EAC7D,IACES,mCAAwB,CAACT,UAAU,CAAC,IACpCU,yCAA8B,CAACV,UAAU,CAAC,EAC1C;AACA,IAAA,OAAO,eAAe,CAAA;AACxB,GAAA;AAEA,EAAA,OAAO,YAAY,CAAA;AACrB;;ACtCO,SAASW,aAAaA,CAC3BhK,CAAqC,EACnB;EAClB,OAAO,QAAQ,IAAIA,CAAC,CAAA;AACtB,CAAA;AAEO,SAASiK,eAAeA,CAC7BpK,IAAY,EACZgJ,aAAgC,EAChC;AACA,EAAA,OAAOqB,uBAAuB,CAACrK,IAAI,EAAEgJ,aAAa,CAAC,CAAA;AACrD,CAAA;AAEA,SAASqB,uBAAuBA,CAC9BrK,IAAY,EACZgJ,aAAgC,EAChCsB,YAAqE,EACrE;EACA,MAAMC,YAAY,GAAGxB,kBAAkB,CACrCyB,qCAA0B,CAACxK,IAAI,CAAC,EAChCgJ,aACF,CAAC,CAAA;EAED,MAAMyB,iBAAgD,GAAGlH,cAAc,CACrEyF,aAAa,CAAC0B,uBAAuB,EACrCH,YACF,CAAC,CAAA;EAED,IAAII,SAAiC,GAAG,EAAE,CAAA;EAE1C,CAACF,iBAAiB,CAACG,SAAS,EAAEC,MAAM,IAAI,EAAE,EACvCxK,MAAM,CAAEyK,KAAK,IACZR,YAAY,GAAGA,YAAY,CAACQ,KAA6B,CAAC,GAAG,IAC/D,CAAC,CACA/H,OAAO,CAAEgI,IAAI,IAAK;AACjB,IAAA,IAAIZ,aAAa,CAACY,IAAI,CAAC,EAAE;MACvB,IAAIF,MAA8B,GAAG,EAAE,CAAA;AAEvC,MAAA,IAAIE,IAAI,CAACC,MAAM,KAAK,WAAW,EAAE;QAC/B,MAAMC,qBAAqB,GAAGZ,uBAAuB,CACnDU,IAAI,CAAChJ,MAAM,EACXiH,aACF,CAAC,CAAA;AACD6B,QAAAA,MAAM,CAACK,IAAI,CAAC,GAAGD,qBAAqB,CAAC,CAAA;AAErC,QAAA,IAAI,CAACF,IAAI,CAACI,aAAa,EAAE;AACvBN,UAAAA,MAAM,GAAGA,MAAM,CAACxK,MAAM,CAAEF,CAAC,IAAKA,CAAC,CAACwJ,IAAI,KAAK,SAAS,CAAC,CAAA;AACrD,SAAA;AAEA,QAAA,MAAMyB,MAAM,GAAGL,IAAI,CAACK,MAAM,CAAA;AAC1B,QAAA,IAAIA,MAAM,EAAE;UACVP,MAAM,GAAGA,MAAM,CAACxK,MAAM,CACnBF,CAAC,IACAA,CAAC,CAACwJ,IAAI,KAAK,SAAS,IACpByB,MAAM,CAACvJ,QAAQ,CAAC1B,CAAC,CAACkL,KAAK,IAAI,sBAAsB,CACrD,CAAC,CAAA;AACH,SAAA;AACF,OAAC,MAAM,IAAIN,IAAI,CAACC,MAAM,KAAK,OAAO,EAAE;QAClC,IAAID,IAAI,CAACO,MAAM,EAAE;AACf,UAAA,OAAA;AACF,SAAA;QAEA,MAAMC,iBAAiB,GAAGlB,uBAAuB,CAC/CU,IAAI,CAAChJ,MAAM,EACXiH,aAAa,EACZ8B,KAAK,IAAK,CAACX,aAAa,CAACW,KAAK,CAAC,IAAIA,KAAK,CAACnB,IAAI,KAAKoB,IAAI,CAACnB,SAC1D,CAAC,CAAA;AAED,QAAA,IAAI2B,iBAAiB,CAAC7L,MAAM,KAAK,CAAC,EAAE;AAClC8L,UAAAA,OAAO,CAACC,IAAI,CACV,CAAkBV,eAAAA,EAAAA,IAAI,CAACnB,SAAS,CAAA,WAAA,EAAcmB,IAAI,CAAChJ,MAAM,CAA6B0I,0BAAAA,EAAAA,iBAAiB,CAACiB,UAAU,EACpH,CAAC,CAAA;AACD,UAAA,OAAA;AACF,SAAA;AAEA,QAAA,MAAMC,WAAW,GAAG;UAClB,GAAGJ,iBAAiB,CAAC,CAAC,CAAC;AACvB,UAAA,GAAGR,IAAI,CAACa,SAAAA;SACT,CAAA;AAEDf,QAAAA,MAAM,CAACK,IAAI,CAACS,WAAW,CAAC,CAAA;AAC1B,OAAC,MAAM,IAAIZ,IAAI,CAACC,MAAM,KAAK,aAAa,EAAE;AACxC,QAAA,IAAID,IAAI,CAACc,OAAO,CAACnM,MAAM,KAAK,CAAC,EAAE;UAC7B,IAAIqL,IAAI,CAACO,MAAM,EAAE;AACf,YAAA,OAAA;AACF,WAAA;UAEA,MAAM,IAAI/L,KAAK,CACb,CAAwDkL,qDAAAA,EAAAA,iBAAiB,CAACiB,UAAU,CAAA,WAAA,EAAc1L,IAAI,CAAA,8DAAA,CACxG,CAAC,CAAA;AACH,SAAA;AAEA,QAAA,MAAMuL,iBAAiB,GAAGR,IAAI,CAACc,OAAO,CAACC,OAAO,CAAE/J,MAAM,IACpDsI,uBAAuB,CACrBtI,MAAM,EACNiH,aAAa,EACZ8B,KAAK,IAAK,CAACX,aAAa,CAACW,KAAK,CAAC,IAAIA,KAAK,CAACnB,IAAI,KAAKoB,IAAI,CAACnB,SAC1D,CACF,CAAC,CAAA;AAED,QAAA,MAAMmC,UAAU,GAAGR,iBAAiB,CAAC,CAAC,CAAC,CAAA;AACvC,QAAA,MAAMS,aAA4B,GAAG;AACnC,UAAA,GAAGD,UAAU;UACb,GAAGhB,IAAI,CAACa,SAAS;UACjBK,IAAI,EAAEV,iBAAiB,CAACO,OAAO,CAAEhB,KAAK,IAAKA,KAAK,CAACmB,IAAI,CAAA;SACtD,CAAA;AAEDpB,QAAAA,MAAM,CAACK,IAAI,CAACc,aAAa,CAAC,CAAA;AAC5B,OAAA;AAEArB,MAAAA,SAAS,GAAG,CAAC,GAAGA,SAAS,EAAE,GAAGE,MAAM,CAAC,CAAA;AACvC,KAAC,MAAM;AACLF,MAAAA,SAAS,CAACO,IAAI,CAACH,IAAqB,CAAC,CAAA;AACvC,KAAA;AACF,GAAC,CAAC,CAAA;;AAEJ;;AAEA,EAAA,MAAMmB,kBAAkB,GAAGvB,SAAS,CAACtK,MAAM,CAAEF,CAAC,IAAKA,CAAC,CAACkL,KAAK,KAAK,WAAW,CAAC,CAAA;AAC3E,EAAA,MAAMc,eAAe,GAAGxB,SAAS,CAACtK,MAAM,CAAEF,CAAC,IAAKA,CAAC,CAACkL,KAAK,KAAK,WAAW,CAAC,CAAA;AAExE,EAAA,OAAO,CAAC,GAAGa,kBAAkB,EAAE,GAAGC,eAAe,CAAC,CAAA;AACpD;;ACvIO,eAAeC,eAAeA,CAACC,UAAkB,EAAE;AACxD;AACA,EAAA,IAAIC,SAAS,CAACC,SAAS,IAAIvF,MAAM,CAACwF,eAAe,EAAE;AACjD,IAAA,MAAMF,SAAS,CAACC,SAAS,CAACE,SAAS,CAACJ,UAAU,CAAC,CAAA;AACjD,GAAC,MAAM;AACL;AACA,IAAA,MAAMK,QAAQ,GAAG7F,QAAQ,CAACxB,aAAa,CAAC,UAAU,CAAC,CAAA;IACnDqH,QAAQ,CAACjK,KAAK,GAAG4J,UAAU,CAAA;;AAE3B;AACAK,IAAAA,QAAQ,CAACpE,KAAK,CAACqE,QAAQ,GAAG,UAAU,CAAA;AACpCD,IAAAA,QAAQ,CAACpE,KAAK,CAACsE,IAAI,GAAG,WAAW,CAAA;AAEjC/F,IAAAA,QAAQ,CAACI,IAAI,CAAC4F,OAAO,CAACH,QAAQ,CAAC,CAAA;IAC/BA,QAAQ,CAACI,MAAM,EAAE,CAAA;IAEjB,IAAI;AACFjG,MAAAA,QAAQ,CAACkG,WAAW,CAAC,MAAM,CAAC,CAAA;KAC7B,CAAC,OAAOC,KAAK,EAAE;AACdxB,MAAAA,OAAO,CAACwB,KAAK,CAACA,KAAK,CAAC,CAAA;AACtB,KAAC,SAAS;MACRN,QAAQ,CAACO,MAAM,EAAE,CAAA;AACnB,KAAA;AACF,GAAA;AACF;;ACLA,MAAMC,SAAS,GAAG3E,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,0BAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAAA,CAAA,CAAA,CAAA,6BAAA,EAAA,SAAA,EAAA,GAAA,CAAA,EAGxBwE,4BAAK,CAAClG,IAAI,EACH2B,6BAAM,CAACwE,OAAO,CACxB,CAAA;AAEM,SAASC,aAAaA,CAACC,KAA0B,EAAE;AACxD,EAAA,MAAMtE,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;AACxC,EAAA,MAAMmO,OAAO,GAAGC,iCAAU,EAAE,CAAA;EAC5B,MAAM;IAAErE,IAAI;AAAEsE,IAAAA,WAAAA;AAAY,GAAC,GAAGzE,aAAa,CAAA;AAE3C,EAAA,IAAIsE,KAAK,CAACI,KAAK,CAAChO,MAAM,KAAK,CAAC,EAAE;AAC5B,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;EAEA,MAAMM,IAAI,GAAGwK,qCAA0B,CAAC8C,KAAK,CAACI,KAAK,CAAC,CAAC,CAAC,CAAC,CAAA;EACvD,MAAMjL,KAA2B,GAAGc,cAAc,CAAC4F,IAAI,CAACwE,MAAM,EAAE3N,IAAI,CAAC,CAAA;EAErE,IAAI,CAACyC,KAAK,EAAE;AACV,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;AAEA,EAAA,MAAM8H,YAAY,GAAGxB,kBAAkB,CAAC/I,IAAI,EAAEgJ,aAAa,CAAC,CAAA;EAC5D,MAAM4E,aAAa,GAAGrK,cAAc,CAClCyF,aAAa,CAAC0B,uBAAuB,EACrCH,YACF,CAAC,CAAA;AAED,EAAA,MAAMsD,SAAS,GAAGD,aAAa,CAAChD,SAAS,EAAEiD,SAAS,CAAA;AACpD,EAAA,MAAMtG,KAAK,GAAGsG,SAAS,EAAEtG,KAAK,EAAEuG,EAAE,CAAA;AAClC,EAAA,MAAMC,SAAS,GAAGF,SAAS,EAAEG,IAAI,EAAEF,EAAE,CAAA;AAErC,EAAA,MAAMzE,UAAU,GAAG4E,kCAAuB,CAACxL,KAAK,EAAEuG,aAAa,CAAC,CAAA;AAChE,EAAA,MAAMkF,UAAU,GAAG,CAAC,CAAC7E,UAAU,EAAE8E,SAAS,CAAA;AAE1C,EAAA,MAAMC,kBAAkB,GACtBF,UAAU,IACV,CAAClF,aAAa,CAACqF,QAAQ,IACvB,CAACrF,aAAa,CAACsF,sBAAsB,CAAA;AAEvC,EAAA,oBACEpP,gBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA,IAAA,eACEnG,gBAAA,CAAAmG,aAAA,CAAC6H,SAAS,EACRhO,IAAAA,eAAAA,gBAAA,CAAAmG,aAAA,cAAK,MAAI,EAAC5C,KAAK,CAAC8L,GAAS,CAAC,eAC1BrP,gBAAA,CAAAmG,aAAA,CAAA,IAAA,EAAA,IAAK,CAAC,EAEL+I,kBAAkB,iBACjBlP,gBAAA,CAAAmG,aAAA,CAACmJ,sCAAe,EAAA;IACdC,OAAO,EAAEA,MAAM;AACbzF,MAAAA,aAAa,CAAC0F,OAAO,CAACC,iBAAiB,CAAC;AACtCC,QAAAA,IAAI,EAAE,QAAQ;AACdC,QAAAA,MAAM,EAAEpM,KAAK;QACb8E,KAAK;AACLwG,QAAAA,SAAAA;AACF,OAAC,CAAC,CAAA;AACJ,KAAA;AAAE,GAAA,EACH,kBAEgB,CAClB,EAEAN,WAAW,iBACVvO,gBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AAAKiD,IAAAA,KAAK,EAAE;AAAEwG,MAAAA,UAAU,EAAE,EAAA;AAAG,KAAA;GAC3B5P,eAAAA,gBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA,IAAA,eACEnG,gBAAA,CAAAmG,aAAA,CAAC0J,oCAAa,EAAA;IACZN,OAAO,EAAE,YAAY;MACnB,IAAI;QACF,MAAMrC,eAAe,CAACpK,IAAI,CAACE,SAAS,CAACO,KAAK,CAAC,CAAC,CAAA;AAC5C8K,QAAAA,OAAO,CAACyB,OAAO,CAAC,QAAQ,CAAC,CAAA;OAC1B,CAAC,OAAOhC,KAAK,EAAE;AACdO,QAAAA,OAAO,CAACP,KAAK,CAAC,mBAAmB,CAAC,CAAA;AACpC,OAAA;AACF,KAAA;GACD,EAAA,YAEc,CACZ,CAAC,EACLvK,KAAK,CAACwM,OAAO,iBACZ/P,gBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AAAKiD,IAAAA,KAAK,EAAE;AAAEwG,MAAAA,UAAU,EAAE,EAAA;AAAG,KAAA;GAAG,EAAA,UAAQ,EAACrM,KAAK,CAACwM,OAAa,CAE3D,CAEE,CACR,CAAC,CAAA;AAEV;;ACnFO,MAAMC,MAAuB,GAAGA,CAAC;EAAEC,KAAK;EAAErE,KAAK;AAAEsE,EAAAA,QAAQ,GAAG,KAAA;AAAM,CAAC,KAAK;EAC7E,MAAMC,OAAO,GAAG,CAAC,EAAEF,KAAK,CAAC1M,KAAK,IAAI0M,KAAK,CAACE,OAAO,CAAC,CAAA;AAEhD,EAAA,MAAMC,WAAW,GAAG;AAClB,IAAA,GAAGH,KAAK;AACRI,IAAAA,MAAM,EAAE,IAAI;IACZtD,IAAI,EAAEnB,KAAK,CAACmB,IAAI;IAChBmD,QAAQ;AACR3M,IAAAA,KAAK,EAAE4M,OAAO;AACdA,IAAAA,OAAAA;GACD,CAAA;AACD,EAAA,oBACEnQ,yBAAA,CAAAmG,aAAA,CAACmK,kBAAkB,EACjBtQ,IAAAA,eAAAA,yBAAA,CAAAmG,aAAA,CAACoK,6BAAkB,EAAKH,WAAc,CACpB,CAAC,CAAA;AAEzB,CAAC,CAAA;AAED,MAAME,kBAAkB,GAAGjH,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,4BAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAGpC,CAAA,CAAA,CAAA,wCAAA,CAAA,CAAA;;AC3CD,MAAM+G,WAAW,GAAG,WAAW,CAAA;AAE/B,MAAMC,kCAAkC,GAAG,CACzC,OAAO,EACP,aAAa,EACb,QAAQ,EACR,OAAO,CACR;;ACLD,SAASC,iBAAiBA,CAACnN,KAAc,EAA4B;AACnE,EAAA,OACE,OAAOA,KAAK,KAAK,QAAQ,IACzBA,KAAK,KAAK,IAAI,IACd,WAAW,IAAIA,KAAK,IACnBA,KAAK,CAAqBoN,SAAS,CAAA;AAExC;;ACwBO,MAAMC,oBAAyD,GAAGA,CAAC;EACxEX,KAAK;EACLrE,KAAK;AACLiF,EAAAA,OAAAA;AACF,CAAC,KAAK;EACJ,MAAM;IAAEtN,KAAK;AAAEuN,IAAAA,QAAAA;AAAS,GAAC,GAAGb,KAAK,CAAA;AACjC,EAAA,MAAMc,YAAY,GAAGL,iBAAiB,CAACnN,KAAK,CAAC,CAAA;AAE7C,EAAA,MAAMyN,aAAa,GAAGH,OAAO,IAAIjF,KAAK,CAACiF,OAAO,CAAA;AAC9C,EAAA,MAAMI,uBAAuB,GAAGD,aAAa,CAAChQ,GAAG,CAACkQ,OAAO,CAAC,CAAA;AAE1D,EAAA,IAAIH,YAAY,EAAE;IAChBE,uBAAuB,CAACE,OAAO,CAC7B;AACEC,MAAAA,KAAK,EAAE,OAAO;AACd7N,MAAAA,KAAK,EAAEiN,WAAAA;AACT,KAAC,EACD;AACEa,MAAAA,SAAS,EAAE,IAAA;AACb,KACF,CAAC,CAAA;AACH,GAAA;AAEA,EAAA,MAAMC,UAAU,GAAGP,YAAY,GAAGP,WAAW,GAAGjN,KAAK,CAAA;EAErD,MAAMgO,YAAY,GAAIhO,KAAa,IAAK;IACtCuN,QAAQ,CAACvN,KAAK,CAAC,CAAA;GAChB,CAAA;AAED,EAAA,oBACEvD,yBAAA,CAAAmG,aAAA,CAACqL,6BAAM,EAAA;AAACjO,IAAAA,KAAK,EAAE+N,UAAW;AAACR,IAAAA,QAAQ,EAAES,YAAAA;AAAa,GAAA,EAC/CN,uBAAuB,CAACjQ,GAAG,CAACyQ,WAAW,CAClC,CAAC,CAAA;AAEb,CAAC,CAAA;AAED,SAASP,OAAOA,CAACQ,MAAuB,EAAU;AAChD,EAAA,IAAI,OAAOA,MAAM,KAAK,QAAQ,EAAE,OAAOA,MAAM,CAAA;EAC7C,OAAO;AAAEnO,IAAAA,KAAK,EAAEmO,MAAM;AAAEN,IAAAA,KAAK,EAAEM,MAAAA;GAAQ,CAAA;AACzC,CAAA;AAEA,SAASD,WAAWA,CAACC,MAAc,EAAE;EACnC,IAAI,WAAW,IAAIA,MAAM,EAAE;AACzB,IAAA,oBAAO1R,yBAAA,CAAAmG,aAAA,CAACwL,sCAAe,EAAA;AAAC7N,MAAAA,GAAG,EAAC,SAAA;AAAS,KAAE,CAAC,CAAA;AAC1C,GAAA;AAEA,EAAA,oBACE9D,yBAAA,CAAAmG,aAAA,CAACyL,iCAAU,EAAA;IACT9N,GAAG,EAAE4N,MAAM,CAACnO,KAAM;IAClBA,KAAK,EAAEmO,MAAM,CAACnO,KAAM;AACpBwD,IAAAA,UAAU,EAAE2K,MAAM,CAACnO,KAAK,KAAKiN,WAAAA;GAE5BkB,EAAAA,MAAM,CAACN,KACE,CAAC,CAAA;AAEjB;;AC9DO,MAAMS,UAAqC,GAAGA,CAAC;EACpD5B,KAAK;EACLrE,KAAK;AACLiF,EAAAA,OAAAA;AACF,CAAC,KAAK;EACJ,MAAM;AAAEtN,IAAAA,KAAAA;AAAM,GAAC,GAAG0M,KAAK,CAAA;AACvB,EAAA,MAAM6B,YAAY,GAAGjB,OAAO,IAAIjF,KAAK,CAACiF,OAAO,CAAA;EAC7C,MAAMkB,iBAAiB,GAAGrB,iBAAiB,CAACnN,KAAK,CAAC,GAAGoC,SAAS,GAAGpC,KAAK,CAAA;EAEtE,MAAM2N,OAAO,GAAIQ,MAAuB,IAA8B;AACpE,IAAA,IAAI,OAAOA,MAAM,KAAK,QAAQ,EAAE,OAAOA,MAAM,CAAA;IAC7C,OAAO;AAAEnO,MAAAA,KAAK,EAAEmO,MAAM;AAAEN,MAAAA,KAAK,EAAEM,MAAAA;KAAQ,CAAA;GACxC,CAAA;EAED,MAAMM,kBAAkB,GAAGF,YAAY,GAAGA,YAAY,CAAC9Q,GAAG,CAACkQ,OAAO,CAAC,GAAG,EAAE,CAAA;EAExE,OACEc,kBAAkB,iBAChBhS,yBAAA,CAAAmG,aAAA,CAAC8L,mCAAY,EAAAC,4BAAA,CAAA,EAAA,EAAKjC,KAAK,EAAA;AAAE1M,IAAAA,KAAK,EAAEwO,iBAAAA;AAAkB,GAAA,CAAA,EAC/CC,kBAAkB,CAAChR,GAAG,CAAE0Q,MAAM,IAAK;IAClC,IAAIS,IAAsD,GACxDxM,SAAS,CAAA;AAEX,IAAA,IAAI,OAAO+L,MAAM,CAACU,IAAI,KAAK,QAAQ,IAAIV,MAAM,CAACU,IAAI,IAAIC,4BAAK,EAAE;AAC3DF,MAAAA,IAAI,GAAGE,4BAAK,CAACX,MAAM,CAACU,IAAI,CAAuB,CAAA;AACjD,KAAA;AAEA,IAAA,IAAI,OAAOV,MAAM,CAACU,IAAI,KAAK,UAAU,EAAE;MACrCD,IAAI,GAAGT,MAAM,CAACU,IAAI,CAAA;AACpB,KAAA;AAEA,IAAA,oBACEpS,yBAAA,CAAAmG,aAAA,CAACmM,mCAAY,EAAA;MACXxO,GAAG,EAAE4N,MAAM,CAACnO,KAAM;AAClB6O,MAAAA,IAAI,EAAED,IAAK;MACX5O,KAAK,EAAEmO,MAAM,CAACnO,KAAM;MACpBgP,SAAS,EAAEb,MAAM,CAACa,SAAAA;AAAU,KAAA,EAE3Bb,MAAM,CAACN,KAAK,IAAIM,MAAM,CAACnO,KACZ,CAAC,CAAA;AAEnB,GAAC,CACW,CACf,CAAA;AAEL,CAAC;;AC5DM,MAAMiP,WAAkC,GAAGA,CAAC;EACjD1B,QAAQ;EACRvN,KAAK;EACLkP,IAAI;EACJxQ,GAAG;AACHyQ,EAAAA,GAAAA;AACF,CAAC,kBACC1S,gBAAA,CAAAmG,aAAA,CAACwM,4BAAK,EAAA;AACJC,EAAAA,IAAI,EAAC,QAAA;AACL;AACA;AAAA;AACAH,EAAAA,IAAI,EAAEA,IAAK;AACXlP,EAAAA,KAAK,EAAEA,KAAM;AACbuN,EAAAA,QAAQ,EAAEA,QAAS;AACnB7O,EAAAA,GAAG,EAAEA,GAAI;AACTyQ,EAAAA,GAAG,EAAEA,GAAAA;AAAI,CACV,CACF;;AClBD,MAAMG,OAAO,gBAAGC,gBAAU,CACxB,CAAC;EAAE7M,QAAQ;EAAEmD,KAAK,GAAG,EAAE;EAAE,GAAG2J,IAAAA;AAAK,CAAC,EAAElK,GAAG,KAAK;AAC1C,EAAA,oBAAOmK,qBAAY,cACjBhT,yBAAA,CAAAmG,aAAA,QAAA+L,4BAAA,CAAA;AAAK9I,IAAAA,KAAK,EAAE;AAAE,MAAA,GAAGA,KAAK;AAAE6J,MAAAA,MAAM,EAAE,MAAA;KAAS;AAACpK,IAAAA,GAAG,EAAEA,GAAAA;GAASkK,EAAAA,IAAI,GACzD9M,QACE,CAAC,EACN0B,QAAQ,CAACI,IACX,CAAC,CAAA;AACH,CACF,CAAC,CAAA;AAID,MAAMmL,WAAW,GAAG7J,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,sBAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAc1BwE,CAAAA,CAAAA,CAAAA,2JAAAA,EAAAA,cAAAA,CAAAA,EAAAA,4BAAK,CAAClG,IAAI,CAEb,CAAA;AAED,MAAMoL,YAAY,GAAG9J,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,uBAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAO9B,CAAA,CAAA,CAAA,qGAAA,CAAA,CAAA;;AC/BD,SAAS2J,UAAUA,CAAC;EAClBrM,UAAU;AACVwI,EAAAA,OAAAA;AACc,CAAC,GAAG,EAAE,EAAiB;EACrC,MAAM,CAAC8D,MAAM,EAAEC,SAAS,CAAC,GAAGrP,cAAQ,CAAC,KAAK,CAAC,CAAA;EAC3C,MAAM,CAACsP,cAAc,EAAEC,iBAAiB,CAAC,GAAGvP,cAAQ,CAClD,IACF,CAAC,CAAA;EACD,MAAM,CAACwP,cAAc,EAAEC,iBAAiB,CAAC,GAAGzP,cAAQ,CAClD,IACF,CAAC,CAAA;EACD,MAAM,CAAC0P,YAAY,EAAEC,eAAe,CAAC,GAAG3P,cAAQ,CAAqB,IAAI,CAAC,CAAA;EAE1E,MAAM;IAAE4P,MAAM;AAAEC,IAAAA,UAAAA;AAAW,GAAC,GAAGC,qBAAS,CAACR,cAAc,EAAEE,cAAc,EAAE;AACvEO,IAAAA,QAAQ,EAAE,UAAU;AACpBC,IAAAA,SAAS,EAAE,QAAQ;AACnBC,IAAAA,SAAS,EAAE,CACT;AAAEnH,MAAAA,IAAI,EAAE,OAAO;AAAE8D,MAAAA,OAAO,EAAE;AAAEsD,QAAAA,OAAO,EAAER,YAAY;AAAES,QAAAA,OAAO,EAAE,CAAA;AAAE,OAAA;KAAG,CAAA;AAErE,GAAC,CAAC,CAAA;EAEF,MAAMC,cAAc,GAAGC,yBAAiB,CACtC;IACEvN,UAAU;AACVwN,IAAAA,KAAK,EAAE,CAAA;AACT,GAAC,EACD;IACElB,MAAM;IACNmB,IAAI,EAAEA,MAAM;MACVlB,SAAS,CAAC,IAAI,CAAC,CAAA;KAChB;IACDmB,KAAK,EAAEA,MAAM;MACXnB,SAAS,CAAC,KAAK,CAAC,CAAA;AAClB,KAAA;AACF,GAAC,EACD;AAAElP,IAAAA,OAAO,EAAEmP,cAAAA;AAAe,GAC5B,CAAC,CAAA;AAED,EAAA,MAAMmB,YAAY,GAAG;AACnB7L,IAAAA,GAAG,EAAE2K,iBAAiB;IACtB,GAAGa,cAAc,CAACK,YAAY;AAC9BnF,IAAAA,OAAO,EACLA,OAAO,KAAK5J,SAAS,GACjB0O,cAAc,CAACM,YAAY,CAACpF,OAAO,GAClCtI,KAAoC,IAAK;AACxCoN,MAAAA,cAAc,CAACM,YAAY,CAACpF,OAAO,GAAGtI,KAAK,CAAC,CAAA;AAC5CsI,MAAAA,OAAO,EAAE,CAAA;AACX,KAAA;GACP,CAAA;AAED,EAAA,MAAMoF,YAAY,GAAG;AACnB9L,IAAAA,GAAG,EAAE6K,iBAAiB;IACtBtK,KAAK,EAAEyK,MAAM,CAACe,MAAM;IACpB,GAAGd,UAAU,CAACc,MAAM;AACpB,IAAA,GAAGP,cAAc,CAACM,YAAAA;GACnB,CAAA;AAED,EAAA,MAAME,UAAU,GAAG;AACjBhM,IAAAA,GAAG,EAAE+K,eAAe;IACpBxK,KAAK,EAAEyK,MAAM,CAACiB,KAAAA;GACf,CAAA;EAED,OAAO;IACLzB,MAAM;IACNqB,YAAY;IACZC,YAAY;AACZE,IAAAA,UAAAA;GACD,CAAA;AACH;;ACtBA;AACA;;AAEO,SAASE,gBAAgBA,CAG9B;EACA9O,QAAQ;EACR2F,KAAK;EACLqE,KAAK;EACL+E,MAAM;AACNC,EAAAA,MAAM,GAAG,KAAK;EACdC,WAAW;AACXC,EAAAA,aAAAA;AAC2C,CAAC,EAAE;AAC9C,EAAA,MAAMrL,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;AACxC,EAAA,MAAMkV,eAAe,GAAGvP,kBAAkB,EAAE,CAAA;AAC5C,EAAA,MAAMK,YAAY,GAAGG,qBAAqB,EAAE,CAAA;EAC5C,MAAM;IAAEgN,MAAM;IAAEsB,YAAY;IAAED,YAAY;AAAEG,IAAAA,UAAAA;GAAY,GAAGzB,UAAU,EAAE,CAAA;EAEvE,MAAM;AACJ5D,IAAAA,OAAO,EAAE;AAAE6F,MAAAA,SAAAA;KAAW;IACtBpL,IAAI;AACJqL,IAAAA,aAAAA;AACF,GAAC,GAAGxL,aAAa,CAAA;AAEjB,EAAA,MAAMyL,qBAAqB,GAAGC,gCAAgC,CAC5DC,iBAAiB,CAAC7J,KAAK,CAAC,GAAGA,KAAK,CAAC8J,YAAY,GAAG9J,KAAK,CAAC+J,SACxD,CAAC,CAAA;AAED,EAAA,MAAM5E,YAAY,GAAGL,iBAAiB,CAACT,KAAK,CAAC1M,KAAK,CAAC,CAAA;AACnD,EAAA,MAAMqS,UAAU,GAAGnV,OAAO,CAACmL,KAAK,CAACmB,IAAI,CAAC,CAAA;EAEtC,SAAS8I,sBAAsBA,GAAG;AAChCR,IAAAA,SAAS,CAAC,MAAM;MACdO,UAAU,CAAC/R,OAAO,CAAC,CAAC6G,SAAS,EAAEoL,CAAC,EAAEC,KAAK,KAAK;AAC1C,QAAA,MAAMC,eAAe,GAAG3R,cAAc,CAAC4F,IAAI,CAACwE,MAAM,EAAEsH,KAAK,CAAC,CAAC,CAAC,CAAC,CAAA;AAC7D9L,QAAAA,IAAI,CAACgM,MAAM,CAACvL,SAAS,EAAEsL,eAAe,CAAC,CAAA;AACzC,OAAC,CAAC,CAAA;AACJ,KAAC,CAAC,CAAA;AACJ,GAAA;AAEA,EAAA,MAAME,cAAc,GAAGtK,KAAK,CAACqJ,MAAM,IAAIA,MAAM,CAAA;AAE7C,EAAA,MAAMkB,OAAO,gBACXnW,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEiD,IAAAA,KAAK,EAAE;AACLf,MAAAA,KAAK,EAAE,MAAM;AACb+N,MAAAA,OAAO,EAAE,MAAM;AACfC,MAAAA,UAAU,EAAEH,cAAc,KAAK,KAAK,GAAG,UAAU,GAAG,YAAY;AAChEI,MAAAA,aAAa,EAAE,QAAA;AACjB,KAAA;AAAE,GAAA,EAED,CAACvF,YAAY,IAAKA,YAAY,IAAIwE,qBAAsB,GACvDtP,QAAQ,gBAERjG,yBAAA,CAAAmG,aAAA,CAACoQ,UAAU,EAAA;AACTZ,IAAAA,SAAS,EAAC,QAAQ;AAClBa,IAAAA,OAAO,EAAC,OAAO;AACfC,IAAAA,KAAK,EAAC,SAAS;AACflH,IAAAA,OAAO,EAAEsG,sBAAAA;GACV,EAAA,OAEW,CAEX,CACN,CAAA;AAED,EAAA,IAAIb,MAAM,EAAE;AACV,IAAA,OAAOmB,OAAO,CAAA;AAChB,GAAA;EAEA,MAAM/E,KAAK,GAAGxF,KAAK,CAACwF,KAAK,IAAInB,KAAK,CAAClD,IAAI,CAAA;EACvC,MAAM;AAAEzC,IAAAA,UAAAA;AAAW,GAAC,GAAGsB,KAAK,CAAA;EAC5B,MAAM8K,eAAe,GACnBC,+BAAoB,CAACrM,UAAU,EAAER,aAAa,CAAC8M,KAAK,CAAC,IACpDtM,UAAU,CAACsI,IAAI,KAAK,MAAM,IAAI,CAAC3C,KAAK,CAAC1M,KAAK,CAAC2B,EAAE,EAAE2F,UAAU,CAAC,QAAQ,CAAE,CAAA;AACvE,EAAA,MAAMgM,cAAc,GAAGjB,UAAU,CAAC5U,GAAG,CAAE0J,SAAS,IAC9CA,SAAS,CAAC,CAAC,CAAC,CAAC3J,KAAK,CAAC,GAAG,CAAC,CAAC+V,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAACC,IAAI,CAAC,GAAG,CAC/C,CAAC,CAAA;AACD,EAAA,MAAMC,WAAW,GAAGpB,UAAU,CAAC5U,GAAG,CAAEiW,CAAC,IAAK5S,cAAc,CAAC+Q,eAAe,EAAE6B,CAAC,CAAC,CAAC,CAAA;AAC7E,EAAA,MAAMC,OAAO,GAAGL,cAAc,CAAC7V,GAAG,CAAEoE,CAAC,IAAKf,cAAc,CAAC+Q,eAAe,EAAEhQ,CAAC,CAAC,CAAC,CAAA;EAC7E,MAAM+R,cAAc,GAAGT,eAAe,GAClCQ,OAAO,CAAClW,GAAG,CACRoE,CAAC,IACAc,YAAY,CACVkR,8CAA+B,CAC7B9B,aAAa,CAAC9U,MAAM,KAAK,CAAC,GAAG,GAAG,GAAG4E,CAAC,CAACiK,GAAG,EACxC/E,UAAU,CAACG,IAAI,EACf4M,qCAAsB,CAACpH,KAAK,CAAC1M,KAAK,CAAC,GAC/B+T,wDAAyC,CACvCrH,KAAK,CAAC1M,KAAK,EACXuG,aAAa,CAACyN,eAAe,EAC7BzN,aAAa,CAAC0N,OAChB,CAAC,EAAEtS,EAAE,GACLS,SACN,CAAC,CAEP,CAAC,GACDA,SAAS,CAAA;AAEb,EAAA,MAAM8R,4BAA4B,GAAGT,WAAW,CAAChW,GAAG,CAAEuE,CAAC,IACrDmS,sCAAuB,CAACnS,CAAC,EAAEuE,aAAa,CAACyN,eAAe,CAC1D,CAAC,CAAA;AAED,EAAA,MAAMI,sBAAsB,GAC1BjB,eAAe,IACfS,cAAc,EAAE3W,MAAM,KAAK,CAAC,IAC5BiX,4BAA4B,CAACtQ,KAAK,CAC/B5B,CAAC,IACA,CAACqS,uCAAwB,CAACrS,CAAC,CAAC,IAC5B,CAACsS,mDAAoC,CAACtS,CAAC,CAACL,EAAE,CAC9C,CAAC,CAAA;AAEH,EAAA,oBACElF,yBAAA,CAAAmG,aAAA,CAAC2R,cAAY,EAAA;AAACC,IAAAA,MAAM,EAAE,KAAM;AAAC9C,IAAAA,MAAM,EAAEiB,cAAAA;AAAe,GAAA,EACjD,CAACf,aAAa,iBACbnV,yBAAA,CAAAmG,aAAA,CAAC6R,iBAAiB,EAAA;IAACC,WAAW,EAAE/B,cAAc,KAAK,QAAA;AAAS,GAAA,EACzDhB,WAAW,GAAG;AAAE9D,IAAAA,KAAAA;GAAO,CAAC,iBACvBpR,yBAAA,CAAAmG,aAAA,CAAC+R,UAAU,EAAAhG,4BAAA,CAAA;IACTiG,OAAO,EAAE1X,OAAO,CAACmL,KAAK,CAACmB,IAAI,CAAC,CAACgK,IAAI,CAAC,GAAG,CAAE;AACvCqB,IAAAA,OAAO,EACLjB,cAAc,KAAKxR,SAAS,IAAI,OAAO,IAAIwR,cAAAA;AAC5C,GAAA,EACGzC,YAAY,CAAA,eAEhB1U,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACEiD,IAAAA,KAAK,EAAE;AACLiP,MAAAA,UAAU,EAAE,MAAM;AAClBC,MAAAA,QAAQ,EAAE,QAAQ;AAClBC,MAAAA,YAAY,EAAE,UAAA;AAChB,KAAA;AAAE,GAAA,EAEDnH,KACG,CAAC,EACNiC,MAAM,iBACLrT,yBAAA,CAAAmG,aAAA,CAAC0M,OAAO,EAAK8B,YAAY,eACvB3U,yBAAA,CAAAmG,aAAA,CAACgN,YAAY,EAAK0B,UAAa,CAAC,eAChC7U,yBAAA,CAAAmG,aAAA,CAAC+M,WAAW,QAAEtH,KAAK,CAAC4M,WAAW,IAAI5M,KAAK,CAACwF,KAAmB,CACrD,CAED,CACb,EAEAuG,sBAAsB,iBACrB3X,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEiD,IAAAA,KAAK,EAAE;AACLqP,MAAAA,UAAU,EAAE,KAAA;AACd,KAAA;AAAE,GAAA,eAEFzY,yBAAA,CAAAmG,aAAA,CAACuS,6BAAM,MAAE,CACN,CACN,EAEAxC,cAAc,KAAK,QAAQ,KACzBS,+BAAoB,CAACrM,UAAU,EAAER,aAAa,CAAC8M,KAAK,CAAC,IACpDtM,UAAU,CAACsI,IAAI,KAAK,MAAM,CAAC,IAC7B,CAAC7B,YAAY,iBACX/Q,yBAAA,CAAAmG,aAAA,CAACwS,aAAa,EAAA;AACZrO,IAAAA,UAAU,EAAEA,UAAW;AACvB/G,IAAAA,KAAK,EAAEkU,4BAA4B,CAAC,CAAC,CAAE;IACvC3G,QAAQ,EAAG8H,QAAQ,IAAK;MACtB,IAAIA,QAAQ,KAAK,wBAAwB,EAAE;AACzC,QAAA,MAAMC,aAAiC,GAAG;AACxC3T,UAAAA,EAAE,EAAE,CAAA,MAAA,EAASD,QAAQ,EAAE,CAAE,CAAA;UACzB1B,KAAK,EAAE,EAAE;AACTqV,UAAAA,QAAAA;SACD,CAAA;AAED3I,QAAAA,KAAK,CAACa,QAAQ,CAAC+H,aAAa,CAAC,CAAA;AAC7B,QAAA,OAAA;AACF,OAAA;AAEA,MAAA,IAAIxB,qCAAsB,CAACpH,KAAK,CAAC1M,KAAK,CAAC,EAAE;AACvC,QAAA,MAAMsV,aAAsD,GAC1D;UACE,GAAG5I,KAAK,CAAC1M,KAAK;UACd,CAACuG,aAAa,CAACyN,eAAe,GAAG;AAC/BrS,YAAAA,EAAE,EAAE,IAAI;AACR0T,YAAAA,QAAAA;AACF,WAAA;SACD,CAAA;AAEH3I,QAAAA,KAAK,CAACa,QAAQ,CAAC+H,aAAa,CAAC,CAAA;AAC/B,OAAC,MAAM;AACL,QAAA,MAAMA,aAAgC,GAAG;AACvC3T,UAAAA,EAAE,EAAE,IAAI;AACR0T,UAAAA,QAAAA;SACD,CAAA;AAED3I,QAAAA,KAAK,CAACa,QAAQ,CAAC+H,aAAa,CAAC,CAAA;AAC/B,OAAA;KACA;AACFC,IAAAA,eAAe,EAAElD,UAAU,CAACnT,IAAI,CAC7BwU,CAAC,IAAKA,CAAC,CAAClW,KAAK,CAAC,GAAG,CAAC,CAACP,MAAM,KAAK,CACjC,CAAA;AAAE,GACH,CAEY,CACpB,eAEDR,yBAAA,CAAAmG,aAAA,CAAC4S,iBAAiB,EAAA;AAAC9D,IAAAA,MAAM,EAAEiB,cAAAA;AAAe,GAAA,EAAEC,OAA2B,CAAC,EAEvE,CAACzF,iBAAiB,IACjBgG,eAAe,IACfS,cAAc,CAAE3W,MAAM,GAAG,CAAC,IAC1B,OAAO,IAAI2W,cAAc,CAAE,CAAC,CAAC,iBAC3BnX,yBAAA,CAAAmG,aAAA,CAAC6S,UAAU,EAAE7B,IAAAA,EAAAA,cAAc,CAAE,CAAC,CAAC,CAACrJ,KAAK,CAACpI,OAAoB,CAElD,CAAC,CAAA;AAEnB,CAAA;AAEA,SAASiT,aAAaA,CAAC;EACrBpV,KAAK;EACLuN,QAAQ;EACRxG,UAAU;AACVwO,EAAAA,eAAAA;AAMF,CAAC,EAAE;AACD,EAAA,MAAMhP,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;EACxC,MAAM,CAAC+Y,gBAAgB,EAAEC,mBAAmB,CAAC,GAAGjV,cAAQ,CAACV,KAAK,CAACqV,QAAQ,CAAC,CAAA;EAExE,MAAMO,OAAO,GACXrP,aAAa,CAAC8M,KAAK,CAACtM,UAAU,CAACsI,IAAI,CAAC,CACpCuG,OAAO,CAAA;EACT,MAAMC,gBAAgB,GAAGN,eAAe,GACpCK,OAAO,CAAChY,MAAM,CAAEkY,CAAC,IAAK;AACpB,IAAA,OAAOA,CAAC,CAACnU,EAAE,KAAK,2BAA2B,CAAA;AAC7C,GAAC,CAAC,GACF,CAAC,GAAGiU,OAAO,CAAC,CAAA;AAEhB,EAAA,IAAI7O,UAAU,CAACsI,IAAI,KAAK,MAAM,EAAE;IAC9BwG,gBAAgB,CAACjI,OAAO,CAAC;AACvBjM,MAAAA,EAAE,EAAE,wBAAwB;AAC5BkM,MAAAA,KAAK,EAAE,YAAY;MACnBuE,SAAS,EAAEA,MAAM;AACf,QAAA,OAAO,IAAI,CAAA;AACb,OAAA;AACF,KAAC,CAAC,CAAA;AACJ,GAAA;AAEA,EAAA,IAAIyD,gBAAgB,CAAC5Y,MAAM,IAAI,CAAC,EAAE;AAChC,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;EAEA,oBACER,yBAAA,CAAAmG,aAAA,CAACmT,qBAAqB,qBACpBtZ,yBAAA,CAAAmG,aAAA,CAACqL,6BAAM,EAAA;AACLjO,IAAAA,KAAK,EAAE0V,gBAAiB;IACxBnI,QAAQ,EAAG8H,QAAQ,IAAK;MACtBM,mBAAmB,CAACN,QAAQ,CAAC,CAAA;MAC7B9H,QAAQ,CAAC8H,QAAQ,CAAC,CAAA;AACpB,KAAA;AAAE,GAAA,EAEDQ,gBAAgB,CAACpY,GAAG,CAAEuY,MAAM,IAAK;AAChC,IAAA,oBACEvZ,yBAAA,CAAAmG,aAAA,CAACyL,iCAAU,EAAA;MAACrO,KAAK,EAAEgW,MAAM,CAACrU,EAAG;MAACpB,GAAG,EAAEyV,MAAM,CAACrU,EAAAA;AAAG,KAAA,EAC1CqU,MAAM,CAACnI,KAAK,IAAImI,MAAM,CAACrU,EACd,CAAC,CAAA;GAEhB,CACK,CACa,CAAC,CAAA;AAE5B,CAAA;AAEA,SAASuQ,iBAAiBA,CACxB7J,KAAoB,EACgB;EACpC,OACE,OAAOA,KAAK,CAAC+J,SAAS,KAAK,QAAQ,IAAI/J,KAAK,CAAC+J,SAAS,KAAK,aAAa,CAAA;AAE5E,CAAA;AAEA,SAASH,gCAAgCA,CACvCG,SAAqC,EAC5B;AACT,EAAA,IAAI,OAAOA,SAAS,KAAK,QAAQ,EAAE;AACjC,IAAA,OAAOlF,kCAAkC,CAAC9N,QAAQ,CAACgT,SAAS,CAAC,CAAA;AAC/D,GAAA;AAEA,EAAA,OAAO,KAAK,CAAA;AACd,CAAA;AAEA,MAAMY,UAAU,GAAGlN,uBAAM,CAACmQ,iCAAU,CAAC,CAAAjQ,UAAA,CAAA;EAAAC,WAAA,EAAA,+BAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAYpC,CAAA,CAAA,CAAA,mIAAA,CAAA,CAAA,CAAA;AAEM,SAASgQ,kBAAkBA,CAIhCC,KAAuE,EACvEC,UAAwC,EACxC;AACA,EAAA,OAAQvL,KAAkD,IAAK;IAC7D,oBACEpO,yBAAA,CAAAmG,aAAA,CAAC4O,gBAAgB,EAAA7C,4BAAA,KAAK9D,KAAK,EAAMuL,UAAU,CACzC3Z,eAAAA,yBAAA,CAAAmG,aAAA,CAACuT,KAAK,EAAKtL,KAAQ,CACH,CAAC,CAAA;GAEtB,CAAA;AACH,CAAA;AAOA,MAAM0J,cAAY,GAAGzO,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,iCAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAAA,CAAA,CAAA,CAAA,8BAAA,EAAA,OAAA,EAAA,wDAAA,EAAA,sCAAA,CAAA,EAEX,CAAC;AAAEwL,EAAAA,MAAAA;AAAO,CAAC,KAAKA,MAAM,EACjC,CAAC;AAAEA,EAAAA,MAAAA;AAAO,CAAC,KAAMA,MAAM,KAAK,KAAK,GAAG,MAAM,GAAG,KAAM,EAGxD,CAAC;AAAEA,EAAAA,MAAAA;AAAO,CAAC,KACXA,MAAM,KAAK,QAAQ,IACnB2E,oBAAG,kBAEF,CAGJ,CAAA;AAED,MAAM5B,iBAAiB,GAAG3O,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,sCAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAAA,CAAA,CAAA,CAAA,iFAAA,EAAA,mCAAA,CAAA,EAMhC,CAAC;AAAEwO,EAAAA,WAAAA;AAAY,CAAC,KAAKA,WAAW,IAAI;AAAE5P,EAAAA,KAAK,EAAE,MAAA;AAAO,CAAC,CAGxD,CAAA;AAMD,MAAM6P,UAAU,GAAG7O,uBAAM,CAAC+H,KAAK,CAAA7H,UAAA,CAAA;EAAAC,WAAA,EAAA,+BAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAAA,CAAA,CAAA,CAAA,YAAA,EAAA,SAAA,EAAA,yDAAA,CAAA,EAE3BwE,4BAAK,CAAClG,IAAI,EACH,CAAC;AAAEqQ,EAAAA,OAAAA;AAAQ,CAAC,KAAMA,OAAO,GAAG,KAAK,GAAG,MAAO,CAIrD,CAAA;AAED,MAAMkB,qBAAqB,GAAGjQ,uBAAM,CAACwQ,IAAI,CAAAtQ,UAAA,CAAA;EAAAC,WAAA,EAAA,0CAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAYxC,CAAA,CAAA,CAAA,wHAAA,CAAA,CAAA,CAAA;AAED,MAAMuP,UAAU,GAAG3P,uBAAM,CAACwQ,IAAI,CAAAtQ,UAAA,CAAA;EAAAC,WAAA,EAAA,+BAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAM7B,CAAA,CAAA,CAAA,uHAAA,CAAA,CAAA,CAAA;AAMD,MAAMsP,iBAAiB,GAAG1P,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,sCAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAAA,CAAA,CAAA,CAAA,2DAAA,EAAA,mBAAA,CAAA,EAKhC,CAAC;AAAEwL,EAAAA,MAAAA;AAAO,CAAC,KACXA,MAAM,KAAK,KAAK,GACZ2E,oBAAG,CAAA,CAAA,cAAA,CAAA,CAAA,GAGHA,oBAAG,CAAA,CAAA,aAAA,CAAA,CAEF,CAER;;ACldM,MAAM7W,OAAK,GAAIQ,KAAc,IAAKA,KAAK,IAAI,CAACA,KAAK;;ACKxD,MAAMuW,WAAW,GAAGL,kBAAkB,CAKnC,CAAC;EAAExJ,KAAK;AAAErE,EAAAA,KAAAA;AAAM,CAAC,KAAK;EACvB,oBACE5L,yBAAA,CAAAmG,aAAA,CAAC4T,WAAe,EAAA7H,4BAAA,KACVjC,KAAK,EAAA;IACTwC,IAAI,EAAE7G,KAAK,CAAC6G,IAAK;IACjBxQ,GAAG,EAAE2J,KAAK,CAAC3J,GAAI;IACfyQ,GAAG,EAAE9G,KAAK,CAAC8G,GAAAA;AAAI,GAAA,CAChB,CAAC,CAAA;AAEN,CAAC,CAAC,CAAA;AAEK,MAAMsH,iBAAiB,GAAG;AAC/BjN,EAAAA,IAAI,EAAE,QAAQ;AACdkN,EAAAA,SAAS,EAAEH,WAAW;AACtB/W,SAAAA,OAAAA;AACF,CAAC;;ACzBM,MAAMA,KAAK,GAAIQ,KAAc,IAAKA,KAAK,IAAI,EAAE;;ACIpD,MAAM2W,WAAW,GAAGT,kBAAkB,CAAC7I,oBAAoB,CAAC,CAAA;AAErD,MAAMuJ,iBAAiB,GAAG;AAC/BpN,EAAAA,IAAI,EAAE,QAAQ;AACd6F,EAAAA,IAAI,EAAE,QAAQ;AACdqH,EAAAA,SAAS,EAAEC,WAAW;AACtBnX,EAAAA,KAAAA;AACF,CAAC;;ACRD,MAAMqX,eAAe,GAAGX,kBAAkB,CAAC5H,UAAU,CAAC,CAAA;AAE/C,MAAMwI,qBAAqB,GAAG;AACnCtN,EAAAA,IAAI,EAAE,aAAa;AACnBkN,EAAAA,SAAS,EAAEG,eAAAA;AACb,CAAC;;ACgBD,SAASE,SAASA,CAAC;EAAErK,KAAK;EAAErE,KAAK;AAAEoJ,EAAAA,MAAAA;AAAuB,CAAC,EAAE;AAC3D,EAAA,MAAMlL,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;EACxC,MAAM;IAAEqD,KAAK;IAAEuN,QAAQ;IAAE,GAAGyJ,mBAAAA;AAAoB,GAAC,GAAGtK,KAAK,CAAA;EAEzD,MAAMuK,UAAU,GAAGC,uBAAY,CAC7BlX,KAAK,EACLuN,QAAQ,EACRhH,aAAa,CAAC4Q,aAAa,CAACC,MAAM,EAClC7Q,aAAa,CAAC8Q,OAAO,EACrBhP,KAAK,CAACiP,WAAW,EACjBjP,KAAK,CAACkP,SACR,CAAC,CAAA;EAED,MAAMC,gBAAgB,GAAGnP,KAAK,CAACtB,UAAU,CAACsI,IAAI,KAAK,MAAM,CAAA;AAEzD,EAAA,oBACE5S,yBAAA,CAAAmG,aAAA,CAAC4O,gBAAgB,EAAA;AACf9E,IAAAA,KAAK,EAAEA,KAAM;AACbrE,IAAAA,KAAK,EAAEA,KAAM;AACbqJ,IAAAA,MAAM,EAAE8F,gBAAgB,GAAG,QAAQ,GAAG,KAAM;AAC5C/F,IAAAA,MAAM,EAAEA,MAAAA;GAERhV,eAAAA,yBAAA,CAAAmG,aAAA,CAACwM,4BAAK,EAAAT,4BAAA,CAAA,EAAA,EACAqI,mBAAmB,EACnBC,UAAU,EAAA;AACdQ,IAAAA,WAAW,EAAC,YAAY;AACxBC,IAAAA,KAAK,EAAE,CAACF,gBAAgB,GAAG,OAAO,GAAG,MAAO;AAC5CG,IAAAA,UAAU,EAAEH,gBAAAA;AAAiB,GAAA,CAC9B,CACe,CAAC,CAAA;AAEvB,CAAA;AAEO,MAAMI,eAAe,GAAG;AAC7BpO,EAAAA,IAAI,EAAE,MAAM;AACZkN,EAAAA,SAAS,EAAEK,SAAS;AACpBvX,EAAAA,KAAAA;AACF,CAAC;;AC1DD,MAAMqY,WAAW,GAAG3B,kBAAkB,CAACzJ,MAAM,CAAC,CAAA;AAEvC,MAAMqL,iBAAiB,GAAG;AAC/BtO,EAAAA,IAAI,EAAE,QAAQ;AACd6F,EAAAA,IAAI,EAAE,UAAU;AAChBqH,EAAAA,SAAS,EAAEmB,WAAAA;AACb,CAAC;;AC0CD,MAAME,mBAAmB,GAAG,YAAY,CAAA;AAExC,SAASC,mBAAmBA,CAC1BC,WAA6D,EAC7DjY,KAAa,EACb;AACA,EAAA,KAAK,IAAIb,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG8Y,WAAW,CAAChb,MAAM,EAAEkC,CAAC,EAAE,EAAE;AAC3C,IAAA,MAAM+Y,UAAU,GAAGD,WAAW,CAAC9Y,CAAC,CAAC,CAAA;AACjC,IAAA,IAAI,OAAO+Y,UAAU,KAAK,QAAQ,EAAE;MAClC,IAAIA,UAAU,KAAKlY,KAAK,EAAE;AACxB,QAAA,OAAO,IAAI,CAAA;AACb,OAAA;AACF,KAAC,MAAM;AACL,MAAA,IAAIkY,UAAU,CAAClY,KAAK,KAAKA,KAAK,EAAE;AAC9B,QAAA,OAAO,IAAI,CAAA;AACb,OAAA;AACF,KAAA;AACF,GAAA;AACA,EAAA,OAAO,KAAK,CAAA;AACd,CAAA;AAOA,SAASmY,aAAaA,GAAqB;AACzC,EAAA,MAAM5R,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;AAExC,EAAA,MAAMyb,UAAU,GAAGhY,MAAM,CAACiY,WAAW,CACnCjY,MAAM,CAACkY,OAAO,CAAC/R,aAAa,CAAC8M,KAAK,CAAC,CAACzV,MAAM,CAItC2a,mBAAmB,IAC2C;AAC9D,IAAA,OAAOA,mBAAmB,CAAC,CAAC,CAAC,CAAClJ,IAAI,KAAK,OAAO,CAAA;AAChD,GACF,CACF,CAAC,CAAA;AAED,EAAA,OAAO+I,UAAU,CAAA;AACnB,CAAA;AAEA,SAASI,mBAAmBA,CAAgC;EAC1D9L,KAAK;AACLrE,EAAAA,KAAAA;AAC2B,CAAC,EAAE;AAC9B,EAAA,MAAM9B,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;AACxC,EAAA,MAAMyb,UAAU,GAAGD,aAAa,EAAE,CAAA;EAClC,MAAMM,mBAAmB,GAAGL,UAAU,CAAC/P,KAAK,CAACtB,UAAU,CAACsI,IAAI,CAAC,CAAA;EAC7D,MAAMqJ,oBAAoB,GAAGrQ,KAAK,CAACqQ,oBAAoB,KAAMhb,CAAS,IAAKA,CAAC,CAAC,CAAA;AAC7E,EAAA,MAAMib,WAAW,GAAGtQ,KAAK,CAACsQ,WAAW,IAAI,KAAK,CAAA;AAC9C,EAAA,MAAMV,WAAW,GAAG5P,KAAK,CAAC4P,WAAW,IAAI,EAAE,CAAA;AAE3C,EAAA,MAAM,CAAClK,UAAU,EAAE6K,aAAa,CAAC,GAAGlY,cAAQ,CAC1CyM,iBAAiB,CAACT,KAAK,CAAC1M,KAAK,CAAC,GAAG,EAAE,GAAG0M,KAAK,CAAC1M,KAAK,EAAEA,KAAK,CAACiC,QAAQ,EAAE,IAAI,EACzE,CAAC,CAAA;AAED,EAAA,MAAM4W,uBAAuB,GAAGjY,YAAM,CAA0B,IAAI,CAAC,CAAA;AAErE,EAAA,MAAM0M,OAAO,GAAGlN,MAAM,CAACkY,OAAO,CAACjQ,KAAK,CAACyQ,MAAM,CAAC,CAACrb,GAAG,CAAC,CAAC,CAACsb,OAAO,EAAEC,UAAU,CAAC,KAAK;AAC1E,IAAA,IAAIP,mBAAmB,CAACQ,KAAK,KAAK,OAAO,EAAE;MACzC,MAAMC,cAAc,GAAGC,iBAAiB,CACtCJ,OAAO,EACPC,UAAU,EACVzS,aACF,CAAC,CAAA;MAED,OAAO;AACL5E,QAAAA,EAAE,EAAEoX,OAAO;AACXlL,QAAAA,KAAK,EAAEqL,cAAAA;OACR,CAAA;AACH,KAAA;IAEA,OAAO;AACLvX,MAAAA,EAAE,EAAEoX,OAAO;AACXlL,MAAAA,KAAK,EAAEmL,UAAU,CAACnL,KAAK,IAAIkL,OAAAA;KAC5B,CAAA;AACH,GAAC,CAAC,CAAA;;AAEF;EACA,IAAI1Q,KAAK,CAAC4P,WAAW,EAAE;AACrB5P,IAAAA,KAAK,CAAC4P,WAAW,CAAC3X,OAAO,CAAE4X,UAAU,IAAK;AACxC,MAAA,IAAI,OAAOA,UAAU,KAAK,QAAQ,EAAE;QAClC5K,OAAO,CAAC7E,IAAI,CAAC;AACX9G,UAAAA,EAAE,EAAEuW,UAAU;AACdrK,UAAAA,KAAK,EAAEqK,UAAAA;AACT,SAAC,CAAC,CAAA;AACJ,OAAC,MAAM;QACL5K,OAAO,CAAC7E,IAAI,CAAC;UACX9G,EAAE,EAAEuW,UAAU,CAAClY,KAAK;UACpB6N,KAAK,EAAEqK,UAAU,CAACrK,KAAAA;AACpB,SAAC,CAAC,CAAA;AACJ,OAAA;AACF,KAAC,CAAC,CAAA;AACJ,GAAA;;AAEA;AACA,EAAA,IACE,CAACV,iBAAiB,CAACT,KAAK,CAAC1M,KAAK,CAAC,IAC/B,OAAO0M,KAAK,CAAC1M,KAAK,CAAC+Y,OAAO,KAAK,QAAQ,IACvC,CAAC1Q,KAAK,CAACyQ,MAAM,CAACpM,KAAK,CAAC1M,KAAK,CAAC+Y,OAAO,CAAC,EAClC;IACAzL,OAAO,CAACM,OAAO,CAAC;AACdjM,MAAAA,EAAE,EAAE+K,KAAK,CAAC1M,KAAK,CAAC+Y,OAAO;AACvBlL,MAAAA,KAAK,EAAE,CAAanB,UAAAA,EAAAA,KAAK,CAAC1M,KAAK,CAAC+Y,OAAO,CAAA,CAAA;AACzC,KAAC,CAAC,CAAA;AACJ,GAAA;EAEA,MAAMK,oBAAoB,GACxB,CAACjM,iBAAiB,CAACT,KAAK,CAAC1M,KAAK,CAAC,IAC/B,CAAC0M,KAAK,CAAC1M,KAAK,CAAC+Y,OAAO,IACpBf,mBAAmB,CACjBC,WAAW,EACXoB,6CAA8B,CAC5B3M,KAAK,CAAC1M,KAAK,CAACA,KAAK,EACjBuG,aAAa,CAACyN,eAAe,EAC7BzN,aAAa,CAAC0N,OAAO,EACrBqF,+BAAgB,CACd/S,aAAa,CAAC0N,OAChB,CAAC,+CAEL,CAAC,CAAA;EAEH,MAAMsF,0BAA0B,GAC9B,CAACpM,iBAAiB,CAACT,KAAK,CAAC1M,KAAK,CAAC,IAC/B,EAAE0M,KAAK,CAAC1M,KAAK,CAAC+Y,OAAO,IAAIK,oBAAoB,CAAC,IAC9CT,WAAW,CAAA;EAEb,MAAMa,WAAW,GAAGrM,iBAAiB,CAACT,KAAK,CAAC1M,KAAK,CAAC,GAC9CiN,WAAW,GACXP,KAAK,CAAC1M,KAAK,CAAC+Y,OAAO,KAClBK,oBAAoB,GAChB1M,KAAK,CAAC1M,KAAK,CAACA,KAAK,GAClB+X,mBAAmB,CAAC,CAAA;EAE5B,MAAM0B,cAAc,GAAIC,aAAqB,IAAK;IAChD,IAAIA,aAAa,KAAK3B,mBAAmB,EAAE;AACzC,MAAA,IAAI5K,iBAAiB,CAACT,KAAK,CAAC1M,KAAK,CAAC,EAAE;QAClC0M,KAAK,CAACa,QAAQ,CAAC;AACbvN,UAAAA,KAAK,EAAE,EAAE;AACTqV,UAAAA,QAAQ,EAAEoD,mBAAmB,CAACzC,MAAM,EAAErU,EAAAA;AACxC,SAAC,CAAC,CAAA;QACFiX,aAAa,CAAC,EAAE,CAAC,CAAA;AACjB,QAAA,OAAA;AACF,OAAA;AAEA,MAAA,IAAI5Y,KAAK,GAAG0M,KAAK,CAAC1M,KAAK,CAACA,KAAK,CAAA;;AAE7B;AACA,MAAA,IAAI8T,qCAAsB,CAAC9T,KAAK,CAAC,EAAE;AACjCA,QAAAA,KAAK,GAAGqZ,6CAA8B;AACpC;AACArZ,QAAAA,KAAK,EACLuG,aAAa,CAACyN,eAAe,EAC7BzN,aAAa,CAAC0N,OAAO,EACrBqF,+BAAgB,CACd/S,aAAa,CAAC0N,OAChB,CAAC,+CACQ,CAAA;AACb,OAAA;MAEAvH,KAAK,CAACa,QAAQ,CAAC;QACbvN,KAAK;AACLqV,QAAAA,QAAQ,EAAE3I,KAAK,CAAC1M,KAAK,CAACqV,QAAAA;AACxB,OAAC,CAAC,CAAA;MACFuD,aAAa,CAAC5Y,KAAK,CAAC,CAAA;AAEpB2Z,MAAAA,cAAc,CAAC,MAAM;AACnBd,QAAAA,uBAAuB,CAAChY,OAAO,EAAE+Y,KAAK,EAAE,CAAA;AAC1C,OAAC,CAAC,CAAA;KACH,MAAM,IAAI5B,mBAAmB,CAACC,WAAW,EAAEyB,aAAa,CAAC,EAAE;MAC1DhN,KAAK,CAACa,QAAQ,CAAC;AACbvN,QAAAA,KAAK,EAAE0Z,aAAa;AACpBrE,QAAAA,QAAQ,EAAEoD,mBAAmB,CAACzC,MAAM,EAAErU,EAAAA;AACxC,OAAC,CAAC,CAAA;AACJ,KAAC,MAAM;MACL+K,KAAK,CAACa,QAAQ,CAAC;AACbwL,QAAAA,OAAO,EAAEW,aAAa;QACtB1Z,KAAK,EAAEqI,KAAK,CAACyQ,MAAM,CAACY,aAAa,CAAC,CAAC1Z,KAAK;AACxCqV,QAAAA,QAAQ,EAAEoD,mBAAmB,CAACzC,MAAM,EAAErU,EAAAA;AACxC,OAAC,CAAC,CAAA;AACJ,KAAA;GACD,CAAA;AAED,EAAA,MAAMkY,0BAA0B,GAAGpB,mBAAmB,EAAEzC,MAAM,EAAE5D,SAEnD,CAAA;EAEb,MAAM0H,kBAAkB,GAAGP,0BAA0B,gBACnD9c,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA,IAAA,eACEnG,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AAAKiD,IAAAA,KAAK,EAAE;AAAEd,MAAAA,MAAM,EAAE,CAAA;AAAE,KAAA;GAAI,CAAC,EAC5B8U,0BAA0B,gBACzBpd,yBAAA,CAAAmG,aAAA,CAACiX,0BAA0B,EAAA;AACzB7Z,IAAAA,KAAK,EAAE+N,UAAW;IAClBR,QAAQ,EAAGvN,KAAK,IAAK;MACnB0M,KAAK,CAACa,QAAQ,CAAC;QACbvN,KAAK;AACLqV,QAAAA,QAAQ,EAAEoD,mBAAmB,CAACzC,MAAM,EAAErU,EAAAA;AACxC,OAAC,CAAC,CAAA;KACF;AACFoY,IAAAA,MAAM,EACJ,QAAQ,IAAI1R,KAAK,CAACtB,UAAU,GAAGsB,KAAK,CAACtB,UAAU,CAACgT,MAAM,GAAG3X,SAAAA;AAC1D,GACF,CAAC,gBAEF3F,yBAAA,CAAAmG,aAAA,CAACwM,4BAAK,EAAA;AACJpP,IAAAA,KAAK,EAAE+N,UAAW;IAClBR,QAAQ,EAAGyM,CAAsC,IAAK;AACpDpB,MAAAA,aAAa,CAACoB,CAAC,CAACC,MAAM,CAACja,KAAK,CAAC,CAAA;KAC7B;IACFka,MAAM,EAAEA,MAAM;AACZ,MAAA,MAAMC,eAAe,GAAGzB,oBAAoB,CAAC3K,UAAU,CAAC,CAAA;MACxD6K,aAAa,CAACuB,eAAe,CAAC,CAAA;MAC9BzN,KAAK,CAACa,QAAQ,CAAC;AACbvN,QAAAA,KAAK,EAAEma,eAAAA;AACT,OAAC,CAAC,CAAA;KACF;AACF7U,IAAAA,GAAG,EAAEuT,uBAAwB;AAC7BnB,IAAAA,KAAK,EAAE,OAAA;GACR,CAEA,CAAC,GACJ,IAAI,CAAA;AAER,EAAA,IAAIe,mBAAmB,CAACQ,KAAK,KAAK,QAAQ,EAAE;IAC1C,oBACExc,yBAAA,CAAAmG,aAAA,CAACwX,cAAQ,qBACP3d,yBAAA,CAAAmG,aAAA,CAACqL,6BAAM,EAAA;AAACjO,MAAAA,KAAK,EAAEwZ,WAAY;AAACjM,MAAAA,QAAQ,EAAEkM,cAAAA;AAAe,KAAA,EAClDtM,iBAAiB,CAACT,KAAK,CAAC1M,KAAK,CAAC,iBAC7BvD,yBAAA,CAAAmG,aAAA,CAAAnG,yBAAA,CAAA2d,QAAA,EAAA,IAAA,eACE3d,yBAAA,CAAAmG,aAAA,CAACyX,oBAAoB,EAAA;AAACra,MAAAA,KAAK,EAAEiN,WAAY;MAACzJ,UAAU,EAAA,IAAA;KAAC,EAAA,OAE/B,CAAC,eACvB/G,yBAAA,CAAAmG,aAAA,CAACwL,sCAAe,EAAA,IAAE,CAClB,CACH,eAEC3R,yBAAA,CAAAmG,aAAA,CAACwX,cAAQ,EAAA,IAAA,EACN9M,OAAO,CAAC7P,GAAG,CAAE6c,CAAC,IAAK;AAClB,MAAA,oBACE7d,yBAAA,CAAAmG,aAAA,CAACyX,oBAAoB,EAAA;QACnB9Z,GAAG,EAAE+Z,CAAC,CAAC3Y,EAAG;QACV3B,KAAK,EAAEsa,CAAC,CAAC3Y,EAAAA;AACT;AAAA;AACA4Y,QAAAA,YAAY,EACTlS,KAAK,CAACyQ,MAAM,CAACwB,CAAC,CAAC3Y,EAAE,CAAC,EAAE3B,KAAK,IAERsa,CAAC,CAAC3Y,EAAAA;OAGrB2Y,EAAAA,CAAC,CAACzM,KACiB,CAAC,CAAA;KAE1B,CAAC,EACD8K,WAAW,iBACVlc,yBAAA,CAAAmG,aAAA,CAAAnG,yBAAA,CAAA2d,QAAA,EAAA,IAAA,eACE3d,yBAAA,CAAAmG,aAAA,CAACwL,sCAAe,EAAE,IAAA,CAAC,eACnB3R,yBAAA,CAAAmG,aAAA,CAACyX,oBAAoB,EAAA;AACnBra,MAAAA,KAAK,EAAE+X,mBAAoB;MAC3BwC,YAAY,EACVf,WAAW,KAAKzB,mBAAmB,GAE7BrL,KAAK,CAAC1M,KAAK,CAIXA,KAAK,GACPoC,SAAAA;AACL,KAAA,EACF,QAEqB,CACtB,CAEI,CAEN,CAAC,EACR0X,kBACO,CAAC,CAAA;AAEf,GAAA;EAEA,oBACErd,yBAAA,CAAAmG,aAAA,CAAC4X,IAAI,qBACH/d,yBAAA,CAAAmG,aAAA,CAACqL,6BAAM,EAAA;AAACjO,IAAAA,KAAK,EAAEwZ,WAAY;AAACjM,IAAAA,QAAQ,EAAEkM,cAAAA;AAAe,GAAA,EAClDtM,iBAAiB,CAACT,KAAK,CAAC1M,KAAK,CAAC,iBAC7BvD,yBAAA,CAAAmG,aAAA,CAAAnG,yBAAA,CAAA2d,QAAA,EAAA,IAAA,eACE3d,yBAAA,CAAAmG,aAAA,CAACyL,iCAAU,EAAA;AAACrO,IAAAA,KAAK,EAAEiN,WAAY;IAACzJ,UAAU,EAAA,IAAA;AAAA,GAAA,EAAC,OAE/B,CAAC,eACb/G,yBAAA,CAAAmG,aAAA,CAACwL,sCAAe,EAAE,IAAA,CAClB,CACH,EAEAoL,WAAW,KAAKzB,mBAAmB,IAAI,CAACY,WAAW,iBAClDlc,yBAAA,CAAAmG,aAAA,CAAAnG,yBAAA,CAAA2d,QAAA,EACE3d,IAAAA,eAAAA,yBAAA,CAAAmG,aAAA,CAACyL,iCAAU,EAAA;AAACrO,IAAAA,KAAK,EAAE+X,mBAAoB;IAACvU,UAAU,EAAA,IAAA;GAAC,EAAA,QAEvC,CAAC,eACb/G,yBAAA,CAAAmG,aAAA,CAACwL,sCAAe,EAAA,IAAE,CAClB,CACH,eAEC3R,yBAAA,CAAAmG,aAAA,CAACwX,cAAQ,EAAA,IAAA,EACN9M,OAAO,CAAC7P,GAAG,CAAE6c,CAAC,IAAK;AAClB,IAAA,oBACE7d,yBAAA,CAAAmG,aAAA,CAACyL,iCAAU,EAAA;MAAC9N,GAAG,EAAE+Z,CAAC,CAAC3Y,EAAG;MAAC3B,KAAK,EAAEsa,CAAC,CAAC3Y,EAAAA;KAC7B2Y,EAAAA,CAAC,CAACzM,KACO,CAAC,CAAA;GAEhB,CAAC,EACD8K,WAAW,iBACVlc,yBAAA,CAAAmG,aAAA,CAAAnG,yBAAA,CAAA2d,QAAA,EAAA,IAAA,eACE3d,yBAAA,CAAAmG,aAAA,CAACwL,sCAAe,EAAE,IAAA,CAAC,eACnB3R,yBAAA,CAAAmG,aAAA,CAACyL,iCAAU,EAAA;AAACrO,IAAAA,KAAK,EAAE+X,mBAAAA;AAAoB,GAAA,EAAC,QAAkB,CAC1D,CAEI,CAEN,CAAC,EACR+B,kBACG,CAAC,CAAA;AAEX,CAAA;AAEA,SAASX,iBAAiBA,CACxB3P,IAAY,EACZyP,KAAiC,EACjC1S,aAAgC,EAChC;AACA,EAAA,MAAMkU,yBAAyB,GAAGC,kCAAmB,CACnDzB,KAAK,CAACjZ,KAAK,EACXuG,aAAa,CAAC0N,OAAO,EACrBqF,+BAAgB,CAAC/S,aAAa,CAAC0N,OAAO,CACxC,CAAC,CAAA;EAED,MAAM0G,sBAAsB,GAAGxG,sCAAuB,CACpDsG,yBAAyB,EACzBlU,aAAa,CAACyN,eAChB,CAAC,CAAA;AAED,EAAA,IAAI4G,qBAAqB,CAACD,sBAAsB,CAAC,EAAE;IACjD,OAAO,CAAA,EAAG1B,KAAK,CAACpL,KAAK,IAAIrE,IAAI,CAAA,EAAA,EAAKqR,WAAW,CAC3CF,sBAAsB,CAACG,QACzB,CAAC,IAAID,WAAW,CAACF,sBAAsB,CAAC7F,UAAU,CAAC,CAAG,CAAA,CAAA,CAAA;AACxD,GAAA;AAEA,EAAA,OAAOmE,KAAK,CAACpL,KAAK,IAAIrE,IAAI,CAAA;AAC5B,CAAA;AAEA,SAASqR,WAAWA,CAAC7a,KAAsB,EAAE;AAC3C,EAAA,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE;AAC7B,IAAA,OAAOA,KAAK,CAAA;AACd,GAAA;EAEA,OAAOA,KAAK,CAAC4B,OAAO,CAAC,IAAImZ,MAAM,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,CAAA;AAC5C,CAAA;AAEA,SAASH,qBAAqBA,CAAC5a,KAAc,EAG3C;AACA,EAAA,OACE,OAAOA,KAAK,KAAK,QAAQ,IACzBA,KAAK,KAAK,IAAI,IACd,UAAU,IAAIA,KAAK,IACnB,YAAY,IAAIA,KAAK,CAAA;AAEzB,CAAA;AAEA,MAAMwa,IAAI,GAAG1U,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,wBAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAItB,CAAA,CAAA,CAAA,0DAAA,CAAA,CAAA,CAAA;AAEM,MAAM8U,gBAAgB,GAAG;AAC9BxR,EAAAA,IAAI,EAAE,OAAO;AACb6F,EAAAA,IAAI,EAAE,OAAO;EACbqH,SAAS,EAAER,kBAAkB,CAACsC,mBAAmB,CAAA;AACnD,CAAC,CAAA;AAED,MAAM6B,oBAAoB,gBAAG9K,gBAAU,CAQrC,CAAC1E,KAAK,EAAEvF,GAAG,KAAK;AAChB,EAAA,oBACE7I,yBAAA,CAAAmG,aAAA,CAACyL,iCAAU,EAAA;IAACrO,KAAK,EAAE6K,KAAK,CAAC7K,KAAM;IAACwD,UAAU,EAAEqH,KAAK,CAACrH,UAAW;AAAC8B,IAAAA,GAAG,EAAEA,GAAAA;GACjE7I,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACEiD,IAAAA,KAAK,EAAE;AACLgN,MAAAA,OAAO,EAAE,MAAM;AACfC,MAAAA,UAAU,EAAE,QAAQ;AACpBmI,MAAAA,GAAG,EAAE,KAAA;AACP,KAAA;GAEAxe,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEsY,IAAAA,KAAK,EAAC,4BAA4B;AAClCpW,IAAAA,KAAK,EAAC,IAAI;AACVC,IAAAA,MAAM,EAAC,IAAI;AACXoW,IAAAA,OAAO,EAAC,WAAW;AACnBC,IAAAA,IAAI,EAAC,MAAA;GAEL3e,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,QAAA,EAAA;AACEyY,IAAAA,EAAE,EAAC,SAAS;AACZC,IAAAA,EAAE,EAAC,SAAS;AACZxZ,IAAAA,CAAC,EAAC,SAAS;AACXsZ,IAAAA,IAAI,EAAEvQ,KAAK,CAAC0P,YAAY,IAAI,MAAO;IACnCgB,MAAM,EAAEpV,6BAAM,CAACC,QAAAA;AAAS,GACzB,CACE,CAAC,eACN3J,yBAAA,CAAAmG,aAAA,CAAOiI,MAAAA,EAAAA,IAAAA,EAAAA,KAAK,CAACnI,QAAe,CACxB,CACI,CAAC,CAAA;AAEjB,CAAC,CAAC;;ACxdF,MAAM8Y,iCAAiC,GACrC,yEAAyE,CAAA;AAE3E,SAASC,wBAAwBA,CAACC,UAAkB,EAAW;AAC7D,EAAA,OAAOF,iCAAiC,CAACG,IAAI,CAACD,UAAU,CAAC,CAAA;AAC3D;;ACLA;AACA;AACA;AACA;AACA;AACA,SAASE,eAAeA,CAItB5e,UAAsB,EACtB6e,MAA0D,EAC7C;AACb,EAAA,IAAIA,MAAM,EAAE;AACV,IAAA,MAAMC,YAAY,GAAG,IAAI/X,GAAG,EAAsB,CAAA;IAClD,MAAMgY,WAAwB,GAAG,EAAE,CAAA;AAEnC/e,IAAAA,UAAU,CAACsD,OAAO,CAAC,CAACgI,IAAI,EAAE3J,KAAK,KAAK;AAClC,MAAA,MAAMqd,UAAU,GAAGH,MAAM,CAACvT,IAAI,EAAE3J,KAAK,CAAC,CAAA;AAEtC,MAAA,IAAI,CAACmd,YAAY,CAAC7X,GAAG,CAAC+X,UAAU,CAAC,EAAE;AACjCF,QAAAA,YAAY,CAACG,GAAG,CAACD,UAAU,CAAC,CAAA;AAC5BD,QAAAA,WAAW,CAACtT,IAAI,CAACH,IAAI,CAAC,CAAA;AACxB,OAAA;AACF,KAAC,CAAC,CAAA;AAEF,IAAA,OAAOyT,WAAW,CAAA;AACpB,GAAA;EAEA,OAAO3e,KAAK,CAAC8e,IAAI,CAAC,IAAInY,GAAG,CAAC/G,UAAU,CAAC,CAAC,CAAA;AACxC;;ACjBA,SAASmf,iBAAiBA,CAAC;AACzB/T,EAAAA,MAAAA;AAC2B,CAAC,EAAwB;EACpD,MAAMgU,kBAAwC,GAAG,EAAE,CAAA;EACnD,MAAMC,uBAAuB,GAAGC,yBAAyB,CAAClU,MAAM,CAACmU,IAAI,EAAE,CAAC,CAAA;EAExE,KAAK,MAAMC,aAAa,IAAIpc,MAAM,CAAC8K,MAAM,CAACmR,uBAAuB,CAAC,EAAE;AAClE,IAAA,IAAIG,aAAa,CAACvf,MAAM,GAAGmL,MAAM,CAACnL,MAAM,EAAE;AACxC,MAAA,SAAA;AACF,KAAA;;AAEA;AACJ;AACA;AACA;AACI,IAAA,MAAMwf,aAAa,GAAGD,aAAa,CAAC5e,MAAM,CAAEyK,KAAK,IAAK;MACpD,OAAO,CAACA,KAAK,CAACQ,MAAM,CAAA;AACtB,KAAC,CAAC,CAAA;AAEF,IAAA,IAAI4T,aAAa,CAACxf,MAAM,KAAK,CAAC,EAAE;AAC9B,MAAA,SAAA;AACF,KAAA;AAEA,IAAA,MAAMyf,kBAAkB,GAAGD,aAAa,CAAChf,GAAG,CACzC4K,KAAK,IAAKsU,4BAA4B,CAACtU,KAAK,CAAC,CAACzB,UAAU,CAACjF,EAC5D,CAAC,CAAA;;AAED;AACJ;AACA;AACA;AACI,IAAA,MAAMib,mBAAmB,GAAGhB,eAAe,CAACc,kBAAkB,CAAC,CAAA;;AAE/D;AACA;IACA,IACEE,mBAAmB,CAAC3f,MAAM,GAAG,CAAC,IAC9B,CAAC2f,mBAAmB,CAAChZ,KAAK,CAAEjC,EAAE,IAAKA,EAAE,CAAC2F,UAAU,CAAC,uBAAuB,CAAC,CAAC,EAC1E;AACA,MAAA,SAAA;AACF,KAAA;AAEA,IAAA,MAAMuV,iBAAiB,GAAGJ,aAAa,CAAC,CAAC,CAAC,CAAA;IAE1CL,kBAAkB,CAAC3T,IAAI,CAAC;AACtB,MAAA,GAAGoU,iBAAiB;MACpBrT,IAAI,EACFiT,aAAa,CAACxf,MAAM,KAAK,CAAC,GACtB4f,iBAAiB,CAACrT,IAAI,GACtBoS,eAAe,CAACa,aAAa,CAACpT,OAAO,CAAEhB,KAAK,IAAKA,KAAK,CAACmB,IAAI,CAAC,CAAA;AACpE,KAAC,CAAC,CAAA;AACJ,GAAA;AAEA,EAAA,OAAO4S,kBAAkB,CAAA;AAC3B,CAAA;AAEA,SAASE,yBAAyBA,CAChClU,MAA4B,EACU;EACtC,OAAOA,MAAM,CAACpH,MAAM,CAAC,CAAC8b,cAAc,EAAEzU,KAAK,KAAK;IAC9C,MAAM0U,wBAAwB,GAAGC,eAAe,CAAC3U,KAAK,CAACtB,UAAU,CAACG,IAAI,CAAC,CAAA;AACvE,IAAA,MAAMkB,MAAM,GAAG0U,cAAc,CAACC,wBAAwB,CAAC,CAAA;AACvDD,IAAAA,cAAc,CAACC,wBAAwB,CAAC,GACtC3U,MAAM,KAAKhG,SAAS,GAAG,CAAC,GAAGgG,MAAM,EAAEC,KAAK,CAAC,GAAG,CAACA,KAAK,CAAC,CAAA;AACrD,IAAA,OAAOyU,cAAc,CAAA;GACtB,EAAE,EAA0C,CAAC,CAAA;AAChD,CAAA;AAEA,SAASE,eAAeA,CAAC7V,SAAiB,EAAU;AAClD,EAAA,MAAM8V,cAAc,GAAG9V,SAAS,CAAC3J,KAAK,CAAC,GAAG,CAAC,CAAA;AAC3C,EAAA,IAAI0f,QAAQ,GAAGngB,IAAI,CAACkgB,cAAc,CAAC,CAAA;;AAEnC;AACA,EAAA,IAAIC,QAAQ,CAAC5V,UAAU,CAAC,GAAG,CAAC,EAAE;AAC5B4V,IAAAA,QAAQ,GAAGA,QAAQ,CAAC3J,KAAK,CAAC,CAAC,CAAC,CAAA;AAC9B,GAAA;AAEA,EAAA,IAAI0J,cAAc,CAAC,CAAC,CAAC,KAAK,WAAW,EAAE;AACrC,IAAA,OAAO,GAAGA,cAAc,CAAC,CAAC,CAAC,CAAA,CAAA,EAAIC,QAAQ,CAAE,CAAA,CAAA;AAC3C,GAAA;AAEA,EAAA,OAAOA,QAAQ,CAAA;AACjB,CAAA;AAEA,SAASP,4BAA4BA,CAACtU,KAAoB,EAExD;EACA,OAAOA,KAAK,CAACtB,UAAU,CAAA;AAGzB;;AC7CA,MAAMoW,UAAU,GAAGA,CAAC;EAAE9U,KAAK;EAAEqE,KAAK;AAAEkF,EAAAA,aAAAA;AAA+B,CAAC,KAAK;EACvE,MAAM,CAACwL,2BAA2B,EAAEC,8BAA8B,CAAC,GACjE5gB,yBAAK,CAACiE,QAAQ,CAAC,KAAK,CAAC,CAAA;AACvB,EAAA,MAAM6F,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;EACxC,MAAM;AAAEsP,IAAAA,OAAAA;AAAQ,GAAC,GAAG1F,aAAa,CAAA;EACjC,MAAM;AAAE+W,IAAAA,mBAAAA;AAAoB,GAAC,GAAGrR,OAAO,CAAA;AACvC,EAAA,MAAMsR,OAAO,GAAGpQ,iBAAiB,CAACT,KAAK,CAAC1M,KAAK,CAAC,CAAA;EAE9C,MAAMoM,MAAmC,GAAG,CAAC,MAAM;AACjD,IAAA,IAAImR,OAAO,EAAE;AACX,MAAA,OAAO,IAAI,CAAA;AACb,KAAA;;AAEA;AACA,IAAA,OAAO7Q,KAAK,CAAC1M,KAAK,CAAC,CAAC,CAAC,IAAI,IAAI,CAAA;AAC/B,GAAC,GAAG,CAAA;AAEJ,EAAA,MAAMwd,cAAc,GAAGtgB,OAAO,CAACmL,KAAK,CAACmB,IAAI,CAAC,CAAA;AAC1C;EACA,MAAMyB,KAAK,GAAGuS,cAAc,CAAC/f,GAAG,CAAEC,CAAC,IAAK,CAAA,EAAGA,CAAC,CAAA,EAAA,CAAI,CAAC,CAAA;AACjD,EAAA,MAAM+f,mBAAmB,GAAGD,cAAc,CAAC,CAAC,CAAC,CAAA;AAE7C,EAAA,oBACE/gB,yBAAA,CAAAmG,aAAA,CAAAnG,yBAAA,CAAA2d,QAAA,EAAA,IAAA,EACG,CAACxI,aAAa,iBACbnV,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEiD,IAAAA,KAAK,EAAE;AACLgN,MAAAA,OAAO,EAAE,MAAM;AACfC,MAAAA,UAAU,EAAE,QAAQ;AACpBjC,MAAAA,OAAO,EAAE,UAAU;AACnB6M,MAAAA,SAAS,EAAE,MAAA;AACb,KAAA;AAAE,GAAA,eAEFjhB,yBAAA,CAAAmG,aAAA,CAACqT,iCAAU,EAAA,IAAA,EAAE5N,KAAK,CAACwF,KAAK,IAAIxF,KAAK,CAACmB,IAAiB,CAChD,CACN,eACD/M,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEiD,IAAAA,KAAK,EAAE;AACLgN,MAAAA,OAAO,EAAE,MAAM;AACf8K,MAAAA,cAAc,EAAE,eAAe;AAC/B7K,MAAAA,UAAU,EAAE,QAAQ;AACpBjC,MAAAA,OAAO,EAAE,UAAA;AACX,KAAA;AAAE,GAAA,EAEDzE,MAAM,KAAK,IAAI,iBACd3P,yBAAA,CAAAmG,aAAA,CAAAnG,yBAAA,CAAA2d,QAAA,EACE3d,IAAAA,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AAAKiD,IAAAA,KAAK,EAAE;AAAE+X,MAAAA,IAAI,EAAE,UAAU;AAAEC,MAAAA,QAAQ,EAAE,CAAA;AAAE,KAAA;AAAE,GAAA,eAC5CphB,yBAAA,CAAAmG,aAAA,CAACkb,uBAAuB,EAAA;AACtB7S,IAAAA,KAAK,EAAEA,KAAM;AACb8S,IAAAA,UAAU,EAAEX,2BAA4B;IACxCY,QAAQ,EAAEA,MAAM;MACdX,8BAA8B,CAAC,IAAI,CAAC,CAAA;KACpC;IACFY,UAAU,EAAEA,MAAM;MAChBZ,8BAA8B,CAAC,KAAK,CAAC,CAAA;AACvC,KAAA;AAAE,GACH,CACE,CAAC,EACL,CAAChV,KAAK,CAACtB,UAAU,CAACmX,QAAQ,iBACzBzhB,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AAAKiD,IAAAA,KAAK,EAAE;AAAE+X,MAAAA,IAAI,EAAE,UAAU;AAAEC,MAAAA,QAAQ,EAAE,CAAA;AAAE,KAAA;AAAE,GAAA,eAC5CphB,yBAAA,CAAAmG,aAAA,CAACub,kCAAW,EAAA;IACVnS,OAAO,EAAEA,MAAM;MACb,IACEzF,aAAa,CAACwL,aAAa,CAAC7S,IAAI,CAACuc,wBAAwB,CAAC,EAC1D;AACA/O,QAAAA,KAAK,CAACa,QAAQ,CAAC,EAAE,CAAC,CAAA;AACpB,OAAC,MAAM;AACLtB,QAAAA,OAAO,CAACmS,WAAW,CAACnT,KAAK,CAAC,CAAA;AAC5B,OAAA;KACA;IACF4D,IAAI,EAAEC,4BAAK,CAACuP,MAAO;IACnB,YAAW,EAAA,QAAA;AAAQ,GACpB,CACE,CAEP,CACH,EAEAjS,MAAM,KAAK,IAAI,KACbmR,OAAO,gBACN9gB,yBAAA,CAAAmG,aAAA,CAAC0b,sCAAe,EAAA;AAACzQ,IAAAA,KAAK,EAAE,OAAQ;AAAClB,IAAAA,QAAQ,EAAE,IAAA;AAAK,GAAE,CAAC,gBAEnDlQ,yBAAA,CAAAmG,aAAA,CAAC2b,WAAS,EAAA;IACRC,KAAK,EAAEA,MAAM;AACXlB,MAAAA,mBAAmB,CAAC;AAAE/f,QAAAA,IAAI,EAAEkgB,mBAAAA;AAAoB,OAAC,CAAC,CAACgB,IAAI,CACpDC,SAAS,IAAK;AACb,QAAA,IAAIA,SAAS,EAAE;UACb,IACEnY,aAAa,CAACwL,aAAa,CAAC7S,IAAI,CAC9Buc,wBACF,CAAC,EACD;AACA/O,YAAAA,KAAK,CAACa,QAAQ,CAAC,CAACmR,SAAS,CAAC,CAAC,CAAA;AAC7B,WAAC,MAAM;AACLzS,YAAAA,OAAO,CAAC0S,YAAY,CAAC1T,KAAK,EAAEyT,SAAS,CAAC,CAAA;AACxC,WAAA;UAEArB,8BAA8B,CAAC,IAAI,CAAC,CAAA;AACtC,SAAA;AACF,OACF,CAAC,CAAA;AACH,KAAA;GACD,CACF,CACA,CACL,CAAC,CAAA;AAEP,CAAC,CAAA;AAMD,SAASkB,WAASA,CAAC;AAAEC,EAAAA,KAAAA;AAAsB,CAAC,EAAE;AAC5C,EAAA,oBACE/hB,yBAAA,CAAAmG,aAAA,CAACub,kCAAW,EAAA;AACVtY,IAAAA,KAAK,EAAE;AACLf,MAAAA,KAAK,EAAE,MAAM;AACb8Z,MAAAA,WAAW,EAAE,GAAA;KACb;AACF5S,IAAAA,OAAO,EAAEwS,KAAM;AACfzZ,IAAAA,MAAM,EAAE,MAAO;IACf8Z,SAAS,EAAA,IAAA;GAETpiB,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEiD,IAAAA,KAAK,EAAE;AACLgN,MAAAA,OAAO,EAAE,MAAM;AACfC,MAAAA,UAAU,EAAE,QAAQ;AACpBmI,MAAAA,GAAG,EAAE,KAAK;AACVnW,MAAAA,KAAK,EAAE,MAAA;AACT,KAAA;GAEArI,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEiD,IAAAA,KAAK,EAAE;AACLgN,MAAAA,OAAO,EAAE,MAAM;AACfiM,MAAAA,UAAU,EAAE,QAAQ;AACpBha,MAAAA,KAAK,EAAE,MAAM;AACbC,MAAAA,MAAM,EAAE,MAAM;AACdmQ,MAAAA,UAAU,EAAE,MAAM;AAClB6J,MAAAA,MAAM,EAAE,CAAA,WAAA,EAAc5Y,6BAAM,CAAC6Y,OAAO,CAAE,CAAA;AACtCC,MAAAA,YAAY,EAAE,KAAA;AAChB,KAAA;AAAE,GAAA,eAEFxiB,yBAAA,CAAAmG,aAAA,CAACkM,4BAAK,CAACoQ,GAAG,EAAA;AAACC,IAAAA,IAAI,EAAE,EAAA;AAAG,GAAE,CACnB,CAAC,EAEH,KAAA,CACM,CAAC,CAAA;AAElB,CAAA;AASA,MAAMrB,uBAAuB,GAAGA,CAAC;EAC/B7S,KAAK;EACL8S,UAAU;EACVC,QAAQ;AACRC,EAAAA,UAAAA;AAC4B,CAAC,KAAK;AAClC,EAAA,MAAMmB,iBAAiB,GAAGhb,QAAQ,CAACib,cAAc,CAAC,qBAAqB,CAAC,CAAA;AACxE,EAAA,MAAM9Y,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;AACxC,EAAA,MAAMgG,YAAY,GAAGG,qBAAqB,EAAE,CAAA;AAC5C,EAAA,MAAMwc,cAAc,GAAGhd,kBAAkB,EAAE,CAAA;AAE3C,EAAA,MAAM8J,MAAM,GAAGtL,cAAc,CAACyF,aAAa,CAACG,IAAI,CAACwE,MAAM,EAAED,KAAK,CAAC,CAAC,CAAC,CAAC,CAAA;AAClE,EAAA,MAAMsU,mBAAmB,GAAG/T,kCAAuB,CAACY,MAAM,EAAE7F,aAAa,CAAC,CAAA;AAC1E,EAAA,MAAMsH,KAAK,GACT0R,mBAAmB,EAAE1R,KAAK,IAC1B0R,mBAAmB,EAAE5d,EAAE,IACvB,CAAA,qCAAA,EAAwCyK,MAAM,CAACnD,UAAU,CAAyE,uEAAA,CAAA,CAAA;AACpI,EAAA,MAAMuW,SAAS,GAAGD,mBAAmB,KAAKnd,SAAS,CAAA;EAEnD,MAAMqd,cAAc,GAAGF,mBAAmB,GACtCG,iBAAiB,CACfH,mBAAmB,EACnBze,cAAc,CAACwe,cAAc,EAAErU,KAAK,CAAC,CAAC,CAAC,CAAC,EACxCtI,YAAY,EACZ4D,aACF,CAAC,GACDnE,SAAS,CAAA;AAEb,EAAA,MAAMud,gBAA2C,GAC/CJ,mBAAmB,EAAEK,SAAS,GAC1B;AAAEvQ,IAAAA,IAAI,EAAE,OAAO;IAAE5J,GAAG,EAAE8Z,mBAAmB,CAACK,SAAAA;AAAU,GAAC,GACrDxd,SAAS,CAAA;AACf,EAAA,MAAMwd,SAAoC,GACxCH,cAAc,EAAEG,SAAS,IAAID,gBAAgB,CAAA;AAC/C,EAAA,MAAM1K,WAA+B,GAAGwK,cAAc,EAAExK,WAAW,CAAA;EAEnE,OAAOuK,SAAS,gBACd/iB,yBAAA,CAAAmG,aAAA,CAAC9F,OAAK,EAAE+Q,IAAAA,EAAAA,KAAa,CAAC,gBAEtBpR,yBAAA,CAAAmG,aAAA,CAAAnG,yBAAA,CAAA2d,QAAA,qBACE3d,yBAAA,CAAAmG,aAAA,CAAC0b,sCAAe,EAAA;AACdtS,IAAAA,OAAO,EAAEgS,QAAS;AAClBnQ,IAAAA,KAAK,EAAEA,KAAM;AACboH,IAAAA,WAAW,EAAEA,WAAY;AACzB2K,IAAAA,SAAS,EAAEA,SAAAA;AAAU,GACtB,CAAC,EAEDR,iBAAiB,iBAChBS,4BAAQ,CAACpQ,YAAY,cACnBhT,yBAAA,CAAAmG,aAAA,CAACkd,KAAK,EAAA;AACJ/B,IAAAA,UAAU,EAAEA,UAAW;AACvBE,IAAAA,UAAU,EAAEA,UAAW;AACvBhT,IAAAA,KAAK,EAAEA,KAAAA;AAAM,GACd,CAAC,EACFmU,iBACF,CACF,CACH,CAAA;AACH,CAAC,CAAA;AAED,SAASM,iBAAiBA,CACxBH,mBAA8C,EAC9CD,cAAoC,EACpC3c,YAA0B,EAC1B4D,aAAgC,EACG;AACnC,EAAA,MAAMwZ,aAAa,GAAG3f,MAAM,CAACiY,WAAW,CACtCkH,mBAAmB,CAACvY,MAAM,CAACvJ,GAAG,CAAEuiB,CAAC,IAAK;AACpC,IAAA,MAAMhgB,KAAK,GAAGmU,sCAAuB,CACnCmL,cAAc,CAACU,CAAC,CAAC9Y,IAAI,CAAC,EACtBX,aAAa,CAACyN,eAChB,CAAC,CAAA;IAED,IAAIZ,+BAAoB,CAAC4M,CAAC,EAAEzZ,aAAa,CAAC8M,KAAK,CAAC,EAAE;AAChD,MAAA,MAAM4M,iBAAiB,GAAGC,mCAAoB,CAC5ClgB,KAAK,EACLsf,cAAc,CAACxT,GAAG,EAClBkU,CAAC,EACDrd,YACF,CAAC,CAAA;AACD,MAAA,OAAO,CAACqd,CAAC,CAAC9Y,IAAI,EAAE+Y,iBAAiB,CAAC,CAAA;AACpC,KAAA;AAEA,IAAA,IAAID,CAAC,CAAC3Q,IAAI,KAAK,MAAM,EAAE;AACrB,MAAA,OAAO,CACL2Q,CAAC,CAAC9Y,IAAI,EACNiZ,oCAAqB,CAClBngB,KAAK,CAAwBA,KAAK,EACnCuG,aACF,CAAC,EAAEvG,KAAK,CACT,CAAA;AACH,KAAA;AAEA,IAAA,OAAO,CAACggB,CAAC,CAAC9Y,IAAI,EAAElH,KAAK,CAAC,CAAA;AACxB,GAAC,CACH,CAAC,CAAA;EAED,OAAOuf,mBAAmB,CAACa,OAAO,GAAG;AAAElV,IAAAA,MAAM,EAAE6U,aAAa;AAAEpd,IAAAA,YAAAA;AAAa,GAAC,CAAC,CAAA;AAC/E,CAAA;AAEA,MAAM7F,OAAK,GAAGgJ,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,yBAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CACpBwE,CAAAA,CAAAA,CAAAA,EAAAA,EAAAA,+IAAAA,CAAAA,EAAAA,4BAAK,CAAClG,IAAI,CAOb,CAAA;AAQM,MAAM6b,YAAY,gBAAG5jB,yBAAK,CAACC,aAAa,CAE7C0F,SAAS,CAAC,CAAA;AAEZ,SAAS0d,KAAKA,CAAC;EAAE7B,UAAU;EAAEF,UAAU;AAAE9S,EAAAA,KAAAA;AAAkB,CAAC,EAAE;AAC5D,EAAA,MAAM1E,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;AAExC,EAAA,MAAMyL,MAA4B,GAAG3L,yBAAK,CAAC6jB,OAAO,CAAC,MAAM;IACvD,IAAI,CAACvC,UAAU,EAAE;AACf,MAAA,OAAO,EAAE,CAAA;AACX,KAAA;IAEA,MAAMwC,aAAa,GAAGrjB,OAAO,CAAC+N,KAAK,CAAC,CAACxN,GAAG,CAAEF,IAAI,IAAK;AACjD,MAAA,OAAOoK,eAAe,CAACpK,IAAI,EAAEgJ,aAAa,CAAC,CAAA;AAC7C,KAAC,CAAC,CAAA;IAEF,MAAMia,YAAY,GAAGrE,iBAAiB,CAAC;AACrC/T,MAAAA,MAAM,EAAEmY,aAAAA;AACV,KAAC,CAAC,CAAA;AAEF,IAAA,OAAOC,YAAY,CAAA;AACrB,GAAC,EAAE,CAACzC,UAAU,EAAE9S,KAAK,CAAC,CAAC,CAAA;AAEvB,EAAA,oBACExO,yBAAA,CAAAmG,aAAA,CAACyd,YAAY,CAACxd,QAAQ,EAAA;AACpB7C,IAAAA,KAAK,EAAE;AACLygB,MAAAA,OAAO,EAAExC,UAAAA;AACX,KAAA;AAAE,GAAA,eAEFxhB,yBAAA,CAAAmG,aAAA,CAAC8d,UAAU,EAAA;AAAC3C,IAAAA,UAAU,EAAEA,UAAAA;AAAW,GAAA,eACjCthB,yBAAA,CAAAmG,aAAA,CAAC+d,SAAS,QACP5C,UAAU,gBACTthB,yBAAA,CAAAmG,aAAA,CACEnG,KAAAA,EAAAA,IAAAA,eAAAA,yBAAA,CAAAmG,aAAA,CAACge,aAAa,EAAA;IAACla,IAAI,EAAEH,aAAa,CAACG,IAAK;AAAC0B,IAAAA,MAAM,EAAEA,MAAAA;AAAO,GAAE,CAAC,eAC3D3L,yBAAA,CAAAmG,aAAA,CAACgI,aAAa,EAAA;AAACK,IAAAA,KAAK,EAAEA,KAAAA;AAAM,GAAE,CAC3B,CAAC,GACJ,IACK,CACD,CACS,CAAC,CAAA;AAE5B,CAAA;AAEO,MAAM4V,gBAAgB,GAAG;AAC9BC,EAAAA,MAAM,EAAE,OAAO;AACftX,EAAAA,IAAI,EAAE,OAAO;AACbkN,EAAAA,SAAS,EAAEyG,UAAAA;AACb,CAAC,CAAA;AAED,MAAMwD,SAAS,GAAG7a,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,6BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAK3B,CAAA,CAAA,CAAA,iEAAA,CAAA,CAAA,CAAA;AAED,MAAM6a,mBAAmB,GAAGC,0BAAS,CAOpC,CAAA,6EAAA,CAAA,CAAA,CAAA;AAED,MAAMN,UAAU,GAAG5a,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,8BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAAA,CAAA,CAAA,CAAA,oFAAA,EAAA,OAAA,EAAA,GAAA,EAAA,IAAA,CAAA,EAQR+a,CAAC,IAAMA,CAAC,CAAClD,UAAU,GAAG,KAAK,GAAG,MAAO,EAGnDkD,CAAC,IACFA,CAAC,CAAClD,UAAU,IACZ1H,oBAAG,CACiB0K,CAAAA,iBAAAA,EAAAA,6IAAAA,CAAAA,EAAAA,mBAAmB,CAMtC,EAEAE,CAAC,IACF,CAACA,CAAC,CAAClD,UAAU,IACb1H,oBAAG,0EAGF,CAEN;;AC9YD,SAAS6K,aAAaA,CAAC;EAAExU,KAAK;AAAErE,EAAAA,KAAAA;AAA0B,CAAC,EAAE;AAC3D,EAAA,MAAM9B,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;AACxC,EAAA,MAAMwkB,YAAY,GAAGtkB,gBAAU,CAACwjB,YAAY,CAAC,CAAA;AAE7C,EAAA,MAAM9C,OAAO,GAAGpQ,iBAAiB,CAACT,KAAK,CAAC1M,KAAK,CAAC,CAAA;EAC9C,MAAMoM,MAAM,GAAGmR,OAAO,GAAG,IAAI,GAAG7Q,KAAK,CAAC1M,KAAK,CAAA;EAE3C,IAAIoM,MAAM,IAAI,IAAI,EAAE;AAClB,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;EAEA,MAAMmT,mBAAmB,GAAG1Y,sCAA2B,CACrDuF,MAAM,CAACnD,UAAU,EACjB1C,aACF,CAAC,CAAA;AAED,EAAA,MAAM6a,WAAW,GAAGlkB,OAAO,CAACmL,KAAK,CAACmB,IAAI,CAAC,CAAA;EACvC,MAAM;AAAE7C,IAAAA,MAAAA;GAAQ,GAAGF,oBAAS,CAAC2a,WAAW,CAAC,CAAC,CAAC,EAAE7a,aAAa,CAACG,IAAI,CAAC,CAAA;AAChE,EAAA,MAAM2a,mBAAmB,GAAGF,YAAY,KAAK/e,SAAS,CAAA;AAEtD,EAAA,MAAMkf,yBAAyB,GAAG3a,MAAM,GACpCE,sCAA2B,CAACF,MAAM,CAACG,UAAU,EAAEP,aAAa,CAAC,GAC7DnE,SAAS,CAAA;AACb,EAAA,MAAMmf,gBAAgB,GAAGD,yBAAyB,EAAEta,MAAM,CAACC,IAAI,CAC5DF,UAAU,IAAKA,UAAU,CAACG,IAAI,KAAKP,MAAM,CAAEQ,SAC9C,CAAC,CAAA;AAED,EAAA,MAAMqa,cAAc,GACjBjC,mBAAmB,EAAE5d,EAAE,CAAC2F,UAAU,CAAC,uBAAuB,CAAC,IAC1DiY,mBAAmB,CAAC5d,EAAE,KAAK,uBAAuB,KACnD4f,gBAAgB,GACbA,gBAAgB,CAAClS,IAAI,KAAK,WAAW,IACpCkS,gBAAgB,CAAyBrD,QAAQ,GAClD,IAAI,CAAC,CAAA;AAEX,EAAA,MAAMuD,cAAc,GAClBlC,mBAAmB,EAAE5d,EAAE,KAAK,4BAA4B,IACxD4d,mBAAmB,EAAE5d,EAAE,KAAK4E,aAAa,CAACmb,aAAa,CAAC/f,EAAE,CAAA;EAE5D,SAASggB,yBAAyBA,GAAG;AACnC,IAAA,IAAIF,cAAc,EAAE;AAClB,MAAA,OAAA;AACF,KAAA;IAEA,IAAI,CAAC9a,MAAM,EAAE;AACX,MAAA,OAAA;AACF,KAAA;IAEA,MAAM8W,mBAAmB,GAAG9W,MAAM,CAACpJ,IAAI,GAAG,GAAG,GAAGoJ,MAAM,CAACQ,SAAS,CAAA;AAEhEZ,IAAAA,aAAa,CAAC0F,OAAO,CAClBqR,mBAAmB,CAAC;AAAE/f,MAAAA,IAAI,EAAEkgB,mBAAAA;AAAoB,KAAC,CAAC,CAClDgB,IAAI,CAAEmD,cAAc,IAAK;MACxB,IAAI,CAACA,cAAc,EAAE;AACnB,QAAA,OAAA;AACF,OAAA;MAEArb,aAAa,CAAC0F,OAAO,CAAC0S,YAAY,CAACyC,WAAW,EAAEQ,cAAc,CAAC,CAAA;AACjE,KAAC,CAAC,CAAA;AACN,GAAA;EAEA,SAASC,YAAYA,GAAG;AACtB,IAAA,IAAIL,cAAc,EAAE;AAClB,MAAA,OAAA;AACF,KAAA;AAEAjb,IAAAA,aAAa,CAAC0F,OAAO,CAACmS,WAAW,CAACgD,WAAW,CAAC,CAAA;AAChD,GAAA;AAEA,EAAA,MAAMU,YAAY,gBAChBrlB,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEiD,IAAAA,KAAK,EAAE;AACLgN,MAAAA,OAAO,EAAE,MAAM;AACfC,MAAAA,UAAU,EAAE,QAAQ;AACpBmI,MAAAA,GAAG,EAAE,KAAA;AACP,KAAA;AAAE,GAAA,eAEFxe,yBAAA,CAAAmG,aAAA,CAACqT,iCAAU,EAAA;AACTpQ,IAAAA,KAAK,EAAE;AACLiP,MAAAA,UAAU,EAAE,MAAM;AAClBiN,MAAAA,UAAU,EAAE,KAAA;AACd,KAAA;AAAE,GAAA,EAEDxC,mBAAmB,EAAE1R,KAAK,IAAI0R,mBAAmB,EAAE5d,EAC1C,CAAC,EACZ,CAAC8f,cAAc,iBAAIhlB,yBAAA,CAAAmG,aAAA,CAACkM,4BAAK,CAACkT,WAAW,EAAA;AAAC7C,IAAAA,IAAI,EAAE,EAAA;AAAG,GAAE,CAC/C,CACN,CAAA;EAED,oBACE1iB,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEiD,IAAAA,KAAK,EAAE;AACLgN,MAAAA,OAAO,EAAE,MAAM;AACfoI,MAAAA,GAAG,EAAE,KAAK;AACVyC,MAAAA,SAAS,EAAE,MAAM;AACjB7M,MAAAA,OAAO,EAAE,MAAA;AACX,KAAA;GAEApU,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEiD,IAAAA,KAAK,EAAE;AACLgN,MAAAA,OAAO,EAAE,MAAM;AACfC,MAAAA,UAAU,EAAE,QAAQ;AACpB8K,MAAAA,IAAI,EAAE,KAAA;AACR,KAAA;AAAE,GAAA,EAEDyD,mBAAmB,iBAClB5kB,yBAAA,CAAAmG,aAAA,CAACub,kCAAW,EAAA;IACVtP,IAAI,EAAEC,4BAAK,CAACmT,WAAY;IACxBjW,OAAO,EAAEA,MAAM;MACbmV,YAAY,CAACV,OAAO,EAAE,CAAA;KACtB;AACF5a,IAAAA,KAAK,EAAE;AACLqc,MAAAA,WAAW,EAAE,MAAA;AACf,KAAA;AAAE,GACH,CACF,EAEAT,cAAc,iBACbhlB,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AAAKiD,IAAAA,KAAK,EAAE;AAAEgL,MAAAA,OAAO,EAAE,SAAA;AAAU,KAAA;GAAIiR,EAAAA,YAAkB,CACxD,EACA,CAACL,cAAc,iBACdhlB,yBAAA,CAAAmG,aAAA,CAACub,kCAAW,EAAA;AAACnS,IAAAA,OAAO,EAAE2V,yBAAAA;AAA0B,GAAA,EAC7CG,YACU,CACd,eAEDrlB,yBAAA,CAAAmG,aAAA,CAACub,kCAAW,EAAA;AACV,IAAA,YAAA,EAAW,kBAAkB;IAC7BtP,IAAI,EAAEC,4BAAK,CAACuP,MAAO;AACnBrS,IAAAA,OAAO,EAAE6V,YAAa;AACtBhc,IAAAA,KAAK,EAAE;AACLqP,MAAAA,UAAU,EAAE,MAAM;AAClBiN,MAAAA,OAAO,EAAEX,cAAc,GAAG,CAAC,GAAG,CAAC;AAC/BY,MAAAA,aAAa,EAAEZ,cAAc,GAAG,MAAM,GAAG,MAAA;AAC3C,KAAA;GACD,CACE,CACF,CAAC,CAAA;AAEV,CAAA;AAEA,MAAMa,mBAAmB,GAAG;AAC1B7Y,EAAAA,IAAI,EAAE,UAAU;AAChBkN,EAAAA,SAAS,EAAEwK,aAAAA;AACb,CAAC;;ACxKM,SAASoB,aAAaA,CAACzX,KAAuB,EAAE;AACrD,EAAA,oBAAOpO,yBAAA,CAAAmG,aAAA,CAACqT,iCAAU,EAAA,IAAA,EAAC,4BAAyB,EAACpL,KAAK,CAACwE,IAAI,EAAC,KAAc,CAAC,CAAA;AACzE;;AC0BA,MAAMkT,sBAAsB,GAAI1X,KAAyB,IAAK;EAC5D,MAAM;IACJ2X,QAAQ;IACRna,KAAK;IACLqE,KAAK;AACLA,IAAAA,KAAK,EAAE;AAAE1M,MAAAA,KAAAA;AAAM,KAAA;AACjB,GAAC,GAAG6K,KAAK,CAAA;AACT,EAAA,MAAMtE,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;AACxC,EAAA,MAAMgG,YAAY,GAAGG,qBAAqB,EAAE,CAAA;AAE5C,EAAA,MAAMuP,UAAU,GAAGnV,OAAO,CAACmL,KAAK,CAACmB,IAAI,CAAC,CAAA;EAEtC,MAAMiZ,qBAAqB,GAAGpa,KAAK,CAACtB,UAAU,CAACsI,IAAI,CAAC/H,UAAU,CAAC,SAAS,CAAC,CAAA;AAEzE,EAAA,MAAMob,aAAsE,GAC1E,CAACvV,iBAAiB,CAACT,KAAK,CAAC1M,KAAK,CAAC,GAC3ByiB,qBAAqB,GACnBE,8BAA8B,CAACjW,KAAK,CAAC1M,KAAK,EAAEuG,aAAa,CAAC,GAC1Dqc,wBAAwB,CACtBlW,KAAK,CAAC1M,KAAK,EACXqI,KAAK,CAACtB,UAAU,CAACsI,IAAI,EACrB9I,aACF,CAAC,GACHnE,SAAS,CAAA;EAEf,MAAM7E,IAAI,GAAG8U,UAAU,CAAC,CAAC,CAAC,CAAC7U,KAAK,CAAC,GAAG,CAAC,CAAC+V,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAACC,IAAI,CAAC,GAAG,CAAC,CAAA;AAC5D,EAAA,MAAMqP,QAAQ,GAAG/hB,cAAc,CAACyF,aAAa,CAACG,IAAI,CAACwE,MAAM,EAAE3N,IAAI,CAAC,CAACuO,GAAG,CAAA;EACpE,MAAMgX,4BAA4B,GAAGjP,8CAA+B,CAClEgP,QAAQ,EACRxa,KAAK,CAACtB,UAAU,CAACG,IAAI,EACrBmB,KAAK,CAACtB,UAAU,CAACgc,UAAU,GAAGxc,aAAa,CAACyN,eAAe,GAAG5R,SAChE,CAAC,CAAA;EACD,MAAM4gB,aAAa,GAAGF,4BAA4B,GAC9CngB,YAAY,CAACmgB,4BAA4B,CAAC,GAC1C1gB,SAAS,CAAA;EAEb,MAAM6gB,gDAAgD,GACpD,CAAC9V,iBAAiB,CAACnN,KAAK,CAAC,IACzB,CAACqU,uCAAwB,CAACrU,KAAK,CAAC,IAChCgjB,aAAa,KAAK5gB,SAAS,IAC3B8gB,kDAAmC,CAACF,aAAa,CAAC,CAAA;AAEpD,EAAA,MAAMG,cAAc,GAAGF,gDAAgD,GACnEG,uBAAuB,CAACJ,aAAa,CAAChjB,KAAK,EAAEqI,KAAK,CAACtB,UAAU,CAACsI,IAAI,CAAC,GACnE,EAAE,CAAA;AAEN,EAAA,MAAMgU,oCAAoC,GACxCJ,gDAAgD,IAChD,CAAC3O,mDAAoC,CAACtU,KAAK,CAAC2B,EAAE,CAAC,IAC/CwhB,cAAc,CAAClmB,MAAM,GAAG,CAAC,CAAA;AAE3BqmB,EAAAA,qBAAe,CAAC,MAAM;AACpB,IAAA,IACEL,gDAAgD,IAChDE,cAAc,CAAClmB,MAAM,KAAK,CAAC,IAC3B,CAAC+C,KAAK,CAACO,GAAG,EACV;AACA;MACAgG,aAAa,CAACG,IAAI,CAACgM,MAAM,CAACL,UAAU,CAAC,CAAC,CAAC,EAAE;AACvC,QAAA,GAAGrS,KAAK;AACRO,QAAAA,GAAG,EAAE4iB,cAAc,CAAC,CAAC,CAAC,CAAC5iB,GAAAA;AACzB,OAAC,CAAC,CAAA;AACJ,KAAA;AACF,GAAC,CAAC,CAAA;EAEF,oBACE9D,yBAAA,CAAAmG,aAAA,CAAC4O,gBAAgB,EAAA7C,4BAAA,KAAK9D,KAAK,EAAA;AAAEnE,IAAAA,IAAI,EAAE8b,QAAS;AAAC9Q,IAAAA,MAAM,EAAC,QAAA;GAClDjV,CAAAA,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEiD,IAAAA,KAAK,EAAE;AACLf,MAAAA,KAAK,EAAE,MAAA;AACT,KAAA;GAECqI,EAAAA,iBAAiB,CAACnN,KAAK,CAAC,GACvB,OAAO,gBAEPvD,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEiD,IAAAA,KAAK,EAAE;AACLgN,MAAAA,OAAO,EAAE,MAAM;AACfE,MAAAA,aAAa,EAAE,QAAQ;AACvBD,MAAAA,UAAU,EAAE,YAAY;AACxBmI,MAAAA,GAAG,EAAE,KAAA;AACP,KAAA;AAAE,GAAA,EAEDyH,aAAa,gBACZjmB,yBAAA,CAAAmG,aAAA,CAAC8f,aAAa,EAAA;IACZ/gB,EAAE,EAAE3B,KAAK,CAAC2B,EAAG;IACb4hB,WAAW,EAAE,KAAK,IAAIvjB,KAAK,GAAGA,KAAK,CAACO,GAAG,GAAG6B,SAAU;AACpDmL,IAAAA,QAAQ,EAAEA,CAACiW,KAAK,EAAEC,MAAM,KAAK;AAC3B,MAAA,MAAMC,QAA2B,GAAG;AAClC/hB,QAAAA,EAAE,EAAE6hB,KAAK;QACTnO,QAAQ,EAAErV,KAAK,CAACqV,QAAAA;OACjB,CAAA;AAED,MAAA,IAAIoO,MAAM,IAAIC,QAAQ,CAAC/hB,EAAE,KAAK,IAAI,EAAE;QAClC+hB,QAAQ,CAACnjB,GAAG,GAAGkjB,MAAM,CAAA;AACvB,OAAA;AAEA/W,MAAAA,KAAK,CAACa,QAAQ,CAACmW,QAAQ,CAAC,CAAA;KACxB;AACFnmB,IAAAA,IAAI,EAAE8U,UAAU,CAAC,CAAC,CAAE;AACpB0H,IAAAA,MAAM,EAAE1R,KAAK,CAACtB,UAAU,CAACgT,MAAAA;AAAO,GACjC,CAAC,gBAEFtd,yBAAA,CAAAmG,aAAA,CAAC0f,aAAa,EAAA;AAACjT,IAAAA,IAAI,EAAEhH,KAAK,CAACtB,UAAU,CAACsI,IAAAA;GAAO,CAC9C,EAEAgU,oCAAoC,iBACnC5mB,yBAAA,CAAAmG,aAAA,CAAC+gB,2BAA2B,EAAA;AAC1BrW,IAAAA,OAAO,EAAE6V,cAAc,CAAC1lB,GAAG,CAAEqE,CAAC,KAAM;AAClCH,MAAAA,EAAE,EAAEmhB,4BAA4B;MAChCviB,GAAG,EAAEuB,CAAC,CAACvB,GAAG;AACVsN,MAAAA,KAAK,EAAE/L,CAAC,CAAC+L,KAAK,IAAI/L,CAAC,CAACvB,GAAAA;AACtB,KAAC,CAAC,CAAE;AACJqjB,IAAAA,QAAQ,EAAE;AACRjiB,MAAAA,EAAE,EAAEmhB,4BAA4B;MAChCviB,GAAG,EAAEP,KAAK,CAACO,GAAAA;KACX;AACFsjB,IAAAA,mBAAmB,EAAEA,CAACtR,CAAC,EAAEhS,GAAG,KAAK;MAC/BmM,KAAK,CAACa,QAAQ,CAAC;AACb,QAAA,GAAGvN,KAAK;AACRO,QAAAA,GAAAA;AACF,OAAC,CAAC,CAAA;AACJ,KAAA;GACD,CAEA,CAEJ,CACW,CAAC,CAAA;AAEvB,CAAC,CAAA;AAEM,MAAMujB,mBAAmB,GAAG;AACjCta,EAAAA,IAAI,EAAE,UAAU;AAChBkN,EAAAA,SAAS,EAAE6L,sBAAAA;AACb,CAAC,CAAA;AAED,SAASK,wBAAwBA,CAC/BmB,iBAAoC,EACpC1U,IAAY,EACZ9I,aAAgC,EAChC;EACA,OACEA,aAAa,CAAC8M,KAAK,CAAChE,IAAI,CAAC,CACzBuG,OAAO,CAAC3O,IAAI,CAAE6O,CAAC,IAAKA,CAAC,CAACnU,EAAE,KAAKoiB,iBAAiB,CAAC1O,QAAQ,CAAC,EAAEjD,SAAS,CAAA;AACvE,CAAA;AAEA,SAASuQ,8BAA8BA,CACrCoB,iBAAoC,EACpCxd,aAAgC,EAChC;AACA,EAAA,OAAOnG,MAAM,CAAC8K,MAAM,CAAC3E,aAAa,CAAC8M,KAAK,CAAC,CACtCzV,MAAM,CAAEomB,CAAC,IAAwCA,CAAC,CAAC3U,IAAI,KAAK,UAAU,CAAC,CACvEhG,OAAO,CAAE2a,CAAC,IAAKA,CAAC,CAACpO,OAAO,CAAC,CACzB3O,IAAI,CAAE6O,CAAC,IAAKA,CAAC,CAACnU,EAAE,KAAKoiB,iBAAiB,CAAC1O,QAAQ,CAAC,EAAEjD,SAAS,CAAA;AAChE,CAAA;AAEO,SAASgR,uBAAuBA,CACrCa,sBAAyD,EACzD5U,IAAY,EACZ;AACA,EAAA,OAAOjP,MAAM,CAACkY,OAAO,CAAC2L,sBAAsB,CAAC,CAC1CrmB,MAAM,CAAC,CAAC,GAAGkE,CAAC,CAAC,KAAKA,CAAC,CAACuN,IAAI,KAAKA,IAAI,CAAC,CAClC5R,GAAG,CAAC,CAAC,CAAC8C,GAAG,EAAEuB,CAAC,CAAC,KAAK;IACjB,OAAO;MACLvB,GAAG;MACH,GAAGuB,CAAAA;KACJ,CAAA;AACH,GAAC,CAAC,CAAA;AACN,CAAA;AAEO,SAAS6hB,2BAA2BA,CAAC9Y,KAM3C,EAAE;AACD,EAAA,oBACEpO,yBAAA,CAAAmG,aAAA,CAACqL,6BAAM,EAAA;IACLV,QAAQ,EAAGvN,KAAK,IAAK;AACnB,MAAA,MAAMkkB,cAAc,GAAG3kB,IAAI,CAACC,KAAK,CAACQ,KAAK,CAAC,CAAA;MACxC6K,KAAK,CAACgZ,mBAAmB,CAACK,cAAc,CAACviB,EAAE,EAAEuiB,cAAc,CAAC3jB,GAAG,CAAC,CAAA;KAChE;IACFP,KAAK,EACH6K,KAAK,CAAC+Y,QAAQ,CAACjiB,EAAE,KAAK,IAAI,IAAIkJ,KAAK,CAAC+Y,QAAQ,CAACrjB,GAAG,KAAK6B,SAAS,GAC1D7C,IAAI,CAACE,SAAS,CAAC;AAAEkC,MAAAA,EAAE,EAAEkJ,KAAK,CAAC+Y,QAAQ,CAACjiB,EAAE;AAAEpB,MAAAA,GAAG,EAAEsK,KAAK,CAAC+Y,QAAQ,CAACrjB,GAAAA;KAAK,CAAC,GAClE,EACL;AACD+W,IAAAA,WAAW,EAAC,kBAAA;AAAkB,GAAA,EAE7BzM,KAAK,CAACyC,OAAO,CAAC7P,GAAG,CAAEqE,CAAC,IAAK;AACxB,IAAA,oBACErF,yBAAA,CAAAmG,aAAA,CAACyL,iCAAU,EAAA;MACT9N,GAAG,EAAE,GAAGuB,CAAC,CAACH,EAAE,CAAIG,CAAAA,EAAAA,CAAC,CAACvB,GAAG,CAAG,CAAA;AACxBP,MAAAA,KAAK,EAAET,IAAI,CAACE,SAAS,CAAC;QAAEkC,EAAE,EAAEG,CAAC,CAACH,EAAE;QAAEpB,GAAG,EAAEuB,CAAC,CAACvB,GAAAA;OAAK,CAAA;KAE7CuB,EAAAA,CAAC,CAAC+L,KACO,CAAC,CAAA;AAEjB,GAAC,CACK,CAAC,CAAA;AAEb;;ACnNA,SAASsW,aAAaA,CACpBnkB,KAAU,EACVokB,aAAkB,EAClB7d,aAAgC,EAChC;AACA,EAAA,MAAMyN,eAAe,GAAGzN,aAAa,CAACyN,eAAe,CAAA;EAErD,IAAI,OAAOhU,KAAK,KAAK,QAAQ,IAAIA,KAAK,CAACsH,UAAU,CAAC,IAAI,CAAC,EAAE,CAMvD;;AAGF;AACA,EAAA,IAAI,CAACwM,qCAAsB,CAACsQ,aAAa,CAAC,EAAE;AAC1C,IAAA,IAAIpkB,KAAK,KAAKoC,SAAS,IAAIpC,KAAK,KAAK,IAAI,EAAE;AACzC,MAAA,OAAO,IAAI,CAAA;AACb,KAAA;AAEA,IAAA,OAAOA,KAAK,CAAA;AACd,GAAA;AAEA,EAAA,MAAMoH,MAAM,GAAG;IAAE,GAAGgd,aAAAA;GAAe,CAAA;AACnChd,EAAAA,MAAM,CAAC4M,eAAe,CAAC,GAAGhU,KAAK,CAAA;AAC/B,EAAA,OAAOoH,MAAM,CAAA;AACf,CAAA;AAEO,SAASid,yBAAyBA,CAACjY,MAMzC,EAA6B;EAC5B,MAAM;IAAE/D,KAAK;IAAEic,UAAU;IAAE/W,QAAQ;IAAEhH,aAAa;AAAEge,IAAAA,eAAAA;AAAgB,GAAC,GACnEnY,MAAM,CAAA;AAER,EAAA,SAASoY,cAAcA,CAACxkB,KAAc,EAAEmH,SAAiB,EAAE;IACzD,OAAOkB,KAAK,CAACoc,MAAM,GAAGzkB,KAAK,EAAEmH,SAAS,EAAEkB,KAAK,CAAC,IAAIrI,KAAK,CAAA;AACzD,GAAA;AAEA,EAAA,SAAS0kB,aAAaA,CAAC1kB,KAAc,EAAEmH,SAAiB,EAAE;IACxD,OAAOkB,KAAK,CAAC7I,KAAK,GAAGQ,KAAK,EAAEmH,SAAS,EAAEkB,KAAK,CAAC,IAAIrI,KAAK,CAAA;AACxD,GAAA;AAEA,EAAA,MAAM2kB,mBAAmB,GAAGznB,OAAO,CAACmL,KAAK,CAACmB,IAAI,CAAC,CAAA;AAE/C,EAAA,MAAMiK,WAAW,GAAGkR,mBAAmB,CAAClnB,GAAG,CAAE0J,SAAS,IACpDrG,cAAc,CAACwjB,UAAU,EAAEnd,SAAS,CACtC,CAAC,CAAA;AAED,EAAA,MAAMyd,YAAY,GAAGnR,WAAW,CAAC7P,KAAK,CAAEihB,UAAU,IAChD/Q,qCAAsB,CAAC+Q,UAAU,CACnC,CAAC,CAAA;AAED,EAAA,MAAMC,KAAK,GACTF,YAAY,IACZnR,WAAW,CAAC7P,KAAK,CACdihB,UAAU,IAAKA,UAAU,CAACte,aAAa,CAACyN,eAAe,CAAC,KAAK5R,SAChE,CAAC,CAAA;AAEH,EAAA,MAAMqiB,MAAM,GAAGA,CAACzkB,KAAU,EAAEwJ,IAAY,KAAK;AAC3C,IAAA,MAAMub,gBAAgB,GAAGP,cAAc,CAACxkB,KAAK,EAAEwJ,IAAI,CAAC,CAAA;AACpD,IAAA,MAAMwb,cAAc,GAClB,CAAClR,qCAAsB,CAACiR,gBAAgB,CAAC,GACrCA,gBAAgB,CAACxe,aAAa,CAACyN,eAAe,CAAC,GAC/C+Q,gBAAgB,KAAK,IAAI,CAAA;AAC/B,IAAA,OAAOC,cAAc,CAAA;GACtB,CAAA;AAED,EAAA,MAAMxlB,KAAK,GAAGA,CAACQ,KAAU,EAAEwJ,IAAY,KAAK;IAC1C,IAAIxJ,KAAK,KAAK,IAAI,EAAE;AAClB,MAAA,MAAM,IAAIlD,KAAK,CACb,mIACF,CAAC,CAAA;AACH,KAAA;AAEA,IAAA,MAAM+nB,UAAU,GAAGL,cAAc,CAAC1jB,cAAc,CAACwjB,UAAU,EAAE9a,IAAI,CAAC,EAAEA,IAAI,CAAC,CAAA;IACzE,MAAMyb,UAAU,GAAGd,aAAa,CAACnkB,KAAK,EAAE6kB,UAAU,EAAEte,aAAa,CAAC,CAAA;AAElE,IAAA,OAAOme,aAAa,CAACO,UAAU,EAAEzb,IAAI,CAAC,CAAA;GACvC,CAAA;EAED,MAAM0b,KAAK,GAAGA,MAAM;IAClB,IAAI,CAACN,YAAY,EAAE;AACjB,MAAA,MAAM,IAAI9nB,KAAK,CAAC,qBAAqB,CAAC,CAAA;AACxC,KAAA;AAEA,IAAA,MAAMqoB,UAAU,GAAGR,mBAAmB,CAAClnB,GAAG,CAAE0J,SAAS,IAAK;AACxD,MAAA,MAAMid,aAAa,GAAGI,cAAc,CAClC1jB,cAAc,CAACwjB,UAAU,EAAEnd,SAAS,CAAC,EACrCA,SACF,CAAC,CAAA;AAED,MAAA,MAAMuc,QAAQ,GAAG;QACf,GAAGU,aAAAA;OACJ,CAAA;AAED,MAAA,OAAOV,QAAQ,CAACnd,aAAa,CAACyN,eAAe,CAAC,CAAA;MAE9C,IAAI5T,MAAM,CAACC,IAAI,CAACqjB,QAAQ,CAAC,CAACzmB,MAAM,IAAI,CAAC,EAAE;QACrC,OAAOoL,KAAK,CAAC+c,YAAY,CAAA;AAC3B,OAAA;AAEA,MAAA,OAAOV,aAAa,CAAChB,QAAQ,EAAEvc,SAAS,CAAC,CAAA;AAC3C,KAAC,CAAC,CAAA;IAEFoG,QAAQ,CAAC4X,UAAU,CAAC,CAAA;GACrB,CAAA;EAED,MAAME,aAAa,GAAGA,MAAM;AAC1B,IAAA,MAAMC,uBAAuB,GAAG7R,WAAW,CAAChW,GAAG,CAC5ConB,UAAU,IAAKA,UAAU,CAACte,aAAa,CAACyN,eAAe,CAC1D,CAAC,CAAA;IAED,IAAIuR,qBAAqB,GAAG,IAAI,CAAA;IAChC,IAAIC,mBAAmB,GAAG,KAAK,CAAA;AAE/BF,IAAAA,uBAAuB,CAAChlB,OAAO,CAAEN,KAAK,IAAK;MACzC,IAAIA,KAAK,KAAKoC,SAAS,EAAE;QACvB,IAAI,CAACojB,mBAAmB,EAAE;AACxBA,UAAAA,mBAAmB,GAAG,IAAI,CAAA;AAC5B,SAAA;AACF,OAAC,MAAM;AACL,QAAA,IAAID,qBAAqB,EAAE;AACzBA,UAAAA,qBAAqB,GAAG,KAAK,CAAA;AAC/B,SAAA;AACF,OAAA;AACF,KAAC,CAAC,CAAA;AAEF,IAAA,MAAME,eAAe,GAAGd,mBAAmB,CAAClnB,GAAG,CAAE0J,SAAS,IAAK;AAC7D,MAAA,MAAM0d,UAAU,GAAG/jB,cAAc,CAACwjB,UAAU,EAAEnd,SAAS,CAAC,CAAA;AACxD,MAAA,MAAMue,cAAc,GAAGH,qBAAqB,GACxCzkB,cAAc,CAACyjB,eAAe,EAAEI,mBAAmB,CAAC,CAAC,CAAC,CAAC,GACvDa,mBAAmB,GACjB/R,WAAW,CAACxM,IAAI,CACfjH,KAAK,IAAKA,KAAK,CAACuG,aAAa,CAACyN,eAAe,CAAC,KAAK5R,SACtD,CAAC,GACCyiB,UAAU,CAAA;AAEhB,MAAA,MAAMvP,aAAa,GAAG;AACpB,QAAA,GAAGuP,UAAU;AACb,QAAA,CAACte,aAAa,CAACyN,eAAe,GAAGG,sCAAuB;AACtD;QACAuR,cAAc,EACdnf,aAAa,CAACyN,eAChB,CAAA;OACD,CAAA;AAED,MAAA,OAAOsB,aAAa,CAAA;AACtB,KAAC,CAAC,CAAA;IAEF/H,QAAQ,CAACkY,eAAe,CAAC,CAAA;GAC1B,CAAA;AAED,EAAA,MAAME,UAAyB,GAAG;AAChC,IAAA,GAAGtd,KAAK;IACR+J,SAAS,EAAE/J,KAAK,CAAC8J,YAAY;IAC7BsS,MAAM;AACNjlB,IAAAA,KAAAA;GACD,CAAA;EAED,OAAO;AACL6I,IAAAA,KAAK,EAAEsd,UAAU;IACjBf,YAAY;IACZE,KAAK;IACLI,KAAK;AACLG,IAAAA,aAAAA;GACD,CAAA;AACH;;ACtKA,MAAMO,eAAe,GAAI/a,KAA4B,IAAK;EACxD,MAAM;IAAE2X,QAAQ;IAAEna,KAAK;AAAEqE,IAAAA,KAAAA;AAAM,GAAC,GAAG7B,KAAK,CAAA;AAExC,EAAA,MAAMtE,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;AACxC,EAAA,MAAMkV,eAAe,GAAGvP,kBAAkB,EAAE,CAAA;AAC5C,EAAA,MAAMqiB,mBAAmB,GAAGznB,OAAO,CAACmL,KAAK,CAACmB,IAAI,CAAC,CAAA;AAE/C,EAAA,MAAMiK,WAAW,GAAGkR,mBAAmB,CAAClnB,GAAG,CAAE0J,SAAS,IACpDrG,cAAc,CAAC+Q,eAAe,EAAE1K,SAAS,CAC3C,CAAC,CAAA;AAED,EAAA,MAAM0e,iBAAiB,GAAGpS,WAAW,CAAChW,GAAG,CAAEonB,UAAU,IAAK;AACxD,IAAA,OAAO1Q,sCAAuB;AAC5B;AACA0Q,IAAAA,UAAU,EACVte,aAAa,CAACyN,eAChB,CAAC,CAAA;AACH,GAAC,CAAC,CAAA;EAEF,MAAM8H,YAAY,GAAGF,eAAe,CAACiK,iBAAiB,EAAG7lB,KAAK,IAC5D,OAAOA,KAAK,KAAK,QAAQ,GAAGT,IAAI,CAACE,SAAS,CAACO,KAAK,CAAC,GAAGA,KACtD,CAAC,CAAA;AAED,EAAA,MAAMwN,YAAY,GAAGsO,YAAY,CAAC7e,MAAM,GAAG,CAAC,CAAA;EAC5C,MAAM+C,KAAK,GAAGwN,YAAY,GAAGP,WAAW,GAAG6O,YAAY,CAAC,CAAC,CAAC,CAAA;EAC1D,MAAMgK,UAAU,GAAGzB,yBAAyB,CAAC;IAC3Chc,KAAK;IACLkF,QAAQ,EAAGwY,SAAS,IAAK;AACvBrZ,MAAAA,KAAK,CAACa,QAAQ,CAAC,GAAGwY,SAAS,CAAC,CAAA;KAC7B;IACDzB,UAAU,EAAE9B,QAAQ,CAACtX,MAAM;IAC3B3E,aAAa;AACbge,IAAAA,eAAe,EAAE1S,eAAAA;AACnB,GAAC,CAAC,CAAA;AAEF,EAAA,MAAMmU,kCAAkC,GACtCF,UAAU,CAAChB,KAAK,IAChBve,aAAa,CAACyN,eAAe,KAAKzN,aAAa,CAAC0f,mBAAmB,CAAA;AAErE,EAAA,MAAMC,cAAc,GAClB,CAACJ,UAAU,CAAClB,YAAY,IACxBkB,UAAU,CAAChB,KAAK,IAChBve,aAAa,CAACyN,eAAe,KAAKzN,aAAa,CAAC0f,mBAAmB,CAAA;AAErE,EAAA,MAAME,iBAAiB,GAAGvK,eAAe,CAACiK,iBAAiB,CAAC,CAAA;EAE5D,MAAMO,iBAAiB,GACrBD,iBAAiB,CAAClpB,MAAM,GAAG,CAAC,IAAIkpB,iBAAiB,CAAC/mB,QAAQ,CAACgD,SAAS,CAAC,GACjE,OAAO,GACPikB,uBAAuB,CAACrmB,KAAK,CAAC,CAAA;AAEpC,EAAA,MAAMmT,eAAe,GAAG9K,KAAK,CAAC8J,YAAY,KAAK,UAAU,CAAA;EAEzD,MAAM;IAAErC,MAAM;IAAEwB,UAAU;IAAEF,YAAY;AAAED,IAAAA,YAAAA;GAAc,GAAGtB,UAAU,CAAC;IACpErM,UAAU,EAAE,CAACwiB,kCAAkC;IAC/Cha,OAAO,EAAEA,MAAM;MACb8Z,UAAU,CAACZ,KAAK,EAAE,CAAA;AACpB,KAAA;AACF,GAAC,CAAC,CAAA;EAEF,oBACEzoB,yBAAA,CAAAmG,aAAA,CAAC4O,gBAAgB,EAAA7C,4BAAA,KACX9D,KAAK,EAAA;AACT6G,IAAAA,MAAM,EAAEyB,eAAe,GAAG,QAAQ,GAAG,KAAM;IAC3CxB,WAAW,EACTqU,kCAAkC,GAC9B,CAAC;AAAEnY,MAAAA,KAAAA;AAAM,KAAC,kBACRpR,yBAAA,CAAAmG,aAAA,CAAC0jB,WAAW,EAAA3X,4BAAA,CAAA;MAAC,YAAW,EAAA,gBAAA;KAAqBwC,EAAAA,YAAY,gBACvD1U,yBAAA,CAAAmG,aAAA,CAACkM,4BAAK,CAACyX,KAAK,EAAE,IAAA,CAAC,eACf9pB,yBAAA,CAAAmG,aAAA,CAAC4jB,gBAAgB,EAAA,IAAA,EAAE3Y,KAAwB,CAAC,EAC3CiC,MAAM,iBACLrT,yBAAA,CAAAmG,aAAA,CAAC0M,OAAO,EAAK8B,YAAY,eACvB3U,yBAAA,CAAAmG,aAAA,CAACgN,YAAY,EAAK0B,UAAa,CAAC,eAChC7U,yBAAA,CAAAmG,aAAA,CAAC+M,WAAW,QAAC,gBAA2B,CACjC,CAEA,CACd,GACDvN,SAAAA;GAGN3F,CAAAA,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AAAKiD,IAAAA,KAAK,EAAE;AAAEf,MAAAA,KAAK,EAAE,MAAA;AAAO,KAAA;AAAE,GAAA,EAC3BohB,cAAc,gBACbzpB,yBAAA,CAAAmG,aAAA,CAAC6jB,YAAY,EAAA;AACX/f,IAAAA,IAAI,EAAE8b,QAAS;IACfna,KAAK,EAAEyd,UAAU,CAACzd,KAAM;AACxBoJ,IAAAA,MAAM,EAAE,IAAA;AAAK,GACd,CAAC,gBAEFhV,yBAAA,CAAAmG,aAAA,CAAC8jB,SAAS,EAAA;AACRhP,IAAAA,KAAK,EAAEvE,eAAe,GAAG,MAAM,GAAG,OAAQ;IAC1CnH,OAAO,EAAEA,MAAM;MACb8Z,UAAU,CAACT,aAAa,EAAE,CAAA;AAC5B,KAAA;GAECe,EAAAA,iBACQ,CAEV,CACW,CAAC,CAAA;AAEvB,CAAC,CAAA;AAEM,MAAMO,qBAAqB,GAAG;AACnCnd,EAAAA,IAAI,EAAE,aAAsB;AAC5BkN,EAAAA,SAAS,EAAEkP,eAAAA;AACb,CAAC,CAAA;AAED,MAAMc,SAAS,GAAG5gB,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,kCAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAAA,CAAA,CAAA,CAAA,EAAA,EAAA,SAAA,EAAA,cAAA,EAAA,iEAAA,CAAA,EACxBwE,4BAAK,CAAClG,IAAI,EACH2B,6BAAM,CAACwE,OAAO,EACRE,KAAK,IAAKA,KAAK,CAAC6M,KAAK,CAOrC,CAAA;AAED,MAAM4O,WAAW,GAAGxgB,uBAAM,CAAC8gB,MAAM,CAAA5gB,UAAA,CAAA;EAAAC,WAAA,EAAA,oCAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAStBC,CAAAA,CAAAA,CAAAA,gGAAAA,EAAAA,kBAAAA,CAAAA,EAAAA,6BAAM,CAAC0gB,MAAM,CAGvB,CAAA;AAED,MAAML,gBAAgB,GAAG1gB,uBAAM,CAACwQ,IAAI,CAAAtQ,UAAA,CAAA;EAAAC,WAAA,EAAA,yCAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAChCwE,CAAAA,CAAAA,CAAAA,EAAAA,EAAAA,oBAAAA,CAAAA,EAAAA,4BAAK,CAAClG,IAAI,CAEb,CAAA;AAED,SAAS6hB,uBAAuBA,CAACrmB,KAAU,EAAU;EACnD,IAAIA,KAAK,KAAKiN,WAAW,EAAE;AACzB,IAAA,OAAO,aAAa,CAAA;AACtB,GAAA;;AAEA;AACF;AACA;AACE,EAAA,IAAI,OAAOjN,KAAK,KAAK,QAAQ,EAAE;IAC7B,IAAIA,KAAK,CAAC+Y,OAAO,KAAK3W,SAAS,IAAIpC,KAAK,CAACA,KAAK,KAAKoC,SAAS,EAAE;MAC5D,MAAM0kB,YAAY,GAAG9mB,KAAK,CAAC+Y,OAAO,CAACvb,KAAK,CAAC,GAAG,CAAC,CAAA;MAC7C,OAAO,CAAA,MAAA,EAASspB,YAAY,CAACA,YAAY,CAAC7pB,MAAM,GAAG,CAAC,CAAC,CAAE,CAAA,CAAA;AACzD,KAAC,MAAM,IAAI+C,KAAK,CAACA,KAAK,KAAKoC,SAAS,IAAIpC,KAAK,CAAC2B,EAAE,KAAKS,SAAS,EAAE;AAC9D;MACA,OAAO,CAAA,MAAA,EACL,OAAOpC,KAAK,CAACA,KAAK,KAAK,QAAQ,GAC3BvB,IAAI,CAACsoB,KAAK,CAAC/mB,KAAK,CAACA,KAAK,GAAG,GAAG,CAAC,GAAG,GAAG,GACnCA,KAAK,CAACA,KAAK,CACf,CAAA,CAAA;AACJ,KAAA;AACA,IAAA,OAAO,MAAM,CAAA;AACf,GAAA;AAEA,EAAA,IAAI,OAAOA,KAAK,KAAK,SAAS,EAAE;AAC9B,IAAA,OAAO,SAAST,IAAI,CAACE,SAAS,CAACO,KAAK,CAAC,CAAE,CAAA,CAAA;AACzC,GAAA;EAEA,OAAO,CAAA,MAAA,EAASA,KAAK,CAAE,CAAA,CAAA;AACzB;;AC3LA,SAASgnB,sBAAsBA,CAACC,IAAa,EAAE;AAC7C,EAAA,MAAM7L,IAAI,GAAG6L,IAAI,CAACC,YAAY,CAAC,MAAM,CAAC,CAAA;AACtC,EAAA,MAAM3L,MAAM,GAAG0L,IAAI,CAACC,YAAY,CAAC,QAAQ,CAAC,CAAA;AAE1C,EAAA,IAAI9L,IAAI,IAAIA,IAAI,KAAK,MAAM,EAAE;AAC3B6L,IAAAA,IAAI,CAACE,YAAY,CAAC,MAAM,EAAE,cAAc,CAAC,CAAA;AAC3C,GAAA;AACA,EAAA,IAAI5L,MAAM,IAAIA,MAAM,KAAK,MAAM,EAAE;AAC/B0L,IAAAA,IAAI,CAACE,YAAY,CAAC,QAAQ,EAAE,cAAc,CAAC,CAAA;AAC7C,GAAA;AAEA/pB,EAAAA,KAAK,CAAC8e,IAAI,CAAC+K,IAAI,CAACvkB,QAAQ,CAAC,CAACpC,OAAO,CAAE8mB,KAAK,IAAKJ,sBAAsB,CAACI,KAAK,CAAC,CAAC,CAAA;AAC7E,CAAA;AAEA,MAAMC,SAAS,GAAGnR,kBAAkB,CAClC,CAAC;EAAExJ,KAAK;EAAE4a,IAAI;AAAEjf,EAAAA,KAAAA;AAAM,CAAC,KAAK;AAC1B,EAAA,MAAMkf,SAAS,GAAG7a,KAAK,CAAC1M,KAAK,CAACA,KAAK,CAAA;AACnC,EAAA,MAAMwnB,QAAQ,GAAG5mB,YAAM,CAAmB,IAAI,CAAC,CAAA;AAE/CuD,EAAAA,eAAS,CAAC,MAAM;IACd,SAASsjB,gBAAgBA,GAAG;AAC1B;AACA,MAAA,MAAMC,KAAK,GAAG,IAAI,CAACA,KAAK,CAAA;AACxB,MAAA,IAAIA,KAAK,CAACzqB,MAAM,KAAK,CAAC,EAAE;AACtB,QAAA,OAAA;AACF,OAAA;AAEA,MAAA,MAAM0qB,MAAM,GAAG,IAAIC,UAAU,EAAE,CAAA;AAC/BD,MAAAA,MAAM,CAACE,MAAM,GAAG,UAAUnkB,KAAK,EAAE;AAC/B;QACA,MAAMokB,OAAO,GAAGpkB,KAAK,CAACuW,MAAM,EAAE7S,MAAM,CAAC2gB,IAAI,EAAE,CAAA;AAE3C,QAAA,MAAMC,QAAQ,GAAG5jB,QAAQ,CAACxB,aAAa,CAAC,KAAK,CAAC,CAAA;QAC9ColB,QAAQ,CAACC,SAAS,GAAGH,OAAO,CAAA;AAC5B,QAAA,MAAMI,GAAG,GAAGF,QAAQ,CAACtlB,QAAQ,CAAC,CAAC,CAAC,CAAA;AAEhCwlB,QAAAA,GAAG,CAACC,eAAe,CAAC,OAAO,CAAC,CAAA;AAC5BD,QAAAA,GAAG,CAACC,eAAe,CAAC,QAAQ,CAAC,CAAA;AAE7BD,QAAAA,GAAG,CAACf,YAAY,CACd,OAAO,EACP,+CACF,CAAC,CAAA;QAEDH,sBAAsB,CAACkB,GAAG,CAAC,CAAA;QAE3B,IAAIA,GAAG,CAACE,OAAO,CAACC,WAAW,EAAE,KAAK,KAAK,EAAE;UACvCC,KAAK,CAAC,gBAAgB,CAAC,CAAA;AACvB,UAAA,OAAA;AACF,SAAA;QAEA5b,KAAK,CAACa,QAAQ,CAAC;UACbvN,KAAK,EAAEgoB,QAAQ,CAACC,SAAAA;AAClB,SAAC,CAAC,CAAA;OACH,CAAA;AACDN,MAAAA,MAAM,CAACY,UAAU,CAACb,KAAK,CAAC,CAAC,CAAC,CAAC,CAAA;AAC7B,KAAA;IAEAF,QAAQ,CAAC3mB,OAAO,CAAE4D,gBAAgB,CAAC,QAAQ,EAAEgjB,gBAAgB,CAAC,CAAA;AAE9D,IAAA,OAAO,MAAM;MACXD,QAAQ,CAAC3mB,OAAO,CAAE6D,mBAAmB,CAAC,QAAQ,EAAE+iB,gBAAgB,CAAC,CAAA;KAClE,CAAA;GACF,EAAE,EAAE,CAAC,CAAA;AAEN,EAAA,oBACEhrB,yBAAA,CAAAmG,aAAA,CACEnG,KAAAA,EAAAA,IAAAA,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEiD,IAAAA,KAAK,EAAE;AACLf,MAAAA,KAAK,EAAE,EAAE;AACTC,MAAAA,MAAM,EAAE,EAAE;AACVmF,MAAAA,QAAQ,EAAE,UAAU;AACpBgJ,MAAAA,KAAK,EAAE,OAAO;AACdsV,MAAAA,YAAY,EAAE,EAAA;AAChB,KAAA;GAEA/rB,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AAAK6lB,IAAAA,uBAAuB,EAAE;AAAEC,MAAAA,MAAM,EAAEnB,SAAAA;AAAU,KAAA;AAAE,GAAE,CACnD,CAAC,eAEN9qB,yBAAA,CAAAmG,aAAA,CAAA,OAAA,EAAA;AAAOyM,IAAAA,IAAI,EAAC,MAAM;AAAC1N,IAAAA,EAAE,EAAC,QAAQ;AAACgnB,IAAAA,MAAM,EAAE,MAAO;AAACrjB,IAAAA,GAAG,EAAEkiB,QAAAA;AAAS,GAAE,CAC5D,CAAC,CAAA;AAEV,CACF,CAAC,CAAA;AAEM,MAAMoB,oBAAoB,GAAG;AAClC9H,EAAAA,MAAM,EAAE,OAAO;AACftX,EAAAA,IAAI,EAAE,MAAM;AACZkN,EAAAA,SAAS,EAAE2Q,SAAAA;AACb,CAAC;;ACxFD,MAAMwB,MAAM,GAAG3S,kBAAkB,CAAmB,CAAC;EAAExJ,KAAK;AAAErE,EAAAA,KAAAA;AAAM,CAAC,KAAK;EACxE,oBACE5L,yBAAA,CAAAmG,aAAA,CAACkmB,kCAAW,EAAAna,4BAAA,KAAKjC,KAAK,EAAA;IAAEyC,GAAG,EAAE9G,KAAK,CAAC8G,GAAI;IAACzQ,GAAG,EAAE2J,KAAK,CAAC3J,GAAI;IAACwQ,IAAI,EAAE7G,KAAK,CAAC6G,IAAAA;AAAK,GAAA,CAAE,CAAC,CAAA;AAEhF,CAAC,CAAC,CAAA;AAEK,MAAM6Z,iBAAiB,GAAG;AAC/BjI,EAAAA,MAAM,EAAE,OAAO;AACftX,EAAAA,IAAI,EAAE,QAAQ;AACdkN,EAAAA,SAAS,EAAEmS,MAAAA;AACb,CAAC;;ACPD,SAASG,cAAcA,GAAsB;AAC3C,EAAA,MAAMziB,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;AAExC,EAAA,MAAMyb,UAAU,GAAGhY,MAAM,CAACiY,WAAW,CACnCjY,MAAM,CAACkY,OAAO,CAAC/R,aAAa,CAAC8M,KAAK,CAAC,CAACzV,MAAM,CAItC2a,mBAAmB,IAC4C;AAC/D,IAAA,OAAOA,mBAAmB,CAAC,CAAC,CAAC,CAAClJ,IAAI,KAAK,QAAQ,CAAA;AACjD,GACF,CACF,CAAC,CAAA;AAED,EAAA,OAAO+I,UAAU,CAAA;AACnB,CAAA;AAEA,MAAM6Q,gBAAgB,GAAG;AACvBzf,EAAAA,IAAI,EAAE,OAAO;AACbkN,EAAAA,SAAS,EAAER,kBAAkB,CAAC,SAASgT,UAAUA,CAAC;IAChD7gB,KAAK;AACLqE,IAAAA,KAAAA;AAGF,GAAC,EAAE;AACD,IAAA,MAAMyc,WAAW,GAAGH,cAAc,EAAE,CAAA;IACpC,MAAMI,oBAAoB,GAAGD,WAAW,CAAC9gB,KAAK,CAACtB,UAAU,CAACsI,IAAI,CAAC,CAAA;AAC/D,IAAA,MAAMga,eAAe,GAAGD,oBAAoB,EAAEpT,MAAM,CAAC5D,SAAS,CAAA;IAE9D,IAAI,CAACiX,eAAe,EAAE;AACpB,MAAA,oBAAO5sB,yBAAA,CAAAmG,aAAA,CAAC0f,aAAa,EAAA;AAACjT,QAAAA,IAAI,EAAEhH,KAAK,CAACtB,UAAU,CAACsI,IAAAA;AAAK,OAAE,CAAC,CAAA;AACvD,KAAA;AAEA,IAAA,oBACE5S,yBAAA,CAAAmG,aAAA,CAACymB,eAAe,EAAA;AACdrpB,MAAAA,KAAK,EAAE0M,KAAK,CAAC1M,KAAK,CAACA,KAAM;MACzBuN,QAAQ,EAAGvN,KAAK,IAAK;QACnB0M,KAAK,CAACa,QAAQ,CAAC;UACbvN,KAAK;AACLqV,UAAAA,QAAQ,EAAE3I,KAAK,CAAC1M,KAAK,CAACqV,QAAAA;AACxB,SAAC,CAAC,CAAA;OACF;AACF0E,MAAAA,MAAM,EACJ,QAAQ,IAAI1R,KAAK,CAACtB,UAAU,GAAGsB,KAAK,CAACtB,UAAU,CAACgT,MAAM,GAAG3X,SAAAA;AAC1D,KACF,CAAC,CAAA;GAEL,CAAA;AACH,CAAC;;ACpDD,MAAMknB,eAAe,GAAGxjB,uBAAM,CAACyjB,0BAAe,CAACC,IAAI,CAAC,CAAAxjB,UAAA,CAAA;EAAAC,WAAA,EAAA,sCAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAAA,CAAA,CAAA,CAAA,2DAAA,EAAA,eAAA,EAAA,kFAAA,EAAA,IAAA,CAAA,EAS9B2E,KAAK,IACvB4e,2CAA2C,CAAC5e,KAAK,CAAC6e,UAAU,CAAC,EAC/C7e,KAAK,IACnB8e,qCAAqC,CAAC9e,KAAK,CAAC+e,QAAQ,CAAC,EAOzC/e,KAAK,IAAMA,KAAK,CAACoW,CAAC,CAACjhB,KAAK,KAAK6K,KAAK,CAACX,QAAQ,GAAG,CAAC,GAAG,GAAI,CAErE,CAAA;AAED,MAAM2f,SAA4D,GAAG,CACnE;AAAEhc,EAAAA,KAAK,EAAE,UAAU;AAAE7N,EAAAA,KAAK,EAAE,UAAA;AAAW,CAAC,EACxC;AAAE6N,EAAAA,KAAK,EAAE,YAAY;AAAE7N,EAAAA,KAAK,EAAE,YAAA;AAAa,CAAC,EAC5C;AAAE6N,EAAAA,KAAK,EAAE,WAAW;AAAE7N,EAAAA,KAAK,EAAE,WAAA;AAAY,CAAC,EAC1C;AAAE6N,EAAAA,KAAK,EAAE,aAAa;AAAE7N,EAAAA,KAAK,EAAE,aAAA;AAAc,CAAC,EAC9C;AAAE6N,EAAAA,KAAK,EAAE,eAAe;AAAE7N,EAAAA,KAAK,EAAE,eAAA;AAAgB,CAAC,EAClD;AAAE6N,EAAAA,KAAK,EAAE,cAAc;AAAE7N,EAAAA,KAAK,EAAE,cAAA;AAAe,CAAC,EAChD;AAAE6N,EAAAA,KAAK,EAAE,aAAa;AAAE7N,EAAAA,KAAK,EAAE,aAAA;AAAc,CAAC,EAC9C;AAAE6N,EAAAA,KAAK,EAAE,eAAe;AAAE7N,EAAAA,KAAK,EAAE,eAAA;AAAgB,CAAC,EAClD;AAAE6N,EAAAA,KAAK,EAAE,cAAc;AAAE7N,EAAAA,KAAK,EAAE,cAAA;AAAe,CAAC,CACjD,CAAA;AAED,SAASypB,2CAA2CA,CAClDvf,QAAqC,EACrC;AACA,EAAA,QAAQA,QAAQ;AACd,IAAA,KAAK,MAAM;AACT,MAAA,OAAO,YAAY,CAAA;AACrB,IAAA,KAAK,QAAQ;AACX,MAAA,OAAO,QAAQ,CAAA;AACjB,IAAA,KAAK,OAAO;AACV,MAAA,OAAO,UAAU,CAAA;AACrB,GAAA;AACF,CAAA;AAEA,SAASyf,qCAAqCA,CAC5Czf,QAAqC,EACrC;AACA,EAAA,QAAQA,QAAQ;AACd,IAAA,KAAK,KAAK;AACR,MAAA,OAAO,YAAY,CAAA;AACrB,IAAA,KAAK,QAAQ;AACX,MAAA,OAAO,QAAQ,CAAA;AACjB,IAAA,KAAK,QAAQ;AACX,MAAA,OAAO,UAAU,CAAA;AACrB,GAAA;AACF,CAAA;AACA,SAAS4f,mBAAmBA,CAAC;EAC3B5f,QAAQ;AACR6f,EAAAA,gBAAAA;AAIF,CAAC,EAAE;AACD,EAAA,oBACEttB,yBAAA,CAAAmG,aAAA,CAAC2mB,0BAAe,CAAC/O,IAAI,EAAA;AACnBxa,IAAAA,KAAK,EAAEkK,QAAS;IAChB8f,aAAa,EAAGC,WAAW,IAAK;MAC9BF,gBAAgB,CAACE,WAAuB,CAAC,CAAA;KACzC;AACFpkB,IAAAA,KAAK,EAAE;AACLgN,MAAAA,OAAO,EAAE,MAAM;AACfqX,MAAAA,gBAAgB,EAAE,gBAAgB;AAClCC,MAAAA,mBAAmB,EAAE,gBAAgB;AACrClP,MAAAA,GAAG,EAAE,GAAG;AACRgE,MAAAA,YAAY,EAAE,KAAK;AACnBF,MAAAA,MAAM,EAAE,CAAA,UAAA,EAAa5Y,6BAAM,CAACikB,OAAO,CAAA,CAAA;AACrC,KAAA;AAAE,GAAA,EAEDP,SAAS,CAACpsB,GAAG,CAAEwjB,CAAC,IAAK;AACpB,IAAA,MAAM,CAAC2I,QAAQ,EAAEF,UAAU,CAAC,GAAGzI,CAAC,CAACjhB,KAAK,CAACxC,KAAK,CAAC,GAAG,CAG/C,CAAA;AAED,IAAA,oBACEf,yBAAA,CAAAmG,aAAA,CAAC0mB,eAAe,EAAA;MACdtpB,KAAK,EAAEihB,CAAC,CAACjhB,KAAM;MACfO,GAAG,EAAE0gB,CAAC,CAACjhB,KAAM;MACb,YAAYihB,EAAAA,CAAC,CAACpT,KAAM;AACpB6b,MAAAA,UAAU,EAAEA,UAAW;AACvBE,MAAAA,QAAQ,EAAEA,QAAS;AACnB3I,MAAAA,CAAC,EAAEA,CAAE;AACL/W,MAAAA,QAAQ,EAAEA,QAAAA;KAEVzN,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEiD,MAAAA,KAAK,EAAE;AACLf,QAAAA,KAAK,EAAE,KAAK;AACZC,QAAAA,MAAM,EAAE,KAAK;AACbslB,QAAAA,eAAe,EAAE,SAAA;AACnB,OAAA;AAAE,KACE,CAAC,eACP5tB,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEiD,MAAAA,KAAK,EAAE;AACLqE,QAAAA,QAAQ,EAAE,UAAU;AACpBogB,QAAAA,GAAG,EAAE,KAAK;AACVngB,QAAAA,IAAI,EAAE,KAAK;AACX0I,QAAAA,OAAO,EAAE,MAAM;AACfE,QAAAA,aAAa,EAAE,QAAQ;AACvB4K,QAAAA,cAAc,EAAE,QAAQ;AACxB7K,QAAAA,UAAU,EACR2W,2CAA2C,CAACC,UAAU,CAAC;AACzDzO,QAAAA,GAAG,EAAE,KAAK;AACVnW,QAAAA,KAAK,EAAE,MAAM;AACbC,QAAAA,MAAM,EAAE,MAAM;QACdod,OAAO,EAAElB,CAAC,CAACjhB,KAAK,KAAKkK,QAAQ,GAAG,CAAC,GAAG,CAAA;AACtC,OAAA;AAAE,KAAA,eAEFzN,yBAAA,CAAAmG,aAAA,CAAC2nB,iBAAiB,EAAA;AAChBC,MAAAA,KAAK,EAAEZ,QAAQ,KAAK,KAAK,GAAG,MAAM,GAAG,QAAA;AAAS,KAC/C,CAAC,eACFntB,yBAAA,CAAAmG,aAAA,CAAC2nB,iBAAiB,EAAA;AAChBC,MAAAA,KAAK,EAAEZ,QAAQ,KAAK,QAAQ,GAAG,MAAM,GAAG,QAAA;AAAS,KAClD,CAAC,eACFntB,yBAAA,CAAAmG,aAAA,CAAC2nB,iBAAiB,EAAA;AAChBC,MAAAA,KAAK,EAAEZ,QAAQ,KAAK,QAAQ,GAAG,MAAM,GAAG,QAAA;KACzC,CACE,CACU,CAAC,CAAA;AAEtB,GAAC,CACmB,CAAC,CAAA;AAE3B,CAAA;AAKA,MAAMW,iBAAiB,GAAGzkB,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,wCAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CACxB+a,CAAAA,CAAAA,CAAAA,QAAAA,EAAAA,uCAAAA,CAAAA,EAAAA,CAAC,IAAMA,CAAC,CAACuJ,KAAK,KAAK,MAAM,GAAG,MAAM,GAAG,KAAM,CAGtD;;AClJD,SAASC,aAAaA,CACpB5f,KAA8E,EAC9E;AACA,EAAA,oBACEpO,yBAAA,CAAAmG,aAAA,CAACknB,mBAAmB,EAAA;AAClB5f,IAAAA,QAAQ,EAAEW,KAAK,CAAC6B,KAAK,CAAC1M,KAAM;IAC5B+pB,gBAAgB,EAAG7f,QAAQ,IAAK;AAC9BW,MAAAA,KAAK,CAAC6B,KAAK,CAACa,QAAQ,CAACrD,QAAQ,CAAC,CAAA;AAChC,KAAA;AAAE,GACH,CAAC,CAAA;AAEN,CAAA;AAEO,MAAMwgB,mBAAmB,GAAG;AACjClhB,EAAAA,IAAI,EAAE,UAAU;EAChBkN,SAAS,EAAER,kBAAkB,CAACuU,aAAa,CAAA;AAC7C,CAAC;;ACFD;AACA;;AAGA,SAASE,qBAAqBA,CAAC;EAC7BtiB,KAAK;EACL9B,aAAa;EACbke,MAAM,GAAIziB,CAAC,IAAKA,CAAC;EACjBxC,KAAK,GAAIwC,CAAC,IAAKA,CAAAA;AAQjB,CAAC,EAAE;EACD,MAAM;IAAEiK,OAAO;IAAEkL,aAAa;IAAEzQ,IAAI;IAAE2Q,OAAO;AAAEtF,IAAAA,aAAAA;AAAc,GAAC,GAC5DxL,aAAa,CAAA;AACf,EAAA,MAAMoe,mBAAmB,GAAGznB,OAAO,CAACmL,KAAK,CAACmB,IAAI,CAAC,CAAA;EAE/C,OAAO;AACL+D,IAAAA,QAAQA,CAACqd,YAAwB,EAAE,GAAGC,cAA4B,EAAE;AAClE;AACN;AACA;AACA;AACA;AACA;;AAEM,MAAA,MAAMnH,QAAmC,GACvCmH,cAAc,CAAC5tB,MAAM,KAAK,CAAC,GACvB2tB,YAAY,GACZ,CAACA,YAAY,EAAE,GAAGC,cAAc,CAAC,CAAA;MAEvC,IACE,CAACztB,KAAK,CAACC,OAAO,CAACutB,YAAY,CAAC,IAC5BxtB,KAAK,CAACC,OAAO,CAACqmB,QAAQ,CAAC,IACvBA,QAAQ,CAACzmB,MAAM,KAAK0nB,mBAAmB,CAAC1nB,MAAM,EAC9C;AACA,QAAA,MAAM,IAAIH,KAAK,CACb,kEACF,CAAC,CAAA;AACH,OAAA;AAEA,MAAA,IAAIiV,aAAa,CAAC7S,IAAI,CAACuc,wBAAwB,CAAC,EAAE;AAChD;AACA;AACA;QACA,MAAM;AAAE3U,UAAAA,UAAAA;SAAY,GAAGL,oBAAS,CAACke,mBAAmB,CAAC,CAAC,CAAC,EAAEje,IAAI,CAAC,CAAA;AAE9DokB,QAAAA,eAAe,CAACnG,mBAAmB,CAAC,CAAC,CAAC,EAAEpe,aAAa,CAAC,CAAA;QAEtD,IAAIO,UAAU,KAAK,4BAA4B,EAAE;AAC/C,UAAA,MAAMikB,sBAAsB,GAAGhuB,IAAI,CACjC4nB,mBAAmB,CAAC,CAAC,CAAC,CAACnnB,KAAK,CAAC,GAAG,CAClC,CAAC,CAAA;AAED,UAAA,MAAMwtB,YAAY,GAAG5mB,QAAQ,CAACib,cAAc,CAC1C,kBACF,CAA6B,CAAA;UAE7B,IAAI2L,YAAY,KAAK,IAAI,IAAIA,YAAY,CAAC1mB,aAAa,KAAK,IAAI,EAAE;AAChE,YAAA,MAAM,IAAIxH,KAAK,CAAC,qBAAqB,CAAC,CAAA;AACxC,WAAA;AAEA,UAAA,IAAI+tB,cAAc,CAAC5tB,MAAM,GAAG,CAAC,EAAE;YAC7B,MAAMguB,YAAY,GAAIvH,QAAQ,CAAgBjmB,GAAG,CAAEuC,KAAK,IACtDR,KAAK,CAAC0rB,QAAQ,CAAClrB,KAAK,CAAC,EAAE2kB,mBAAmB,CAAC,CAAC,CAAC,EAAEtc,KAAK,CACtD,CAAC,CAAA;AAED2iB,YAAAA,YAAY,CAAC1mB,aAAa,CAAC6mB,WAAW,CACpCC,+BAAoB,CAAC;AACnBlkB,cAAAA,IAAI,EAAE6jB,sBAA6B;cACnChkB,UAAU,EAAEsB,KAAK,CAACtB,UAAU;AAC5BmE,cAAAA,MAAM,EAAE+f,YAAAA;aACT,CAAC,EACF,GACF,CAAC,CAAA;AACH,WAAC,MAAM;AACL,YAAA,MAAMI,WAAW,GAAG7rB,KAAK,CACvB0rB,QAAQ,CAACxH,QAAQ,CAAC,EAClBiB,mBAAmB,CAAC,CAAC,CAAC,EACtBtc,KACF,CAAC,CAAA;AAED2iB,YAAAA,YAAY,CAAC1mB,aAAa,CAAC6mB,WAAW,CACpCC,+BAAoB,CAAC;AACnBlkB,cAAAA,IAAI,EAAE6jB,sBAA6B;cACnChkB,UAAU,EAAEsB,KAAK,CAACtB,UAAU;cAC5BmE,MAAM,EAAE,CAACmgB,WAAW,CAAA;aACrB,CAAC,EACF,GACF,CAAC,CAAA;AACH,WAAA;AAEA,UAAA,OAAA;AACF,SAAA;AACF,OAAA;MAEApf,OAAO,CAAC6F,SAAS,CAAC,MAAM;AACtB6S,QAAAA,mBAAmB,CAACrkB,OAAO,CAAC,CAAC/C,IAAI,EAAE+tB,UAAU,KAAK;UAChD,MAAMvd,UAAU,GAAG3Q,KAAK,CAACC,OAAO,CAACqmB,QAAQ,CAAC,GACtCwH,QAAQ,CAACxH,QAAQ,CAAC4H,UAAU,CAAC,CAAC,GAC9BJ,QAAQ,CAACxH,QAAQ,CAAC,CAAA;UAEtB,MAAM6H,oBAAoB,GACxBhlB,aAAa,CAAC8M,KAAK,CAAChL,KAAK,CAACtB,UAAU,CAACsI,IAAI,CAAC,CAAA;AAE5C,UAAA,IACEkc,oBAAoB,IACpB,UAAU,IAAIA,oBAAoB,IAClCA,oBAAoB,CAACC,QAAQ,IAC7B,OAAO,IAAIzd,UAAU,KACpBwd,oBAAoB,CAAClc,IAAI,KAAK,OAAO,GAClC,EAAE,SAAS,IAAItB,UAAU,CAAC,GAC1B,IAAI,CAAC,EACT;YACA,MAAM0d,iBAAiB,GAAGF,oBAAoB,CAACC,QAAQ,CACrDzd,UAAU,CAAC/N,KACb,CAAC,CAAA;YAED,IAAI,CAACyrB,iBAAiB,EAAE;AACtB,cAAA,OAAA;AACF,aAAA;AACF,WAAA;UAEA,IAAIJ,WAAW,GAAG7rB,KAAK,CAACuO,UAAU,EAAExQ,IAAI,EAAE8K,KAAK,CAAC,CAAA;;AAEhD;AACA,UAAA,IAAIqjB,cAAc,CAACnuB,IAAI,CAAC,EAAE;YACxB,MAAMouB,sBAAsB,GAAGC,kBAAkB,CAC/CruB,IAAI,EACJ4Z,aAAa,CAACC,MAChB,CAAC,CAAA;YAED,MAAMyU,kBAAkB,GAAG/qB,cAAc,CACvC4F,IAAI,CAACwE,MAAM,EACXygB,sBACF,CAAC,CAAA;YAEDN,WAAW,GAAG7rB,KAAK,CAACuO,UAAU,EAAE4d,sBAAsB,EAAEtjB,KAAK,CAAC,CAAA;;AAE9D;YACA,IAAIwjB,kBAAkB,KAAKzpB,SAAS,EAAE;cACpC,MAAM0pB,cAAc,GAAGC,yCAA0B,CAC/C5U,aAAa,CAACC,MAAM,EACpBC,OACF,CAAE,CAAA;AAEF,cAAA,MAAM2U,iBAAiB,GAAGzuB,IAAI,CAACC,KAAK,CAAC,GAAG,CAAC,CAAA;AACzC,cAAA,MAAMyuB,gBAAgB,GAAGD,iBAAiB,CAACE,OAAO,CAAC,UAAU,CAAC,CAAA;cAC9D,MAAMC,mBAAmB,GAAG,CAC1B,GAAGH,iBAAiB,CAACzY,KAAK,CAAC,CAAC,EAAE0Y,gBAAgB,GAAG,CAAC,CAAC,EACnD,GAAG,CACJ,CAACzY,IAAI,CAAC,GAAG,CAAC,CAAA;AAEX,cAAA,MAAM4Y,uBAAuB,GAAGR,kBAAkB,CAChDO,mBAAmB,EACnBL,cACF,CAAC,CAAA;cAED,MAAMO,gBAAgB,GAAGT,kBAAkB,CACzCO,mBAAmB,EACnBhV,aAAa,CAACC,MAChB,CAAC,CAAA;AAED1Q,cAAAA,IAAI,CAACgM,MAAM,CACT2Z,gBAAgB,EAChBC,0BAAe,CACbxrB,cAAc,CAAC4F,IAAI,CAACwE,MAAM,EAAEkhB,uBAAuB,CAAC,EACpD7lB,aACF,CACF,CAAC,CAAA;AACH,aAAA;AAEAhJ,YAAAA,IAAI,GAAGouB,sBAAsB,CAAA;AAC/B,WAAA;AAEAb,UAAAA,eAAe,CAACvtB,IAAI,EAAEgJ,aAAa,CAAC,CAAA;;AAEpC;;AAEA;AACV;AACA;;AAEU,UAAA,MAAM/I,KAAK,GAAGD,IAAI,CAACC,KAAK,CAAC,GAAG,CAAC,CAAA;AAC7B,UAAA,MAAM+uB,QAAQ,GAAGxvB,IAAI,CAACS,KAAK,CAAC,CAAA;;AAE5B;AACA,UAAA,MAAMgvB,aAAa,GAAGhvB,KAAK,CAAC+V,KAAK,CAAC,CAAC,EAAE/V,KAAK,CAACP,MAAM,GAAG,CAAC,CAAC,CAACuW,IAAI,CAAC,GAAG,CAAC,CAAA;UAChE,MAAM;AAAE1M,YAAAA,UAAAA;WAAY,GAAGL,oBAAS,CAAC+lB,aAAa,EAAEjmB,aAAa,CAACG,IAAI,CAAC,CAAA;AAEnE,UAAA,MAAM+lB,gBAAgB,GAAG5lB,sCAA2B,CAClDC,UAAU,EACVP,aACF,CAAE,CAAA;UACF,MAAM6F,MAAM,GAAGtL,cAAc,CAC3ByF,aAAa,CAACG,IAAI,CAACwE,MAAM,EACzBshB,aACF,CAAC,CAAA;AAED,UAAA,IAAIC,gBAAgB,IAAIA,gBAAgB,CAAC/Z,MAAM,EAAE;YAC/C,MAAMxH,MAA2B,GAAG,EAAE,CAAA;YACtC,MAAMwhB,oBAAyC,GAAG,EAAE,CAAA;AAEpDD,YAAAA,gBAAgB,CAACzlB,MAAM,CAAC1G,OAAO,CAAEyG,UAAU,IAAK;AAC9C,cAAA,MAAM4lB,GAAG,GAAGvgB,MAAM,CAACrF,UAAU,CAACG,IAAI,CAAC,CAAA;AAEnCgE,cAAAA,MAAM,CAACnE,UAAU,CAACG,IAAI,CAAC,GAAG4M,qCAAsB,CAAC6Y,GAAG,CAAC,GACjDA,GAAG,CAACpmB,aAAa,CAACyN,eAAe,CAAC,GAClC2Y,GAAG,CAAA;cAEPD,oBAAoB,CAAC3lB,UAAU,CAACG,IAAI,CAAC,GACnCmS,6CAA8B,CAC5BsT,GAAG,EACHpmB,aAAa,CAACyN,eAAe,EAC7BzN,aAAa,CAAC0N,OAAO,EACrBqF,+BAAgB,CAAC/S,aAAa,CAAC0N,OAAO,CACxC,CAAC,CAAA;AACL,aAAC,CAAC,CAAA;AAEF,YAAA,MAAMlG,UAAU,GAAG+F,qCAAsB,CAACuX,WAAW,CAAC,GAClDA,WAAW,CAAC9kB,aAAa,CAACyN,eAAe,CAAC,GAC1CqX,WAAW,CAAA;AAEf,YAAA,MAAMjkB,MAAM,GAAGqlB,gBAAgB,CAAC/Z,MAAM,CAAC;AACrCgR,cAAAA,QAAQ,EAAE3V,UAAU;AACpB7G,cAAAA,IAAI,EAAEqlB,QAAQ;cACdrhB,MAAM;AAEN;AACd;AACA;AACA;AACA;AACA;AACcqZ,cAAAA,eAAe,EAAEmI,oBAAAA;AACnB,aAAC,CAAC,IAAI;AACJ,cAAA,CAACH,QAAQ,GAAGxe,UAAAA;aACb,CAAA;AAED0e,YAAAA,gBAAgB,CAACzlB,MAAM,CAAC1G,OAAO,CAAEyG,UAAU,IAAK;cAC9C,IAAI,CAACK,MAAM,CAACwlB,cAAc,CAAC7lB,UAAU,CAACG,IAAI,CAAC,EAAE;AAC3C,gBAAA,OAAA;AACF,eAAA;cAEA,IAAI2lB,UAAU,GAAG,CAAGL,EAAAA,aAAa,IAAIzlB,UAAU,CAACG,IAAI,CAAE,CAAA,CAAA;AACtD,cAAA,IAAI2lB,UAAU,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;AACzBA,gBAAAA,UAAU,GAAGA,UAAU,CAACtlB,SAAS,CAAC,CAAC,CAAC,CAAA;AACtC,eAAA;cAEA,IAAIuM,qCAAsB,CAAC1H,MAAM,CAACrF,UAAU,CAACG,IAAI,CAAC,CAAC,EAAE;AACnDR,gBAAAA,IAAI,CAACgM,MAAM,CACT,CAAGma,EAAAA,UAAU,IAAItmB,aAAa,CAACyN,eAAe,CAAA,CAAE,EAChD5M,MAAM,CAACL,UAAU,CAACG,IAAI,CACxB,CAAC,CAAA;AACH,eAAC,MAAM;AACLR,gBAAAA,IAAI,CAACgM,MAAM,CAAC,CAAA,EAAGma,UAAU,CAAA,CAAE,EAAEzlB,MAAM,CAACL,UAAU,CAACG,IAAI,CAAC,CAAC,CAAA;AACvD,eAAA;AACF,aAAC,CAAC,CAAA;AACJ,WAAC,MAAM;AACLR,YAAAA,IAAI,CAACgM,MAAM,CAACnV,IAAI,EAAE8tB,WAAW,CAAC,CAAA;AAChC,WAAA;AACF,SAAC,CAAC,CAAA;AACJ,OAAC,CAAC,CAAA;KACH;AACDH,IAAAA,QAAQA,GAAG;AACT,MAAA,MAAMzX,WAAW,GAAGkR,mBAAmB,CAAClnB,GAAG,CAAE0J,SAAS,IAAK;QACzD,MAAMolB,QAAQ,GAAGxvB,IAAI,CAACoK,SAAS,CAAC3J,KAAK,CAAC,GAAG,CAAC,CAAC,CAAA;AAE3C,QAAA,IAAI+uB,QAAQ,CAACjlB,UAAU,CAAC,GAAG,CAAC,IAAI,cAAc,IAAIe,KAAK,CAACtB,UAAU,EAAE;AAClE,UAAA,OAAOsB,KAAK,CAACtB,UAAU,CAACqe,YAAY,CAAA;AACtC,SAAA;AAEA,QAAA,IAAIsG,cAAc,CAACvkB,SAAS,CAAC,EAAE;UAC7B,MAAM2lB,iBAAiB,GAAGlB,kBAAkB,CAC1CzkB,SAAS,EACTZ,aAAa,CAAC4Q,aAAa,CAACC,MAC9B,CAAC,CAAA;UAED,MAAMyN,UAAU,GAAG/jB,cAAc,CAAC4F,IAAI,CAACwE,MAAM,EAAE4hB,iBAAiB,CAAC,CAAA;AAEjE,UAAA,IAAIjI,UAAU,EAAE;AACd,YAAA,OAAOA,UAAU,CAAA;AACnB,WAAA;AAEA,UAAA,MAAMiH,cAAc,GAAGC,yCAA0B,CAC/CxlB,aAAa,CAAC4Q,aAAa,CAACC,MAAM,EAClC7Q,aAAa,CAAC8Q,OAChB,CAAE,CAAA;AAEF,UAAA,MAAM0V,yBAAyB,GAAGnB,kBAAkB,CAClDzkB,SAAS,EACT2kB,cACF,CAAC,CAAA;UAED,MAAMkB,kBAAkB,GAAGlsB,cAAc,CACvC4F,IAAI,CAACwE,MAAM,EACX6hB,yBACF,CAAC,CAAA;AAED,UAAA,OAAOC,kBAAkB,CAAA;AAC3B,SAAA;AAEA,QAAA,OAAOlsB,cAAc,CAAC4F,IAAI,CAACwE,MAAM,EAAE/D,SAAS,CAAC,CAAA;AAC/C,OAAC,CAAC,CAAA;AAEF,MAAA,MAAMgf,iBAAiB,GAAGvK,eAAe,CAACnI,WAAW,EAAGoR,UAAU,IAAK;QACrE,MAAM;AAAEoI,UAAAA,OAAAA;SAAS,GAAGC,8BAAmB,CACrC7kB,KAAK,CAACtB,UAAU,EAChBR,aACF,CAAC,CAAA;QAED,OAAO0mB,OAAO,CACZpI,UAAU,EACVte,aAAa,CAACyN,eAAe,EAC7BzN,aAAa,CAAC0N,OAChB,CAAC,CAAA;AACH,OAAC,CAAC,CAAA;AAEF,MAAA,IAAIkS,iBAAiB,CAAClpB,MAAM,GAAG,CAAC,EAAE;QAChC,OAAO;AAAEmQ,UAAAA,SAAS,EAAE,IAAA;SAAM,CAAA;AAC5B,OAAA;AAEA,MAAA,OAAOqX,MAAM,CAAC0B,iBAAiB,CAAC,CAAC,CAAC,EAAExB,mBAAmB,CAAC,CAAC,CAAC,EAAEtc,KAAK,CAAC,CAAA;AACpE,KAAA;GACD,CAAA;AACH,CAAA;AAIA,SAASqjB,cAAcA,CAAChQ,UAAkB,EAAE;AAC1C,EAAA,OAAOA,UAAU,CAACtc,QAAQ,CAAC,UAAU,CAAC,CAAA;AACxC,CAAA;AAEA,SAASwsB,kBAAkBA,CAAClQ,UAAkB,EAAEtE,MAAc,EAAE;EAC9D,MAAM+V,kBAAkB,GAAGzR,UAAU,CAAC9Z,OAAO,CAAC,UAAU,EAAEwV,MAAM,CAAC,CAAA;AACjE,EAAA,OAAO+V,kBAAkB,CAAA;AAC3B,CAAA;AAEA,SAASjC,QAAQA,CACfkC,YAA2E,EAC3E;AACA;AACA;AACA,EAAA,MAAMC,aAAa,GACjB,OAAOD,YAAY,KAAK,QAAQ,IAChCA,YAAY,KAAK,IAAI,IACrB,eAAe,IAAIA,YAAY,CAAA;AAEjC,EAAA,IAAIC,aAAa,EAAE;AACjB,IAAA,IACE,SAAS,IAAID,YAAY,CAACE,aAAa,IACvCF,YAAY,CAACE,aAAa,CAACje,IAAI,KAAK,UAAU,EAC9C;AACA,MAAA,OAAO+d,YAAY,CAACE,aAAa,CAAC1gB,OAAO,CAAA;AAC3C,KAAA;AAEA,IAAA,OAAOwgB,YAAY,CAACE,aAAa,CAACttB,KAAK,CAAA;AACzC,GAAC,MAAM;AACL,IAAA,OAAOotB,YAAY,CAAA;AACrB,GAAA;AACF,CAAA;AAQA;AACA;AACA;AACA;AACA,MAAMG,wBAA0C,GAAGA,CACjDC,KAAK,EACLC,WAAW,EACX7wB,OAAO,KACJ;EACH,MAAM8wB,iBAAgC,GAAG,EAAE,CAAA;EAC3C,MAAM;IAAE5mB,UAAU;IAAEK,SAAS;AAAER,IAAAA,MAAAA;GAAQ,GAAGF,oBAAS,CACjDgnB,WAAW,EACX7wB,OAAO,CAAC8J,IACV,CAAC,CAAA;AAED,EAAA,MAAMinB,qCAAqC,GACzC7mB,UAAU,CAACQ,UAAU,CAAC,uBAAuB,CAAC,IAC9CX,MAAM,EAAEG,UAAU,CAACQ,UAAU,CAAC,uBAAuB,CAAC,CAAA;AAExD,EAAA,IAAIqmB,qCAAqC,EAAE;AACzC,IAAA,MAAMC,YAAY,GAChB9mB,UAAU,KAAK,uBAAuB,IAAIK,SAAS,GAC/CsmB,WAAW,CAAC7rB,OAAO,CAAC,CAAIuF,CAAAA,EAAAA,SAAS,CAAE,CAAA,EAAE,EAAE,CAAC,GACxC0mB,wCAA6B,CAC7BJ,WAAW,EACX,uBAAuB,EACvB7wB,OAAO,CAAC8J,IACV,CAAC,CAAA;IAEL,MAAMonB,cAAc,GAAGhtB,cAAc,CAAClE,OAAO,CAAC8J,IAAI,CAACwE,MAAM,EAAE0iB,YAAY,CAAC,CAAA;AAExEG,IAAAA,6BAAkB,CAACD,cAAc,EAAElxB,OAAO,EAAE,CAAC;AAAEoxB,MAAAA,eAAAA;AAAgB,KAAC,KAAK;MACnE,IACEA,eAAe,IACfA,eAAe,CAAC/kB,UAAU,CAAC3B,UAAU,CAAC,uBAAuB,CAAC,EAC9D;AACAomB,QAAAA,iBAAiB,CAACjlB,IAAI,CAACulB,eAAe,CAACliB,GAAI,CAAC,CAAA;AAC9C,OAAA;AACF,KAAC,CAAC,CAAA;AACJ,GAAA;AAEA,EAAA,OAAO4hB,iBAAiB,CAAA;AAC1B,CAAC,CAAA;AAED,MAAMO,iBAA0C,GAAG,CAACV,wBAAwB,CAAC,CAAA;AAE7E,SAASzC,eAAeA,CAAC2C,WAAmB,EAAE7wB,OAA0B,EAAE;EACxE,MAAM8wB,iBAAiB,GAAG,IAAI3pB,GAAG,CAC/BkqB,iBAAiB,CAAC5kB,OAAO,CAAE6kB,WAAW,IAAK;IACzC,OAAOA,WAAW,CAACtxB,OAAO,CAACuxB,gBAAgB,EAAEV,WAAW,EAAE7wB,OAAO,CAAC,CAAA;AACpE,GAAC,CACH,CAAC,CAAA;AAED8wB,EAAAA,iBAAiB,CAACptB,OAAO,CAAE8tB,QAAQ,IAAK;AACtCxxB,IAAAA,OAAO,CAACuxB,gBAAgB,CAAC3jB,MAAM,CAAC4jB,QAAQ,CAAC,CAAA;AAC3C,GAAC,CAAC,CAAA;AACJ;;AChaA,SAASC,sBAAsBA,CAAChmB,KAAoB,EAAW;AAC7D,EAAA,IAAIA,KAAK,CAAC+J,SAAS,KAAK,IAAI,EAAE,OAAO,KAAK,CAAA;EAE1C,IAAIhV,KAAK,CAACC,OAAO,CAACgL,KAAK,CAACmB,IAAI,CAAC,EAAE;AAC7B,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;EAEA,IAAInB,KAAK,CAACQ,MAAM,EAAE;AAChB,IAAA,OAAO,KAAK,CAAA;AACd,GAAA;AAEA,EAAA,OAAO,IAAI,CAAA;AACb,CAAA;AAEA,MAAMylB,gBAAoC,GAAG,CAC3C1W,eAAe,EACfnB,iBAAiB,EACjBqB,iBAAiB,EACjBlB,iBAAiB,EACjBE,qBAAqB,EACrB4T,mBAAmB,EACnB7J,gBAAgB,EAChBkI,iBAAiB,EACjBH,oBAAoB,EACpBjC,qBAAqB,EACrB7C,mBAAmB,EACnB9I,gBAAgB,EAChBqH,mBAAmB,EACnB4G,gBAAgB,CACjB,CAAA;AAEM,SAASxC,YAAYA,CAAC;EAC3B/f,IAAI;EACJ2B,KAAK;EACLoJ,MAAM;AACNG,EAAAA,aAAAA;AACiB,CAAC,EAAE;AACpB,EAAA,MAAMrL,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;AAExC,EAAA,IAAI,CAAC0xB,sBAAsB,CAAChmB,KAAK,CAAC,EAAE;AAClC,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;AAEA,EAAA,MAAMkmB,cAAc,GAAGD,gBAAgB,CAACrnB,IAAI,CACzCmL,SAAS,IAAKA,SAAS,CAAC5I,IAAI,KAAMnB,KAAK,CAAC+J,SAC3C,CAAC,CAAA;EAED,MAAM;IAAE7E,QAAQ;AAAE2d,IAAAA,QAAAA;GAAU,GAAGP,qBAAqB,CAAC;IACnDtiB,KAAK;IACL9B,aAAa;AACbke,IAAAA,MAAM,EAAEpc,KAAK,CAACoc,MAAM,IAAI8J,cAAc,EAAE9J,MAAM;AAC9CjlB,IAAAA,KAAK,EAAE6I,KAAK,CAAC7I,KAAK,IAAI+uB,cAAc,EAAE/uB,KAAAA;AACxC,GAAC,CAAC,CAAA;AAEF,EAAA,IAAI+uB,cAAc,EAAE;AAClB,IAAA,oBACE9xB,yBAAA,CAAAmG,aAAA,CAAC2rB,cAAc,CAAC7X,SAAS,EAAA;AACvB;AACA;AACA;AACA;AACA;AACA;AACAhK,MAAAA,KAAK,EAAE;QACL1M,KAAK,EAAEkrB,QAAQ,EAAE;AACjB3d,QAAAA,QAAAA;AACF,OAAA;AACA;AAAA;MACA+Z,IAAI,EAAE,EAAG;AACT9E,MAAAA,QAAQ,EAAE9b,IAAK;MACfA,IAAI,EAAEA,IAAI,CAAC8nB,SAAU;AACrBnmB,MAAAA,KAAK,EAAEA,KAAM;AACboJ,MAAAA,MAAM,EAAEA,MAAO;AACfG,MAAAA,aAAa,EAAEA,aAAAA;AAAc,KAC9B,CAAC,CAAA;AAEN,GAAA;AAEA,EAAA,IAAI,OAAOvJ,KAAK,CAAC+J,SAAS,KAAK,QAAQ,IAAI/J,KAAK,CAAC+J,SAAS,KAAK,IAAI,EAAE;AACnErJ,IAAAA,OAAO,CAAC0lB,GAAG,CAAC,cAAc,CAAC,CAAA;AAE3B,IAAA,oBACEhyB,yBAAA,CAAAmG,aAAA,CAACyF,KAAK,CAAC+J,SAAS,EAAA;AACd1F,MAAAA,KAAK,EAAE;QACL1M,KAAK,EAAEkrB,QAAQ,EAAE;AACjB3d,QAAAA,QAAAA;OACA;MACF+Z,IAAI,EAAE,EAAG;AACT9E,MAAAA,QAAQ,EAAE9b,IAAK;MACfA,IAAI,EAAEA,IAAI,CAAC8nB,SAAU;AACrBnmB,MAAAA,KAAK,EAAEA,KAAM;AACboJ,MAAAA,MAAM,EAAEA,MAAO;AACfG,MAAAA,aAAa,EAAEA,aAAAA;AAAc,KAC9B,CAAC,CAAA;AAEN,GAAA;AAEA,EAAA,oBACEnV,yBAAA,CAAAmG,aAAA,CAAC4O,gBAAgB,EAAA;AACf9E,IAAAA,KAAK,EAAE;MACL1M,KAAK,EAAEkrB,QAAQ,EAAE;AACjB3d,MAAAA,QAAAA;KACA;AACFlF,IAAAA,KAAK,EAAEA,KAAM;AACbqJ,IAAAA,MAAM,EAAC,QAAA;GAEPjV,eAAAA,yBAAA,CAAAmG,aAAA,CAACqT,iCAAU,EAAC,IAAA,EAAA,yBAAmC,CAC/B,CAAC,CAAA;AAEvB,CAAA;AAOA,MAAMyY,cAAc,GAAG5oB,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,gCAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAGXC,CAAAA,CAAAA,CAAAA,8CAAAA,EAAAA,GAAAA,CAAAA,EAAAA,6BAAM,CAACikB,OAAO,CACnC,CAAA;AAEM,SAASxJ,aAAaA,CAAC;EAAEla,IAAI;AAAE0B,EAAAA,MAAAA;AAA2B,CAAC,EAAE;AAClE,EAAA,MAAM7B,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;AACxC,EAAA,MAAMwkB,YAAY,GAAGtkB,gBAAU,CAACwjB,YAAY,CAAC,CAAA;EAC7C,MAAMsO,OAA6C,GAAG,EAAE,CAAA;EACxD,MAAMC,SAA+B,GAAG,EAAE,CAAA;AAE1CxmB,EAAAA,MAAM,CAAC9H,OAAO,CAAE+H,KAAK,IAAK;AACxB,IAAA,IAAI,CAACgmB,sBAAsB,CAAChmB,KAAK,CAAC,EAAE;AAClC,MAAA,OAAA;AACF,KAAA;IAEA,IAAIA,KAAK,CAACO,KAAK,EAAE;AACf+lB,MAAAA,OAAO,CAACtmB,KAAK,CAACO,KAAK,CAAC,GAAG+lB,OAAO,CAACtmB,KAAK,CAACO,KAAK,CAAC,IAAI,EAAE,CAAA;MACjD+lB,OAAO,CAACtmB,KAAK,CAACO,KAAK,CAAC,CAACH,IAAI,CAACJ,KAAK,CAAC,CAAA;AAClC,KAAC,MAAM;AACL,MAAA,IAAIA,KAAK,CAAC+J,SAAS,KAAK,UAAU,EAAE;AAClC,QAAA,OAAA;AACF,OAAA;AAEAwc,MAAAA,SAAS,CAACnmB,IAAI,CAACJ,KAAK,CAAC,CAAA;AACvB,KAAA;AACF,GAAC,CAAC,CAAA;EAEF,MAAMwmB,cAAc,gBAAGpyB,yBAAA,CAAAmG,aAAA,CAAC8rB,cAAc,MAAE,CAAC,CAAA;AAEzC,EAAA,MAAMI,aAAa,GAAG1mB,MAAM,CAACnB,IAAI,CAAEoB,KAAK,IAAKA,KAAK,CAAC+J,SAAS,KAAK,UAAU,CAAC,CAAA;EAE5E,MAAM4B,eAAe,GAAGmN,YAAY,GAChC5a,aAAa,CAACyN,eAAe,GAC7B5R,SAAS,CAAA;EAEb,oBACE3F,yBAAA,CAAAmG,aAAA,CAACmsB,WAAW,EACTD,IAAAA,EAAAA,aAAa,KAAK1sB,SAAS,iBAC1B3F,yBAAA,CAAAmG,aAAA,CAACnG,yBAAK,CAAC2d,QAAQ,qBACb3d,yBAAA,CAAAmG,aAAA,CAAC6jB,YAAY,EAAA;AAACpe,IAAAA,KAAK,EAAEymB,aAAc;AAACpoB,IAAAA,IAAI,EAAEA,IAAAA;AAAK,GAAE,CAAC,EACjDmoB,cACa,CACjB,EACAzuB,MAAM,CAACC,IAAI,CAACsuB,OAAO,CAAC,CAAClxB,GAAG,CAAEuxB,SAAS,iBAClCvyB,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AAAKrC,IAAAA,GAAG,EAAEyuB,SAAAA;GACRvyB,eAAAA,yBAAA,CAAAmG,aAAA,CAACqsB,gBAAgB,EAAED,IAAAA,EAAAA,SAA4B,CAAC,EAC/CL,OAAO,CAACK,SAAS,CAAC,CAACvxB,GAAG,CAAC,CAAC4K,KAAK,EAAE1J,KAAK,EAAEyJ,MAAM,kBAC3C3L,yBAAA,CAAAmG,aAAA,CAAC2R,YAAY,EAAA;AACXhU,IAAAA,GAAG,EAAE2uB,gBAAgB,CAAC7mB,KAAK,EAAE2L,eAAe,CAAE;AAC9Cmb,IAAAA,MAAM,EAAExwB,KAAK,KAAKyJ,MAAM,CAACnL,MAAM,GAAG,CAAA;AAAE,GAAA,eAEpCR,yBAAA,CAAAmG,aAAA,CAAC6jB,YAAY,EAAA;AACXpe,IAAAA,KAAK,EAAEA,KAAM;AACb3B,IAAAA,IAAI,EAAEA,IAAK;AACXkL,IAAAA,aAAa,EAAEvJ,KAAK,CAACtB,UAAU,CAAC6K,aAAAA;GACjC,CACW,CACf,CAAC,EACDid,cACE,CACN,CAAC,EACDD,SAAS,CAACnxB,GAAG,CAAC,CAAC4K,KAAK,EAAE1J,KAAK,EAAEyJ,MAAM,kBAClC3L,yBAAA,CAAAmG,aAAA,CAAC2R,YAAY,EAAA;AACXhU,IAAAA,GAAG,EAAE2uB,gBAAgB,CAAC7mB,KAAK,EAAE2L,eAAe,CAAE;AAC9Cmb,IAAAA,MAAM,EAAExwB,KAAK,KAAKyJ,MAAM,CAACnL,MAAM,GAAG,CAAA;AAAE,GAAA,eAEpCR,yBAAA,CAAAmG,aAAA,CAAC6jB,YAAY,EAAA;AACXpe,IAAAA,KAAK,EAAEA,KAAM;AACb3B,IAAAA,IAAI,EAAEA,IAAK;AACXkL,IAAAA,aAAa,EAAEvJ,KAAK,CAACtB,UAAU,CAAC6K,aAAAA;AAAc,GAC/C,CACW,CACf,CAAC,EACDid,cACU,CAAC,CAAA;AAElB,CAAA;AAEA,SAASK,gBAAgBA,CACvB7mB,KAAoB,EACpB2L,eAAmC,EACnC;AACA,EAAA,MAAMzT,GAAG,GAAG,CAAGrD,EAAAA,OAAO,CAACmL,KAAK,CAACmB,IAAI,CAAC,CAACgK,IAAI,CAAC,GAAG,CAAC,CAAInL,CAAAA,EAAAA,KAAK,CAACtB,UAAU,CAACsI,IAAI,CACnE2E,EAAAA,eAAe,GAAG,CAAA,CAAA,EAAIA,eAAe,CAAA,CAAE,GAAG,EAAE,CAC5C,CAAA,CAAA;AACF,EAAA,OAAOzT,GAAG,CAAA;AACZ,CAAA;AAEA,MAAMgU,YAAY,GAAGzO,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,8BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CACX2E,CAAAA,CAAAA,CAAAA,gBAAAA,EAAAA,GAAAA,CAAAA,EAAAA,KAAK,IAAMA,KAAK,CAACskB,MAAM,GAAG,KAAK,GAAG,CAAE,CACvD,CAAA;AAED,MAAMF,gBAAgB,GAAGnpB,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,kCAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAM/BwE,CAAAA,CAAAA,CAAAA,8DAAAA,EAAAA,cAAAA,CAAAA,EAAAA,4BAAK,CAACmD,KAAK,CAEd,CAAA;AAED,MAAMkhB,WAAW,GAAGjpB,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,6BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAQ7B,CAAA,CAAA,CAAA,uHAAA,CAAA,CAAA;;ACrQD,MAAMkpB,KAAK,GAAG/Y,oBAAG,CAkEhB,CAAA,+/CAAA,CAAA,CAAA,CAAA;AAEM,MAAMgZ,YAAY,GAAGC,kCAAiB,CAAA,CAAA,EAAA,EAAA,GAAA,CAAA,EACzCF,KAAK,CACR,CAAA;AAED,MAAMG,iBAAiB,GAAGlZ,oBAAG,CAuF5B,CAAA,8pCAAA,CAAA,CAAA,CAAA;AAEM,MAAMmZ,UAAU,GAAG1pB,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,oBAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAAA,CAAA,CAAA,CAAA,EAAA,EAAA,EAAA,CAAA,EAChCqpB,iBAAiB,CACpB;;ACzJD,MAAME,MAAM,GAAG3pB,uBAAM,CAAC8gB,MAAM,CAAA5gB,UAAA,CAAA;EAAAC,WAAA,EAAA,QAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAwBvB+a,CAAAA,CAAAA,CAAAA,qhBAAAA,EAAAA,GAAAA,EAAAA,GAAAA,EAAAA,GAAAA,EAAAA,GAAAA,EAAAA,GAAAA,EAAAA,GAAAA,CAAAA,EAAAA,CAAC,IACFA,CAAC,CAACtU,QAAQ,IACV0J,oBAAG,CAAA,CAAA,sDAAA,CAAA,CAIF,EAEA4K,CAAC,IACFA,CAAC,CAACyO,OAAO,IACTrZ,oBAAG,CAAA,CAAA,0OAAA,CAAA,CAWF,EAEA4K,CAAC,IACFA,CAAC,CAAC0O,KAAK,IACPtZ,oBAAG,CAAA,CAAA,kFAAA,CAAA,CAIF,EAEA4K,CAAC,IACFA,CAAC,CAACzM,MAAM,IACR6B,oBAAG,CAIF,CAAA,uCAAA,CAAA,CAAA,EAEA4K,CAAC,IACFA,CAAC,CAAC2O,IAAI,IACNvZ,oBAAG,CAEF,CAAA,cAAA,CAAA,CAAA,EAEA4K,CAAC,IACFA,CAAC,CAAC4O,IAAI,IACNxZ,oBAAG,CAAA,CAAA,cAAA,CAAA,CAEF,CACJ,CAAA;AAEM,MAAMyZ,gBAAgB,GAAG,EAAE,CAAA;AAClC,MAAMC,SAAS,GAAG,EAAE,CAAA;AAEb,MAAMC,UAAU,GAAGlqB,uBAAM,CAAC2pB,MAAM,CAAC,CAAAzpB,UAAA,CAAA;EAAAC,WAAA,EAAA,oBAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAAA,CAAA,CAAA,CAAA,kBAAA,EAAA,YAAA,EAAA,gLAAA,EAAA,YAAA,EAAA,oCAAA,EAAA,GAAA,CAAA,EAE7B4pB,gBAAgB,EACfA,gBAAgB,EAYfC,SAAS,EACRA,SAAS,EAIlBllB,KAAK,IACNA,KAAK,CAACoG,IAAI,IACVoF,oBAAG,sQAcF,CACJ;;ACpHM,SAAS4Z,cAAcA,CAAC;AAAE7nB,EAAAA,MAAAA;AAA4B,CAAC,EAAE;EAC9D,MAAM8nB,gBAAgB,GAAG,EAAE9nB,MAAM,IAAIA,MAAM,CAACnL,MAAM,CAAC,CAAA;AAEnD,EAAA,IAAIizB,gBAAgB,EAAE;AACpB,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;AAEA,EAAA,oBACEzzB,yBAAA,CAAAmG,aAAA,CAAC4sB,UAAU,EAAA;IACTxjB,OAAO,EAAGgO,CAAa,IAAK;MAC1BA,CAAC,CAACmW,eAAe,EAAE,CAAA;KACnB;AACFtqB,IAAAA,KAAK,EAAE;AAAEd,MAAAA,MAAM,EAAE,MAAA;AAAO,KAAA;AAAE,GAAA,eAG1BtI,yBAAA,CAAAmG,aAAA,CAACwtB,eAAe,EAAA;AAAChoB,IAAAA,MAAM,EAAEA,MAAAA;AAAO,GAAE,CACxB,CAAC,CAAA;AAEjB,CAAA;AAMA,SAASgoB,eAAeA,CAAC;AAAEhoB,EAAAA,MAAAA;AAA6B,CAAC,EAAE;EACzD,MAAM;IAAE1B,IAAI;AAAEqL,IAAAA,aAAAA;GAAe,GAAGpV,gBAAgB,EAAE,CAAA;AAElD,EAAA,oBACEF,yBAAA,CAAAmG,aAAA,CAACytB,QAAQ,EAAA;AAAC1uB,IAAAA,EAAE,EAAE,qBAAA;GACZlF,eAAAA,yBAAA,CAAAmG,aAAA,CAAC0tB,SAAO,qBACN7zB,yBAAA,CAAAmG,aAAA,CAACge,aAAa,EAAA;AAACla,IAAAA,IAAI,EAAEA,IAAK;AAAC0B,IAAAA,MAAM,EAAEA,MAAAA;AAAO,GAAE,CAAC,eAC7C3L,yBAAA,CAAAmG,aAAA,CAACgI,aAAa,EAAA;AAACK,IAAAA,KAAK,EAAE8G,aAAAA;GAAgB,CAC/B,CACD,CAAC,CAAA;AAEf,CAAA;AAEA,MAAMse,QAAQ,GAAGvqB,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,2BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAS1B,CAAA,CAAA,CAAA,iKAAA,CAAA,CAAA,CAAA;AAED,MAAMoqB,SAAO,GAAGxqB,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,0BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAMzB,CAAA,CAAA,CAAA,qEAAA,CAAA,CAAA;;AClDD,MAAMpJ,OAAK,GAAGgJ,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,sBAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CACpBwE,CAAAA,CAAAA,CAAAA,EAAAA,EAAAA,2JAAAA,CAAAA,EAAAA,4BAAK,CAAClG,IAAI,CAQb,CAAA;AAEM,MAAM+rB,aAA2C,GAAI1lB,KAAK,IAAK;EACpE,MAAM;IAAEkH,aAAa;AAAErL,IAAAA,IAAAA;AAAK,GAAC,GAAGmE,KAAK,CAAA;AACrC,EAAA,MAAMtE,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;EAExC,MAAM4N,KAAK,GAAG,CAAC,MAAM;AACnB,IAAA,IAAIwH,aAAa,CAAC9U,MAAM,KAAK,CAAC,EAAE;AAC9B,MAAA,MAAMM,IAAI,GAAGwU,aAAa,CAAC,CAAC,CAAC,CAAA;MAC7B,MAAM/J,iBAA0C,GAAGlH,cAAc,CAC/DyF,aAAa,CAAC0B,uBAAuB,EACrC1K,IACF,CAAC,CAAA;MACD,MAAMizB,iBAAiB,GAAG1vB,cAAc,CAAC4F,IAAI,CAACwE,MAAM,EAAE3N,IAAI,CAAC,CAAA;AAC3D,MAAA,IAAIyK,iBAAiB,EAAEiB,UAAU,KAAK,+BAA+B,EAAE;AACrE,QAAA,OAAO,CAAwCunB,qCAAAA,EAAAA,iBAAiB,CAACvnB,UAAU,CAAyE,uEAAA,CAAA,CAAA;AACtJ,OAAA;AACF,KAAA;AAEA,IAAA,OAAO,IAAI,CAAA;AACb,GAAC,GAAG,CAAA;AAEJ,EAAA,MAAMwnB,yBAAyB,GAAG1e,aAAa,CAAC9U,MAAM,GAAG,CAAC,CAAA;AAC1D,EAAA,MAAMyzB,aAAa,GAAG3e,aAAa,CAAC9U,MAAM,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG8U,aAAa,CAAA;AACvE,EAAA,MAAM4e,qBAAqB,GAAGD,aAAa,CAACjzB,GAAG,CAAEmzB,YAAY,IAAK;AAChE,IAAA,OAAOjpB,eAAe,CAACipB,YAAY,EAAErqB,aAAa,CAAC,CAAA;AACrD,GAAC,CAAC,CAAA;AAEF,EAAA,MAAMia,YAAY,GAAGiQ,yBAAyB,GAC1CtU,iBAAiB,CAAC;AAChB/T,IAAAA,MAAM,EAAEuoB,qBAAAA;AACV,GAAC,CAAC,GACFA,qBAAqB,CAACpU,IAAI,EAAE,CAAA;EAEhC,oBACE9f,yBAAA,CAAAmG,aAAA,CAAAnG,yBAAA,CAAA2d,QAAA,EACG7P,IAAAA,EAAAA,KAAK,iBAAI9N,yBAAA,CAAAmG,aAAA,CAAC9F,OAAK,EAAA,IAAA,EAAEyN,KAAa,CAAC,eAChC9N,yBAAA,CAAAmG,aAAA,CAACqtB,cAAc,EAAA;AAAC7nB,IAAAA,MAAM,EAAEoY,YAAAA;AAAa,GAAE,CACvC,CAAC,CAAA;AAEP,CAAC;;AC5CM,MAAMqQ,cAAc,GAAG,EAAE,CAAA;AAEhC,MAAMC,MAAM,GAAGhrB,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,sBAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAAA,CAAA,CAAA,CAAA,2HAAA,EAAA,+EAAA,CAAA,EAMT2qB,cAAc,CAK7B,CAAA;AAED,MAAME,KAAK,GAAGjrB,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,qBAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAAA,CAAA,CAAA,CAAA,aAAA,EAAA,eAAA,EAAA,8HAAA,CAAA,EACRC,6BAAM,CAAC0gB,MAAM,EAEzBnc,4BAAK,CAACmD,KAAK,CAQd,CAAA;AAED,MAAMmjB,UAAU,GAAGlrB,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,0BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAS5B,CAAA,CAAA,CAAA,0GAAA,CAAA,CAAA,CAAA;AAED,MAAM+qB,WAAW,GAAGnrB,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,2BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAS7B,CAAA,CAAA,CAAA,4GAAA,CAAA,CAAA,CAAA;AAED,MAAMgrB,YAAY,GAAGprB,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,4BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAK9B,CAAA,CAAA,CAAA,oEAAA,CAAA,CAAA,CAAA;AAED,MAAMirB,gBAAc,GAAGrrB,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,8BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAIhC,CAAA,CAAA,CAAA,2CAAA,CAAA,CAAA,CAAA;AAED,MAAMkrB,KAAK,GAAGtrB,uBAAM,CAACurB,GAAG,CAAArrB,UAAA,CAAA;EAAAC,WAAA,EAAA,qBAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAIvB,CAAA,CAAA,CAAA,4CAAA,CAAA,CAAA,CAAA;AAEM,MAAMorB,YAgBX,GAAGA,CAAC;EACJ7Q,OAAO;EACP8Q,cAAc;EACdC,gBAAgB;EAChBvd,OAAO;EACPwd,QAAQ;EACRC,iBAAiB;EACjBC,SAAS;EACTC,MAAM;EACNC,MAAM;EACNxa,OAAO;EACPD,MAAM;EACN0a,cAAc;EACdC,eAAe;AACfnmB,EAAAA,QAAAA;AACF,CAAC,KAAK;AACF,EAAA,MAAMomB,UAAU,GAAGpxB,YAAM,CAAiB,IAAI,CAAC,CAAA;EAC/C,MAAMqxB,MAAM,GAAG,IAAIC,eAAe,CAAC3tB,MAAM,CAACmB,QAAQ,CAACysB,MAAM,CAAC,CAAA;AAC1D,EAAA,MAAMC,OAAO,GAAGH,MAAM,CAACI,GAAG,CAAC,SAAS,CAAC,CAAA;AACrC,EAAA,MAAMC,MAAM,GAAGL,MAAM,CAACI,GAAG,CAAC,QAAQ,CAAC,CAAA;AAEnC,EAAA,oBACE51B,yBAAA,CAAAmG,aAAA,CAACkuB,MAAM,EAAA;AAACxrB,IAAAA,GAAG,EAAE0sB,UAAAA;GACXv1B,eAAAA,yBAAA,CAAAmG,aAAA,CAACouB,UAAU,EACR,IAAA,EAAA,CAACe,eAAe,iBACft1B,yBAAA,CAAAmG,aAAA,CAAAnG,yBAAA,CAAA2d,QAAA,qBACE3d,yBAAA,CAAAmG,aAAA,CAACub,kCAAW,EAAA;IAACtP,IAAI,EAAEC,4BAAK,CAACyjB,KAAM;IAACvjB,SAAS,EAAA,IAAA;AAAChD,IAAAA,OAAO,EAAEyU,OAAAA;AAAQ,GAAA,EAAC,OAE/C,CAAC,eAEdhkB,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEiD,IAAAA,KAAK,EAAE;AAAEd,MAAAA,MAAM,EAAE,MAAM;MAAEytB,UAAU,EAAErsB,6BAAM,CAACikB,OAAO;AAAEtlB,MAAAA,KAAK,EAAE,CAAA;AAAE,KAAA;AAAE,GACjE,CACD,CACH,eACDrI,yBAAA,CAAAmG,aAAA,CAACub,kCAAW,EAAA;IACVtP,IAAI,EAAEC,4BAAK,CAAC2jB,IAAK;IACjBzjB,SAAS,EAAA,IAAA;IACThD,OAAO,EAAEA,MAAM;AACb4lB,MAAAA,MAAM,EAAE,CAAA;AACV,KAAA;AAAE,GAAA,EACH,MAEY,CAAC,eACdn1B,yBAAA,CAAAmG,aAAA,CAACub,kCAAW,EAAA;IACVtP,IAAI,EAAEC,4BAAK,CAAC4jB,IAAK;IACjB1jB,SAAS,EAAA,IAAA;IACThD,OAAO,EAAEA,MAAM;AACb6lB,MAAAA,MAAM,EAAE,CAAA;AACV,KAAA;AAAE,GAAA,EACH,MAEY,CAAC,EAEbjmB,QAAQ,iBAAInP,yBAAA,CAAAmG,aAAA,CAACmuB,KAAK,EAAA,IAAA,EAAC,WAAgB,CAAC,eAErCt0B,yBAAA,CAAAmG,aAAA,CAAC+vB,mCAAY,EAAA;AACXC,IAAAA,SAAS,EAAC,gBAAgB;AAC1BxgB,IAAAA,SAAS,EAAC,OAAO;AACjBpG,IAAAA,OAAO,EAAEA,MAAMulB,cAAc,IAAG;AAAE,GAAA,EACnC,MAEa,CAEJ,CAAC,eAEb90B,yBAAA,CAAAmG,aAAA,CAACsuB,YAAY,EACXz0B,IAAAA,eAAAA,yBAAA,CAAAmG,aAAA,CAACiwB,YAAY,EAAA;AACX5e,IAAAA,OAAO,EAAEA,OAAQ;AACjB6e,IAAAA,QAAQ,EAAErB,QAAS;AACnBsB,IAAAA,cAAc,EAAEvB,gBAAAA;GACjB,CACW,CAAC,eAEf/0B,yBAAA,CAAAmG,aAAA,CAACquB,WAAW,EAAA,IAAA,eACVx0B,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEiD,IAAAA,KAAK,EAAE;AACLgN,MAAAA,OAAO,EAAE,MAAM;AACfE,MAAAA,aAAa,EAAE,KAAK;AACpBkI,MAAAA,GAAG,EAAE,KAAK;AACVnI,MAAAA,UAAU,EAAE,QAAA;AACd,KAAA;AAAE,GAAA,eAEFrW,yBAAA,CAAAmG,aAAA,CAACqL,6BAAM,EAAA;AAACjO,IAAAA,KAAK,EAAEoX,MAAO;AAAC7J,IAAAA,QAAQ,EAAEukB,cAAAA;GAC9Bza,EAAAA,OAAO,CAAC5Z,GAAG,CAAEu1B,CAAC,iBACbv2B,yBAAA,CAAAmG,aAAA,CAACyL,iCAAU,EAAA;IAAC9N,GAAG,EAAEyyB,CAAC,CAACC,IAAK;IAACjzB,KAAK,EAAEgzB,CAAC,CAACC,IAAAA;GAChCx2B,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEiD,IAAAA,KAAK,EAAE;AACLgN,MAAAA,OAAO,EAAE,MAAM;AACfC,MAAAA,UAAU,EAAE,QAAQ;AACpB6K,MAAAA,cAAc,EAAE,QAAQ;AACxBuV,MAAAA,MAAM,EAAE,SAAS;AACjBjY,MAAAA,GAAG,EAAE,CAAA;AACP,KAAA;AAAE,GAAA,EAED+X,CAAC,CAACnkB,IAAI,gBACLpS,yBAAA,CAAAmG,aAAA,CAACuuB,gBAAc,EACb10B,IAAAA,eAAAA,yBAAA,CAAAmG,aAAA,CAACwuB,KAAK,EAAA;IAAC3rB,GAAG,EAAEutB,CAAC,CAACnkB,IAAK;IAACskB,GAAG,EAAEH,CAAC,CAACxpB,IAAAA;AAAK,GAAE,CACpB,CAAC,GACf,IAAI,EACPwpB,CAAC,CAACxpB,IACA,CACK,CACb,CACK,CAAC,eAET/M,yBAAA,CAAAmG,aAAA,CAAA,GAAA,EAAA;AAAG+C,IAAAA,IAAI,EAAE,CAAA,YAAA,EAAeysB,OAAO,CAAA,QAAA,EAAWE,MAAM,CAAG,CAAA;AAACrY,IAAAA,MAAM,EAAC,QAAA;AAAQ,GAAA,eACjExd,yBAAA,CAAAmG,aAAA,CAAC0J,oCAAa,EAAA;AAAC8F,IAAAA,SAAS,EAAC,OAAO;AAACwgB,IAAAA,SAAS,EAAC,gBAAA;GAAiB,EAAA,SAE7C,CACd,CAAC,eAEJn2B,yBAAA,CAAAmG,aAAA,CAACqT,iCAAU,EAAA;AACThD,IAAAA,OAAO,EAAE,MAAO;AAChBb,IAAAA,SAAS,EAAC,OAAO;AACjBwC,IAAAA,OAAO,EAAC,6BAAA;GACT,EAAA,WAEW,CAAC,EAAC,GAAG,eAEjBnY,yBAAA,CAAAmG,aAAA,CAAC6J,6BAAM,EAAA;AACLjD,IAAAA,IAAI,EAAC,6BAA6B;AAClCoD,IAAAA,OAAO,EAAE+kB,SAAU;IACnBpkB,QAAQ,EAAEA,MAAM;AACdmkB,MAAAA,iBAAiB,EAAE,CAAA;AACrB,KAAA;GACD,CACE,CACM,CACP,CAAC,CAAA;AAEb,CAAC,CAAA;AAEH,MAAM0B,iBAGL,GAAG;EACFC,EAAE,eACA52B,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEkC,IAAAA,KAAK,EAAC,IAAI;AACVC,IAAAA,MAAM,EAAC,IAAI;AACXoW,IAAAA,OAAO,EAAC,WAAW;AACnBC,IAAAA,IAAI,EAAC,MAAM;AACXF,IAAAA,KAAK,EAAC,4BAAA;GAENze,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACE0wB,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,CAAC,EAAC,6aAA6a;AAC/apY,IAAAA,IAAI,EAAC,OAAA;AAAO,GACb,CAAC,eACF3e,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACE0wB,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,CAAC,EAAC,0CAA0C;AAC5CpY,IAAAA,IAAI,EAAC,OAAA;AAAO,GACb,CACE,CACN;EACDqY,EAAE,eACAh3B,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEkC,IAAAA,KAAK,EAAC,IAAI;AACVC,IAAAA,MAAM,EAAC,IAAI;AACXoW,IAAAA,OAAO,EAAC,WAAW;AACnBC,IAAAA,IAAI,EAAC,MAAM;AACXF,IAAAA,KAAK,EAAC,4BAAA;GAENze,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACE0wB,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,CAAC,EAAC,6eAA6e;AAC/epY,IAAAA,IAAI,EAAC,OAAA;AAAO,GACb,CAAC,eACF3e,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACE0wB,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,CAAC,EAAC,oEAAoE;AACtEpY,IAAAA,IAAI,EAAC,OAAA;AAAO,GACb,CACE,CACN;EACDsY,EAAE,eACAj3B,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEkC,IAAAA,KAAK,EAAC,IAAI;AACVC,IAAAA,MAAM,EAAC,IAAI;AACXoW,IAAAA,OAAO,EAAC,WAAW;AACnBC,IAAAA,IAAI,EAAC,MAAM;AACXF,IAAAA,KAAK,EAAC,4BAAA;GAENze,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACE0wB,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,CAAC,EAAC,8hBAA8hB;AAChiBpY,IAAAA,IAAI,EAAC,OAAA;AAAO,GACb,CAAC,eACF3e,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACE0wB,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,CAAC,EAAC,mCAAmC;AACrCpY,IAAAA,IAAI,EAAC,OAAA;AAAO,GACb,CACE,CACN;EACDuY,EAAE,eACAl3B,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEkC,IAAAA,KAAK,EAAC,IAAI;AACVC,IAAAA,MAAM,EAAC,IAAI;AACXoW,IAAAA,OAAO,EAAC,WAAW;AACnBC,IAAAA,IAAI,EAAC,MAAM;AACXF,IAAAA,KAAK,EAAC,4BAAA;GAENze,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACE0wB,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,CAAC,EAAC,+gBAA+gB;AACjhBpY,IAAAA,IAAI,EAAC,OAAA;AAAO,GACb,CAAC,eACF3e,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACE0wB,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,CAAC,EAAC,uDAAuD;AACzDpY,IAAAA,IAAI,EAAC,OAAA;AAAO,GACb,CACE,CACN;EACD/P,EAAE,eACA5O,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEkC,IAAAA,KAAK,EAAC,IAAI;AACVC,IAAAA,MAAM,EAAC,IAAI;AACXoW,IAAAA,OAAO,EAAC,WAAW;AACnBC,IAAAA,IAAI,EAAC,MAAM;AACXF,IAAAA,KAAK,EAAC,4BAAA;GAENze,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACE0wB,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,CAAC,EAAC,2EAA2E;AAC7EpY,IAAAA,IAAI,EAAC,OAAA;AAAO,GACb,CAAC,eACF3e,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACE0wB,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,CAAC,EAAC,wFAAwF;AAC1FpY,IAAAA,IAAI,EAAC,OAAA;AAAO,GACb,CACE,CACN;EACD,KAAK,eACH3e,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEkC,IAAAA,KAAK,EAAC,IAAI;AACVC,IAAAA,MAAM,EAAC,IAAI;AACXoW,IAAAA,OAAO,EAAC,WAAW;AACnBC,IAAAA,IAAI,EAAC,MAAM;AACXF,IAAAA,KAAK,EAAC,4BAAA;GAENze,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACE0wB,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,CAAC,EAAC,mEAAmE;AACrEpY,IAAAA,IAAI,EAAC,OAAA;AAAO,GACb,CAAC,eACF3e,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACE0wB,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,CAAC,EAAC,mDAAmD;AACrDpY,IAAAA,IAAI,EAAC,OAAA;AAAO,GACb,CACE,CACN;EACD,YAAY,eACV3e,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEkC,IAAAA,KAAK,EAAC,IAAI;AACVC,IAAAA,MAAM,EAAC,IAAI;AACXoW,IAAAA,OAAO,EAAC,WAAW;AACnBC,IAAAA,IAAI,EAAC,MAAM;AACXF,IAAAA,KAAK,EAAC,4BAAA;GAENze,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACE4wB,IAAAA,CAAC,EAAC,kIAAkI;AACpIjY,IAAAA,MAAM,EAAC,OAAA;AAAO,GACf,CAAC,eACF9e,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACE4wB,IAAAA,CAAC,EAAC,kIAAkI;AACpIjY,IAAAA,MAAM,EAAC,OAAA;AAAO,GACf,CAAC,eACF9e,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACE0wB,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,CAAC,EAAC,oKAAoK;AACtKpY,IAAAA,IAAI,EAAC,OAAA;AAAO,GACb,CACE,CAAA;AAET,CAAC,CAAA;AAED,SAASyX,YAAYA,CAAC;EACpBC,QAAQ;EACR7e,OAAO;AACP8e,EAAAA,cAAAA;AAKF,CAAC,EAAE;AACD,EAAA,oBACEt2B,yBAAA,CAAAmG,aAAA,CAACgxB,kCAAW,EAAA;AACV5zB,IAAAA,KAAK,EAAE8yB,QAAS;IAChBvlB,QAAQ,EAAGulB,QAAQ,IAAK;MACtB,IAAIA,QAAQ,KAAK,EAAE,EAAE;AACnB,QAAA,OAAA;AACF,OAAA;MAEAC,cAAc,CAACD,QAAQ,CAAC,CAAA;AAC1B,KAAA;AAAE,GAAA,EAED7e,OAAO,CAACxW,GAAG,CAAE+1B,CAAC,IAAK;IAClB,IAAIA,CAAC,CAAC3qB,MAAM,EAAE;AACZ,MAAA,OAAO,IAAI,CAAA;AACb,KAAA;AAEA,IAAA,oBACEpM,yBAAA,CAAAmG,aAAA,CAAC0M,8BAAO,EAAA;MAAC/O,GAAG,EAAEizB,CAAC,CAAC7xB,EAAAA;KACdlF,eAAAA,yBAAA,CAAAmG,aAAA,CAACixB,qCAAc,qBACbp3B,yBAAA,CAAAmG,aAAA,CAACkxB,sCAAe,EAAA;MAAC9zB,KAAK,EAAEwzB,CAAC,CAAC7xB,EAAAA;AAAG,KAAA,EAC1ByxB,iBAAiB,CAACI,CAAC,CAAC7xB,EAAE,CACR,CACH,CAAC,eAEjBlF,yBAAA,CAAAmG,aAAA,CAACmxB,qCAAc,EAAA,IAAA,eACbt3B,yBAAA,CAAAmG,aAAA,CAACqT,iCAAU,EAAA;AAAC/C,MAAAA,KAAK,EAAC,OAAA;KAASsgB,EAAAA,CAAC,CAAC3lB,KAAK,IAAI2lB,CAAC,CAAC7xB,EAAe,CACzC,CACT,CAAC,CAAA;AAEd,GAAC,CAAC,eAEFlF,yBAAA,CAAAmG,aAAA,CAAC0M,8BAAO,EACN7S,IAAAA,eAAAA,yBAAA,CAAAmG,aAAA,CAACixB,qCAAc,EAAA,IAAA,eACbp3B,yBAAA,CAAAmG,aAAA,CAACkxB,sCAAe,EAAA;AAAC9zB,IAAAA,KAAK,EAAC,YAAA;AAAY,GAAA,EAChCozB,iBAAiB,CAAC,YAAY,CAChB,CACH,CAAC,eAEjB32B,yBAAA,CAAAmG,aAAA,CAACmxB,qCAAc,EAAA,IAAA,eACbt3B,yBAAA,CAAAmG,aAAA,CAACqT,iCAAU,EAAA;AAAC/C,IAAAA,KAAK,EAAC,OAAA;AAAO,GAAA,EAAC,YAAsB,CAClC,CACT,CACE,CAAC,CAAA;AAElB;;ACtcO,SAAS8gB,sBAAsBA,CAACC,GAAkC,EAAE;AACzE,EAAA,OAAO,OAAOA,GAAG,KAAK,QAAQ,GAAG,CAACA,GAAG,CAAC,GAAG72B,KAAK,CAACC,OAAO,CAAC42B,GAAG,CAAC,GAAGA,GAAG,GAAG,EAAE,CAAA;AACxE;;ACEO,SAASC,oBAAoBA,CAAC3tB,aAAgC,EAAE;EACrE,MAAM4tB,cAAc,GAAGC,gCAAgC,CACrD7tB,aAAa,CAAC8tB,WAAW,CAACC,UAC5B,CAAC,CAAA;AACD,EAAA,OAAOl3B,KAAK,CAAC8e,IAAI,CAAC,IAAInY,GAAG,CAAC,CAAC,GAAGowB,cAAc,CAAC,CAAC,CAAC,CAAA;AACjD,CAAA;AAEA,SAASC,gCAAgCA,CACvCC,WAAwC,EACxC;AACA,EAAA,MAAMhhB,KAAK,GAAG,IAAItP,GAAG,EAAU,CAAA;EAE/BswB,WAAW,CAAC/zB,OAAO,CAAC,CAAC;AAAE+O,IAAAA,IAAAA;AAAK,GAAC,KAAK;AAChC2kB,IAAAA,sBAAsB,CAAC3kB,IAAI,CAAC,CAAC/O,OAAO,CAAEi0B,aAAa,IAAK;AACtDlhB,MAAAA,KAAK,CAAC4I,GAAG,CAACsY,aAAa,CAAC,CAAA;AAC1B,KAAC,CAAC,CAAA;AACJ,GAAC,CAAC,CAAA;AAEF,EAAA,OAAOn3B,KAAK,CAAC8e,IAAI,CAAC7I,KAAK,CAAC,CAAA;AAC1B;;ACjBO,SAASmhB,sBAAsBA,CACpCnlB,IAAY,EACZ9I,aAAgC,EAChC;EACA,OAAOkuB,0CAA0C,CAC/CplB,IAAI,EACJ9I,aAAa,CAAC8tB,WAAW,CAACC,UAC5B,CAAC,CAAA;AACH,CAAA;AAEA,SAASG,0CAA0CA,CACjDplB,IAAY,EACZglB,WAAwC,EACxC;AACA,EAAA,OAAOA,WAAW,CAACz2B,MAAM,CAAEgJ,UAAU,IACnC8tB,sCAAuB,CAAC9tB,UAAU,EAAEyI,IAAI,CAC1C,CAAC,CAAA;AACH;;AChBO,SAASslB,gCAAgCA,CAC9CC,OAAsC,EACtCruB,aAAgC,EAChC;AACA,EAAA,MAAMsuB,iBAAiB,GAAGX,oBAAoB,CAAC3tB,aAAa,CAAC,CAAA;AAC7D,EAAA,MAAMuuB,MAAM,GAAG,IAAI/wB,GAAG,EAA6B,CAAA;AAEnDiwB,EAAAA,sBAAsB,CAACY,OAAO,CAAC,CAACt0B,OAAO,CAAEy0B,YAAY,IAAK;AACxD,IAAA,IAAIF,iBAAiB,CAACz1B,QAAQ,CAAC21B,YAAY,CAAC,EAAE;MAC5C,MAAMR,aAAa,GAAGQ,YAAY,CAAA;AAClC,MAAA,MAAMT,UAAU,GAAGE,sBAAsB,CAACD,aAAa,EAAEhuB,aAAa,CAAC,CAAA;AAEvE+tB,MAAAA,UAAU,CAACh0B,OAAO,CAAE8R,SAAS,IAAK;AAChC0iB,QAAAA,MAAM,CAAC7Y,GAAG,CAAC7J,SAAS,CAAC,CAAA;AACvB,OAAC,CAAC,CAAA;AACJ,KAAC,MAAM;MACL,MAAMlM,WAAW,GAAG6uB,YAAY,CAAA;AAChC,MAAA,MAAM3iB,SAAS,GAAGvL,sCAA2B,CAACX,WAAW,EAAEK,aAAa,CAAC,CAAA;AACzE,MAAA,IAAI6L,SAAS,EAAE;AACb0iB,QAAAA,MAAM,CAAC7Y,GAAG,CAAC7J,SAAS,CAAC,CAAA;AACvB,OAAA;AACF,KAAA;AACF,GAAC,CAAC,CAAA;AAEF,EAAA,OAAOhV,KAAK,CAAC8e,IAAI,CAAC4Y,MAAM,CAAC,CAAA;AAC3B;;ACPO,MAAME,WAA2B,GAAGA,CAAC;EAAE5oB,MAAM;EAAEqU,OAAO;AAAEwU,EAAAA,OAAAA;AAAQ,CAAC,KAAK;AAC3E,EAAA,MAAM1uB,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;EACxC,MAAM;AAAE+J,IAAAA,IAAAA;AAAK,GAAC,GAAGH,aAAa,CAAA;EAE9B,MAAM/I,KAAK,GAAG4O,MAAM,CAAC7O,IAAI,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC;AACrC,EAAA,MAAM03B,UAAU,GAAG13B,KAAK,CAAC+V,KAAK,CAAC,CAAC,EAAE/V,KAAK,CAACP,MAAM,GAAG,CAAC,CAAC,CAACuW,IAAI,CAAC,GAAG,CAAC,CAAA;EAC7D,MAAMrM,SAAS,GAAG3J,KAAK,CAACA,KAAK,CAACP,MAAM,GAAG,CAAC,CAAC,CAAA;EAEzC,MAAMk4B,UAAgC,GAAGr0B,cAAc,CACrD4F,IAAI,CAACwE,MAAM,EACXgqB,UACF,CAAC,CAAA;EACD,MAAMnuB,UAAU,GAAGyE,kCAAuB,CACxC2pB,UAAU,EACV5uB,aACF,CAAC,CAAES,MAAM,CAACC,IAAI,CAAEvJ,CAAC,IAAKA,CAAC,CAACwJ,IAAI,KAAKC,SAAS,CAAwB,CAAA;EAElE,MAAMgtB,cAAc,GAAG/nB,MAAM,CAAC+nB,cAAc,IAAIptB,UAAU,CAAC6tB,OAAO,CAAA;AAClE,EAAA,MAAMN,UAAU,GAAGK,gCAAgC,CACjDR,cAAc,EACd5tB,aACF,CAAC,CAAA;EAED,IAAI6uB,mBAAoD,GAAGhzB,SAAS,CAAA;EAEpE,IAAImE,aAAa,CAAC8uB,SAAS,EAAE;IAC3BD,mBAAmB,GAAG,EAAE,CAAA;AAExBd,IAAAA,UAAU,CAACh0B,OAAO,CAAE8R,SAAS,IAAK;AAChCgjB,MAAAA,mBAAmB,CAAEhjB,SAAS,CAACzQ,EAAE,CAAC,GAAG;QACnCyQ,SAAS;AACTijB,QAAAA,SAAS,EAAE,EAAA;OACZ,CAAA;AAED9uB,MAAAA,aAAa,CAAC8uB,SAAS,CAAE/0B,OAAO,CAAEg1B,QAAQ,IAAK;QAC7C,IAAIljB,SAAS,CAACzQ,EAAE,KAAK2zB,QAAQ,CAACC,KAAK,CAACtsB,UAAU,EAAE;UAC9CmsB,mBAAmB,CAAEhjB,SAAS,CAACzQ,EAAE,CAAC,CAAC0zB,SAAS,CAAC5sB,IAAI,CAAC6sB,QAAQ,CAAC,CAAA;AAC7D,SAAA;AACF,OAAC,CAAC,CAAA;AAEF,MAAA,IAAIF,mBAAmB,CAAEhjB,SAAS,CAACzQ,EAAE,CAAC,CAAC0zB,SAAS,CAACp4B,MAAM,KAAK,CAAC,EAAE;AAC7D,QAAA,OAAOm4B,mBAAmB,CAAEhjB,SAAS,CAACzQ,EAAE,CAAC,CAAA;AAC3C,OAAA;AACF,KAAC,CAAC,CAAA;AACJ,GAAA;AAEA,EAAA,MAAM6zB,MAAM,GAAGzuB,UAAU,CAACyuB,MAAM,IAAI,SAAS,CAAA;;AAE7C;AACA;AACA;AACA;AACA;AACA;;EAEA,MAAMtkB,KAAK,GAAI9E,MAA4B,IAAK;AAC9C,IAAA,MAAMqpB,UAAU,GAAG;MACjB,CAACN,UAAU,CAAClsB,UAAU,GAAG;QACvB,CAAC9B,SAAS,GAAG,EAAC;AAChB,OAAA;KACD,CAAA;AAED,IAAA,MAAMuuB,YAAY,GAAGvuB,SAAS,CAACG,UAAU,CAAC,GAAG,CAAC,GAC1C8E,MAAM,GACNkgB,0BAAe,CACb/U,oBAAS,CACP;AACE,MAAA,GAAGnL,MAAM;AACTqpB,MAAAA,UAAAA;AACF,KAAC,EACDlvB,aACF,CAAC,EACDA,aACF,CAAC,CAAA;IAELka,OAAO,CAACiV,YAAY,CAAC,CAAA;GACtB,CAAA;EAED,MAAMC,YAAY,GAAIL,QAAmB,IAAK;AAC5C,IAAA,IAAIA,QAAQ,EAAE;MACZpkB,KAAK,CAACqG,oBAAS,CAAC+d,QAAQ,CAACC,KAAK,EAAEhvB,aAAa,CAAC,CAAC,CAAA;AACjD,KAAC,MAAM;AACLka,MAAAA,OAAO,EAAE,CAAA;AACX,KAAA;GACD,CAAA;EAED,OAAOwU,OAAO,GAAGO,MAAM,CAAC,GACtBP,OAAO,CAACO,MAAM,CAAC,CAAC;AACd1lB,IAAAA,MAAM,EAAE,IAAI;AACZ2Q,IAAAA,OAAO,EAAEkV,YAAY;AACrBN,IAAAA,SAAS,EAAED,mBAAmB;AAC9BjpB,IAAAA,IAAI,EAAEqpB,MAAAA;GACP,CAAC,gBAEF/4B,yBAAA,CAAAmG,aAAA,CAAK,KAAA,EAAA,IAAA,EAAA,kBAAgB,EAAC4yB,MAAY,CACnC,CAAA;AACH,CAAC;;ACnGM,MAAMI,aAA2C,GAAI/qB,KAAK,IAAK;EACpE,MAAM,CAACN,KAAK,EAAEsrB,QAAQ,CAAC,GAAGn1B,cAAQ,CAAgB,IAAI,CAAC,CAAA;AACvD,EAAA,MAAMyL,IAAI,GAAGtB,KAAK,CAACirB,MAAM,CAAC3pB,IAAI,CAAA;AAC9B,EAAA,MAAM4pB,OAAO,GAAGlrB,KAAK,CAACkrB,OAAO,CAAA;AAE7B,EAAA,MAAMxvB,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;EACxC,MAAM,CAACq5B,aAAa,EAAEC,cAAc,CAAC,GAAGv1B,cAAQ,CAAC,KAAK,CAAC,CAAA;EACvD,MAAM,CAACw1B,eAAe,EAAEC,gBAAgB,CAAC,GAAGz1B,cAAQ,CAAC,KAAK,CAAC,CAAA;AAE3D,EAAA,MAAMoK,OAAO,GAAGC,iCAAU,EAAE,CAAA;EAC5B,MAAM,CAACuqB,QAAQ,EAAEc,WAAW,CAAC,GAAG11B,cAAQ,CAAC,MAAM;AAC7C,IAAA,IAAImK,KAAK,CAACirB,MAAM,CAAC3pB,IAAI,KAAK,MAAM,EAAE;AAChC,MAAA,OAAOtB,KAAK,CAACirB,MAAM,CAACR,QAAQ,CAAA;AAC9B,KAAC,MAAM;MACL,OAAO;AACLznB,QAAAA,KAAK,EAAE,EAAE;AACTjF,QAAAA,KAAK,EAAE,EAAE;AACTgX,QAAAA,SAAS,EAAE,EAAE;AACbyW,QAAAA,cAAc,EAAE,EAAE;AAClBd,QAAAA,KAAK,EAAE1qB,KAAK,CAACirB,MAAM,CAAC1pB,MAAAA;OACrB,CAAA;AACH,KAAA;AACF,GAAC,CAAC,CAAA;EAEF,MAAM;AACJyB,IAAAA,KAAK,GAAG,EAAE;AACVjF,IAAAA,KAAK,GAAG,EAAE;AACVgX,IAAAA,SAAS,GAAG,EAAE;AACdyW,IAAAA,cAAc,GAAG,EAAA;AACnB,GAAC,GAAGf,QAAoB,CAAA;AACxB,EAAA,MAAMrkB,IAAI,GAAGpG,KAAK,CAACirB,MAAM,KAAK1zB,SAAS,CAAA;EACvC,MAAMk0B,OAAO,GAAGzoB,KAAK,CAACka,IAAI,EAAE,KAAK,EAAE,CAAA;EACnC,MAAMwO,QAAQ,GAAG,MAAM,CAAA;AAEvBpyB,EAAAA,eAAS,CAAC,MAAM;AACd,IAAA,IAAI8M,IAAI,EAAE;MACR4kB,QAAQ,CAAC,IAAI,CAAC,CAAA;AAChB,KAAA;AACF,GAAC,EAAE,CAAC5kB,IAAI,CAAC,CAAC,CAAA;AAEV,EAAA,oBACExU,yBAAA,CAAAmG,aAAA,CAAC4zB,4BAAK,EAAA;AACJC,IAAAA,KAAK,EAAE,CAAmB,gBAAA,CAAA;AAC1B3mB,IAAAA,MAAM,EAAE,IAAK;IACb4mB,cAAc,EAAEA,MAAM;MACpB7rB,KAAK,CAAC4V,OAAO,EAAE,CAAA;KACf;AACFtU,IAAAA,IAAI,EAAE,cAAe;AACrBwqB,IAAAA,UAAU,EAAE,IAAA;GAEZl6B,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;IACEg0B,QAAQ,EAAG5c,CAAC,IAAK;MACfA,CAAC,CAAC9V,cAAc,EAAE,CAAA;MAElB2xB,QAAQ,CAAC,IAAI,CAAC,CAAA;MAEd,IAAI,CAACS,OAAO,EAAE;AACZ,QAAA,OAAA;AACF,OAAA;MAEAL,cAAc,CAAC,IAAI,CAAC,CAAA;MAEpB,IAAI9pB,IAAI,KAAK,QAAQ,EAAE;AACrB,QAAA,MAAM0qB,YAAY,GAAGhsB,KAAK,CAACirB,MAAuC,CAAA;AAElEC,QAAAA,OAAO,CAACV,SAAS,CACdyB,MAAM,CAAC;UACNjpB,KAAK;UACLjF,KAAK;UACLgX,SAAS;UACTyW,cAAc;UACdd,KAAK,EAAEsB,YAAY,CAACzqB,MAAM;UAC1BtH,KAAK,EAAE+xB,YAAY,CAAC/xB,KAAK;UACzBwG,SAAS,EAAEurB,YAAY,CAACvrB,SAAAA;AAC1B,SAAC,CAAC,CACDmT,IAAI,CAAEsY,WAAW,IAAK;UACrBxwB,aAAa,CAACywB,aAAa,CAAC;AAC1B7qB,YAAAA,IAAI,EAAE,QAAQ;AACdmpB,YAAAA,QAAQ,EAAE;cACR3zB,EAAE,EAAEo1B,WAAW,CAACp1B,EAAE;cAClB,GAAG2zB,QAAAA;AACL,aAAA;AACF,WAAC,CAAC,CAAA;AACFxqB,UAAAA,OAAO,CAACyB,OAAO,CAAC,mBAAmB,CAAC,CAAA;UACpC1B,KAAK,CAAC4V,OAAO,EAAE,CAAA;AACjB,SAAC,CAAC,CACDwW,KAAK,CAAC,MAAM;AACXnsB,UAAAA,OAAO,CAACP,KAAK,CAAC,wBAAwB,CAAC,CAAA;AACzC,SAAC,CAAC,CACD2sB,OAAO,CAAC,MAAM;UACbjB,cAAc,CAAC,KAAK,CAAC,CAAA;AACvB,SAAC,CAAC,CAAA;AACN,OAAC,MAAM;AACLF,QAAAA,OAAO,CAACV,SAAS,CACd8B,MAAM,CAAC;UACNtpB,KAAK;UACLjF,KAAK;UACLgX,SAAS;UACTyW,cAAc;UACd10B,EAAE,EAAG2zB,QAAQ,CAAc3zB,EAAAA;AAC7B,SAAC,CAAC,CACD8c,IAAI,CAAC,MAAM;UACVlY,aAAa,CAACywB,aAAa,CAAC;AAC1B7qB,YAAAA,IAAI,EAAE,MAAM;AACZmpB,YAAAA,QAAQ,EAAEA,QAAAA;AACZ,WAAC,CAAC,CAAA;AACFxqB,UAAAA,OAAO,CAACyB,OAAO,CAAC,mBAAmB,CAAC,CAAA;UACpC1B,KAAK,CAAC4V,OAAO,EAAE,CAAA;AACjB,SAAC,CAAC,CACDwW,KAAK,CAAC,MAAM;AACXnsB,UAAAA,OAAO,CAACP,KAAK,CAAC,0BAA0B,CAAC,CAAA;AAC3C,SAAC,CAAC,CACD2sB,OAAO,CAAC,MAAM;UACbjB,cAAc,CAAC,KAAK,CAAC,CAAA;AACvB,SAAC,CAAC,CAAA;AACN,OAAA;AACF,KAAA;GAEC1rB,EAAAA,KAAK,iBAAI9N,yBAAA,CAAAmG,aAAA,CAAM2H,KAAAA,EAAAA,IAAAA,EAAAA,KAAW,CAAC,eAE5B9N,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEiD,IAAAA,KAAK,EAAE;AACLgN,MAAAA,OAAO,EAAE,MAAM;AACfE,MAAAA,aAAa,EAAE,QAAQ;AACvBkI,MAAAA,GAAG,EAAE,MAAM;AACXmc,MAAAA,SAAS,EAAE,KAAA;AACb,KAAA;AAAE,GAAA,eAEF36B,yBAAA,CAAAmG,aAAA,CAACy0B,kCAAW,EAAA;AAAC7tB,IAAAA,IAAI,EAAC,OAAO;AAACqE,IAAAA,KAAK,EAAC,MAAA;AAAM,GAAA,eACpCpR,yBAAA,CAAAmG,aAAA,CAACwM,4BAAK,EAAA;AACJkI,IAAAA,WAAW,EAAC,kBAAkB;AAC9B4G,IAAAA,QAAQ,EAAE,IAAK;AACfle,IAAAA,KAAK,EAAE6N,KAAM;IACbN,QAAQ,EAAGyM,CAAC,IAAK;AACfoc,MAAAA,WAAW,CAAC;AACV,QAAA,GAAGd,QAAQ;AACXznB,QAAAA,KAAK,EAAEmM,CAAC,CAACC,MAAM,CAACja,KAAAA;AAClB,OAAC,CAAC,CAAA;KACF;AACF2X,IAAAA,UAAU,EAAE,IAAK;IACjB2f,SAAS,EAAA,IAAA;AAAA,GACV,CACU,CAAC,eAEd76B,yBAAA,CAAAmG,aAAA,CAACy0B,kCAAW,EAAA;AAAC7tB,IAAAA,IAAI,EAAC,OAAO;AAACqE,IAAAA,KAAK,EAAC,OAAA;AAAO,GAAA,eACrCpR,yBAAA,CAAAmG,aAAA,CAACwM,4BAAK,EAAA;AACJkI,IAAAA,WAAW,EAAC,mBAAmB;AAC/BtX,IAAAA,KAAK,EAAE4I,KAAM;IACb2E,QAAQ,EAAGyM,CAAC,IAAK;AACfoc,MAAAA,WAAW,CAAC;AACV,QAAA,GAAGd,QAAQ;AACX1sB,QAAAA,KAAK,EAAEoR,CAAC,CAACC,MAAM,CAACja,KAAAA;AAClB,OAAC,CAAC,CAAA;KACF;AACF2X,IAAAA,UAAU,EAAE,IAAK;IACjB2f,SAAS,EAAA,IAAA;AAAA,GACV,CACU,CAAC,eAEd76B,yBAAA,CAAAmG,aAAA,CAACy0B,kCAAW,EAAA;AAAC7tB,IAAAA,IAAI,EAAC,WAAW;AAACqE,IAAAA,KAAK,EAAC,eAAA;AAAe,GAAA,eACjDpR,yBAAA,CAAAmG,aAAA,CAACwM,4BAAK,EAAA;AACJkI,IAAAA,WAAW,EAAC,2BAA2B;AACvCtX,IAAAA,KAAK,EAAE4f,SAAU;IACjBrS,QAAQ,EAAGyM,CAAC,IAAK;AACfoc,MAAAA,WAAW,CAAC;AACV,QAAA,GAAGd,QAAQ;AACX1V,QAAAA,SAAS,EAAE5F,CAAC,CAACC,MAAM,CAACja,KAAAA;AACtB,OAAC,CAAC,CAAA;KACF;AACF2X,IAAAA,UAAU,EAAE,IAAK;IACjB2f,SAAS,EAAA,IAAA;AAAA,GACV,CACU,CAAC,eAEd76B,yBAAA,CAAAmG,aAAA,CAACy0B,kCAAW,EAAA;AAAC7tB,IAAAA,IAAI,EAAC,gBAAgB;AAACqE,IAAAA,KAAK,EAAC,iBAAA;AAAiB,GAAA,eACxDpR,yBAAA,CAAAmG,aAAA,CAACwM,4BAAK,EAAA;AACJkI,IAAAA,WAAW,EAAC,6BAA6B;AACzCtX,IAAAA,KAAK,EAAEq2B,cAAe;IACtB9oB,QAAQ,EAAGyM,CAAC,IAAK;AACfoc,MAAAA,WAAW,CAAC;AACV,QAAA,GAAGd,QAAQ;AACXe,QAAAA,cAAc,EAAErc,CAAC,CAACC,MAAM,CAACja,KAAAA;AAC3B,OAAC,CAAC,CAAA;KACF;AACF2X,IAAAA,UAAU,EAAE,IAAK;IACjB2f,SAAS,EAAA,IAAA;AAAA,GACV,CACU,CAAC,eAEd76B,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEiD,IAAAA,KAAK,EAAE;AACLgN,MAAAA,OAAO,EAAE,MAAM;AACfE,MAAAA,aAAa,EAAE,KAAK;AACpB4K,MAAAA,cAAc,EAAE,eAAe;AAC/ByZ,MAAAA,SAAS,EAAE,CAAA;AACb,KAAA;AAAE,GAAA,eAEF36B,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA,IAAA,EACGuJ,IAAI,KAAK,MAAM,iBACd1P,yBAAA,CAAAmG,aAAA,CAAC+vB,mCAAY,EAAA;IACX3mB,OAAO,EAAGgO,CAAa,IAAK;MAC1BA,CAAC,CAAC9V,cAAc,EAAE,CAAA;MAElBiyB,gBAAgB,CAAC,IAAI,CAAC,CAAA;AAEtBJ,MAAAA,OAAO,CAACV,SAAS,CACdkC,MAAM,CAAC;QAAE51B,EAAE,EAAG2zB,QAAQ,CAAc3zB,EAAAA;AAAI,OAAC,CAAC,CAC1C8c,IAAI,CAAC,MAAM;QACVlY,aAAa,CAACywB,aAAa,CAAC;AAC1B7qB,UAAAA,IAAI,EAAE,QAAQ;AACdmpB,UAAAA,QAAQ,EAAEA,QAAAA;AACZ,SAAC,CAAC,CAAA;AACFxqB,QAAAA,OAAO,CAACyB,OAAO,CAAC,kBAAkB,CAAC,CAAA;QACnC1B,KAAK,CAAC4V,OAAO,EAAE,CAAA;AACjB,OAAC,CAAC,CACDwW,KAAK,CAAC,MAAM;AACXnsB,QAAAA,OAAO,CAACP,KAAK,CAAC,0BAA0B,CAAC,CAAA;AAC3C,OAAC,CAAC,CACD2sB,OAAO,CAAC,MAAM;QACbf,gBAAgB,CAAC,KAAK,CAAC,CAAA;AACzB,OAAC,CAAC,CAAA;KACJ;AACFqB,IAAAA,SAAS,EAAEtB,eAAAA;GACZ,EAAA,QAEa,CAEb,CAAC,eAENz5B,yBAAA,CAAAmG,aAAA,CAAC0J,oCAAa,EAAA;AACZ+C,IAAAA,IAAI,EAAE,QAAS;IACf1C,QAAQ,EAAE,CAAC2pB,OAAQ;AACnBkB,IAAAA,SAAS,EAAExB,aAAAA;AAAc,GAAA,EAExBO,QACY,CACZ,CACF,CACD,CACD,CAAC,CAAA;AAEZ,CAAC;;AC7OD,SAASkB,aAAaA,CACpB/wB,IAAU,EACV;EAAE8C,IAAI;EAAEkuB,WAAW;AAAEC,EAAAA,WAAAA;AAAqC,CAAC,EAC3DC,kBAA0C,EAC1C;AACA;AACA,EAAA,IAAIC,aAAa,CAACruB,IAAI,GAAG,GAAG,GAAGkuB,WAAW,EAAEhxB,IAAI,CAACwE,MAAM,CAAC,EAAE;AACxD,IAAA,OAAA;AACF,GAAA;AAEA,EAAA,MAAM4sB,iBAAiB,GAAGh3B,cAAc,CACtC4F,IAAI,CAACwE,MAAM,EACX1B,IAAI,GAAG,GAAG,GAAGkuB,WACf,CAAC,CAAA;AAEDhxB,EAAAA,IAAI,CAACqxB,QAAQ,CAACC,MAAM,CAClBxuB,IAAI,EACJmuB,WAAW,EACXrL,0BAAe,CAACwL,iBAAiB,EAAEF,kBAAkB,CACvD,CAAC,CAAA;AACH,CAAA;AAEA,SAASK,UAAUA,CAAC;EAClBC,IAAI;EACJC,KAAK;EACLC,kBAAkB;AAClBC,EAAAA,YAAAA;AAMF,CAAC,EAA6B;EAC5B,MAAMC,sBAAgC,GAAG,EAAE,CAAA;AAE3CC,EAAAA,oBAAoB,CAACJ,KAAK,CAAC,CACxBl4B,IAAI,CAAClC,sBAAsB,EAAE,CAAC,CAC9BN,GAAG,CAAE+6B,kBAAkB,IAAK;IAC3B,MAAMC,WAAW,GAAGH,sBAAsB,CAACt3B,MAAM,CAC/C,CAACC,GAAG,EAAEJ,OAAO,KAAK63B,SAAS,CAACz3B,GAAG,EAAEJ,OAAO,EAAE,UAAU,CAAC,EACrD23B,kBACF,CAAC,CAAA;AAED,IAAA,MAAMG,oBAAoB,GAAGP,kBAAkB,CAACK,WAAW,CAAC,CAAA;IAE5D,OAAOJ,YAAY,CAACM,oBAAoB,CAAC,CAAA;AAC3C,GAAC,CAAC,CACDr4B,OAAO,CAAEs4B,KAAK,IAAK;AAClBV,IAAAA,IAAI,CAAC53B,OAAO,CAAEgI,IAAI,IAAK;AACrB,MAAA,MAAMuwB,YAAY,GAAGD,KAAK,CAACtwB,IAAI,CAAC,CAAA;AAChC,MAAA,IAAIuwB,YAAY,EAAE;AAChBP,QAAAA,sBAAsB,CAAC7vB,IAAI,CAACowB,YAAY,CAAC,CAAA;AAC3C,OAAA;AACF,KAAC,CAAC,CAAA;AACJ,GAAC,CAAC,CAAA;EAEJ,OAAOP,sBAAsB,CAACr7B,MAAM,KAAK,CAAC,GAAGq7B,sBAAsB,GAAGH,KAAK,CAAA;AAC7E,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAASW,cAAcA,CACrBpyB,IAAU,EACV2L,UAAyB,EACzBulB,kBAA0C,EACf;AAC3B,EAAA,MAAMmB,sBAAsB,GAAG1mB,UAAU,CAACzU,MAAM,CAAEuJ,SAAS,IACzD6xB,mBAAmB,CAAC7xB,SAAS,EAAET,IAAI,EAAEkxB,kBAAkB,CACzD,CAAC,CAAA;AAED,EAAA,IAAImB,sBAAsB,CAAC97B,MAAM,KAAK,CAAC,EAAE;AACvC,IAAA,OAAA;AACF,GAAA;AAEA,EAAA,MAAMg8B,yBAAyB,GAAGC,uBAAuB,CACvDH,sBAAsB,EACtB,WACF,CAAC,CAAA;EAED,MAAMI,yBAA+C,GAAG,EAAE,CAAA;AAE1D/4B,EAAAA,MAAM,CAAC8K,MAAM,CAAC+tB,yBAAyB,CAAC,CAAC34B,OAAO,CAC9C,CAAC84B,YAAY,EAAEC,gBAAgB,KAAK;AAClCF,IAAAA,yBAAyB,CAAC1wB,IAAI,CAAC,EAAE,CAAC,CAAA;IAElC,MAAM6wB,cAAc,GAAGC,iBAAiB,CAACx8B,IAAI,CAACq8B,YAAY,CAAC,CAAC,CAAA;AAE5DA,IAAAA,YAAY,CAAC94B,OAAO,CAAC,CAACswB,YAAY,EAAEtF,UAAU,KAAK;AACjD,MAAA,MAAMoM,WAAW,GAAG6B,iBAAiB,CAAC3I,YAAY,CAAC,CAAA;AACnD,MAAA,MAAM+G,WAAW,GAAG2B,cAAc,GAAG,CAAC,GAAGhO,UAAU,CAAA;AACnD,MAAA,MAAM4J,UAAU,GAAGsE,aAAa,CAAC5I,YAAY,CAAC,CAAA;MAE9C6G,aAAa,CACX/wB,IAAI,EACJ;AACE8C,QAAAA,IAAI,EAAE0rB,UAAU;QAChBwC,WAAW;AACXC,QAAAA,WAAAA;OACD,EACDC,kBACF,CAAC,CAAA;AAEDuB,MAAAA,yBAAyB,CAACE,gBAAgB,CAAC,CAAC5wB,IAAI,CAC9C,CAAA,EAAGysB,UAAU,CAAA,CAAA,EAAIoE,cAAc,GAAG,CAAC,GAAGhO,UAAU,EAClD,CAAC,CAAA;AACH,KAAC,CAAC,CAAA;AACJ,GACF,CAAC,CAAA;AAED,EAAA,OAAO6N,yBAAyB,CAAC5c,IAAI,EAAE,CAAA;AACzC,CAAA;AAEA,SAASkd,QAAQA,CAAC/yB,IAAU,EAAE;EAAEwV,IAAI;EAAEwd,EAAE;AAAElwB,EAAAA,IAAAA;AAAyB,CAAC,EAAE;AACpE;AACA,EAAA,IAAIquB,aAAa,CAACruB,IAAI,GAAG,GAAG,GAAG0S,IAAI,EAAExV,IAAI,CAACwE,MAAM,CAAC,EAAE;AACjD,IAAA,OAAA;AACF,GAAA;EAEAxE,IAAI,CAACqxB,QAAQ,CAAC4B,IAAI,CAACnwB,IAAI,EAAE0S,IAAI,EAAEwd,EAAE,CAAC,CAAA;AACpC,CAAA;;AAEA;AACA;AACA;AACA;AACA,SAASE,SAASA,CAChBlzB,IAAU,EACVmzB,YAA2B,EAC3B77B,SAA8C,EACnB;EAC3B,MAAM87B,iBAAgC,GAAG,EAAE,CAAA;AAC3C,EAAA,MAAMC,sBAAsB,GAAGF,YAAY,CAAC58B,MAAM,GAAG,CAAC,CAAA;AAEtD,EAAA,IAAIe,SAAS,KAAK,KAAK,IAAIA,SAAS,KAAK,MAAM,EAAE;AAC/C,IAAA,MAAMi7B,yBAAyB,GAAGC,uBAAuB,CACvDW,YAAY,EACZ,WACF,CAAC,CAAA;IAEDz5B,MAAM,CAAC8K,MAAM,CAAC+tB,yBAAyB,CAAC,CAAC34B,OAAO,CAAE84B,YAAY,IAAK;MACjE,IAAIY,kCAAkC,GAAG,KAAK,CAAA;AAE9CZ,MAAAA,YAAY,CAAC94B,OAAO,CAAC,CAAC6G,SAAS,EAAE8yB,cAAc,KAAK;AAClD,QAAA,MAAMt7B,KAAK,GAAG46B,iBAAiB,CAACpyB,SAAS,CAAC,CAAA;AAC1C,QAAA,MAAM+tB,UAAU,GAAGsE,aAAa,CAACryB,SAAS,CAAC,CAAA;AAE3C,QAAA,IAAI+yB,OAAO,CAAC/yB,SAAS,CAAC,EAAE;AACtB,UAAA,IAAI4yB,sBAAsB,EAAE;AAC1BD,YAAAA,iBAAiB,CAACrxB,IAAI,CAACtB,SAAS,CAAC,CAAA;AACnC,WAAA;AAEA,UAAA,OAAA;AACF,SAAA;QAEA,IACE4yB,sBAAsB,IACtBE,cAAc,GAAG,CAAC,IAClB,CAACD,kCAAkC,EACnC;AACAF,UAAAA,iBAAiB,CAACrxB,IAAI,CAACtB,SAAS,CAAC,CAAA;AACjC,UAAA,OAAA;AACF,SAAA;QAEAsyB,QAAQ,CAAC/yB,IAAI,EAAE;AACbwV,UAAAA,IAAI,EAAEvd,KAAK;AACX6K,UAAAA,IAAI,EAAE0rB,UAAU;UAChBwE,EAAE,EAAE/6B,KAAK,GAAG,CAAA;AACd,SAAC,CAAC,CAAA;QAEF,IAAI,CAACq7B,kCAAkC,EAAE;AACvCA,UAAAA,kCAAkC,GAAG,IAAI,CAAA;AAC3C,SAAA;QAEAF,iBAAiB,CAACrxB,IAAI,CAAC,CAAGysB,EAAAA,UAAU,IAAIv2B,KAAK,GAAG,CAAC,CAAA,CAAE,CAAC,CAAA;AACtD,OAAC,CAAC,CAAA;AACJ,KAAC,CAAC,CAAA;AAEF,IAAA,IAAIm7B,iBAAiB,CAAC78B,MAAM,GAAG,CAAC,EAAE;AAChC,MAAA,OAAO68B,iBAAiB,CAAA;AAC1B,KAAA;AACF,GAAC,MAAM;AACL,IAAA,MAAMb,yBAAyB,GAAGC,uBAAuB,CACvDW,YAAY,EACZ,YACF,CAAC,CAAA;IAEDz5B,MAAM,CAAC8K,MAAM,CAAC+tB,yBAAyB,CAAC,CAAC34B,OAAO,CAAE84B,YAAY,IAAK;MACjE,IAAIY,kCAAkC,GAAG,KAAK,CAAA;AAE9CZ,MAAAA,YAAY,CAAC94B,OAAO,CAAC,CAAC6G,SAAS,EAAE8yB,cAAc,KAAK;AAClD,QAAA,IAAI9K,MAAM,CAAChoB,SAAS,EAAET,IAAI,CAAC,EAAE;AAC3B,UAAA,IAAIqzB,sBAAsB,EAAE;AAC1BD,YAAAA,iBAAiB,CAACrxB,IAAI,CAACtB,SAAS,CAAC,CAAA;AACnC,WAAA;AAEA,UAAA,OAAA;AACF,SAAA;QAEA,IACE4yB,sBAAsB,IACtBE,cAAc,GAAG,CAAC,IAClB,CAACD,kCAAkC,EACnC;AACAF,UAAAA,iBAAiB,CAACrxB,IAAI,CAACtB,SAAS,CAAC,CAAA;AACjC,UAAA,OAAA;AACF,SAAA;AAEA,QAAA,MAAMxI,KAAK,GAAG46B,iBAAiB,CAACpyB,SAAS,CAAC,CAAA;AAC1C,QAAA,MAAM+tB,UAAU,GAAGsE,aAAa,CAACryB,SAAS,CAAC,CAAA;QAE3CsyB,QAAQ,CAAC/yB,IAAI,EAAE;AACb8C,UAAAA,IAAI,EAAE0rB,UAAU;AAChBhZ,UAAAA,IAAI,EAAEvd,KAAK;UACX+6B,EAAE,EAAE/6B,KAAK,GAAG,CAAA;AACd,SAAC,CAAC,CAAA;QAEF,IAAI,CAACq7B,kCAAkC,EAAE;AACvCA,UAAAA,kCAAkC,GAAG,IAAI,CAAA;AAC3C,SAAA;QAEAF,iBAAiB,CAACrxB,IAAI,CAAC,CAAGysB,EAAAA,UAAU,IAAIv2B,KAAK,GAAG,CAAC,CAAA,CAAE,CAAC,CAAA;AACtD,OAAC,CAAC,CAAA;AACJ,KAAC,CAAC,CAAA;AAEF,IAAA,IAAIm7B,iBAAiB,CAAC78B,MAAM,GAAG,CAAC,EAAE;AAChC,MAAA,OAAO68B,iBAAiB,CAAA;AAC1B,KAAA;AACF,GAAA;AACF,CAAA;AAEA,SAASK,UAAUA,CAACzzB,IAAU,EAAE;EAAE/H,KAAK;AAAE6K,EAAAA,IAAAA;AAA2B,CAAC,EAAE;AACrE,EAAA,MAAM4wB,kBAAkB,GAAG5wB,IAAI,GAAG,GAAG,GAAG7K,KAAK,CAAA;;AAE7C;EACA,IAAIk5B,aAAa,CAACuC,kBAAkB,EAAE1zB,IAAI,CAACwE,MAAM,CAAC,EAAE;AAClD,IAAA,OAAA;AACF,GAAA;EAEA,MAAMmvB,oBAAoB,GAAGv5B,cAAc,CAAC4F,IAAI,CAACwE,MAAM,EAAE1B,IAAI,CAAC,CAAA;AAE9D,EAAA,IAAI6wB,oBAAoB,CAACp9B,MAAM,KAAK,CAAC,EAAE;AACrCyJ,IAAAA,IAAI,CAACgM,MAAM,CAAClJ,IAAI,EAAE,EAAE,CAAC,CAAA;AACvB,GAAC,MAAM;IACL9C,IAAI,CAACqxB,QAAQ,CAACvtB,MAAM,CAAChB,IAAI,EAAE7K,KAAK,CAAC,CAAA;AACnC,GAAA;AACF,CAAA;;AAEA;AACA;AACA;AACA;AACA,SAASyf,WAAWA,CAClB1X,IAAU,EACV4zB,kBAAiC,EACjC1C,kBAA0C,EACf;AAC3B,EAAA,MAAM2C,mBAAmB,GAAGD,kBAAkB,CAAC18B,MAAM,CAAEuJ,SAAS,IAC9DqzB,gBAAgB,CAACrzB,SAAS,EAAET,IAAI,EAAEkxB,kBAAkB,CACtD,CAAC,CAAA;AAED,EAAA,IAAI2C,mBAAmB,CAACt9B,MAAM,KAAK,CAAC,EAAE;AACpC,IAAA,OAAA;AACF,GAAA;AAEA,EAAA,MAAMw9B,wBAAwB,GAAGF,mBAAmB,CAACt9B,MAAM,GAAG,CAAC,CAAA;AAE/D,EAAA,MAAMg8B,yBAAyB,GAAGC,uBAAuB,CACvDqB,mBAAmB,EACnB,YACF,CAAC,CAAA;EAED,IAAI,CAACE,wBAAwB,EAAE;IAC7B,MAAM;MAAE97B,KAAK;MAAEgI,MAAM;AAAEG,MAAAA,UAAAA;KAAY,GAAGL,oBAAS,CAC7C8zB,mBAAmB,CAAC,CAAC,CAAC,EACtB7zB,IACF,CAAC,CAAA;AAED,IAAA,IAAI/H,KAAK,KAAKyD,SAAS,IAAI,CAACuE,MAAM,EAAE;AAClC,MAAA,MAAM,IAAI7J,KAAK,CAAC,cAAc,CAAC,CAAA;AACjC,KAAA;IAEA,MAAM49B,SAAS,GAAG,CAAG/zB,EAAAA,MAAM,CAACpJ,IAAI,CAAA,EAAGoJ,MAAM,CAACpJ,IAAI,KAAK,EAAE,GAAG,EAAE,GAAG,GAAG,GAAGoJ,MAAM,CAACQ,SAAS,CAC/E,CAAA,CAAA;IACJ,MAAMwzB,WAAW,GAAG75B,cAAc,CAAC4F,IAAI,CAACwE,MAAM,EAAEwvB,SAAS,CAAC,CAACz9B,MAAM,CAAA;AACjE,IAAA,MAAM29B,UAAU,GAAGD,WAAW,KAAK,CAAC,CAAA;AACpC,IAAA,MAAME,UAAU,GAAGF,WAAW,GAAG,CAAC,KAAKh8B,KAAK,CAAA;IAE5Cw7B,UAAU,CAACzzB,IAAI,EAAE;MACf/H,KAAK;AACL6K,MAAAA,IAAI,EAAEkxB,SAAAA;AACR,KAAC,CAAC,CAAA;AAEF,IAAA,MAAM9zB,UAAU,GAAGC,sCAA2B,CAC5CC,UAAU,EACV8wB,kBACF,CAAC,CAAA;IACD,MAAMkD,aAAa,GACjBl0B,UAAU,IACV8tB,sCAAuB,CAAC9tB,UAAU,EAAE,0BAA0B,CAAC,CAAA;;AAEjE;AACA;AACA,IAAA,IAAIk0B,aAAa,EAAE;AACjB,MAAA,OAAO,CAACn0B,MAAM,CAACpJ,IAAI,CAAC,CAAA;AACtB,KAAA;AAEA,IAAA,IAAIq9B,UAAU,EAAE;AACd,MAAA,OAAO,EAAE,CAAA;KACV,MAAM,IAAIC,UAAU,EAAE;MACrB,OAAO,CAAC,GAAGH,SAAS,CAAA,CAAA,EAAI/7B,KAAK,GAAG,CAAC,EAAE,CAAC,CAAA;AACtC,KAAC,MAAM;AACL,MAAA,OAAO,CAAC,CAAG+7B,EAAAA,SAAS,CAAI/7B,CAAAA,EAAAA,KAAK,EAAE,CAAC,CAAA;AAClC,KAAA;AACF,GAAA;EAEAyB,MAAM,CAAC8K,MAAM,CAAC+tB,yBAAyB,CAAC,CAAC34B,OAAO,CAAE84B,YAAY,IAAK;AACjEA,IAAAA,YAAY,CAAC94B,OAAO,CAAEswB,YAAY,IAAK;MACrC,MAAMvoB,KAAK,GAAGvH,cAAc,CAAC4F,IAAI,CAACwE,MAAM,EAAE0lB,YAAY,CAAC,CAAA;;AAEvD;MACA,IAAI,CAACvoB,KAAK,EAAE;AACV,QAAA,OAAA;AACF,OAAA;AAEA,MAAA,MAAM1J,KAAK,GAAG46B,iBAAiB,CAAC3I,YAAY,CAAC,CAAA;AAC7C,MAAA,MAAMsE,UAAU,GAAGsE,aAAa,CAAC5I,YAAY,CAAC,CAAA;MAE9CuJ,UAAU,CAACzzB,IAAI,EAAE;QACf/H,KAAK;AACL6K,QAAAA,IAAI,EAAE0rB,UAAAA;AACR,OAAC,CAAC,CAAA;AACJ,KAAC,CAAC,CAAA;AACJ,GAAC,CAAC,CAAA;AAEF,EAAA,OAAO,EAAE,CAAA;AACX,CAAA;AAEA,SAASvW,YAAYA,CACnB1T,KAAe,EACfyT,SAA+B,EAC/BnY,aAAgC,EAChC;AACA0E,EAAAA,KAAK,CAAC3K,OAAO,CAAE/C,IAAI,IAAK;IACkBuD,cAAc,CACpDyF,aAAa,CAACG,IAAI,CAACwE,MAAM,EACzB3N,IACF,EAAC;AAEDgJ,IAAAA,aAAa,CAACG,IAAI,CAACgM,MAAM,CACvBnV,IAAI,EACJ+uB,0BAAe;AACb;AACA;AACA;IACA5N,SAAS,EACTnY,aACF,CACF,CAAC,CAAA;AACH,GAAC,CAAC,CAAA;AACJ,CAAA;AAEA,SAASw0B,QAAQA,CAACr0B,IAAU,EAAE0a,WAA0B,EAAE;AACxD,EAAA,MAAM4Z,YAAY,GAAG5Z,WAAW,CAAC3jB,GAAG,CAAEie,UAAU,IAAK;AACnD,IAAA,OAAO5a,cAAc,CAAC4F,IAAI,CAACwE,MAAM,EAAEwQ,UAAU,CAAC,CAAA;AAChD,GAAC,CAAC,CAAA;AAEFsf,EAAAA,YAAY,CAAC16B,OAAO,CAAC,CAAC8L,MAAM,EAAEzN,KAAK,KAAK;IACtCoK,OAAO,CAAC0lB,GAAG,CAAC,YAAY,EAAErN,WAAW,CAACziB,KAAK,CAAC,EAAEyN,MAAM,CAAC,CAAA;AACvD,GAAC,CAAC,CAAA;AACJ,CAAA;AAWA,SAAS8sB,uBAAuBA,CAC9B9wB,MAAqB,EACrB6yB,aAAyC,EACV;EAC/B,MAAMC,gCAAgC,GAAG9yB,MAAM,CAACpH,MAAM,CACpD,CAACm6B,WAAW,EAAEC,YAAY,KAAK;AAC7B,IAAA,MAAMz8B,KAAK,GAAG46B,iBAAiB,CAAC6B,YAAY,CAAC,CAAA;AAC7C,IAAA,MAAMlG,UAAU,GAAGsE,aAAa,CAAC4B,YAAY,CAAC,CAAA;AAE9C,IAAA,MAAMC,OAAO,GAAGF,WAAW,CAACjG,UAAU,CAAC,CAAA;AAEvC,IAAA,IAAImG,OAAO,EAAE;AACXF,MAAAA,WAAW,CAACjG,UAAU,CAAC,GAAG,CAAC,GAAGmG,OAAO,EAAE18B,KAAK,CAAC,CAACsB,IAAI,CAAC,CAACjB,CAAC,EAAEC,CAAC,KAAK;QAC3D,OAAOg8B,aAAa,KAAK,YAAY,GAAGh8B,CAAC,GAAGD,CAAC,GAAGA,CAAC,GAAGC,CAAC,CAAA;AACvD,OAAC,CAAC,CAAA;AACF,MAAA,OAAOk8B,WAAW,CAAA;AACpB,KAAA;AAEAA,IAAAA,WAAW,CAACjG,UAAU,CAAC,GAAG,CAACv2B,KAAK,CAAC,CAAA;AAEjC,IAAA,OAAOw8B,WAAW,CAAA;GACnB,EACD,EACF,CAAC,CAAA;AAED,EAAA,OAAO/6B,MAAM,CAACiY,WAAW,CACvBjY,MAAM,CAACkY,OAAO,CAAC4iB,gCAAgC,CAAC,CAACz9B,GAAG,CAClD,CAAC,CAACy3B,UAAU,EAAEmG,OAAO,CAAC,KAAK;AACzB,IAAA,OAAO,CAACnG,UAAU,EAAEmG,OAAO,CAAC59B,GAAG,CAAEkB,KAAK,IAAKu2B,UAAU,GAAG,GAAG,GAAGv2B,KAAK,CAAC,CAAC,CAAA;AACvE,GACF,CACF,CAAC,CAAA;AACH,CAAA;AAEA,SAAS46B,iBAAiBA,CAACmB,SAAiB,EAAU;EACpD,MAAM/7B,KAAK,GAAG,CAAC5B,IAAI,CAAC29B,SAAS,CAACl9B,KAAK,CAAC,GAAG,CAAC,CAAC,CAAA;AAEzC,EAAA,IAAIK,MAAM,CAACC,KAAK,CAACa,KAAK,CAAC,EAAE;AACvB,IAAA,OAAO,CAAC,CAAC,CAAA;AACX,GAAA;AAEA,EAAA,OAAOA,KAAK,CAAA;AACd,CAAA;AAEA,SAAS66B,aAAaA,CAACkB,SAAiB,EAAU;AAChD,EAAA,MAAMY,cAAc,GAAGZ,SAAS,CAACl9B,KAAK,CAAC,GAAG,CAAC,CAAA;AAE3C,EAAA,OAAO89B,cAAc,CAAC/nB,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAACC,IAAI,CAAC,GAAG,CAAC,CAAA;AAC9C,CAAA;AAEA,SAAS0mB,OAAOA,CAACQ,SAAiB,EAAW;AAC3C,EAAA,MAAM/7B,KAAK,GAAG46B,iBAAiB,CAACmB,SAAS,CAAC,CAAA;EAE1C,OAAO/7B,KAAK,KAAK,CAAC,CAAA;AACpB,CAAA;AAEA,SAASwwB,MAAMA,CAACuL,SAAiB,EAAEh0B,IAAU,EAAW;AACtD,EAAA,MAAM/H,KAAK,GAAG46B,iBAAiB,CAACmB,SAAS,CAAC,CAAA;AAC1C,EAAA,MAAMxF,UAAU,GAAGsE,aAAa,CAACkB,SAAS,CAAC,CAAA;EAC3C,MAAMa,wBAAwB,GAAGz6B,cAAc,CAC7C4F,IAAI,CAACwE,MAAM,EACXgqB,UACF,CAAC,CAACj4B,MAAM,CAAA;AAER,EAAA,OAAO0B,KAAK,KAAK48B,wBAAwB,GAAG,CAAC,CAAA;AAC/C,CAAA;AAEA,SAAS1D,aAAaA,CAACt6B,IAAY,EAAE2N,MAAW,EAAE;EAChD,MAAMpE,UAAU,GAAGhG,cAAc,CAACoK,MAAM,EAAE3N,IAAI,CAAC,CAAC0L,UAAU,CAAA;AAC1D,EAAA,OAAOnC,UAAU,CAACQ,UAAU,CAAC,cAAc,CAAC,CAAA;AAC9C,CAAA;AAEA,SAASkzB,gBAAgBA,CACvBrzB,SAAiB,EACjBT,IAAU,EACVkxB,kBAA0C,EACjC;EACT,MAAM;AAAEjxB,IAAAA,MAAAA;AAAO,GAAC,GAAGF,oBAAS,CAACU,SAAS,EAAET,IAAI,CAAC,CAAA;AAE7C,EAAA,IAAIC,MAAM,EAAE;IACV,MAAM2a,yBAAyB,GAAGza,sCAA2B,CAC3DF,MAAM,CAACG,UAAU,EACjB8wB,kBACF,CAAC,CAAA;AAED,IAAA,MAAM4D,eAAe,GAAGz+B,IAAI,CAACy8B,aAAa,CAACryB,SAAS,CAAC,CAAC3J,KAAK,CAAC,GAAG,CAAC,CAAC,CAAA;AACjE,IAAA,MAAMi+B,WAAW,GAAGna,yBAAyB,EAAEta,MAAM,CAACC,IAAI,CACvDD,MAAM,IAAKA,MAAM,CAACE,IAAI,KAAKs0B,eAC9B,CAAC,CAAA;IAED,IACEC,WAAW,IACXA,WAAW,CAACpsB,IAAI,KAAK,WAAW,IAC/BosB,WAAW,CAAyBvd,QAAQ,EAC7C;AACA,MAAA,OAAO,KAAK,CAAA;AACd,KAAA;AACF,GAAA;AAEA,EAAA,OAAO,IAAI,CAAA;AACb,CAAA;AAEA,SAAS8a,mBAAmBA,CAC1B7xB,SAAiB,EACjBT,IAAU,EACVkxB,kBAA0C,EACjC;AACT,EAAA,OAAO4C,gBAAgB,CAACrzB,SAAS,EAAET,IAAI,EAAEkxB,kBAAkB,CAAC,CAAA;AAC9D,CAAA;AAEO,MAAMc,SAAS,GAAGA,CACvBgD,YAAoB,EACpBC,YAAoB,EACpB39B,SAAgC,GAAG,UAAU,KAC1C;EACH,MAAM49B,eAAe,GAAG59B,SAAS,KAAK,UAAU,GAAG,CAAC,GAAG,CAAC,CAAC,CAAA;AAEzD,EAAA,MAAM69B,QAAQ,GAAGF,YAAY,CAACn+B,KAAK,CAAC,GAAG,CAAC,CAAA;AACxC,EAAA,MAAMs+B,QAAQ,GAAGJ,YAAY,CAACl+B,KAAK,CAAC,GAAG,CAAC,CAAA;AAExC,EAAA,IAAIq+B,QAAQ,CAAC5+B,MAAM,GAAG,CAAC,EAAE;AACvB,IAAA,OAAOy+B,YAAY,CAAA;AACrB,GAAA;EAEA,IAAI/8B,KAAK,GAAG,CAAC,CAAA;AAEb,EAAA,OAAOA,KAAK,GAAGk9B,QAAQ,CAAC5+B,MAAM,GAAG,CAAC,IAAI0B,KAAK,GAAGm9B,QAAQ,CAAC7+B,MAAM,GAAG,CAAC,EAAE;IACjE,IAAI6+B,QAAQ,CAACn9B,KAAK,CAAC,KAAKk9B,QAAQ,CAACl9B,KAAK,CAAC,EAAE;AACvC,MAAA,OAAO+8B,YAAY,CAAA;AACrB,KAAA;AAEA,IAAA,IAAII,QAAQ,CAACn9B,KAAK,GAAG,CAAC,CAAC,KAAKk9B,QAAQ,CAACl9B,KAAK,GAAG,CAAC,CAAC,EAAE;MAC/C,MAAMo9B,OAAO,GAAGl+B,MAAM,CAACg+B,QAAQ,CAACl9B,KAAK,GAAG,CAAC,CAAC,CAAC,CAAA;MAC3C,MAAMq9B,OAAO,GAAGn+B,MAAM,CAACi+B,QAAQ,CAACn9B,KAAK,GAAG,CAAC,CAAC,CAAC,CAAA;MAE3C,IACEo9B,OAAO,GAAGC,OAAO,KAChBr9B,KAAK,GAAG,CAAC,IAAIk9B,QAAQ,CAAC5+B,MAAM,GAAG,CAAC,IAAI0B,KAAK,GAAG,CAAC,KAAKm9B,QAAQ,CAAC7+B,MAAM,GAAG,CAAC,CAAC,EACvE;AACA6+B,QAAAA,QAAQ,CAACG,MAAM,CAACt9B,KAAK,GAAG,CAAC,EAAE,CAAC,EAAEu9B,MAAM,CAACF,OAAO,GAAGJ,eAAe,CAAC,CAAC,CAAA;AAChE,QAAA,OAAOE,QAAQ,CAACtoB,IAAI,CAAC,GAAG,CAAC,CAAA;AAC3B,OAAC,MAAM;AACL,QAAA,OAAOkoB,YAAY,CAAA;AACrB,OAAA;AACF,KAAA;AACA/8B,IAAAA,KAAK,IAAI,CAAC,CAAA;AACZ,GAAA;AAEA,EAAA,OAAO+8B,YAAY,CAAA;AACrB,CAAC,CAAA;AAEM,SAASnD,oBAAoBA,CAACJ,KAAe,EAAE;EACpD,MAAMgE,gBAAgB,GAAGhE,KAAK,CAACn3B,MAAM,CAAC,CAACC,GAAG,EAAEm7B,IAAI,KAAK;AACnD,IAAA,MAAMtU,OAAO,GAAG0R,aAAa,CAAC4C,IAAI,CAAC,CAAA;AACnC,IAAA,MAAMz9B,KAAK,GAAG46B,iBAAiB,CAAC6C,IAAI,CAAC,CAAA;AAErCn7B,IAAAA,GAAG,CAAC6mB,OAAO,CAAC,GAAGrpB,IAAI,CAAC0Q,GAAG,CAACxQ,KAAK,EAAEsC,GAAG,CAAC6mB,OAAO,CAAC,IAAIjqB,MAAM,CAACw+B,gBAAgB,CAAC,CAAA;AAEvE,IAAA,OAAOp7B,GAAG,CAAA;GACX,EAAE,EAA4B,CAAC,CAAA;EAEhC,OAAOb,MAAM,CAACkY,OAAO,CAAC6jB,gBAAgB,CAAC,CAAC1+B,GAAG,CACzC,CAAC,CAAC8C,GAAG,EAAEP,KAAK,CAAC,KAAK,GAAGO,GAAG,CAAA,CAAA,EAAIP,KAAK,CAAA,CACnC,CAAC,CAAA;AACH;;ACzjBO,SAASs8B,SAASA,CAAC;EACxB1/B,OAAO;EACPkK,UAAU;AACVK,EAAAA,SAAAA;AAKF,CAAC,EAAE;AACD,EAAA,OAAQmB,IAA0B,IAAK;AACrC,IAAA,IAAI,CAACnB,SAAS,IAAI,CAACL,UAAU,EAAE;AAC7B,MAAA,OAAOwB,IAAI,CAAA;AACb,KAAA;AAEA,IAAA,MAAMi0B,cAAc,GAClBj0B,IAAI,CAACmtB,UAAU,GAAG3uB,UAAU,CAAC,GAAGK,SAAS,CAAC,KAAK/E,SAAS,CAAA;AAE1D,IAAA,IAAIm6B,cAAc,EAAE;AAClB,MAAA,OAAOj0B,IAAI,CAAA;AACb,KAAA;AAEA,IAAA,OAAOiP,oBAAS,CACd;AACE,MAAA,GAAGjP,IAAI;AACPmtB,MAAAA,UAAU,EAAE;AACV,QAAA,CAAC3uB,UAAU,GAAG;UACZ,CAACK,SAAS,GAAG,EAAC;AAChB,SAAA;AACF,OAAA;KACD,EACDvK,OACF,CAAC,CAAA;GACF,CAAA;AACH;;ACrBA,MAAM4/B,QAAQ,GAAIx1B,MAAmB,IAAK;EACxC,IAAIA,MAAM,EAAEqI,IAAI,KAAK,sBAAsB,IAAIrI,MAAM,EAAEqI,IAAI,KAAK,WAAW,EAAE;IAC3E,OAAQrI,MAAM,CACX4tB,OAAO,CAAA;AACZ,GAAA;AACA,EAAA,OAAO,EAAE,CAAA;AACX,CAAC,CAAA;AAED,MAAM6H,aAAa,GAAGA,CAAC;EACrB7/B,OAAO;EACP8J,IAAI;EACJM,MAAM;AACNF,EAAAA,UAAAA;AAMF,CAAC,KAAK;AACJ,EAAA,MAAMuM,KAAK,GAAGmpB,QAAQ,CAACx1B,MAAM,CAAC,CAAA;EAE9B,MAAM01B,aAAa,GAAGJ,SAAS,CAAC;IAC9B1/B,OAAO;IACPkK,UAAU;IACVK,SAAS,EAAEH,MAAM,EAAEE,IAAAA;AACrB,GAAC,CAAC,CAAA;AAEF,EAAA,OAAO,CAAC3J,IAAY,EAAEoB,KAAa,EAAE2J,IAA0B,KAAK;AAClE,IAAA,MAAMq0B,cAAc,GAAGnxB,kCAAuB,CAAClD,IAAI,EAAE1L,OAAO,CAAC,CAAA;IAC7D,IAAI,CAAC+/B,cAAc,EAAE;AACnB,MAAA,OAAO,IAAI,CAAA;AACb,KAAA;AAEA,IAAA,MAAMC,SAAS,GAAG,CAChBD,cAAc,CAACh7B,EAAE,EACjB,GAAGqyB,sBAAsB,CAAC2I,cAAc,CAACttB,IAAI,CAAC,CAC/C,CAAA;AACD,IAAA,IAAI,CAACtQ,WAAW,CAACsU,KAAK,EAAEupB,SAAS,CAAC,EAAE;AAClC,MAAA,OAAO,IAAI,CAAA;AACb,KAAA;AAEA,IAAA,MAAMC,cAAc,GAAGH,aAAa,CAACp0B,IAAI,CAAC,CAAA;AAC1C,IAAA,MAAMw0B,cAAc,GAAGxQ,0BAAe,CAACuQ,cAAc,EAAEjgC,OAAO,CAAC,CAAA;IAE/D8J,IAAI,CAACqxB,QAAQ,CAACC,MAAM,CAACz6B,IAAI,EAAEoB,KAAK,EAAEm+B,cAAc,CAAC,CAAA;AAEjD,IAAA,OAAO,CAAGv/B,EAAAA,IAAI,CAAIoB,CAAAA,EAAAA,KAAK,CAAE,CAAA,CAAA;GAC1B,CAAA;AACH,CAAC;;AC5CD,SAASo+B,SAASA,CAACx/B,IAAc,EAAEX,OAA+B,EAAE;AAClE,EAAA,MAAM6vB,gBAAgB,GAAG5lB,sCAA2B,CAClDtJ,IAAI,CAACoJ,MAAM,EAAEG,UAAU,IAAI,EAAE,EAC7BlK,OACF,CAAC,CAAA;EAED,MAAMoK,MAAM,GAAG,CAACylB,gBAAgB,EAAEzlB,MAAM,IAAI,EAAE,EAAEC,IAAI,CACjD+Y,CAAC,IAAKA,CAAC,CAAC9Y,IAAI,KAAK3J,IAAI,CAACoJ,MAAM,EAAEQ,SACjC,CAAC,CAAA;AAED,EAAA,OAAOH,MAAM,CAAA;AACf,CAAA;AAEA,MAAMg2B,MAAM,GAAIvE,WAAqB,IACnC,CAACA,WAAW,CAAC9xB,MAAM,EAAEpJ,IAAI,EAAEk7B,WAAW,CAAC9xB,MAAM,EAAEQ,SAAS,CAAC,CACtDvJ,MAAM,CAACq/B,OAAO,CAAC,CACfzpB,IAAI,CAAC,GAAG,CAAC,CAAA;AAEd,MAAM0pB,oBAAoB,GAAGA,CAACv+B,KAAK,GAAG,CAAC,EAAEqI,MAAmB,KAAK;AAC/D,EAAA,IAAIA,MAAM,EAAEqI,IAAI,KAAK,sBAAsB,EAAE;IAC3C,OAAO1Q,KAAK,GAAG,CAAC,CAAA;AAClB,GAAA;AACA,EAAA,OAAOA,KAAK,CAAA;AACd,CAAC,CAAA;AAED,SAASw+B,mBAAmBA,CAAC;EAC3Bz2B,IAAI;AACJ9J,EAAAA,OAAAA;AAIF,CAAC,EAAE;EACD,OAAO,UAAUwgC,sBAA8B,EAAE;IAC/C,MAAMzE,oBAAmC,GAAG,EAAE,CAAA;AAE9C,IAAA,MAAM0E,aAAa,GAAG,IAAIt5B,GAAG,EAAU,CAAA;AACvC,IAAA,MAAMu5B,UAAU,GAAG,CAACF,sBAAsB,CAAC,CAAA;AAE3C,IAAA,OAAOE,UAAU,CAACrgC,MAAM,GAAG,CAAC,EAAE;AAC5B,MAAA,MAAMM,IAAI,GAAG+/B,UAAU,CAACC,KAAK,EAAE,CAAA;MAC/B,IAAI,CAAChgC,IAAI,EAAE;AACT,QAAA,SAAA;AACF,OAAA;AAEA,MAAA,IAAI8/B,aAAa,CAACp5B,GAAG,CAAC1G,IAAI,CAAC,EAAE;AAC3B,QAAA,SAAA;AACF,OAAA;MAEA,IAAI,CAACuD,cAAc,CAAC4F,IAAI,CAACwE,MAAM,EAAE3N,IAAI,CAAC,EAAE;AACtC,QAAA,SAAA;AACF,OAAA;AAEA,MAAA,MAAMigC,MAAM,GAAG/2B,oBAAS,CAAClJ,IAAI,EAAEmJ,IAAI,CAAC,CAAA;MAEpC,MAAME,UAAU,GAAGC,sCAA2B,CAC5C22B,MAAM,CAAC12B,UAAU,IAAI,EAAE,EACvBlK,OACF,CAAC,CAAA;MAED,IAAI,CAACgK,UAAU,EAAE;AACf,QAAA,SAAA;AACF,OAAA;AAEA,MAAA,MAAMI,MAAM,GAAG+1B,SAAS,CAACS,MAAM,EAAE5gC,OAAO,CAAC,CAAA;MAEzC+7B,oBAAoB,CAAClwB,IAAI,CAAC;QACxB9J,KAAK,EAAEu+B,oBAAoB,CAACM,MAAM,CAAC7+B,KAAK,EAAEqI,MAAM,CAAC;AACjDwC,QAAAA,IAAI,EAAEwzB,MAAM,CAACQ,MAAM,CAAC;QACpBxF,MAAM,EAAEyE,aAAa,CAAC;UACpB7/B,OAAO;UACP8J,IAAI;UACJM,MAAM;AACNF,UAAAA,UAAU,EAAE02B,MAAM,CAAC72B,MAAM,EAAEG,UAAAA;SAC5B,CAAA;AACH,OAAC,CAAC,CAAA;MAEF,KAAK,MAAM22B,IAAI,IAAK72B,UAAU,CAC3B82B,UAAU,IAAI,EAAE,EAAE;QACnB,MAAMC,UAAU,GAAG/2B,UAAU,CAACI,MAAM,CAACC,IAAI,CAAC,CAAC;AAAEC,UAAAA,IAAAA;AAAK,SAAC,KAAKA,IAAI,KAAKu2B,IAAI,CAAC,CAAA;QAEtE,IAAI,CAACE,UAAU,EAAE;AACf,UAAA,SAAA;AACF,SAAA;AAEA,QAAA,MAAMC,QAAQ,GAAG,CAAA,EAAGrgC,IAAI,CAAA,CAAA,EAAIkgC,IAAI,CAAE,CAAA,CAAA;QAElC,MAAMI,UAAU,GAAG/8B,cAAc,CAAC4F,IAAI,CAACwE,MAAM,EAAE0yB,QAAQ,CAAC,IAAI,EAAE,CAAA;AAE9D,QAAA,IAAIC,UAAU,CAAC5gC,MAAM,KAAK,CAAC,EAAE;UAC3B07B,oBAAoB,CAAClwB,IAAI,CAAC;AACxBe,YAAAA,IAAI,EAAEo0B,QAAQ;AACdj/B,YAAAA,KAAK,EAAE,CAAC;YACRq5B,MAAM,EAAEyE,aAAa,CAAC;cACpB7/B,OAAO;cACP8J,IAAI;AACJM,cAAAA,MAAM,EAAE22B,UAAU;cAClB72B,UAAU,EAAEF,UAAU,CAACjF,EAAAA;aACxB,CAAA;AACH,WAAC,CAAC,CAAA;AACJ,SAAC,MAAM,IAAIg8B,UAAU,CAACtuB,IAAI,KAAK,WAAW,EAAE;AAC1CiuB,UAAAA,UAAU,CAAC70B,IAAI,CAAC,CAAGm1B,EAAAA,QAAQ,IAAI,CAAC,CAAA;AAClC,SAAC,MAAM,IAAID,UAAU,CAACtuB,IAAI,KAAK,sBAAsB,EAAE;AACrDiuB,UAAAA,UAAU,CAAC70B,IAAI,CACb,GAAGrL,KAAK,CAAC8e,IAAI,CAAC9e,KAAK,CAACygC,UAAU,CAAC5gC,MAAM,CAAC,CAACoD,IAAI,EAAE,CAAC,CAC3C5C,GAAG,CAAEqgC,GAAG,IAAK,CAAGF,EAAAA,QAAQ,CAAIE,CAAAA,EAAAA,GAAG,EAAE,CAAC,CAClCC,OAAO,EACZ,CAAC,CAAA;AACH,SAAA;AACF,OAAA;AACF,KAAA;AAEA,IAAA,OAAOpF,oBAAoB,CAAA;GAC5B,CAAA;AACH;;AClIA,SAASqF,YAAYA,GAAG;AACtB,EAAA,MAAMC,OAAO,GAAG,IAAIC,GAAG,EAAkB,CAAA;EACzC,OAAQC,YAA2B,IAAM71B,IAA0B,IAAK;IACtE,IAAInJ,CAAC,GAAG,CAAC,CAAA;AAET,IAAA,OAAOA,CAAC,GAAGg/B,YAAY,CAAClhC,MAAM,EAAE;MAC9B,MAAM;QAAE0B,KAAK;QAAE6K,IAAI;AAAEwuB,QAAAA,MAAAA;AAAO,OAAC,GAAGmG,YAAY,CAACh/B,CAAC,CAAC,CAAA;AAE/C,MAAA,MAAM5B,IAAI,GAAG,CAAA,EAAGiM,IAAI,CAAA,CAAA,EAAI7K,KAAK,CAAE,CAAA,CAAA;MAC/B,MAAMy/B,wBAAwB,GAAGH,OAAO,CAAC5L,GAAG,CAAC90B,IAAI,CAAC,IAAI,CAAC,CAAA;MAEvD,MAAM6J,MAAM,GAAG4wB,MAAM,CAACxuB,IAAI,EAAE7K,KAAK,GAAGy/B,wBAAwB,EAAE91B,IAAI,CAAC,CAAA;AAEnE,MAAA,IAAIlB,MAAM,EAAE;QACV62B,OAAO,CAACI,GAAG,CAAC9gC,IAAI,EAAE6gC,wBAAwB,GAAG,CAAC,CAAC,CAAA;AAC/C,QAAA,OAAOh3B,MAAM,CAAA;AACf,OAAA;AAEAjI,MAAAA,CAAC,EAAE,CAAA;AACL,KAAA;AAEA,IAAA,OAAO,IAAI,CAAA;GACZ,CAAA;AACH;;AC1BA,SAASm/B,cAAcA,CAAmB90B,IAAO,EAA6B;EAC5E,OAAO,CAAA,mBAAA,EAAsBA,IAAI,CAAE,CAAA,CAAA;AACrC,CAAA;AAEA,MAAM+0B,yBAAyB,GAAGD,cAAc,CAAC,2BAA2B,CAAC,CAAA;AAC7E,MAAME,qBAAqB,GAAGF,cAAc,CAAC,uBAAuB,CAAC,CAAA;AACrE,MAAMG,sBAAsB,GAAGH,cAAc,CAAC,wBAAwB,CAAC,CAAA;AAEvE,MAAMI,wBAAwB,GAAGJ,cAAc,CAAC,0BAA0B,CAAC,CAAA;AAC3E,MAAMK,oBAAoB,GAAGL,cAAc,CAAC,sBAAsB,CAAC,CAAA;AACnE,MAAMM,qBAAqB,GAAGN,cAAc,CAAC,uBAAuB,CAAC;;ACSrE,SAAS/f,SAASA,CAAC;EAAErU,QAAQ;EAAEvL,KAAK;EAAEkgC,MAAM;AAAE7yB,EAAAA,OAAAA;AAAwB,CAAC,EAAE;EACvE,MAAM,CAAC8D,MAAM,EAAEC,SAAS,CAAC,GAAGtT,yBAAK,CAACiE,QAAQ,CAAC,KAAK,CAAC,CAAA;AACjD,EAAA,MAAMo+B,iBAAiB,GAAGriC,yBAAK,CAACmE,MAAM,CAAoB,IAAI,CAAC,CAAA;EAE/D,MAAMm+B,mBAAmB,GAAIr7B,KAAuB,IAAK;IACvDA,KAAK,CAACysB,eAAe,EAAE,CAAA;IACvBzsB,KAAK,CAACQ,cAAc,EAAE,CAAA;;AAEtB;AACA,IAAA,IAAI8H,OAAO,EAAE;AACXA,MAAAA,OAAO,EAAE,CAAA;AACT,MAAA,OAAA;AACF,KAAA;GACD,CAAA;EAEDvP,yBAAK,CAAC0H,SAAS,CAAC,MAAM;AACpB,IAAA,MAAM66B,mBAAmB,GAAGA,MAAMjvB,SAAS,CAAC,KAAK,CAAC,CAAA;IAClD3L,QAAQ,CAACK,gBAAgB,CAAC,SAAS,EAAEu6B,mBAAmB,EAAE,KAAK,CAAC,CAAA;IAChE,OAAO,MAAM56B,QAAQ,CAACM,mBAAmB,CAAC,SAAS,EAAEs6B,mBAAmB,CAAC,CAAA;GAC1E,EAAE,EAAE,CAAC,CAAA;AAEN,EAAA,oBACEviC,yBAAA,CAAAmG,aAAA,CAACq8B,gBAAgB,EAAA;AACftgC,IAAAA,KAAK,EAAEA,KAAM;AACbkgC,IAAAA,MAAM,EAAEA,MAAO;AACf30B,IAAAA,QAAQ,EAAEA,QAAS;AACnB4F,IAAAA,MAAM,EAAEA,MAAAA;AAAO,GAAA,eAEfrT,yBAAA,CAAAmG,aAAA,CAACs8B,aAAa,EAAA;AACZ55B,IAAAA,GAAG,EAAEw5B,iBAAkB;AACvB9yB,IAAAA,OAAO,EAAE+yB,mBAAoB;AAC7BjvB,IAAAA,MAAM,EAAEA,MAAO;IACf4f,OAAO,EAAA,IAAA;IACPC,KAAK,EAAA,IAAA;GAELlzB,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEsY,IAAAA,KAAK,EAAC,4BAA4B;AAClCpW,IAAAA,KAAK,EAAC,IAAI;AACVC,IAAAA,MAAM,EAAC,IAAI;AACXoW,IAAAA,OAAO,EAAC,WAAW;AACnBC,IAAAA,IAAI,EAAC,MAAA;GAEL3e,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AAAMu8B,IAAAA,EAAE,EAAC,MAAM;AAACC,IAAAA,EAAE,EAAC,GAAG;AAACC,IAAAA,EAAE,EAAC,MAAM;AAACC,IAAAA,EAAE,EAAC,IAAI;AAAC/jB,IAAAA,MAAM,EAAC,cAAA;AAAc,GAAE,CAAC,eACjE9e,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AAAMu8B,IAAAA,EAAE,EAAC,GAAG;AAACC,IAAAA,EAAE,EAAC,MAAM;AAACC,IAAAA,EAAE,EAAC,IAAI;AAACC,IAAAA,EAAE,EAAC,MAAM;AAAC/jB,IAAAA,MAAM,EAAC,cAAA;GAAgB,CAC7D,CACQ,CACC,CAAC,CAAA;AAEvB,CAAA;AAUA,MAAM2jB,aAAa,GAAGp5B,uBAAM,CAACkqB,UAAU,CAAC,CAAAhqB,UAAA,CAAA;EAAAC,WAAA,EAAA,0BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAQnC2E,CAAAA,CAAAA,CAAAA,mEAAAA,EAAAA,GAAAA,CAAAA,EAAAA,KAAK,IACNA,KAAK,CAACiF,MAAM,IACZuG,oBAAG,0BAEF,CACJ,CAAA;AASD,MAAM4oB,gBAAgB,GAAGn5B,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,6BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAAA,CAAA,CAAA,CAAA,6BAAA,EAAA,eAAA,EAAA,kBAAA,EAAA,6BAAA,CAAA,EAI7B,CAAC;AAAEgE,EAAAA,QAAAA;AAAS,CAAC,KACbA,QAAQ,KAAK,QAAQ,GAAGs0B,qBAAqB,GAAGG,oBAAoB,EAGpE,CAAC;AAAEz0B,EAAAA,QAAAA;AAAS,CAAC,KACbA,QAAQ,KAAK,QAAQ,GAAGu0B,sBAAsB,GAAGG,qBAAqB,EAItE,CAAC;AAAE10B,EAAAA,QAAAA;AAAS,CAAC,KACbA,QAAQ,KAAK,QAAQ,GACjBq0B,yBAAyB,GACzBG,wBAAwB,CAKjC;;ACtHD,MAAMpO,OAAO,GAAGxqB,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,+BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CASzB,CAAA,CAAA,CAAA,sGAAA,CAAA,CAAA,CAAA;AAQD,MAAMq5B,YAAY,GAAGz5B,uBAAM,CAACC,GAAG,CAACy5B,KAAK,CACnC,CAAC;EAAE16B,KAAK;EAAEC,MAAM;AAAEC,EAAAA,SAAAA;AAAU,CAAC,KAAK;EAChC,OAAO;AACLa,IAAAA,KAAK,EAAE;MACLf,KAAK;MACLC,MAAM;AACNC,MAAAA,SAAAA;AACF,KAAA;GACD,CAAA;AACH,CACF,CAAC,CAAAgB,UAAA,CAAA;EAAAC,WAAA,EAAA,oCAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAQA,CAAA,CAAA,CAAA,oFAAA,CAAA,CAAA;;AClCD,SAASu5B,6BAA6BA,CACpCzhC,SAAiD,EACjD0hC,iBAA0B,EAC1BjO,QAGC,EACDkO,oBAA8B,EAI9B;EACA,MAAMC,cAAc,GAAGnhC,IAAI,CAACohC,KAAK,CAACC,gBAAe,GAAG,CAAC,CAAC,CAAA;EAEtD,IAAI9hC,SAAS,KAAK,UAAU,EAAE;IAC5B,MAAM+hC,qBAAqB,GAAGthC,IAAI,CAACohC,KAAK,CACtCH,iBAAiB,CAACpV,GAAG,GAAGsV,cAC1B,CAAC,CAAA;AACD,IAAA,MAAMI,oBAAoB,GAAGvhC,IAAI,CAACohC,KAAK,CACrCH,iBAAiB,CAACpV,GAAG,GAAGoV,iBAAiB,CAAC36B,MAAM,GAAG66B,cACrD,CAAC,CAAA;AACD,IAAA,MAAMK,iBAAiB,GAAGxhC,IAAI,CAACohC,KAAK,CAClCH,iBAAiB,CAACv1B,IAAI,GAAGu1B,iBAAiB,CAAC56B,KAAK,GAAG,CAAC,GAAG86B,cACzD,CAAC,CAAA;IAED,MAAMM,4BAA4B,GAAGC,sBAAsB,CACzD;MACE7V,GAAG,EAAEyV,qBAAqB,GAAGH,cAAc;MAC3Cz1B,IAAI,EAAE81B,iBAAiB,GAAGL,cAAAA;KAC3B,EACDnO,QACF,CAAC,CAAA;IAED,MAAM2O,2BAA2B,GAAGD,sBAAsB,CACxD;MACE7V,GAAG,EAAE0V,oBAAoB,GAAGJ,cAAc;MAC1Cz1B,IAAI,EAAE81B,iBAAiB,GAAGL,cAAAA;KAC3B,EACDnO,QACF,CAAC,CAAA;AAED,IAAA,IAAIkO,oBAAoB,EAAE;MACxB,OAAO;AACLU,QAAAA,MAAM,EAAE;AACN/V,UAAAA,GAAG,EAAEyV,qBAAqB;AAC1B51B,UAAAA,IAAI,EAAE81B,iBAAiB;AACvBptB,UAAAA,OAAO,EACLqtB,4BAA4B,GACxB,OAAO,GACP,MAAA;SACP;AACDI,QAAAA,KAAK,EAAE;AACLhW,UAAAA,GAAG,EAAE0V,oBAAoB;AACzB71B,UAAAA,IAAI,EAAE81B,iBAAiB;AACvBptB,UAAAA,OAAO,EACLutB,2BAA2B,GACvB,OAAO,GACP,MAAA;AACR,SAAA;OACD,CAAA;AACH,KAAC,MAAM;MACL,OAAO;AACLC,QAAAA,MAAM,EAAE;AACN/V,UAAAA,GAAG,EAAEyV,qBAAqB;AAC1B51B,UAAAA,IAAI,EAAE81B,iBAAiB;AACvBptB,UAAAA,OAAO,EAAEqtB,4BAA4B,GAAG,OAAO,GAAG,MAAA;SACnD;AACDI,QAAAA,KAAK,EAAE;AACLhW,UAAAA,GAAG,EAAE0V,oBAAoB;AACzB71B,UAAAA,IAAI,EAAE81B,iBAAiB;AACvBptB,UAAAA,OAAO,EAAEutB,2BAA2B,GAAG,OAAO,GAAG,MAAA;AACnD,SAAA;OACD,CAAA;AACH,KAAA;AACF,GAAC,MAAM;AACL,IAAA,MAAMG,gBAAgB,GAAG9hC,IAAI,CAACohC,KAAK,CACjCH,iBAAiB,CAACpV,GAAG,GAAGoV,iBAAiB,CAAC36B,MAAM,GAAG,CAAC,GAAG66B,cACzD,CAAC,CAAA;IACD,MAAMY,sBAAsB,GAAG/hC,IAAI,CAACohC,KAAK,CACvCH,iBAAiB,CAACv1B,IAAI,GAAGy1B,cAC3B,CAAC,CAAA;AACD,IAAA,MAAMa,qBAAqB,GAAGhiC,IAAI,CAACohC,KAAK,CACtCH,iBAAiB,CAACv1B,IAAI,GAAGu1B,iBAAiB,CAAC56B,KAAK,GAAG86B,cACrD,CAAC,CAAA;IAED,MAAMM,4BAA4B,GAAGC,sBAAsB,CACzD;MACE7V,GAAG,EAAEiW,gBAAgB,GAAGX,cAAc;MACtCz1B,IAAI,EAAEq2B,sBAAsB,GAAGZ,cAAAA;KAChC,EACDnO,QACF,CAAC,CAAA;IACD,MAAM2O,2BAA2B,GAAGD,sBAAsB,CACxD;MACE7V,GAAG,EAAEiW,gBAAgB,GAAGX,cAAc;MACtCz1B,IAAI,EAAEs2B,qBAAqB,GAAGb,cAAAA;KAC/B,EACDnO,QACF,CAAC,CAAA;AAED,IAAA,IAAIkO,oBAAoB,EAAE;MACxB,OAAO;AACLU,QAAAA,MAAM,EAAE;AACN/V,UAAAA,GAAG,EAAEiW,gBAAgB;AACrBp2B,UAAAA,IAAI,EAAEq2B,sBAAsB;AAC5B3tB,UAAAA,OAAO,EAAEqtB,4BAA4B,GAAG,OAAO,GAAG,MAAA;SACnD;AACDI,QAAAA,KAAK,EAAE;AACLhW,UAAAA,GAAG,EAAEiW,gBAAgB;AACrBp2B,UAAAA,IAAI,EAAEs2B,qBAAqB;AAC3B5tB,UAAAA,OAAO,EAAEutB,2BAA2B,GAAG,OAAO,GAAG,MAAA;AACnD,SAAA;OACD,CAAA;AACH,KAAC,MAAM;MACL,OAAO;AACLC,QAAAA,MAAM,EAAE;AACN/V,UAAAA,GAAG,EAAEiW,gBAAgB;AACrBp2B,UAAAA,IAAI,EAAEq2B,sBAAsB;AAC5B3tB,UAAAA,OAAO,EAAEqtB,4BAA4B,GAAG,OAAO,GAAG,MAAA;SACnD;AACDI,QAAAA,KAAK,EAAE;AACLhW,UAAAA,GAAG,EAAEiW,gBAAgB;AACrBp2B,UAAAA,IAAI,EAAEs2B,qBAAqB;AAC3B5tB,UAAAA,OAAO,EAAEutB,2BAA2B,GAAG,OAAO,GAAG,MAAA;AACnD,SAAA;OACD,CAAA;AACH,KAAA;AACF,GAAA;AACF,CAAA;AAIA,SAASD,sBAAsBA,CAC7BlmB,MAAqC,EACrCwX,QAA2C,EAC3C;EACA,OACExX,MAAM,CAACqQ,GAAG,IAAI,CAAC,IACfrQ,MAAM,CAACqQ,GAAG,IAAImH,QAAQ,CAAC1sB,MAAM,IAC7BkV,MAAM,CAAC9P,IAAI,IAAI,CAAC,IAChB8P,MAAM,CAAC9P,IAAI,IAAIsnB,QAAQ,CAAC3sB,KAAK,CAAA;AAEjC;;AC7GA,SAAS47B,cAAcA,CAAC;EAAE57B,KAAK;EAAEC,MAAM;AAAEC,EAAAA,SAAAA;AAA+B,CAAC,EAAE;AACzE,EAAA,MAAMuB,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;EACxC,MAAM;IAAEoV,aAAa;IAAErL,IAAI;AAAEuF,IAAAA,OAAAA;AAAQ,GAAC,GAAG1F,aAAa,CAAA;AAEtD,EAAA,MAAMo6B,oBAAoB,GACxB5uB,aAAa,CAAC9U,MAAM,KAAK,CAAC,GACtBqJ,kBAAkB,CAACyL,aAAa,CAAC,CAAC,CAAC,EAAExL,aAAa,CAAC,GACnDnE,SAAS,CAAA;AAEf,EAAA,MAAM6F,uBAAyD,GAC7D04B,oBAAoB,GAChB7/B,cAAc,CACZyF,aAAa,CAAC0B,uBAAuB,EACrC04B,oBACF,CAAC,GACDv+B,SAAS,CAAA;EAEf,MAAM;AAAEpE,IAAAA,SAAS,GAAG,UAAA;AAAW,GAAC,GAAGiK,uBAAuB,EAAEE,SAAS,IAAI,EAAE,CAAA;AAE3E,EAAA,MAAMy4B,eAAe,GAAGC,gCAAgC,CACtD9uB,aAAa,EACbxL,aACF,CAAC,CAAA;AAED+c,EAAAA,qBAAe,CAAC,MAAM;AACpB,IAAA,IAAIvR,aAAa,CAAC9U,MAAM,KAAK,CAAC,EAAE;AAC9B6jC,MAAAA,cAAc,EAAE,CAAA;AAClB,KAAA;AACF,GAAC,EAAE,CAAC/uB,aAAa,CAAC,CAAC,CAAA;AAEnBuR,EAAAA,qBAAe,CAAC,MAAM;IACpB,SAASyd,4BAA4BA,CACnCr9B,KAAyC,EACzC;MACA,IAAI,CAACk9B,eAAe,EAAE;AACpBE,QAAAA,cAAc,EAAE,CAAA;AAChB,QAAA,OAAA;AACF,OAAA;AAEA,MAAA,IACEp9B,KAAK,CAACs9B,IAAI,CAAC3xB,IAAI,KACf,qDAAqD,EACrD;QACA4xB,gBAAgB,CACdjjC,SAAS,EACT0F,KAAK,CAACs9B,IAAI,CAACE,OAAO,CAACjnB,MAAM,EACzB;UACEnV,KAAK;AACLC,UAAAA,MAAAA;SACD,EACDrB,KAAK,CAACs9B,IAAI,CAACE,OAAO,CAACC,SACrB,CAAC,CAAA;AACH,OAAA;AACF,KAAA;AAEA58B,IAAAA,MAAM,CAACE,gBAAgB,CAAC,SAAS,EAAEs8B,4BAA4B,CAAC,CAAA;AAEhE,IAAA,OAAO,MAAM;AACXx8B,MAAAA,MAAM,CAACG,mBAAmB,CAAC,SAAS,EAAEq8B,4BAA4B,CAAC,CAAA;KACpE,CAAA;GACF,EAAE,CAAC/iC,SAAS,EAAE+G,MAAM,EAAE67B,eAAe,EAAE97B,KAAK,CAAC,CAAC,CAAA;EAE/C,eAAes8B,oBAAoBA,CAACC,KAAyB,EAAE;AAC7D,IAAA,IAAI9jC,IAAI,GAAGwU,aAAa,CAAC9U,MAAM,KAAK,CAAC,GAAG8U,aAAa,CAAC,CAAC,CAAC,GAAG3P,SAAS,CAAA;IAEpE,IAAI,CAAC7E,IAAI,EAAE;AACT,MAAA,OAAA;AACF,KAAA;AAEA,IAAA,IAAIke,wBAAwB,CAACle,IAAI,CAAC,EAAE;MAClCA,IAAI,GAAGA,IAAI,CAACqE,OAAO,CAAC4Z,iCAAiC,EAAE,EAAE,CAAC,CAAA;AAC5D,KAAA;IAEA,MAAM;MAAE7U,MAAM;AAAEhI,MAAAA,KAAAA;AAAM,KAAC,GAAG8H,oBAAS,CAAClJ,IAAI,EAAEmJ,IAAI,CAAC,CAAA;AAE/C,IAAA,IAAI,CAACC,MAAM,IAAIhI,KAAK,KAAKyD,SAAS,EAAE;AAClC,MAAA,OAAA;AACF,KAAA;IAEA,MAAMwE,UAAU,GAAGC,sCAA2B,CAC5CF,MAAM,CAACG,UAAU,EACjBP,aACF,CAAC,CAAA;AAED,IAAA,MAAMQ,UAAU,GAAGH,UAAU,EAAEI,MAAM,CAACC,IAAI,CACvCF,UAAU,IAAKA,UAAU,CAACG,IAAI,KAAKP,MAAM,CAACQ,SAC7C,CAAC,CAAA;IAED,IAAI,CAACJ,UAAU,EAAE;AACf,MAAA,OAAA;AACF,KAAA;AAEA,IAAA,MAAMmuB,UAAU,GACdvuB,MAAM,CAACpJ,IAAI,IAAIoJ,MAAM,CAACpJ,IAAI,KAAK,EAAE,GAAG,EAAE,GAAG,GAAG,CAAC,GAAGoJ,MAAM,CAACQ,SAAS,CAAA;AAElE,IAAA,MAAMiF,MAAM,GAAG,MAAMH,OAAO,CAACqR,mBAAmB,CAAC;AAAE/f,MAAAA,IAAI,EAAE23B,UAAAA;AAAW,KAAC,CAAC,CAAA;AAEtE,IAAA,IAAI9oB,MAAM,EAAE;MACVH,OAAO,CAACq1B,UAAU,CAAC;AACjB93B,QAAAA,IAAI,EACFzC,UAAU,CAACsI,IAAI,KAAK,gCAAgC,GAChD,CAAA,EAAG6lB,UAAU,CAAA,CAAA,EAAI3uB,aAAa,CAAC4Q,aAAa,CAACC,MAAM,CAAA,CAAE,GACrD8d,UAAU;QAChBv2B,KAAK,EAAE0iC,KAAK,KAAK,QAAQ,GAAG1iC,KAAK,GAAGA,KAAK,GAAG,CAAC;AAC7C4iC,QAAAA,KAAK,EAAEn1B,MAAAA;AACT,OAAC,CAAC,CAAA;AACJ,KAAA;AACF,GAAA;EAEA,oBACE3P,yBAAA,CAAAmG,aAAA,CAAC0tB,OAAO,qBACN7zB,yBAAA,CAAAmG,aAAA,CAAC28B,YAAY,EAAA;AAACz6B,IAAAA,KAAK,EAAEA,KAAM;AAACC,IAAAA,MAAM,EAAEA,MAAO;AAACC,IAAAA,SAAS,EAAEA,SAAAA;AAAU,GAAA,eAC/DvI,yBAAA,CAAAmG,aAAA,CAAC2b,SAAS,EAAA;AACRrU,IAAAA,QAAQ,EAAC,QAAQ;AACjB8B,IAAAA,OAAO,EAAEA,MAAMo1B,oBAAoB,CAAC,QAAQ,CAAA;AAAE,GAC/C,CAAC,eACF3kC,yBAAA,CAAAmG,aAAA,CAAC2b,SAAS,EAAA;AACRrU,IAAAA,QAAQ,EAAC,OAAO;AAChB8B,IAAAA,OAAO,EAAEA,MAAMo1B,oBAAoB,CAAC,OAAO,CAAA;GAC5C,CACW,CACP,CAAC,CAAA;AAEd,CAAA;AAIA,SAASH,gBAAgBA,CACvBjjC,SAAiD,EACjD0hC,iBAA0B,EAC1BjO,QAGC,EACDkO,oBAA8B,EAC9B;EACA,MAAM;IAAEW,KAAK;AAAED,IAAAA,MAAAA;GAAQ,GAAGZ,6BAA6B,CACrDzhC,SAAS,EACT0hC,iBAAiB,EACjBjO,QAAQ,EACRkO,oBACF,CAAC,CAAA;EAED6B,cAAc,CAAChD,qBAAqB,EAAE6B,MAAM,CAAC/V,GAAG,GAAG,IAAI,CAAC,CAAA;EACxDkX,cAAc,CAAC/C,sBAAsB,EAAE4B,MAAM,CAACl2B,IAAI,GAAG,IAAI,CAAC,CAAA;EAC1Dq3B,cAAc,CAAC7C,oBAAoB,EAAE2B,KAAK,CAAChW,GAAG,GAAG,IAAI,CAAC,CAAA;EACtDkX,cAAc,CAAC5C,qBAAqB,EAAE0B,KAAK,CAACn2B,IAAI,GAAG,IAAI,CAAC,CAAA;AACxDq3B,EAAAA,cAAc,CAACjD,yBAAyB,EAAE8B,MAAM,CAACxtB,OAAO,CAAC,CAAA;AACzD2uB,EAAAA,cAAc,CAAC9C,wBAAwB,EAAE4B,KAAK,CAACztB,OAAO,CAAC,CAAA;AACzD,CAAA;AAEA,SAASiuB,cAAcA,GAAG;AACxBU,EAAAA,cAAc,CAACjD,yBAAyB,EAAE,MAAM,CAAC,CAAA;AACjDiD,EAAAA,cAAc,CAAC9C,wBAAwB,EAAE,MAAM,CAAC,CAAA;AAClD,CAAA;AAEA,SAAS8C,cAAcA,CAACh4B,IAAY,EAAExJ,KAAsB,EAAE;AAC5DoE,EAAAA,QAAQ,CAACq9B,eAAe,CAAC57B,KAAK,CAAC67B,WAAW,CAACl4B,IAAI,EAAExJ,KAAK,CAACiC,QAAQ,EAAE,CAAC,CAAA;AACpE,CAAA;AAEA,SAAS4+B,gCAAgCA,CACvCnQ,aAA4B,EAC5BnqB,aAAgC,EAChC;AACA,EAAA,IAAImqB,aAAa,CAACzzB,MAAM,KAAK,CAAC,EAAE;AAC9B,IAAA,OAAO,KAAK,CAAA;AACd,GAAC,MAAM,IAAIyzB,aAAa,CAACzzB,MAAM,KAAK,CAAC,EAAE;AACrC,IAAA,IAAIwe,wBAAwB,CAACiV,aAAa,CAAC,CAAC,CAAC,CAAC,EAAE;AAC9C,MAAA,OAAO,KAAK,CAAA;AACd,KAAA;IAEA,MAAM;AAAE/pB,MAAAA,MAAAA;KAAQ,GAAGF,oBAAS,CAACiqB,aAAa,CAAC,CAAC,CAAC,EAAEnqB,aAAa,CAACG,IAAI,CAAC,CAAA;AAElE,IAAA,IAAI,CAACC,MAAM,EAAE,OAAO,KAAK,CAAA;IAEzB,MAAM8lB,gBAAgB,GAAG5lB,sCAA2B,CAClDF,MAAM,CAACG,UAAU,EACjBP,aACF,CAAC,CAAA;AAED,IAAA,MAAMQ,UAAU,GAAG0lB,gBAAgB,EAAEzlB,MAAM,CAACC,IAAI,CAC7CF,UAAU,IAAKA,UAAU,CAACG,IAAI,KAAKP,MAAM,CAACQ,SAC7C,CAAC,CAAA;AAED,IAAA,IAAI,CAACJ,UAAU,EAAE,OAAO,KAAK,CAAA;IAE7B,OAAO46B,iCAAsB,CAAC56B,UAAU,CAAC,CAAA;AAC3C,GAAC,MAAM;AACL,IAAA,OAAO,KAAK,CAAA;AACd,GAAA;AACF;;ACvNA;AACA;AACA;AACA;;AAQA,SAAS66B,cAAcA,CACrBC,WAA+C,EAC/CjlC,OAA+B,EAC/B0G,QAA2B,EAC3Bw+B,MAAc,EACd;AACA;AACF;AACA;AACA;AACA;EACE,IAAID,WAAW,KAAKz/B,SAAS,EAAE;AAC7B,IAAA,OAAA;AACF,GAAA;AAEA,EAAA,IAAI,CAAChF,KAAK,CAACC,OAAO,CAACwkC,WAAW,CAAC,EAAE;AAC/B,IAAA,OAAA;AACF,GAAA;EAEA,OAAOA,WAAW,CAACpkC,GAAG,CAAC,CAACC,CAAC,EAAEiB,KAAK,KAC9BojC,iBAAiB,CAACrkC,CAAC,EAAEd,OAAO,EAAE0G,QAAQ,EAAE,CAAA,EAAGw+B,MAAM,CAAInjC,CAAAA,EAAAA,KAAK,CAAE,CAAA,CAC9D,CAAC,CAAA;AACH,CAAA;AAEA,SAASqjC,SAASA,CAChB51B,MAA4B,EAC5BxP,OAA+B,EAC/B0G,QAA2B,EACL;EACtB,OAAOy+B,iBAAiB,CAAC31B,MAAM,EAAExP,OAAO,EAAE0G,QAAQ,EAAE,EAAE,CAAC,CAAA;AACzD,CAAA;AAEA,SAASy+B,iBAAiBA,CACxB31B,MAA4B,EAC5BxP,OAA+B,EAC/B0G,QAA2B,EAC3Bw+B,MAAe,EACO;AACtB,EAAA,MAAMviB,mBAAmB,GAAG/T,kCAAuB,CAACY,MAAM,EAAExP,OAAO,CAAC,CAAA;AAEpE,EAAA,MAAMwK,MAA4B,GAAG;IAAE,GAAGgF,MAAAA;GAAQ,CAAA;EAElD,IAAI,CAACmT,mBAAmB,EAAE;AACxB,IAAA,OAAOnY,MAAM,CAAA;AACf,GAAA;AAEA06B,EAAAA,MAAM,GAAGA,MAAM,KAAK1/B,SAAS,IAAI0/B,MAAM,KAAK,EAAE,GAAG,EAAE,GAAG,CAAA,EAAGA,MAAM,CAAG,CAAA,CAAA,CAAA;AAElEviB,EAAAA,mBAAmB,CAACvY,MAAM,CAAC1G,OAAO,CAAEyG,UAAU,IAAK;AACjD,IAAA,IAAIA,UAAU,CAACsI,IAAI,KAAK,gCAAgC,EAAE;MACxD,IAAIjD,MAAM,CAACrF,UAAU,CAACG,IAAI,CAAC,KAAK9E,SAAS,EAAE;AACzC,QAAA,OAAA;AACF,OAAA;AAEAgF,MAAAA,MAAM,CAACL,UAAU,CAACG,IAAI,CAAC,GAAG,EAAE,CAAA;MAE5B,KAAK,MAAMkQ,MAAM,IAAIhL,MAAM,CAACrF,UAAU,CAACG,IAAI,CAAC,EAAE;QAC5C,IAAIkQ,MAAM,KAAK,YAAY,EAAE;AAC3B,UAAA,SAAA;AACF,SAAA;AAEAhQ,QAAAA,MAAM,CAACL,UAAU,CAACG,IAAI,CAAC,CAACkQ,MAAM,CAAC,GAAGwqB,cAAc,CAC9Cx1B,MAAM,CAACrF,UAAU,CAACG,IAAI,CAAC,CAACkQ,MAAM,CAAC,EAC/Bxa,OAAO,EACP0G,QAAQ,EACR,CAAA,EAAGw+B,MAAM,CAAA,EAAG/6B,UAAU,CAACG,IAAI,CAAIkQ,CAAAA,EAAAA,MAAM,EACvC,CAAC,CAAA;AACH,OAAA;AAEAhQ,MAAAA,MAAM,CAACL,UAAU,CAACG,IAAI,CAAC,GAAG5D,QAAQ,CAAC;AACjCtD,QAAAA,KAAK,EAAEoH,MAAM,CAACL,UAAU,CAACG,IAAI,CAAC;AAC9B3J,QAAAA,IAAI,EAAE,CAAGukC,EAAAA,MAAM,GAAG/6B,UAAU,CAACG,IAAI,CAAE,CAAA;AACnCH,QAAAA,UAAAA;AACF,OAAC,CAAC,CAAA;AACJ,KAAC,MAAM,IACLA,UAAU,CAACsI,IAAI,KAAK,WAAW,IAC/BtI,UAAU,CAACsI,IAAI,KAAK,sBAAsB,EAC1C;MACAjI,MAAM,CAACL,UAAU,CAACG,IAAI,CAAC,GAAG06B,cAAc,CACtCx1B,MAAM,CAACrF,UAAU,CAACG,IAAI,CAAC,EACvBtK,OAAO,EACP0G,QAAQ,EACR,CAAA,EAAGw+B,MAAM,CAAA,EAAG/6B,UAAU,CAACG,IAAI,CAAA,CAC7B,CAAC,CAAA;AAEDE,MAAAA,MAAM,CAACL,UAAU,CAACG,IAAI,CAAC,GAAG5D,QAAQ,CAAC;AACjCtD,QAAAA,KAAK,EAAEoH,MAAM,CAACL,UAAU,CAACG,IAAI,CAAC;AAC9B3J,QAAAA,IAAI,EAAE,CAAGukC,EAAAA,MAAM,GAAG/6B,UAAU,CAACG,IAAI,CAAE,CAAA;AACnCH,QAAAA,UAAAA;AACF,OAAC,CAAC,CAAA;AACJ,KAAC,MAAM;MACL,IAAI+M,qCAAsB,CAAC1M,MAAM,CAACL,UAAU,CAACG,IAAI,CAAC,CAAC,EAAE;AACnD,QAAA,MAAM+6B,SAAoC,GAAG;AAAEC,UAAAA,IAAI,EAAE,IAAA;SAAM,CAAA;QAE3D,KAAK,MAAM3hC,GAAG,IAAI6G,MAAM,CAACL,UAAU,CAACG,IAAI,CAAC,EAAE;UACzC,IAAI3G,GAAG,KAAK,MAAM,EAAE;AAClB,YAAA,SAAA;AACF,WAAA;AACA0hC,UAAAA,SAAS,CAAC1hC,GAAG,CAAC,GAAG+C,QAAQ,CAAC;YACxBtD,KAAK,EAAEoH,MAAM,CAACL,UAAU,CAACG,IAAI,CAAC,CAAC3G,GAAG,CAAC;YACnCwG,UAAU;YACVxJ,IAAI,EAAE,GAAGukC,MAAM,CAAA,EAAG/6B,UAAU,CAACG,IAAI,IAAI3G,GAAG,CAAA,CAAA;AAC1C,WAAC,CAAC,CAAA;AACJ,SAAA;AACA6G,QAAAA,MAAM,CAACL,UAAU,CAACG,IAAI,CAAC,GAAG+6B,SAAS,CAAA;AACrC,OAAC,MAAM;AACL76B,QAAAA,MAAM,CAACL,UAAU,CAACG,IAAI,CAAC,GAAG5D,QAAQ,CAAC;AACjCtD,UAAAA,KAAK,EAAEoH,MAAM,CAACL,UAAU,CAACG,IAAI,CAAC;UAC9BH,UAAU;AACVxJ,UAAAA,IAAI,EAAE,CAAGukC,EAAAA,MAAM,CAAG/6B,EAAAA,UAAU,CAACG,IAAI,CAAA,CAAA;AACnC,SAAC,CAAC,CAAA;AACJ,OAAA;AACF,KAAA;AACF,GAAC,CAAC,CAAA;AAEF,EAAA,OAAOE,MAAM,CAAA;AACf;;ACzHA,SAAS+6B,+BAA+BA,CACtCC,GAAgC,EAChC77B,aAAgC,EACd;AAClB;EACA,MAAM6F,MAA4B,GAChCg2B,GAAG,CAACzgC,EAAE,KAAK,uBAAuB,GAC9B0gC,uCAAwB,CAAC;IACzBnvB,KAAK,EAAEovB,iBAAiB,CAAC/7B,aAAa,CAAC6oB,KAAK,CAACmT,MAAM,CAAC;AACpDC,IAAAA,IAAI,EAAEF,iBAAiB,CAAC/7B,aAAa,CAAC6oB,KAAK,CAACqT,KAAK,CAAA;AACnD,GAAC,CAAC,GACA;IACAx5B,UAAU,EAAEm5B,GAAG,CAACzgC,EAAE;IAClBmK,GAAG,EAAEpK,QAAQ,EAAC;GACf,CAAA;EAEL,OAAO;AACLC,IAAAA,EAAE,EAAE,CAAA,EAAGygC,GAAG,CAACzgC,EAAE,CAAU,QAAA,CAAA;AACvBkM,IAAAA,KAAK,EAAEu0B,GAAG,CAACv0B,KAAK,IAAIu0B,GAAG,CAACzgC,EAAE;AAC1B4zB,IAAAA,KAAK,EAAEnpB,MAAM;AACbs2B,IAAAA,aAAa,EAAE,KAAA;GAChB,CAAA;AACH,CAAA;AAEA,SAASJ,iBAAiBA,CAACxpB,MAA0C,EAAE;EACrE,OAAO1Y,MAAM,CAACkY,OAAO,CAACQ,MAAM,CAAC,CAAC7R,IAAI,CAAC,CAAC,GAAGjH,KAAK,CAAC,KAAKA,KAAK,CAAC2iC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAA;AACzE,CAAA;AAEO,eAAeC,YAAYA,CAChCr8B,aAAgC,EAChCs8B,eAAmC,GAAG,EAAE,EACnB;AACrB,EAAA,MAAMC,0BAAiD,GACrD,CAACv8B,aAAa,CAACsF,sBAAsB,GACjC,MAAMtF,aAAa,CAACwvB,OAAO,CAACV,SAAS,CAAC0N,MAAM,EAAE,GAC9C,EAAE,CAAA;AAER,EAAA,OAAOC,oBAAoB,CACzBz8B,aAAa,EACbs8B,eAAe,EACfC,0BACF,CAAC,CAAA;AACH,CAAA;AAEA,SAASG,4BAA4BA,CACnC3O,UAAyC,EACzCe,SAAqB,EACrB9uB,aAAgC,EAChC;EACA,MAAMa,MAA0B,GAAG,EAAE,CAAA;AAErCktB,EAAAA,UAAU,CAACh0B,OAAO,CAAE8R,SAAS,IAAK;AAChC,IAAA,MAAM8wB,kBAAkB,GAAG7N,SAAS,CAACz3B,MAAM,CACxC03B,QAAQ,IAAKA,QAAQ,CAACC,KAAK,CAACtsB,UAAU,KAAKmJ,SAAS,CAACzQ,EACxD,CAAC,CAAA;AACD,IAAA,IAAIuhC,kBAAkB,CAACjmC,MAAM,KAAK,CAAC,EAAE;MACnCmK,MAAM,CAACqB,IAAI,CAAC05B,+BAA+B,CAAC/vB,SAAS,EAAE7L,aAAa,CAAC,CAAC,CAAA;AACxE,KAAA;AACF,GAAC,CAAC,CAAA;AAEF,EAAA,OAAOa,MAAM,CAAA;AACf,CAAA;AAEA,SAAS+7B,oBAAoBA,CAC3B/2B,MAA4B,EAC5B7F,aAAgC,EAChC;AACA,EAAA,OAAOy7B,SAAS,CAAC51B,MAAM,EAAE7F,aAAa,EAAE,CAAC;IAAEvG,KAAK;AAAE+G,IAAAA,UAAAA;AAAW,GAAC,KAAK;AACjE,IAAA,IAAIA,UAAU,CAACsI,IAAI,KAAK,MAAM,EAAE;MAC9B,MAAM+zB,iBAAiB,GAAGhjC,MAAM,CAAC8K,MAAM,CAAClL,KAAK,CAACA,KAAK,CAAC,CAACpC,MAAM,CACxDF,CAAC,IAAKA,CAAC,KAAK,IAAI,IAAIA,CAAC,KAAK0E,SAC7B,CAAC,CAAC,CAAC,CAAC,CAAA;MAEJ,OAAO;AACL,QAAA,GAAGpC,KAAK;AACRA,QAAAA,KAAK,EAAE;UACL,CAACqjC,+BAAgB,CAAC98B,aAAa,CAAC8Q,OAAO,CAAC,CAAC4b,IAAI,GAAGmQ,iBAAAA;AAClD,SAAA;OACD,CAAA;AACH,KAAC,MAAM,IAAIr8B,UAAU,CAACsI,IAAI,KAAK,gCAAgC,EAAE;MAC/D,MAAM+zB,iBAAiB,GAAGhjC,MAAM,CAAC8K,MAAM,CAAClL,KAAK,CAAC,CAACpC,MAAM,CAClDF,CAAC,IAAKA,CAAC,KAAK,IAAI,IAAIA,CAAC,KAAK0E,SAC7B,CAAC,CAAC,CAAC,CAAC,CAAA;MAEJ,OAAO;QACL,CAACihC,+BAAgB,CAAC98B,aAAa,CAAC8Q,OAAO,CAAC,CAAC4b,IAAI,GAAGmQ,iBAAAA;OACjD,CAAA;AACH,KAAA;AAEA,IAAA,OAAOpjC,KAAK,CAAA;AACd,GAAC,CAAC,CAAA;AACJ,CAAA;AAEA,SAASgjC,oBAAoBA,CAC3Bz8B,aAAgC,EAChCs8B,eAAmC,EACnCC,0BAAiD,EACrC;AACZ;AACA,EAAA,MAAMQ,mBAAmB,GAAG,CAC1B,GAAGT,eAAe,EAClB,GAAGI,4BAA4B,CAC7B18B,aAAa,CAAC8tB,WAAW,CAACC,UAAU,EACpCuO,eAAe,EACft8B,aACF,CAAC,CACF,CAAA;EAED,MAAMg9B,gBAAgB,GAAG,CACvB,GAAGT,0BAA0B,EAC7B,GAAGQ,mBAAmB,CACvB,CAAA;AAED,EAAA,MAAMl8B,MAAM,GAAGm8B,gBAAgB,CAC5B3lC,MAAM,CAAE03B,QAAQ,IAAK;IACpB,MAAM1uB,UAAU,GAAGC,sCAA2B,CAC5CyuB,QAAQ,CAACC,KAAK,CAACtsB,UAAU,EACzB1C,aACF,CAAC,CAAA;AAED,IAAA,IAAI,CAACK,UAAU,IAAIA,UAAU,CAAC48B,aAAa,EAAE;AAC3C,MAAA,OAAO,KAAK,CAAA;AACd,KAAA;AACA,IAAA,OAAO,IAAI,CAAA;GACZ,CAAA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;GACC/lC,GAAG,CAAE63B,QAAQ,IAAK;AACjB,IAAA,MAAMyB,WAAqB,GAAG;AAC5B,MAAA,GAAGzB,QAAQ;AACXC,MAAAA,KAAK,EAAE4N,oBAAoB,CACzB5rB,oBAAS,CAAC;QAAE,GAAG+d,QAAQ,CAACC,KAAK;AAAEE,QAAAA,UAAU,EAAE,EAAC;AAAE,OAAC,EAAElvB,aAAa,CAAC,EAC/DA,aACF,CAAA;KACD,CAAA;AAED,IAAA,OAAOwwB,WAAW,CAAA;AACpB,GAAC,CAAC,CAAA;AAEJ,EAAA,OAAO3vB,MAAM,CAAA;AACf;;ACjJO,MAAMq8B,IAAI,CAGf;AAaAC,EAAAA,OAAO,GAAG,KAAK,CAAA;AAEfC,EAAAA,WAAWA,CAAC;IACVhiC,EAAE;IACFkM,KAAK;IACLzF,MAAM;IACN6D,OAAO;IACP23B,OAAO;IACP1e,KAAK;IACL2e,iBAAiB;IACjBt2B,QAAQ;IACR,GAAGD,OAAAA;AACc,GAAC,EAAE;AACpB,IAAA,MAAMw2B,aAAa,GAAGx2B,OAAO,CAACw2B,aAAa,IAAK,EAAQ,CAAA;AACxD,IAAA,IAAI,CAAChjB,MAAM,GAAGxT,OAAO,CAACwT,MAAM,IAAI,MAAM,CAAA;IACtC,IAAI,CAACnf,EAAE,GAAGA,EAAE,CAAA;IACZ,IAAI,CAACkM,KAAK,GAAGA,KAAK,CAAA;AAClB,IAAA,IAAI,CAACzF,MAAM,GAAGA,MAAM,IAAI,EAAE,CAAA;AAC1B,IAAA,IAAI,CAACwuB,QAAQ,GAAGtpB,OAAO,CAACspB,QAAQ,CAAA;AAChC,IAAA,IAAI,CAACpI,SAAS,GAAGuV,oBAAU,CAAI;AAC7B,MAAA,GAAGz2B,OAAO;MACVw2B,aAAa;MACblN,QAAQ,EAAE,IAAI,CAACoN,YAAY;AAC3BjM,MAAAA,QAAQ,EAAE;AACR,QAAA,GAAGkM,iCAAa;AAChB,QAAA,GAAG32B,OAAO,CAACyqB,QAAAA;AACb,OAAA;AACF,KAAC,CAAC,CAAA;IAEF,IAAI,CAACmM,MAAM,GAAGhf,KAAK,CAAA;AACnB,IAAA,IAAI,CAACjZ,OAAO,GAAGA,OAAO,IAAI,EAAE,CAAA;AAC5B,IAAA,IAAI,CAAC23B,OAAO,GAAGA,OAAO,IAAI;AACxBO,MAAAA,IAAI,EAAE,MAAM;AACZjf,MAAAA,KAAK,EAAE,OAAA;KACR,CAAA;AACD,IAAA,IAAI,CAACkf,YAAY,CAAC,IAAI,CAACh8B,MAAM,CAAC,CAAA;AAE9B,IAAA,IAAIy7B,iBAAiB,EAAE;MACrB,IAAI,CAACH,OAAO,GAAG,IAAI,CAAA;AACnBG,MAAAA,iBAAiB,EAAE,CAChBplB,IAAI,CAAEqlB,aAAa,IAAK;AACvB,QAAA,IAAI,CAACO,mBAAmB,CAACP,aAAa,CAAC,CAAA;AACzC,OAAC,CAAC,CACD5M,OAAO,CAAC,MAAM;QACb,IAAI,CAACwM,OAAO,GAAG,KAAK,CAAA;AACtB,OAAC,CAAC,CAAA;AACN,KAAA;AAEA,IAAA,IAAIn2B,QAAQ,EAAE;MACZ,IAAI+2B,WAAW,GAAG,IAAI,CAAA;AACtB,MAAA,IAAI,CAACC,SAAS,CACXC,SAAS,IAAK;AACb,QAAA,IAAIF,WAAW,EAAE;AACfA,UAAAA,WAAW,GAAG,KAAK,CAAA;AACrB,SAAC,MAAM;UACL/2B,QAAQ,CAACi3B,SAAS,CAAC,CAAA;AACrB,SAAA;AACF,OAAC,EACD;AAAEt5B,QAAAA,MAAM,EAAE,IAAA;AAAK,OACjB,CAAC,CAAA;AACH,KAAA;AACF,GAAA;;AAEA;AACF;AACA;AACA;AACA;EACE,IAAIA,MAAMA,GAAkB;IAC1B,IAAI,IAAI,CAACw4B,OAAO,EAAE;AAChB,MAAA,OAAOthC,SAAS,CAAA;AAClB,KAAA;AACA,IAAA,OAAO,IAAI,CAACosB,SAAS,CAACiW,QAAQ,EAAE,CAACv5B,MAAM,IAAK,IAAI,CAAC44B,aAAmB,CAAA;AACtE,GAAA;;AAEA;AACF;AACA;EACE,IAAIA,aAAaA,GAAG;IAClB,OAAO,IAAI,CAACtV,SAAS,CAACiW,QAAQ,EAAE,CAACX,aAAa,CAAA;AAChD,GAAA;;AAEA;AACF;AACA;EACEM,YAAYA,CAACh8B,MAAW,EAAE;IACxB,IAAI,CAACA,MAAM,GAAGA,MAAM,CAAA;AACtB,GAAA;;AAEA;AACF;AACA;AACA;AACEm8B,EAAAA,SAAS,GAA4BA,CAACG,EAAE,EAAEp3B,OAAO,KAAK;IACpD,OAAO,IAAI,CAACkhB,SAAS,CAAC+V,SAAS,CAACG,EAAE,EAAEp3B,OAAO,CAAC,CAAA;GAC7C,CAAA;EAIO02B,YAAY,GAA0B,OAAO94B,MAAM,EAAExE,IAAI,EAAEg+B,EAAE,KAAK;IACxE,IAAI;AACF,MAAA,MAAMC,QAAQ,GAAG,MAAM,IAAI,CAAC/N,QAAQ,CAAC1rB,MAAM,EAAExE,IAAI,EAAEg+B,EAAE,CAAC,CAAA;AACtDh+B,MAAAA,IAAI,CAACk+B,UAAU,CAAC15B,MAAM,CAAC,CAAA;AACvB,MAAA,OAAOy5B,QAAQ,CAAA;KAChB,CAAC,OAAOp6B,KAAK,EAAE;MACd,OAAO;AAAE,QAAA,CAACs6B,oBAAU,GAAGt6B,KAAAA;OAAO,CAAA;AAChC,KAAA;GACD,CAAA;;AAED;AACF;AACA;AACA;AACA;AACA;AACEmI,EAAAA,MAAMA,CAAClJ,IAAY,EAAExJ,KAAW,EAAE;AAChC,IAAA,IAAI8kC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,aAAa,EAAE;AAC1Cj8B,MAAAA,OAAO,CAACk8B,cAAc,CAAC,WAAW,EAAEz7B,IAAI,KAAK,EAAE,GAAG,IAAI,GAAG,CAAIA,CAAAA,EAAAA,IAAI,GAAG,CAAC,CAAA;MACrET,OAAO,CAAC0lB,GAAG,CAAC,YAAY,EAAE,IAAI,CAACvjB,MAAM,CAAC,CAAA;AACtCnC,MAAAA,OAAO,CAAC0lB,GAAG,CAAC,WAAW,EAAE3tB,cAAc,CAAC,IAAI,CAACoK,MAAM,EAAE1B,IAAI,CAAC,CAAC,CAAA;MAC3D,IAAI,CAACglB,SAAS,CAAC9b,MAAM,CAAClJ,IAAI,EAAaxJ,KAAK,CAAC,CAAA;MAC7C+I,OAAO,CAAC0lB,GAAG,CAAC,YAAY,EAAE,IAAI,CAACvjB,MAAM,CAAC,CAAA;AACtCnC,MAAAA,OAAO,CAAC0lB,GAAG,CAAC,WAAW,EAAEzuB,KAAK,CAAC,CAAA;MAC/B+I,OAAO,CAACm8B,QAAQ,EAAE,CAAA;AAClB,MAAA,OAAA;AACF,KAAA;IAEA,OAAO,IAAI,CAAC1W,SAAS,CAAC9b,MAAM,CAAClJ,IAAI,EAAaxJ,KAAK,CAAC,CAAA;AACtD,GAAA;EAEA,IAAI+3B,QAAQA,GAAG;AACb,IAAA,OAAO,IAAI,CAACvJ,SAAS,CAACuJ,QAAQ,CAAA;AAChC,GAAA;;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEoN,YAAYA,CAACj6B,MAAS,EAAE;AACtB,IAAA,IAAI,CAACsjB,SAAS,CAAC4W,KAAK,CAAC,MAAM;MACzB,MAAMC,UAAe,GAAG,IAAI,CAAC7W,SAAS,CAACiW,QAAQ,EAAE,CAACa,MAAM,CAAA;MAExD,IAAI,CAACD,UAAU,EAAE;AACfE,QAAAA,gBAAgB,CAAI,IAAI,CAAC/W,SAAS,EAAEtjB,MAAM,CAAC,CAAA;AAC7C,OAAC,MAAM;AACLs6B,QAAAA,iBAAiB,CAAI,IAAI,CAAChX,SAAS,EAAEtjB,MAAM,CAAC,CAAA;AAC9C,OAAA;AACF,KAAC,CAAC,CAAA;AACJ,GAAA;;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;EACEm5B,mBAAmBA,CAACP,aAAgB,EAAE;AACpC,IAAA,IAAI,CAACtV,SAAS,CAAC4W,KAAK,CAAC,MAAM;AACzB,MAAA,MAAMl6B,MAAM,GAAG,IAAI,CAACA,MAAM,IAAK,EAAQ,CAAA;AACvC,MAAA,IAAI,CAACsjB,SAAS,CAACoW,UAAU,CAACd,aAAa,CAAC,CAAA;MACxC,MAAMuB,UAAe,GAAG,IAAI,CAAC7W,SAAS,CAACiW,QAAQ,EAAE,CAACa,MAAM,CAAA;MAExD,IAAI,CAACD,UAAU,EAAE;AACfE,QAAAA,gBAAgB,CAAI,IAAI,CAAC/W,SAAS,EAAEtjB,MAAM,CAAC,CAAA;AAC7C,OAAC,MAAM;AACLs6B,QAAAA,iBAAiB,CAAI,IAAI,CAAChX,SAAS,EAAEtjB,MAAM,CAAC,CAAA;AAC9C,OAAA;AACF,KAAC,CAAC,CAAA;AACJ,GAAA;AACF,CAAA;AAEA,SAASq6B,gBAAgBA,CACvB7+B,IAAkB,EAClBwE,MAAS,EACT;AACA9K,EAAAA,MAAM,CAACkY,OAAO,CAACpN,MAAM,CAAC,CAAC5K,OAAO,CAAC,CAAC,CAAC/C,IAAI,EAAEyC,KAAK,CAAC,KAAK;AAChD0G,IAAAA,IAAI,CAACgM,MAAM,CAACnV,IAAI,EAAEyC,KAAK,CAAC,CAAA;AAC1B,GAAC,CAAC,CAAA;AACJ,CAAA;AAEA,SAASwlC,iBAAiBA,CACxB9+B,IAAkB,EAClBwE,MAAS,EACT42B,MAAe,EACf;EACA,MAAMuD,UAAe,GAAG3+B,IAAI,CAAC+9B,QAAQ,EAAE,CAACa,MAAO,CAAA;AAE/CllC,EAAAA,MAAM,CAACkY,OAAO,CAACpN,MAAM,CAAC,CAAC5K,OAAO,CAAC,CAAC,CAACkJ,IAAI,EAAExJ,KAAK,CAAC,KAAK;IAChD,MAAMzC,IAAI,GAAGukC,MAAM,GAAG,CAAA,EAAGA,MAAM,CAAIt4B,CAAAA,EAAAA,IAAI,CAAE,CAAA,GAAGA,IAAI,CAAA;AAEhD,IAAA,IAAI,OAAOxJ,KAAK,KAAK,QAAQ,EAAE;AAC7B,MAAA,IAAIqlC,UAAU,CAAC/9B,UAAU,CAAC/J,IAAI,CAAC,EAAE;AAC/BioC,QAAAA,iBAAiB,CAAC9+B,IAAI,EAAE1G,KAAK,EAAEzC,IAAI,CAAC,CAAA;AACtC,OAAC,MAAM;AACLmJ,QAAAA,IAAI,CAACgM,MAAM,CAACnV,IAAI,EAAEyC,KAAK,CAAC,CAAA;AAC1B,OAAA;AACF,KAAC,MAAM,IAAIzC,IAAI,KAAK8nC,UAAU,EAAE;AAC9B3+B,MAAAA,IAAI,CAACgM,MAAM,CAACnV,IAAI,EAAEyC,KAAK,CAAC,CAAA;AAC1B,KAAA;AACF,GAAC,CAAC,CAAA;AACJ;;AC9OA;AACA;AACA;AACO,SAASylC,OAAOA,CACrB;EAAE5B,iBAAiB;EAAE,GAAGv2B,OAAAA;AAA0B,CAAC,EACnDo4B,KAAkC,GAAG,EAAE,EACX;AAC5B;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEp4B,OAAO,CAACw2B,aAAa,GAAGx2B,OAAO,CAACw2B,aAAa,IAAI4B,KAAK,CAACx6B,MAAM,CAAA;EAE7D,MAAM,GAAGy6B,SAAS,CAAC,GAAGlpC,yBAAK,CAACiE,QAAQ,CAAC4M,OAAO,CAACw2B,aAAa,CAAC,CAAA;EAC3D,MAAM,CAACp9B,IAAI,EAAEk/B,OAAO,CAAC,GAAGnpC,yBAAK,CAACiE,QAAQ,CAAO,MAAM;AACjD,IAAA,OAAOqjC,UAAU,CAACz2B,OAAO,EAAG5G,IAAS,IAAK;AACxCi/B,MAAAA,SAAS,CAACj/B,IAAI,CAACwE,MAAM,CAAC,CAAA;AACxB,KAAC,CAAC,CAAA;AACJ,GAAC,CAAC,CAAA;EAEFzO,yBAAK,CAAC0H,SAAS,CACb,YAAY;AACV,IAAA,IAAIuC,IAAI,CAAC/E,EAAE,KAAK2L,OAAO,CAAC3L,EAAE,EAAE,OAAA;AAC5BikC,IAAAA,OAAO,CACL7B,UAAU,CAACz2B,OAAO,EAAG5G,IAAS,IAAK;AACjCi/B,MAAAA,SAAS,CAACj/B,IAAI,CAACwE,MAAM,CAAC,CAAA;AACxB,KAAC,CACH,CAAC,CAAA;AACH,GAAC,EACD,CAACoC,OAAO,CAAC3L,EAAE,CACb,CAAC,CAAA;AAED,EAAA,MAAM,CAACkkC,aAAa,EAAEC,gBAAgB,CAAC,GAAGrpC,yBAAK,CAACiE,QAAQ,CAAC,MACvDmjC,iBAAiB,GAAG,IAAI,GAAG,KAC7B,CAAC,CAAA;AACD,EAAA,MAAMkC,YAAY,GAAGtpC,yBAAK,CAACupC,WAAW,CAAC,YAAY;AACjD,IAAA,IAAInC,iBAAiB,EAAE;MACrBiC,gBAAgB,CAAC,IAAI,CAAC,CAAA;AACtB,MAAA,MAAMjC,iBAAiB,EAAE,CACtBplB,IAAI,CAAEvT,MAAW,IAAK;AACrBxE,QAAAA,IAAI,CAAC29B,mBAAmB,CAACn5B,MAAM,CAAC,CAAA;AAClC,OAAC,CAAC,CACDgsB,OAAO,CAAC,MAAM;QACb4O,gBAAgB,CAAC,KAAK,CAAC,CAAA;AACzB,OAAC,CAAC,CAAA;AACN,KAAA;AACF,GAAC,EAAE,CAACp/B,IAAI,EAAEo/B,gBAAgB,CAAC,CAAC,CAAA;EAC5BrpC,yBAAK,CAAC0H,SAAS,CAAC,MAAM;AACpB4hC,IAAAA,YAAY,EAAE,CAAA;AAChB,GAAC,EAAE,CAACr/B,IAAI,EAAEq/B,YAAY,CAAC,CAAC,CAAA;AAExBE,EAAAA,mBAAmB,CAACv/B,IAAI,EAAEg/B,KAAK,CAACt9B,MAAM,CAAC,CAAA;AACvC89B,EAAAA,kBAAkB,CAACx/B,IAAI,EAAEg/B,KAAK,CAAC73B,KAAK,CAAC,CAAA;AACrCs4B,EAAAA,mBAAmB,CAACz/B,IAAI,EAAEg/B,KAAK,CAACx6B,MAAM,CAAC,CAAA;AAEvC,EAAA,OAAO,CAACxE,IAAI,GAAGA,IAAI,CAACwE,MAAM,GAAGoC,OAAO,CAACw2B,aAAa,EAAEp9B,IAAI,EAAEm/B,aAAa,CAAC,CAAA;AAC1E,CAAA;AAEA,SAAS9B,UAAUA,CAACz2B,OAAyB,EAAEU,YAAiB,EAAQ;AACtE,EAAA,MAAMtH,IAAI,GAAG,IAAI+8B,IAAI,CAACn2B,OAAO,CAAC,CAAA;AAC9B5G,EAAAA,IAAI,CAAC69B,SAAS,CAACv2B,YAAY,EAAE;AAAE9C,IAAAA,MAAM,EAAE,IAAA;AAAK,GAAC,CAAC,CAAA;AAC9C,EAAA,OAAOxE,IAAI,CAAA;AACb,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAASu/B,mBAAmBA,CAACv/B,IAAU,EAAE0B,MAAwB,EAAE;EACjE3L,yBAAK,CAAC0H,SAAS,CAAC,MAAM;AACpB,IAAA,IAAI,OAAOiE,MAAM,KAAK,WAAW,EAAE,OAAA;AACnC1B,IAAAA,IAAI,CAAC09B,YAAY,CAACh8B,MAAM,CAAC,CAAA;AAC3B,GAAC,EAAE,CAAC1B,IAAI,EAAE0B,MAAM,CAAC,CAAC,CAAA;AACpB,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS89B,kBAAkBA,CAACx/B,IAAU,EAAEmH,KAAc,EAAE;EACtDpR,yBAAK,CAAC0H,SAAS,CAAC,MAAM;AACpB,IAAA,IAAI,OAAO0J,KAAK,KAAK,WAAW,EAAE,OAAA;IAClCnH,IAAI,CAACmH,KAAK,GAAGA,KAAK,CAAA;AACpB,GAAC,EAAE,CAACnH,IAAI,EAAEmH,KAAK,CAAC,CAAC,CAAA;AACnB,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASs4B,mBAAmBA,CAACz/B,IAAU,EAAEwE,MAAY,EAAE;EACrDzO,yBAAK,CAAC0H,SAAS,CAAC,MAAM;AACpB,IAAA,IAAI,OAAO+G,MAAM,KAAK,WAAW,EAAE,OAAA;AACnCxE,IAAAA,IAAI,CAACy+B,YAAY,CAACj6B,MAAM,CAAC,CAAA;AAC3B,GAAC,EAAE,CAACxE,IAAI,EAAEwE,MAAM,CAAC,CAAC,CAAA;AACpB;;ACvHA;AACA;AACA;AACA,SAASk7B,iBAAiBA,CAACh6B,MAA4B,EAAwB;AAC7E,EAAA,MAAMi6B,cAAc,GAAGhnC,SAAS,CAAC+M,MAAM,CAAC,CAAA;AACxC,EAAA,OAAOi6B,cAAc,CAAA;AACvB;;ACLO,SAASC,gBAAgBA,CAC9Bl6B,MAA4B,EAC5BxP,OAA+B,EAC/B;AACA,EAAA,OAAOolC,SAAS,CAAC51B,MAAM,EAAExP,OAAO,EAAE,CAAC;IAAEoD,KAAK;AAAE+G,IAAAA,UAAAA;AAAW,GAAC,KAAK;IAC3D,IACGA,UAAU,CAACsI,IAAI,KAAK,MAAM,IAAIrP,KAAK,CAAC2B,EAAE,EAAE2F,UAAU,CAAC,QAAQ,CAAC,IAC7DP,UAAU,CAACsI,IAAI,KAAK,gCAAgC,EACpD;MACA,OAAO;AACLk3B,QAAAA,WAAW,EAAE,IAAI;QACjB,GAAGvmC,KAAAA;OACJ,CAAA;AACH,KAAA;AAEA,IAAA,OAAOA,KAAK,CAAA;AACd,GAAC,CAAC,CAAA;AACJ;;ACjBO,SAASwmC,mBAAmBA,CACjCp6B,MAA4B,EAC5BxP,OAA+B,EAC/B;AACA,EAAA,OAAOolC,SAAS,CAAC51B,MAAM,EAAExP,OAAO,EAAE,CAAC;IAAEoD,KAAK;AAAE+G,IAAAA,UAAAA;AAAW,GAAC,KAAK;IAC3D,IACGA,UAAU,CAACsI,IAAI,KAAK,MAAM,IAAIrP,KAAK,EAAE2B,EAAE,CAAC2F,UAAU,CAAC,QAAQ,CAAC,IAC7DP,UAAU,CAACsI,IAAI,KAAK,gCAAgC,EACpD;MACA,OAAOrP,KAAK,CAACumC,WAAW,CAAA;AAC1B,KAAA;AAEA,IAAA,OAAOvmC,KAAK,CAAA;AACd,GAAC,CAAC,CAAA;AACJ;;ACTA;AACA;AACA;AACA;AACA;AACA;AACO,SAASymC,YAAYA,CAC1BC,eAAgC,EAChCngC,aAAgC,EAChC;AACA,EAAA,MAAMogC,cAAc,GAAG/lC,YAAM,CAAkB8lC,eAAe,CAAC,CAAA;AAC/D,EAAA,MAAM57B,OAAO,GAAGC,iCAAU,EAAE,CAAA;;AAE5B;AACF;AACA;AACA;AACE,EAAA,MAAM,CAAC67B,oCAAoC,CAAC,GAAGlmC,cAAQ,CACrDrB,SAAS,CAACkH,aAAa,CAACG,IAAI,CAACwE,MAAM,CACrC,CAAC,CAAA;EACD,MAAM27B,SAAS,GAAGjmC,YAAM,CAAsB,MAAMW,OAAO,CAACC,OAAO,EAAE,CAAC,CAAA;AAEtE,EAAA,MAAMslC,MAAM,GAAG,YAAY;AACzB;IACA,IAAIvgC,aAAa,CAACqF,QAAQ,EAAE;AAC1B,MAAA,OAAA;AACF,KAAA;AAEA,IAAA,MAAMm7B,WAAW,GAAGxgC,aAAa,CAACG,IAAI,CAACwE,MAAM,CAAA;AAC7C,IAAA,MAAM87B,mBAAmB,GAAGZ,iBAAiB,CAACW,WAAW,CAAC,CAAA;AAE1D,IAAA,MAAME,cAAc,GAAGN,cAAc,CAAC9lC,OAAO,GACzC8lC,cAAc,CAAC9lC,OAAO,CAAC00B,KAAK,GAC5BqR,oCAAoC,CAAA;AACxC,IAAA,MAAMM,sBAAsB,GAAGd,iBAAiB,CAACa,cAAc,CAAC,CAAA;AAEhE,IAAA,MAAME,eAAe,GAAGznC,WAAW,CACjCsnC,mBAAmB,EACnBE,sBACF,CAAC,CAAA;AAED,IAAA,MAAME,6BAA6B,GAAGd,gBAAgB,CACpDU,mBAAmB,EACnBzgC,aACF,CAAC,CAAA;IAED,eAAe8gC,eAAeA,GAAG;AAC/B,MAAA,MAAM9gC,aAAa,CAAC49B,IAAI,CAACwC,cAAc,CAAC9lC,OAAQ,CAAC,CAAA;AACnD,KAAA;;AAEA;AACA,IAAA,IAAI8lC,cAAc,CAAC9lC,OAAO,KAAK,IAAI,EAAE;AACnCkI,MAAAA,OAAO,CAACu+B,KAAK,CAAC,cAAc,CAAC,CAAA;;AAE7B;AACA,MAAA,IAAIH,eAAe,EAAE;AACnBp+B,QAAAA,OAAO,CAACu+B,KAAK,CAAC,kBAAkB,CAAC,CAAA;AACjC,QAAA,OAAA;AACF,OAAA;AAEAv+B,MAAAA,OAAO,CAACu+B,KAAK,CAAC,4BAA4B,CAAC,CAAA;MAE3C,MAAMC,WAAW,GAAG,MAAMhhC,aAAa,CAACwvB,OAAO,CAACyR,SAAS,CAAC1Q,MAAM,CAAC;AAC/DvB,QAAAA,KAAK,EAAE6R,6BAAAA;AACT,OAAC,CAAC,CAAA;MAEFT,cAAc,CAAC9lC,OAAO,GAAG;AACvB,QAAA,GAAG0mC,WAAW;AACd;AACAn7B,QAAAA,MAAM,EAAE;AACNA,UAAAA,MAAM,EAAEg7B,6BAAAA;AACV,SAAA;OACD,CAAA;MAED,MAAMC,eAAe,EAAE,CAAA;AACzB,KAAA;AACA;SACK;AACHt+B,MAAAA,OAAO,CAACu+B,KAAK,CAAC,mBAAmB,CAAC,CAAA;MAElC,IAAI;QACF,MAAMG,cAAc,GAAG,MAAMlhC,aAAa,CAACwvB,OAAO,CAACyR,SAAS,CAACnV,GAAG,CAAC;AAC/D1wB,UAAAA,EAAE,EAAEglC,cAAc,CAAC9lC,OAAO,CAACc,EAAAA;AAC7B,SAAC,CAAC,CAAA;AACF,QAAA,MAAM+lC,2BAA2B,GAAGD,cAAc,CAACE,OAAO,IAAI,CAAC,CAAC,CAAA;QAEhE,MAAMC,+BAA+B,GACnCjB,cAAc,CAAC9lC,OAAO,CAAC8mC,OAAO,GAAGD,2BAA2B,CAAA;;AAE9D;AACA,QAAA,IAAIE,+BAA+B,EAAE;AACnC7+B,UAAAA,OAAO,CAACu+B,KAAK,CAAC,uCAAuC,CAAC,CAAA;UAEtD,IAAI,CAACG,cAAc,EAAE;AACnB,YAAA,MAAM,IAAI3qC,KAAK,CAAC,kBAAkB,CAAC,CAAA;AACrC,WAAA;UAEA,MAAM+qC,YAAY,GAAGrB,mBAAmB,CACtCiB,cAAc,CAAClS,KAAK,EACpBhvB,aACF,CAAC,CAAA;AAEDA,UAAAA,aAAa,CAAC0F,OAAO,CAAC6F,SAAS,CAAC,MAAM;YACpCvL,aAAa,CAACG,IAAI,CAACgM,MAAM,CAAC,EAAE,EAAEm1B,YAAY,CAAC,CAAA;AAC3C,YAAA,OAAO,EAAE,CAAA;AACX,WAAC,CAAC,CAAA;UAEFlB,cAAc,CAAC9lC,OAAO,GAAG4mC,cAAc,CAAA;;AAEvC;UACA,IAAI,CAACN,eAAe,EAAE;AACpBp+B,YAAAA,OAAO,CAACu+B,KAAK,CAAC,oCAAoC,CAAC,CAAA;AAEnD/gC,YAAAA,aAAa,CAAC0F,OAAO,CAAC67B,MAAM,CAC1B,+DACF,CAAC,CAAA;AACH,WAAA;AAEA,UAAA,OAAA;AACF,SAAA;AACA;aACK;AACH,UAAA,IAAIX,eAAe,EAAE;AACnBp+B,YAAAA,OAAO,CAACu+B,KAAK,CAAC,yBAAyB,CAAC,CAAA;AACxC;AACF,WAAC,MAAM;YACLv+B,OAAO,CAACu+B,KAAK,CAAC,uBAAuB,EAAEX,cAAc,CAAC9lC,OAAO,CAACc,EAAE,CAAC,CAAA;YAEjE,MAAMomC,eAAe,GACnB,MAAMxhC,aAAa,CAACwvB,OAAO,CAACyR,SAAS,CAACrQ,MAAM,CAAC;AAC3Cx1B,cAAAA,EAAE,EAAEglC,cAAc,CAAC9lC,OAAO,CAACc,EAAE;AAC7B4zB,cAAAA,KAAK,EAAE6R,6BAA6B;AACpCO,cAAAA,OAAO,EAAEhB,cAAc,CAAC9lC,OAAO,CAAC8mC,OAAAA;AAClC,aAAC,CAAC,CAAA;YAEJ,IAAII,eAAe,EAAEpmC,EAAE,EAAE;AACvBmJ,cAAAA,OAAO,CAACyB,OAAO,CAAC,QAAQ,CAAC,CAAA;AAC3B,aAAC,MAAM;AACLzB,cAAAA,OAAO,CAACP,KAAK,CAAC,mCAAmC,CAAC,CAAA;AACpD,aAAA;AAEAo8B,YAAAA,cAAc,CAAC9lC,OAAO,CAAC00B,KAAK,GAAGyR,mBAAmB,CAAA;AAClDL,YAAAA,cAAc,CAAC9lC,OAAO,CAAC8mC,OAAO,GAAGI,eAAe,CAACJ,OAAO,CAAA;YAExD,MAAMN,eAAe,EAAE,CAAA;AACzB,WAAA;AACF,SAAA;OACD,CAAC,OAAO98B,KAAK,EAAE;AACdO,QAAAA,OAAO,CAACP,KAAK,CAAC,mCAAmC,CAAC,CAAA;AACpD,OAAA;AACF,KAAA;GACD,CAAA;;AAED;EACAs8B,SAAS,CAAChmC,OAAO,GAAGimC,MAAM,CAAA;AAE1B,EAAA,MAAMkB,UAAU,GAAGpnC,YAAM,CAAU,KAAK,CAAC,CAAA;AACzC,EAAA,MAAMqnC,gBAAgB,GAAGrnC,YAAM,CAAU,KAAK,CAAC,CAAA;AAE/CuD,EAAAA,eAAS,CAAC,MAAM;AACd,IAAA,MAAM+jC,QAAQ,GAAGC,WAAW,CAAC,MAAM;AACjC;AACA,MAAA,IAAIH,UAAU,CAACnnC,OAAO,IAAIonC,gBAAgB,CAACpnC,OAAO,EAAE;AAClD,QAAA,OAAA;AACF,OAAA;MAEAmnC,UAAU,CAACnnC,OAAO,GAAG,IAAI,CAAA;AACzBgmC,MAAAA,SAAS,CAAChmC,OAAO,EAAE,CAACq2B,OAAO,CAAC,MAAM;QAChC8Q,UAAU,CAACnnC,OAAO,GAAG,KAAK,CAAA;AAC5B,OAAC,CAAC,CAAA;KACH,EAAE,IAAI,CAAC,CAAA;AAER,IAAA,OAAO,MAAM;MACXunC,aAAa,CAACF,QAAQ,CAAC,CAAA;KACxB,CAAA;GACF,EAAE,EAAE,CAAC,CAAA;EAEN,OAAO;IACLG,OAAO,EAAE,YAAY;MACnBJ,gBAAgB,CAACpnC,OAAO,GAAG,IAAI,CAAA;;AAE/B;AACA,MAAA,OAAO,IAAI,EAAE;QACX,IAAImnC,UAAU,CAACnnC,OAAO,EAAE;AACtBkI,UAAAA,OAAO,CAACu+B,KAAK,CAAC,YAAY,CAAC,CAAA;UAC3B,MAAMjmC,KAAK,CAAC,GAAG,CAAC,CAAA;AAClB,SAAC,MAAM;AACL,UAAA,MAAA;AACF,SAAA;AACF,OAAA;AAEA0H,MAAAA,OAAO,CAACu+B,KAAK,CAAC,YAAY,CAAC,CAAA;MAC3B,MAAMR,MAAM,EAAE,CAAA;AAChB,KAAA;GACD,CAAA;AACH;;ACrMA,MAAMwB,qBAAqB,GAAG,CAC5B,QAAQ,EACR,WAAW,EACX,SAAS,EACT,WAAW,EACX,WAAW,EACX,YAAY,EACZ,GAAG,EACH,GAAG,CACJ,CAAA;AAED,MAAMC,oBAAoB,GAAG,kBAAkB,CAAA;AAE/C,SAASC,gCAAgCA,CAACjiC,aAAgC,EAAE;EAC1E,IAAIkiC,UAAU,GAAG,KAAK,CAAA;AACtBtkC,EAAAA,eAAS,CAAC,MAAM;IACd,MAAM;AAAE4N,MAAAA,aAAa,EAAE2e,aAAa;AAAEzkB,MAAAA,OAAAA;AAAQ,KAAC,GAAG1F,aAAa,CAAA;IAE/D,SAASmiC,aAAaA,CAAChlC,KAAoB,EAAQ;AACjD,MAAA,IAAIilC,oBAAoB,CAACjlC,KAAK,CAACuW,MAAM,CAAC,EAAE;AACtC,QAAA,OAAA;AACF,OAAA;MAEA,IAAI,CAAC2uB,gBAAgB,CAACllC,KAAK,CAAC,IAAI,CAACmlC,kBAAkB,CAACnY,aAAa,CAAC,EAAE;AAClE,QAAA,OAAA;AACF,OAAA;AAEA,MAAA,IACE,CAAChtB,KAAK,CAACnD,GAAG,KAAK,QAAQ,IAAImD,KAAK,CAACnD,GAAG,KAAK,WAAW,KACpD,CAACkoC,UAAU,EACX;AACAA,QAAAA,UAAU,GAAG,IAAI,CAAA;AAEjBx8B,QAAAA,OAAO,CAACmS,WAAW,CAACsS,aAAa,CAAC,CAAA;AAElCjvB,QAAAA,UAAU,CAAC,MAAM;AACfgnC,UAAAA,UAAU,GAAG,KAAK,CAAA;SACnB,EAAE,IAAI,CAAC,CAAA;AACV,OAAC,MAAM,IAAI/kC,KAAK,CAACnD,GAAG,KAAK,SAAS,IAAImD,KAAK,CAACnD,GAAG,KAAK,WAAW,EAAE;AAC/D0L,QAAAA,OAAO,CAAC2tB,SAAS,CAAClJ,aAAa,EAAE,KAAK,CAAC,CAAA;AACzC,OAAC,MAAM,IAAIhtB,KAAK,CAACnD,GAAG,KAAK,WAAW,IAAImD,KAAK,CAACnD,GAAG,KAAK,YAAY,EAAE;AAClE0L,QAAAA,OAAO,CAAC2tB,SAAS,CAAClJ,aAAa,EAAE,QAAQ,CAAC,CAAA;OAC3C,MAAM,IAAIhtB,KAAK,CAACnD,GAAG,CAACuoC,WAAW,EAAE,KAAK,GAAG,EAAE;QAC1C78B,OAAO,CAAC88B,gBAAgB,EAAE,CAAA;AAC5B,OAAA;AACF,KAAA;IAEA,SAASC,UAAUA,CAACtlC,KAAqB,EAAQ;AAC/C,MAAA,IAAI,CAACulC,kBAAkB,CAACvY,aAAa,EAAEhtB,KAAK,CAAC,EAAE;AAC7C,QAAA,OAAA;AACF,OAAA;AAEA,MAAA,MAAMiQ,OAAO,GAAGu1B,gBAAgB,CAACxY,aAAa,EAAEnqB,aAAa,CAAC,CAAA;MAE9D7C,KAAK,CAACQ,cAAc,EAAE,CAAA;AACtBR,MAAAA,KAAK,CAACylC,aAAa,EAAEC,OAAO,CAC1Bb,oBAAoB,EACpBhpC,IAAI,CAACE,SAAS,CAACkU,OAAO,CACxB,CAAC,CAAA;AACH,KAAA;IAEA,SAAS01B,SAASA,CAAC3lC,KAAqB,EAAQ;AAC9C,MAAA,IAAI,CAACulC,kBAAkB,CAACvY,aAAa,EAAEhtB,KAAK,CAAC,EAAE;AAC7C,QAAA,OAAA;AACF,OAAA;AAEA,MAAA,MAAMiQ,OAAO,GAAGu1B,gBAAgB,CAACxY,aAAa,EAAEnqB,aAAa,CAAC,CAAA;MAE9D7C,KAAK,CAACQ,cAAc,EAAE,CAAA;AACtBR,MAAAA,KAAK,CAACylC,aAAa,EAAEC,OAAO,CAC1Bb,oBAAoB,EACpBhpC,IAAI,CAACE,SAAS,CAACkU,OAAO,CACxB,CAAC,CAAA;AAED1H,MAAAA,OAAO,CAACmS,WAAW,CAACsS,aAAa,CAAC,CAAA;AACpC,KAAA;IAEA,SAAS4Y,WAAWA,CAAC5lC,KAAqB,EAAQ;AAChD,MAAA,IAAI,CAACulC,kBAAkB,CAACvY,aAAa,EAAEhtB,KAAK,CAAC,EAAE;AAC7C,QAAA,OAAA;AACF,OAAA;MAEA,MAAM6lC,OAAO,GAAG7lC,KAAK,CAACylC,aAAa,EAAEK,OAAO,CAACjB,oBAAoB,CAAC,CAAA;AAElE,MAAA,IAAI,CAACgB,OAAO,IAAIA,OAAO,KAAK,EAAE,EAAE;AAC9B,QAAA,OAAA;AACF,OAAA;MAEA,IAAI;AACF,QAAA,MAAME,UAAU,GAAGlqC,IAAI,CAACC,KAAK,CAAC+pC,OAAO,CAAC,CAAA;AAEtC,QAAA,MAAMvI,IAAI,GAAG5jC,KAAK,CAACC,OAAO,CAACosC,UAAU,CAAC,GAAGA,UAAU,GAAG,CAACA,UAAU,CAAC,CAAA;AAElEx9B,QAAAA,OAAO,CAACgsB,UAAU,CAAC+I,IAAI,CAAC,CAAA;QACxBt9B,KAAK,CAACQ,cAAc,EAAE,CAAA;OACvB,CAAC,OAAO8V,CAAC,EAAE;AACVjR,QAAAA,OAAO,CAACwB,KAAK,CAACyP,CAAC,CAAC,CAAA;AAChB,QAAA,OAAA;AACF,OAAA;AACF,KAAA;IAEAzV,MAAM,CAACH,QAAQ,CAACK,gBAAgB,CAAC,SAAS,EAAEikC,aAAa,CAAC,CAAA;IAC1DnkC,MAAM,CAACH,QAAQ,CAACK,gBAAgB,CAAC,MAAM,EAAEukC,UAAU,CAAC,CAAA;IACpDzkC,MAAM,CAACH,QAAQ,CAACK,gBAAgB,CAAC,KAAK,EAAE4kC,SAAS,CAAC,CAAA;IAClD9kC,MAAM,CAACH,QAAQ,CAACK,gBAAgB,CAAC,OAAO,EAAE6kC,WAAW,CAAC,CAAA;AAEtD,IAAA,OAAO,MAAM;MACX/kC,MAAM,CAACH,QAAQ,CAACM,mBAAmB,CAAC,SAAS,EAAEgkC,aAAa,CAAC,CAAA;MAC7DnkC,MAAM,CAACH,QAAQ,CAACM,mBAAmB,CAAC,MAAM,EAAEskC,UAAU,CAAC,CAAA;MACvDzkC,MAAM,CAACH,QAAQ,CAACM,mBAAmB,CAAC,KAAK,EAAE2kC,SAAS,CAAC,CAAA;MACrD9kC,MAAM,CAACH,QAAQ,CAACM,mBAAmB,CAAC,OAAO,EAAE4kC,WAAW,CAAC,CAAA;KAC1D,CAAA;AACH,GAAC,CAAC,CAAA;AACJ,CAAA;AAEA,SAASX,oBAAoBA,CAAC1uB,MAA0B,EAAW;AACjE,EAAA,OACEyvB,mBAAmB,CAACzvB,MAAM,CAAC,KAC1B,CAAC,OAAO,EAAE,UAAU,EAAE,QAAQ,CAAC,CAAC7a,QAAQ,CAAC6a,MAAM,CAACmO,OAAO,CAAC,IACtDnO,MAAM,CAACmO,OAAO,KAAK,KAAK,IAAInO,MAAM,CAACiN,YAAY,CAAC,MAAM,CAAC,KAAK,SAAU,CAAC,CAAA;AAE9E,CAAA;AAEA,SAASwiB,mBAAmBA,CAC1B94B,OAA2B,EACH;EACxB,OAAOA,OAAO,KAAK,IAAI,CAAA;AACzB,CAAA;AAEA,SAASs4B,gBAAgBA,CAACj+B,KAAe,EAAE1E,aAAgC,EAAE;AAC3E,EAAA,MAAMojC,WAAW,GAAG,CAAC,GAAG1+B,KAAK,CAAC,CAAChL,IAAI,CAAClC,sBAAsB,CAAC,WAAW,CAAC,CAAC,CAAA;AACxE,EAAA,OAAO4rC,WAAW,CAAClsC,GAAG,CAAEF,IAAI,IAAK;IAC/B,MAAM6O,MAAM,GAAGtL,cAAc,CAACyF,aAAa,CAACG,IAAI,CAACwE,MAAM,EAAE3N,IAAI,CAAC,CAAA;AAC9D,IAAA,OAAO+uB,0BAAe,CAAClgB,MAAM,EAAE7F,aAAa,CAAC,CAAA;AAC/C,GAAC,CAAC,CAAA;AACJ,CAAA;AAEA,SAAS0iC,kBAAkBA,CAACvY,aAAuB,EAAEhtB,KAAqB,EAAE;AAC1E,EAAA,MAAMkmC,qBAAqB,GAAG,EAC5BjB,oBAAoB,CAACjlC,KAAK,CAACuW,MAAM,CAAC,IAClC0uB,oBAAoB,CAACvkC,QAAQ,CAACylC,aAAa,CAAC,CAC7C,CAAA;AAED,EAAA,MAAMC,kBAAkB,GAAGvlC,MAAM,CAACwlC,YAAY,CAAA;AAC9C,EAAA,MAAMC,qBAAqB,GAAGnB,kBAAkB,CAACnY,aAAa,CAAC,CAAA;AAE/D,EAAA,OAAOkZ,qBAAqB,IAAIE,kBAAkB,IAAIE,qBAAqB,CAAA;AAC7E,CAAA;AAEA,SAASpB,gBAAgBA,CAACllC,KAAoB,EAAW;AACvD,EAAA,OAAO4kC,qBAAqB,CAAClpC,QAAQ,CAACsE,KAAK,CAACnD,GAAG,CAAC,CAAA;AAClD,CAAA;;AAEA;AACA;AACA;AACA,SAASsoC,kBAAkBA,CAACnY,aAAuB,EAAE;EACnD,OAAOA,aAAa,CAACzzB,MAAM,GAAG,CAAC,IAAIyzB,aAAa,CAAC,CAAC,CAAC,KAAK,EAAE,CAAA;AAC5D;;AClKA,MAAMuZ,YAAY,GAAG,EAAE,CAAA;AAOvB,MAAMC,aAAa,CAAC;AAIlBvG,EAAAA,WAAWA,GAAG;IACZ,IAAI,CAACz4B,MAAM,GAAG,EAAE,CAAA;AAChB,IAAA,IAAI,CAACi/B,YAAY,GAAG,CAAC,CAAC,CAAA;AACxB,GAAA;EAEA1hC,IAAIA,CAACzI,KAAmB,EAAE;AACxB,IAAA,MAAMoqC,uBAAuB,GAC3B,IAAI,CAACl/B,MAAM,CAACjO,MAAM,GAAG,CAAC,KAAK,IAAI,CAACktC,YAAY,CAAA;;AAE9C;AACA;AACA;IACA,IAAI,CAACC,uBAAuB,EAAE;MAC5B,IAAI,CAACl/B,MAAM,CAAC+wB,MAAM,CAChB,IAAI,CAACkO,YAAY,GAAG,CAAC,EACrB,IAAI,CAACj/B,MAAM,CAACjO,MAAM,GAAG,CAAC,GAAG,IAAI,CAACktC,YAChC,CAAC,CAAA;AACH,KAAA;IAEA,MAAME,uBAAuB,GAAG,IAAI,CAACn/B,MAAM,CAACjO,MAAM,GAAG,CAAC,GAAGgtC,YAAY,CAAA;AAErE,IAAA,IAAII,uBAAuB,EAAE;AAC3B,MAAA,IAAI,CAACn/B,MAAM,CAACqyB,KAAK,EAAE,CAAA;AACrB,KAAA;AAEA,IAAA,IAAI,CAACryB,MAAM,CAACzC,IAAI,CAACzI,KAAK,CAAC,CAAA;IACvB,IAAI,CAACmqC,YAAY,GAAG,IAAI,CAACj/B,MAAM,CAACjO,MAAM,GAAG,CAAC,CAAA;AAC5C,GAAA;EAEA2E,OAAOA,CAAC5B,KAAmB,EAAE;IAC3B,IAAI,CAACkL,MAAM,CAAC,IAAI,CAACi/B,YAAY,CAAC,GAAGnqC,KAAK,CAAA;AACxC,GAAA;AAEAsqC,EAAAA,SAASA,CAACC,QAAsB,EAAE7mB,QAAsB,EAAE;AACxD,IAAA,MAAM8mB,UAAU,GAAG,IAAI,CAACt/B,MAAM,CAACu/B,SAAS,CACrCzqC,KAAK,IAAKA,KAAK,CAACoM,MAAM,KAAKm+B,QAAQ,CAACn+B,MACvC,CAAC,CAAA;AAED,IAAA,IAAIo+B,UAAU,KAAK,CAAC,CAAC,EAAE;AACrB,MAAA,IAAI,CAACt/B,MAAM,CAACs/B,UAAU,CAAC,GAAG9mB,QAAQ,CAAA;AACpC,KAAA;AACF,GAAA;AAEAgnB,EAAAA,OAAOA,GAAG;AACR,IAAA,IAAI,CAAC,IAAI,CAACC,YAAY,EAAE,EAAE;MACxB,IAAI,CAACR,YAAY,GAAG,IAAI,CAACj/B,MAAM,CAACjO,MAAM,GAAG,CAAC,CAAA;AAC1C,MAAA,OAAO,IAAI,CAAA;AACb,KAAA;IAEA,MAAM2tC,YAAY,GAAG,IAAI,CAAC1/B,MAAM,CAAC,IAAI,CAACi/B,YAAY,CAAC,CAAA;AAEnD,IAAA,OAAO,IAAI,CAACQ,YAAY,EAAE,EAAE;MAC1B,IAAI,CAACR,YAAY,IAAI,CAAC,CAAA;MACtB,MAAMU,SAAS,GAAG,IAAI,CAAC3/B,MAAM,CAAC,IAAI,CAACi/B,YAAY,CAAC,CAAA;MAEhD,IAAI,CAACzqC,WAAW,CAACmrC,SAAS,CAACz+B,MAAM,EAAEw+B,YAAY,CAACx+B,MAAM,CAAC,EAAE;AACvD,QAAA,OAAOy+B,SAAS,CAAA;AAClB,OAAA;AACF,KAAA;AAEA,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;AAEAC,EAAAA,IAAIA,GAAG;AACL,IAAA,IAAI,CAAC,IAAI,CAACC,SAAS,EAAE,EAAE;AACrB,MAAA,OAAO,IAAI,CAAA;AACb,KAAA;IAEA,MAAMH,YAAY,GAAG,IAAI,CAAC1/B,MAAM,CAAC,IAAI,CAACi/B,YAAY,CAAC,CAAA;AAEnD,IAAA,OAAO,IAAI,CAACY,SAAS,EAAE,EAAE;MACvB,IAAI,CAACZ,YAAY,IAAI,CAAC,CAAA;MACtB,MAAMa,aAAa,GAAG,IAAI,CAAC9/B,MAAM,CAAC,IAAI,CAACi/B,YAAY,CAAC,CAAA;MAEpD,IAAI,CAACzqC,WAAW,CAACsrC,aAAa,CAAC5+B,MAAM,EAAEw+B,YAAY,CAACx+B,MAAM,CAAC,EAAE;AAC3D,QAAA,OAAO4+B,aAAa,CAAA;AACtB,OAAA;AACF,KAAA;AAEA,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;AAEAC,EAAAA,UAAUA,GAAwB;AAChC,IAAA,OAAO,IAAI,CAAC//B,MAAM,CAACzN,GAAG,CAAEuC,KAAK,KAAM;MACjC,GAAGA,KAAAA;AACL,KAAC,CAAC,CAAC,CAAA;AACL,GAAA;AAEQ2qC,EAAAA,YAAYA,GAAG;IACrB,OAAO,IAAI,CAACR,YAAY,GAAG,IAAI,CAACj/B,MAAM,CAACjO,MAAM,GAAG,CAAC,CAAA;AACnD,GAAA;AAEQ8tC,EAAAA,SAASA,GAAG;AAClB,IAAA,OAAO,IAAI,CAACZ,YAAY,GAAG,CAAC,CAAA;AAC9B,GAAA;AACF;;AC9FA,SAASe,gBAAgBA,CAAC;AAAE39B,EAAAA,QAAAA;AAAqC,CAAC,EAAE;EAClE,MAAM49B,aAAa,GAAGvqC,YAAM,CAAgB,IAAIspC,aAAa,EAAE,CAAC,CAACrpC,OAAO,CAAA;EAExE,SAASuqC,IAAIA,GAAS;IACpBvrB,4BAAQ,CAACwrB,uBAAuB,CAAC,MAAM;AACrC,MAAA,MAAM9V,KAAK,GAAG4V,aAAa,CAACL,IAAI,EAAE,CAAA;MAElC,IAAIvV,KAAK,KAAK,IAAI,EAAE;AAClB,QAAA,OAAA;AACF,OAAA;MAEA,MAAM;QAAExjB,aAAa;QAAE,GAAGvC,IAAAA;AAAK,OAAC,GAAG+lB,KAAK,CAAA;AACxChoB,MAAAA,QAAQ,CAAC;AACPqjB,QAAAA,YAAY,EAAE7e,aAAa;AAC3B,QAAA,GAAGvC,IAAI;AACPH,QAAAA,IAAI,EAAE,MAAA;AACR,OAAC,CAAC,CAAA;AACJ,KAAC,CAAC,CAAA;AACJ,GAAA;EAEA,SAASi8B,IAAIA,GAAG;IACdzrB,4BAAQ,CAACwrB,uBAAuB,CAAC,MAAM;AACrC,MAAA,MAAM9V,KAAK,GAAG4V,aAAa,CAACT,OAAO,EAAE,CAAA;MAErC,IAAI,CAACnV,KAAK,EAAE;AACV,QAAA,OAAO,IAAI,CAAA;AACb,OAAA;MAEA,MAAM;QAAExjB,aAAa;QAAE,GAAGvC,IAAAA;AAAK,OAAC,GAAG+lB,KAAK,CAAA;AAExChoB,MAAAA,QAAQ,CAAC;AACPqjB,QAAAA,YAAY,EAAE7e,aAAa;AAC3B,QAAA,GAAGvC,IAAI;AACPH,QAAAA,IAAI,EAAE,MAAA;AACR,OAAC,CAAC,CAAA;AACJ,KAAC,CAAC,CAAA;AACJ,GAAA;EAEA,SAAS5G,IAAIA,CAAC8sB,KAAmB,EAAE;AACjC4V,IAAAA,aAAa,CAAC1iC,IAAI,CAAC8sB,KAAK,CAAC,CAAA;AAC3B,GAAA;EAEA,OAAO;IACL9sB,IAAI;IACJ6iC,IAAI;IACJF,IAAI;AACJG,IAAAA,qBAAqB,EAAEJ,aAAAA;GACxB,CAAA;AACH;;AC7DO,SAASK,uBAAuBA,CAACn0B,OAAiB,EAAW;AAClE,EAAA,IAAIA,OAAO,CAACpa,MAAM,KAAK,CAAC,EAAE;AACxB,IAAA,MAAM,IAAIH,KAAK,CAAC,8BAA8B,CAAC,CAAA;AACjD,GAAA;EAEA,MAAM2uC,cAAc,GAAGp0B,OAAO,CAACzZ,MAAM,CAAEo1B,CAAC,IAAKA,CAAC,CAAC2P,SAAS,CAAC,CAAA;AACzD,EAAA,IAAI8I,cAAc,CAACxuC,MAAM,KAAK,CAAC,EAAE;AAC/B,IAAA,MAAM,IAAIH,KAAK,CAAC,uDAAuD,CAAC,CAAA;AAC1E,GAAA;AAEA,EAAA,IAAI2uC,cAAc,CAACxuC,MAAM,GAAG,CAAC,EAAE;AAC7B,IAAA,MAAM,IAAIH,KAAK,CACb,+DACF,CAAC,CAAA;AACH,GAAA;AAEA,EAAA,MAAM4uC,aAAa,GAAGD,cAAc,CAAC,CAAC,CAAC,CAAA;EAEvC,IAAIC,aAAa,CAACC,QAAQ,EAAE;AAC1B,IAAA,MAAM,IAAI7uC,KAAK,CAAC,oCAAoC,CAAC,CAAA;AACvD,GAAA;;AAEA;AACAua,EAAAA,OAAO,CAAC/W,OAAO,CAAE8W,MAAM,IAAK;IAC1B,IAAIA,MAAM,CAACu0B,QAAQ,EAAE;AACnB,MAAA,MAAMA,QAAQ,GAAGt0B,OAAO,CAACpQ,IAAI,CAAEvJ,CAAC,IAAKA,CAAC,CAACu1B,IAAI,KAAK7b,MAAM,CAACu0B,QAAQ,CAAC,CAAA;MAEhE,IAAI,CAACA,QAAQ,EAAE;QACb,MAAM,IAAI7uC,KAAK,CACb,CAAUsa,OAAAA,EAAAA,MAAM,mBAAmBA,MAAM,CAACu0B,QAAQ,CAAA,yCAAA,CACpD,CAAC,CAAA;AACH,OAAA;AACF,KAAA;AACA;AACF,GAAC,CAAC,CAAA;;AAEF;AACAt0B,EAAAA,OAAO,CAAC/W,OAAO,CAAE8W,MAAM,IAAK;IAC1B,MAAMw0B,WAAqB,GAAG,EAAE,CAAA;IAEhC,IAAIC,aAAa,GAAGz0B,MAAM,CAAA;IAE1B,GAAG;AACDw0B,MAAAA,WAAW,CAACnjC,IAAI,CAACojC,aAAa,CAAC5Y,IAAI,CAAC,CAAA;MACpC,MAAM6Y,UAAU,GACdD,aAAa,CAACF,QAAQ,IAAItI,+BAAgB,CAAChsB,OAAO,CAAC,CAAC4b,IAAI,CAAA;;AAE1D;MACA,IAAI6Y,UAAU,KAAKzI,+BAAgB,CAAChsB,OAAO,CAAC,CAAC4b,IAAI,EAAE;AACjD,QAAA,MAAA;AACF,OAAA;;AAEA;AACA,MAAA,IAAI2Y,WAAW,CAACxsC,QAAQ,CAAC0sC,UAAU,CAAC,EAAE;AACpC,QAAA,MAAM,IAAIhvC,KAAK,CACb,CAA2C,wCAAA,EAAA,CACzC,GAAG8uC,WAAW,EACdE,UAAU,CACX,CAACt4B,IAAI,CAAC,GAAG,CAAC,EACb,CAAC,CAAA;AACH,OAAA;AAEAq4B,MAAAA,aAAa,GAAGx0B,OAAO,CAACpQ,IAAI,CAAEvJ,CAAC,IAAKA,CAAC,CAACu1B,IAAI,KAAK6Y,UAAU,CAAE,CAAA;AAC7D,KAAC,QAAQ,IAAI,EAAA;AACf,GAAC,CAAC,CAAA;AAEF,EAAA,OAAO,IAAI,CAAA;AACb;;AC6BA,MAAMC,gBAAgB,GAAGjmC,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,0BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAKlC,CAAA,CAAA,CAAA,qEAAA,CAAA,CAAA,CAAA;AAED,MAAM8lC,0BAA0B,GAAGlmC,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,oCAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAChC2E,CAAAA,CAAAA,CAAAA,SAAAA,EAAAA,qFAAAA,CAAAA,EAAAA,KAAK,IAAK,CAAQA,KAAAA,EAAAA,KAAK,CAAC9F,MAAM,CAAA,GAAA,EAAM8rB,cAAc,CAAA,GAAA,CAAK,CAMnE,CAAA;AAED,MAAMob,gBAAgB,GAAGnmC,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,0BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAAA,CAAA,CAAA,CAAA,4BAAA,EAAA,yBAAA,EAAA,oEAAA,CAAA,EAEnBC,6BAAM,CAAC+lC,KAAK,EACD/lC,6BAAM,CAACC,QAAQ,CAQzC,CAAA;AAED,MAAM+lC,aAAa,GAAGrmC,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,uBAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAQ/B,CAAA,CAAA,CAAA,8GAAA,CAAA,CAAA,CAAA;AAED,MAAMkmC,gBAAgB,GAAGtmC,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,0BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAQlC,CAAA,CAAA,CAAA,+FAAA,CAAA,CAAA,CAAA;AAED,MAAMmmC,cAAc,GAAGvmC,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,wBAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAO7BwE,CAAAA,CAAAA,CAAAA,yGAAAA,EAAAA,kBAAAA,CAAAA,EAAAA,4BAAK,CAAClG,IAAI,CAEb,CAAA;AAED,MAAM8nC,oBAAoB,GAAGxmC,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,8BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CASnCwE,CAAAA,CAAAA,CAAAA,mIAAAA,EAAAA,EAAAA,CAAAA,EAAAA,4BAAK,CAAC6hC,SAAS,CAClB,CAAA;AAwBM,MAAMC,MAAM,GAAGC,wBAAwB,CAAA;AAE9C,SAASA,wBAAwBA,CAAC5hC,KAAkB,EAAE;EACpD,MAAM,CAAC6hC,OAAO,EAAEC,UAAU,CAAC,GAAGjsC,cAAQ,CAAU,KAAK,CAAC,CAAA;EACtD,MAAM,CAAC6J,KAAK,EAAEsrB,QAAQ,CAAC,GAAGn1B,cAAQ,CAAqB0B,SAAS,CAAC,CAAA;EACjE,MAAM,CAACgC,QAAQ,EAAEwoC,WAAW,CAAC,GAAGlsC,cAAQ,CAAkB,IAAI,CAAC,CAAA;AAE/DyD,EAAAA,eAAS,CAAC,MAAM;IACd,eAAe0oC,GAAGA,GAAG;MACnB,IAAI;QACF,IAAIhiC,KAAK,CAACiiC,UAAU,EAAE;AACpB,UAAA,MAAM1oC,QAAQ,GAAG,MAAMyG,KAAK,CAACuB,MAAM,CAAC2pB,OAAO,CAACyR,SAAS,CAACnV,GAAG,CAAC;YACxD1wB,EAAE,EAAEkJ,KAAK,CAACiiC,UAAAA;AACZ,WAAC,CAAC,CAAA;UAEF,IAAI,CAAC1oC,QAAQ,EAAE;YACb,MAAM,IAAItH,KAAK,CACb,CAAA,8BAAA,EAAiC+N,KAAK,CAACiiC,UAAU,EACnD,CAAC,CAAA;AACH,WAAA;UAEAF,WAAW,CAACxoC,QAAQ,CAAC,CAAA;AACvB,SAAA;OACD,CAAC,OAAOmG,KAAK,EAAE;AACdxB,QAAAA,OAAO,CAACwB,KAAK,CAACA,KAAK,CAAC,CAAA;QACpBsrB,QAAQ,CACN,mEACF,CAAC,CAAA;AACD,QAAA,OAAA;AACF,OAAA;MAEA8W,UAAU,CAAC,IAAI,CAAC,CAAA;AAClB,KAAA;AAEAE,IAAAA,GAAG,EAAE,CAAA;GACN,EAAE,EAAE,CAAC,CAAA;EAEN,IAAI,CAACH,OAAO,EAAE;AACZ,IAAA,oBAAOjwC,yBAAA,CAAAmG,aAAA,CAAC0pC,oBAAoB,EAAA,IAAA,EAAC,YAAgC,CAAC,CAAA;AAChE,GAAA;AAEA,EAAA,IAAI/hC,KAAK,EAAE;IACT,oBACE9N,yBAAA,CAAAmG,aAAA,CAACupC,aAAa,EACZ1vC,IAAAA,eAAAA,yBAAA,CAAAmG,aAAA,CAACwpC,gBAAgB,MAAmB,CAAC,eACrC3vC,yBAAA,CAAAmG,aAAA,CAACypC,cAAc,EAAA,IAAA,EAAE9hC,KAAsB,CAC1B,CAAC,CAAA;AAEpB,GAAA;EAEA,oBAAO9N,yBAAA,CAAAmG,aAAA,CAACmqC,aAAa,EAAAp+B,4BAAA,KAAK9D,KAAK,EAAA;AAAEzG,IAAAA,QAAQ,EAAEA,QAAAA;AAAS,GAAA,CAAE,CAAC,CAAA;AACzD,CAAA;AAEA,MAAM2oC,aAAa,gBAAGC,UAAI,CACvBniC,KAAkD,IAAK;AACtD,EAAA,IAAI,CAACA,KAAK,CAACzG,QAAQ,EAAE;IACnB,IAAIyG,KAAK,CAACoiC,cAAc,EAAE;MACxB,IAAIpiC,KAAK,CAACqiC,eAAe,EAAE;AACzB,QAAA,MAAM,IAAIpwC,KAAK,CACb,iFACF,CAAC,CAAA;AACH,OAAA;AAEA,MAAA,MAAMw4B,QAAQ,GAAGzqB,KAAK,CAACuB,MAAM,CAACipB,SAAS,EAAEpuB,IAAI,CAC1CquB,QAAQ,IAAKA,QAAQ,CAAC3zB,EAAE,KAAKkJ,KAAK,CAACoiC,cACtC,CAAC,CAAA;MAED,IAAI,CAAC3X,QAAQ,EAAE;QACb,MAAM,IAAIx4B,KAAK,CACb,CAAA,uCAAA,EAA0C+N,KAAK,CAACoiC,cAAc,sCAChE,CAAC,CAAA;AACH,OAAA;AACF,KAAC,MAAM;AACL,MAAA,IAAIpiC,KAAK,CAACqiC,eAAe,KAAK,IAAI,EAAE;AAClC,QAAA,MAAM,IAAIpwC,KAAK,CACb,0GACF,CAAC,CAAA;AACH,OAAA;AAEA,MAAA,IACE,CAAC+N,KAAK,CAACuB,MAAM,CAACkoB,UAAU,EAAErtB,IAAI,CAC3BmL,SAAS,IAAKA,SAAS,CAACzQ,EAAE,KAAKkJ,KAAK,CAACqiC,eACxC,CAAC,EACD;QACA,MAAM,IAAIpwC,KAAK,CACb,CAAA,uCAAA,EAA0C+N,KAAK,CAACqiC,eAAe,uCACjE,CAAC,CAAA;AACH,OAAA;AACF,KAAA;AACF,GAAA;;AAEA;AACA,EAAA,IAAI,CAACriC,KAAK,CAACuB,MAAM,CAACiL,OAAO,EAAE;AACzB,IAAA,MAAM,IAAIva,KAAK,CAAC,2CAA2C,CAAC,CAAA;AAC9D,GAAA;EAEA0uC,uBAAuB,CAAC3gC,KAAK,CAACuB,MAAM,CAACiL,OAAO,CAAC,CAAC;AAC9C,EAAA,MAAMD,MAAM,GAAGvM,KAAK,CAACuM,MAAM,IAAIisB,+BAAgB,CAACx4B,KAAK,CAACuB,MAAM,CAACiL,OAAO,CAAC,CAAC4b,IAAI,CAAA;EAE1E,MAAMka,iBAAiB,GAAGtiC,KAAK,CAACoiC,cAAc,GAC1CpiC,KAAK,CAACuB,MAAM,CAACipB,SAAS,EAAEpuB,IAAI,CAAE+c,CAAC,IAAKA,CAAC,CAACriB,EAAE,KAAKkJ,KAAK,CAACoiC,cAAc,CAAC,EAChE1X,KAAK,GACP,IAAI,CAAA;EAER,MAAM2X,eAAe,GAAGriC,KAAK,CAACzG,QAAQ,GAClCyG,KAAK,CAACzG,QAAQ,CAACmxB,KAAK,CAACtsB,UAAU,GAC/BkkC,iBAAiB,EAAElkC,UAAU,IAAI4B,KAAK,CAACqiC,eAAe,CAAA;AAE1D,EAAA,MAAMtV,kBAAkB,GAAGwV,uCAAwB,CACjDviC,KAAK,CAACuB,MAAM,EACZ;AACEgL,IAAAA,MAAAA;GACD,EACD81B,eACF,CAAC,CAAA;EAED,MAAMG,YAAY,GAAGxiC,KAAK,CAACzG,QAAQ,GAC/BkpC,iBAAiB,CAACziC,KAAK,CAACzG,QAAQ,CAACmxB,KAAK,EAAEqC,kBAAkB,CAAC,GAC3DrgB,wBAAS,CACT41B,iBAAiB,IAAI;IACnBrhC,GAAG,EAAEpK,QAAQ,EAAE;AACfuH,IAAAA,UAAU,EAAEikC,eAAAA;GACb,EACDtV,kBACF,CAAC,CAAA;EAEH,oBACEn7B,yBAAA,CAAAmG,aAAA,CAAC2qC,aAAa,EAAA5+B,4BAAA,KACR9D,KAAK,EAAA;AACT+sB,IAAAA,kBAAkB,EAAEA,kBAAmB;IACvC8O,eAAe,EAAE77B,KAAK,CAACzG,QAAS;AAChCipC,IAAAA,YAAY,EAAEA,YAAAA;AAAa,GAAA,CAC5B,CAAC,CAAA;AAEN,CACF,CAAC,CAAA;AASD,SAASG,mBAAmBA,CAACC,cAAsB,EAIjD;AACA,EAAA,MAAM,CAAC5qB,QAAQ,EAAE1b,SAAS,EAAE6M,eAAe,CAAC,GAAGy5B,cAAc,CAACjwC,KAAK,CAAC,GAAG,CAAC,CAAA;EAExE,OAAO;IACLqlB,QAAQ;IACR1b,SAAS;AACT6M,IAAAA,eAAAA;GACD,CAAA;AACH,CAAA;AAEA,SAAS05B,eAAeA,CACtBnnC,aAAgC,EAChC6F,MAAc,EACduhC,UAAgC,EAChChrC,YAA0B,EAC1BirC,oBAA+C,EAG/C;AACA,EAAA,MAAMC,gBAAgB,GAAGjtC,YAAM,EAAiC,CAAA;;AAEhE;AACA,EAAA,MAAMktC,eAAe,GAAGltC,YAAM,EAAwB,CAAA;AACtD,EAAA,MAAMmtC,cAAc,GAAGntC,YAAM,EAAW,CAAA;AACxC,EAAA,MAAMotC,oBAAoB,GAAGptC,YAAM,EAAU,CAAA;EAE7C,MAAMqtC,YAAY,GAChBH,eAAe,CAACjtC,OAAO,KAAK8sC,UAAU,IACtCI,cAAc,CAACltC,OAAO,KAAK0F,aAAa,CAACorB,SAAS,IAClDqc,oBAAoB,CAACntC,OAAO,KAAK0F,aAAa,CAACyN,eAAe,CAAA;AAEhE,EAAA,IAAI,CAAC65B,gBAAgB,CAAChtC,OAAO,IAAIotC,YAAY,EAAE;AAC7C;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEIJ,IAAAA,gBAAgB,CAAChtC,OAAO,GAAGqtC,yBAAU,CAAC;AACpC3Y,MAAAA,KAAK,EAAEoY,UAAU;MACjBvhC,MAAM;AACNgL,MAAAA,MAAM,EAAE7Q,aAAa,CAAC4Q,aAAa,CAACC,MAAM;MAC1CzU,YAAY;AACZwrC,MAAAA,QAAQ,EAAE;uBACRC,4BAAa;kBACb5iB,uBAAQ;QACR6iB,OAAO,EAAGz7B,OAAO,IAAK;AACpB,UAAA,IAAI07B,UAA+B,GAAG;AACpCC,YAAAA,IAAI,EAAE;cACJt6B,OAAO,EAAE1N,aAAa,CAAC0N,OAAO;AAC9BmD,cAAAA,MAAM,EAAE7Q,aAAa,CAAC4Q,aAAa,CAACC,MAAM;AAC1Cid,cAAAA,WAAW,EAAE;AACXpoB,gBAAAA,OAAO,EAAE,EAAE;AACXqoB,gBAAAA,UAAU,EAAE,EAAE;AACdka,gBAAAA,KAAK,EAAE,EAAE;AACTC,gBAAAA,aAAa,EAAE,EAAA;AACjB,eAAA;AACF,aAAA;WACD,CAAA;AAED,UAAA,MAAMC,iBAAiB,GAAGC,6BAAc,CAAC/7B,OAAO,CAAC,CAAA;UAEjD,MAAM;YAAE0U,IAAI;YAAE,GAAG9X,IAAAA;WAAM,GAAGo/B,8BAAe,CACvCF,iBAAiB,EACjBnoC,aAAa,EACbA,aAAa,CAAC4nB,gBAChB,CAAC,CAAA;AAEDmgB,UAAAA,UAAU,GAAGO,mCAAoB,CAACP,UAAU,EAAEhnB,IAAI,CAAC,CAAA;UAEnD,OAAO;AACL,YAAA,GAAG9X,IAAI;AACP8X,YAAAA,IAAI,EAAEgnB,UAAAA;WACP,CAAA;AACH,SAAA;OACD;AACDQ,MAAAA,qBAAqBA,CAAC7uB,iBAAiB,EAAE8uB,4BAA4B,EAAE;AACrE;AACA,QAAA,MAAMC,kBAAkB,GAAGrsC,YAAY,CAACsd,iBAAiB,CAACte,EAAE,CAAC,CAAA;;AAE7D;AACA;AACA,QAAA,IAAIqtC,kBAAkB,IAAI/uB,iBAAiB,CAACgvB,UAAU,KAAK,IAAI,EAAE;AAC/D,UAAA,OAAO,IAAI,CAAA;AACb,SAAA;;AAEA;AACA;QACA,IACED,kBAAkB,IAClB/uB,iBAAiB,CAACgvB,UAAU,IAC5BnB,eAAe,CAACjtC,OAAO,EACvB;UACA,MAAM;YAAEmT,eAAe;YAAE6O,QAAQ;AAAE1b,YAAAA,SAAAA;AAAU,WAAC,GAAGqmC,mBAAmB,CAClEvtB,iBAAiB,CAACte,EACpB,CAAC,CAAA;UAED,MAAMyK,MAAM,GAAG8iC,cAAc,CAC3BpB,eAAe,CAACjtC,OAAO,EACvB0F,aAAa,EACbsc,QAAQ,KAAK,GAAG,GAAGirB,eAAe,CAACjtC,OAAO,CAACiL,GAAG,GAAG+W,QACnD,CAAC,CAAA;UAED,IAAI,CAACzW,MAAM,EAAE;AACX,YAAA,OAAO,KAAK,CAAA;AACd,WAAA;AAEA,UAAA,MAAMpM,KAAK,GAAGgU,eAAe,GACzBm7B,iCAAkB,CAAC/iC,MAAM,CAACjF,SAAS,CAAC,EAAE6M,eAAe,CAAC,GACtD5H,MAAM,CAACjF,SAAS,CAAC,CAAA;AAErB,UAAA,MAAMioC,oBAAoB,GACxBpvC,KAAK,KAAKoC,SAAS,IAAIpC,KAAK,CAAC2B,EAAE,KAAKse,iBAAiB,CAACgvB,UAAU,CAAA;AAElE,UAAA,OAAOG,oBAAoB,CAAA;AAC7B,SAAA;QAEA,OAAOL,4BAA4B,CAAC9uB,iBAAiB,CAAC,CAAA;AACxD,OAAA;AACF,KAAC,CAAC,CAAA;AAEF,IAAA,IAAI7f,MAAM,CAACC,IAAI,CAACwtC,gBAAgB,CAAChtC,OAAO,CAAC8B,YAAY,CAAC,CAAC1F,MAAM,GAAG,CAAC,EAAE;MACjE2wC,oBAAoB,CAClBC,gBAAgB,CAAChtC,OAAO,CAAC8B,YAAY,EACrC4D,aAAa,CAAC4Q,aAChB,CAAC,CAAA;AACH,KAAA;AACF,GAAA;EAEA22B,eAAe,CAACjtC,OAAO,GAAG8sC,UAAU,CAAA;AACpCI,EAAAA,cAAc,CAACltC,OAAO,GAAG0F,aAAa,CAACorB,SAAS,CAAA;AAChDqc,EAAAA,oBAAoB,CAACntC,OAAO,GAAG0F,aAAa,CAACyN,eAAe,CAAA;EAE5D,OAAO;AACLq7B,IAAAA,iBAAiB,EAAGxB,gBAAgB,CAAChtC,OAAO,CACzCwuC,iBAAiB;AACpBx9B,IAAAA,eAAe,EAAGg8B,gBAAgB,CAAChtC,OAAO,CACvCgR,eAAe;AAClByV,IAAAA,IAAI,EAAEumB,gBAAgB,CAAChtC,OAAO,CAACymB,IAAAA;GAChC,CAAA;AACH,CAAA;AAEA,SAASgoB,6BAA6BA,CACpC7d,QAAgB,EAChBxd,OAAsB,EACtBgS,mBAA2B,EAC3BspB,aAAiD,EACjD;AACA,EAAA,IAAIC,YAAyB,CAAA;;AAE7B;EACA,IAAI/d,QAAQ,KAAK,YAAY,EAAE;IAC7B,IAAI,CAAC8d,aAAa,EAAE;AAClBC,MAAAA,YAAY,GAAGv7B,OAAO,CAAChN,IAAI,CACxBwoC,MAAM,IAAKA,MAAM,CAAC9tC,EAAE,KAAKskB,mBAC5B,CAAE,CAAA;AACJ,KAAC,MAAM;MACL,MAAMypB,cAAc,GAAGC,iBAAiB,CAAC17B,OAAO,EAAEs7B,aAAa,CAACzqC,KAAK,CAAC,CAAA;MACtE,IAAI,CAAC4qC,cAAc,EAAE;AACnB,QAAA,MAAM,IAAI5yC,KAAK,CAAC,4BAA4B,CAAC,CAAA;AAC/C,OAAA;AAEA0yC,MAAAA,YAAY,GAAGE,cAAc,CAAA;AAC/B,KAAA;AACF,GAAC,MAAM;AACLF,IAAAA,YAAY,GAAGv7B,OAAO,CAAChN,IAAI,CAAEwoC,MAAM,IAAKA,MAAM,CAAC9tC,EAAE,KAAK8vB,QAAQ,CAAE,CAAA;AAClE,GAAA;AAEA,EAAA,MAAMme,iBAAiB,GAAG37B,OAAO,CAACw2B,SAAS,CACxCgF,MAAM,IAAKA,MAAM,CAAC9tC,EAAE,KAAK6tC,YAAY,CAAC7tC,EACzC,CAAC,CAAA;;AAED;EACA,IAAImD,KAAK,EAAEC,MAAc,CAAA;EACzB,IAAI8qC,WAA0B,GAAG,IAAI,CAAA;EACrC,IAAIC,OAAO,GAAG,CAAC,CAAA;EAEf,IAAI,CAACP,aAAa,EAAE;AAClB;AACAzqC,IAAAA,KAAK,GAAG,CAAC,CAAA;AACTC,IAAAA,MAAM,GAAG,CAAC,CAAA;AACZ,GAAC,MAAM;IACL,IAAI0sB,QAAQ,KAAK,YAAY,EAAE;MAC7B3sB,KAAK,GAAGyqC,aAAa,CAACzqC,KAAK,CAAA;MAC3BC,MAAM,GAAGwqC,aAAa,CAACxqC,MAAM,CAAA;AAC/B,KAAC,MAAM;AACL,MAAA,MAAMgrC,sBAAsB,GAC1BH,iBAAiB,KAAK,CAAC,GACnB,CAAC,GACD37B,OAAO,CAAC27B,iBAAiB,GAAG,CAAC,CAAC,CAACI,UAAW,CAAA;MAEhDlrC,KAAK,GAAG0qC,YAAY,CAAC15B,CAAC,CAAA;MACtB/Q,MAAM,GACJyqC,YAAY,CAACS,CAAC,KAAK,IAAI,GACnBV,aAAa,CAACxqC,MAAM,GACpBtG,IAAI,CAACC,GAAG,CAAC8wC,YAAY,CAACS,CAAC,EAAEV,aAAa,CAACxqC,MAAM,CAAC,CAAA;AAEpD,MAAA,IAAIyqC,YAAY,CAAC15B,CAAC,IAAIy5B,aAAa,CAACzqC,KAAK,EAAE,CAE1C,MAAM,IAAIirC,sBAAsB,IAAIR,aAAa,CAACzqC,KAAK,EAAE;AACxD;QACAA,KAAK,GAAGyqC,aAAa,CAACzqC,KAAK,CAAA;AAC7B,OAAC,MAAM;AACL;AACA+qC,QAAAA,WAAW,GAAGN,aAAa,CAACzqC,KAAK,GAAG0qC,YAAY,CAAC15B,CAAC,CAAA;AAElD,QAAA,IAAI05B,YAAY,CAACS,CAAC,KAAK,IAAI,EAAE;AAC3BlrC,UAAAA,MAAM,GAAGwqC,aAAa,CAACxqC,MAAM,GAAG8qC,WAAW,CAAA;UAC3CC,OAAO,GAAG,CAACP,aAAa,CAACxqC,MAAM,GAAGA,MAAM,IAAI,CAAC,CAAA;AAC/C,SAAA;AACF,OAAA;AACF,KAAA;AACF,GAAA;EAEA,OAAO;IACLiP,eAAe,EAAEw7B,YAAY,CAAC7tC,EAAE;AAChCuuC,IAAAA,UAAU,EAAE;MACVprC,KAAK;MACLC,MAAM;MACNC,SAAS,EACP6qC,WAAW,KAAK,IAAI,GAChB,MAAM,GACN,CAAA,WAAA,EAAcC,OAAO,CAAA,UAAA,EAAaD,WAAW,CAAA,CAAA,CAAA;AACrD,KAAA;GACD,CAAA;AACH,CAAA;AAEA,SAASM,yBAAyBA,CAAC9pC,MAAiC,EAAE;EACpE,MAAM;AAAE1F,IAAAA,aAAAA;GAAe,GAAGH,gBAAgB,EAAE,CAAA;EAE5C,MAAM4vC,cAAc,GAAGxvC,YAAM,CAC3B,IAAIyvC,cAAc,CAChBC,4BAAQ,CAAC,MAAM;AACb3vC,IAAAA,aAAa,EAAE,CAAA;AACjB,GAAC,EAAE,GAAG,CACR,CACF,CAAC,CAAA;AAEDwD,EAAAA,eAAS,CAAC,MAAM;IACd,IAAI,CAACkC,MAAM,EAAE;AACX,MAAA,OAAA;AACF,KAAA;AAEA+pC,IAAAA,cAAc,CAACvvC,OAAO,CAAC0vC,OAAO,CAAClqC,MAAM,CAAC,CAAA;AAEtC,IAAA,OAAO,MAAM;AACX+pC,MAAAA,cAAc,CAACvvC,OAAO,CAAC2vC,SAAS,CAACnqC,MAAM,CAAC,CAAA;KACzC,CAAA;AACH,GAAC,EAAE,CAACA,MAAM,CAAC,CAAC,CAAA;AACd,CAAA;AAEA,MAAMknC,aAAa,GAAGA,CAAC;EACrB3V,kBAAkB;AAClB6Y,EAAAA,UAAU,GAAG,UAAU;EACvB/J,eAAe;EACf2G,YAAY;EACZ1qC,YAAY;AACZqI,EAAAA,WAAW,GAAG,KAAK;EACnB,GAAGH,KAAAA;AACe,CAAC,KAAK;AACxB,EAAA,MAAM,CAAC6lC,eAAe,EAAEC,kBAAkB,CAAC,GAAGjwC,cAAQ,CACpDk3B,kBAAkB,CAAC3R,mBACrB,CAAC,CAAC;;AAEF,EAAA,MAAM2qB,kBAAkB,GAAGhwC,YAAM,CAAoB,IAAI,CAAC,CAAA;AAC1D,EAAA,MAAM2uC,aAAa,GAAGqB,kBAAkB,CAAC/vC,OAAO,GAC5C;AACAiE,IAAAA,KAAK,EAAE8rC,kBAAkB,CAAC/vC,OAAO,CAACgwC,WAAW;AAC7C9rC,IAAAA,MAAM,EAAE6rC,kBAAkB,CAAC/vC,OAAO,CAACiwC,YAAAA;AACrC,GAAC,GACC1uC,SAAS,CAAA;EAEb,MAAM;IAAE4R,eAAe;AAAEk8B,IAAAA,UAAAA;AAAW,GAAC,GAAGZ,6BAA6B,CACnEoB,eAAe,EACf9Y,kBAAkB,CAAC3jB,OAAO,EAC1B2jB,kBAAkB,CAAC3R,mBAAmB,EACtCspB,aACF,CAAC,CAAA;AAEDY,EAAAA,yBAAyB,CAACS,kBAAkB,CAAC/vC,OAAO,CAAC,CAAC;;EAEtD,MAAMstB,gBAAgB,GAAGvtB,YAAM,CAAC,IAAImwC,+BAAgB,EAAE,CAAC,CAAA;EACvD,MAAM,CAACpf,SAAS,EAAEqf,UAAU,CAAC,GAAGtwC,cAAQ,CAAC,IAAI,CAAC,CAAA;AAC9C,EAAA,MAAM,CAACmrC,aAAa,EAAEoF,gBAAgB,CAAC,GAAGvwC,cAAQ,CAChDk3B,kBAAkB,CAACzgB,aAAa,CAACC,MACnC,CAAC,CAAA;AACD,EAAA,MAAM85B,UAAU,GAAGtwC,YAAM,CAAS,EAAE,CAAC,CAAA;EACrC,MAAM,CAACuwC,mBAAmB,EAAEC,sBAAsB,CAAC,GAAG1wC,cAAQ,CAM5D0B,SAAS,CAAC,CAAA;EACZ,MAAM,CAAC2P,aAAa,EAAEs/B,gBAAgB,CAAC,GAAG3wC,cAAQ,CAAgB,EAAE,CAAC,CAAA;AAErE,EAAA,MAAM4wC,sBAAsB,GAAG70C,yBAAK,CAACmE,MAAM,CACxCyH,KAA6B,IAAK;AACjC,IAAA,MAAMkpC,gBAAgB,GAAGn0C,KAAK,CAACC,OAAO,CAACgL,KAAK,CAAC,GAAGA,KAAK,GAAG,CAACA,KAAK,CAAC,CAAA;IAC/DgpC,gBAAgB,CAACE,gBAAgB,CAAC,CAAA;GAEtC,CAAC,CAAC1wC,OAAO,CAAA;AAET,EAAA,MAAM2wC,UAAU,GAAGlxB,aAAO,CAAC,MAAM;IAC/B,IAAI,CAAC4wB,UAAU,CAACrwC,OAAO,IAAIqwC,UAAU,CAACrwC,OAAO,KAAKgrC,aAAa,EAAE;AAC/D,MAAA,OAAOla,SAAS,CAAA;AAClB,KAAA;AACA,IAAA,OAAO,CAACA,SAAS,CAAA;AACnB,GAAC,EAAE,CAACka,aAAa,EAAEla,SAAS,CAAC,CAAC,CAAA;AAE9B,EAAA,MAAM8f,gBAAgB,GAAGzL,iBAAW,CAAC,MAAM;AACzC7X,IAAAA,gBAAgB,CAACttB,OAAO,CAAC6wC,KAAK,EAAE,CAAA;IAChCV,UAAU,CAAC,CAACrf,SAAS,CAAC,CAAA;AACxB,GAAC,EAAE,CAACA,SAAS,CAAC,CAAC,CAAA;EAEf,MAAMggB,yBAAyB,GAAIvlC,MAA6B,IAAK;IACnEglC,sBAAsB,CAAChvC,SAAS,CAAC,CAAA;AACjC+uC,IAAAA,mBAAmB,CAAES,cAAc,CAACxlC,MAAM,CAAC,CAAA;GAC5C,CAAA;AAED,EAAA,MAAMylC,cAAc,GAAGjxC,YAAM,CAAwB,IAAI,CAAC,CAAA;AAE1D,EAAA,MAAM,CAACkxC,YAAY,EAAEprC,IAAI,CAAC,GAAG++B,OAAO,CAAC;AACnC9jC,IAAAA,EAAE,EAAE,mBAAmB;AACvBkM,IAAAA,KAAK,EAAE,YAAY;AACnBzF,IAAAA,MAAM,EAAE,EAAE;AACV07B,IAAAA,aAAa,EAAEuJ,YAAY;AAC3BzW,IAAAA,QAAQ,EAAE,YAAY,EAAE;AAC1B,GAAC,CAAC,CAAA;EAEF,MAAM;IAAEwU,IAAI;IAAEE,IAAI;AAAE7iC,IAAAA,IAAAA;GAAM,GAAGyiC,gBAAgB,CAAC;AAC5C39B,IAAAA,QAAQ,EAAEA,CAAC;MAAEnB,MAAM;AAAEwkB,MAAAA,YAAAA;AAAa,KAAC,KAAK;MACtCygB,gBAAgB,CAACzgB,YAAY,CAAC,CAAA;MAC9BlqB,IAAI,CAAC8nB,SAAS,CAAC9b,MAAM,CAAC,EAAE,EAAEtG,MAAM,CAAC,CAAA;AACnC,KAAA;AACF,GAAC,CAAC,CAAA;EAEF,MAAM,CAACipB,SAAS,EAAE0c,YAAY,CAAC,GAAGrxC,cAAQ,CAAyB0B,SAAS,CAAC,CAAA;EAE7E,MAAM,CAAC4vC,uBAAuB,EAAEC,0BAA0B,CAAC,GAAGvxC,cAAQ,CAEpE0B,SAAS,CAAC,CAAA;EAEZ,MAAM;AAAE0lC,IAAAA,MAAAA;GAAQ,GAAG/8B,iCAAU,EAAE,CAAA;AAE/B,EAAA,MAAMkB,OAAoB,GAAG;AAC3BC,IAAAA,iBAAiB,EAAE+lC,0BAA0B;IAC7CnK,MAAM,EAAG3lC,OAAO,IAAK;MACnB2lC,MAAM,CAAC3lC,OAAO,CAAC,CAAA;KAChB;AACDmb,IAAAA,mBAAmB,EAAE,UAAUlR,MAAM,EAAE;AACrC,MAAA,OAAO,IAAI7K,OAAO,CAAEC,OAAO,IAAK;AAC9B4vC,QAAAA,sBAAsB,CAAC;AACrBQ,UAAAA,cAAc,EAAEpwC,OAAO;AACvB4K,UAAAA,MAAAA;AACF,SAAC,CAAC,CAAA;AACJ,OAAC,CAAC,CAAA;KACH;AACDuS,IAAAA,YAAY,EAAEA,CAAC1T,KAAK,EAAEyT,SAAS,KAAK;MAClCzS,OAAO,CAAC6F,SAAS,CAAC,MAAM;AACtB6M,QAAAA,YAAY,CAAC1T,KAAK,EAAEyT,SAAS,EAAEnY,aAAa,CAAC,CAAA;AAC/C,OAAC,CAAC,CAAA;KACH;AACDqzB,IAAAA,SAAS,EAAEA,CAACvnB,UAAU,EAAErU,SAAS,KAAK;MACpCiO,OAAO,CAAC6F,SAAS,CAAC,MAAM;AACtB,QAAA,OAAO8nB,SAAS,CAAClzB,IAAI,EAAE2L,UAAU,EAAErU,SAAS,CAAC,CAAA;AAC/C,OAAC,CAAC,CAAA;KACH;IACDogB,WAAW,EAAG/L,UAAU,IAAK;MAC3BpG,OAAO,CAAC6F,SAAS,CAAC,MAAM;AACtB,QAAA,OAAOsM,WAAW,CAAC1X,IAAI,EAAE2L,UAAU,EAAE9L,aAAa,CAAC,CAAA;AACrD,OAAC,CAAC,CAAA;KACH;AACD+6B,IAAAA,UAAU,EAAEA,CAAC;MAAE93B,IAAI;MAAE7K,KAAK;AAAE4iC,MAAAA,KAAAA;AAAM,KAAC,KAAK;MACtCt1B,OAAO,CAAC6F,SAAS,CAAC,MAAM;AACtBpL,QAAAA,IAAI,CAACqxB,QAAQ,CAACC,MAAM,CAClBxuB,IAAI,EACJ7K,KAAK,EACL2tB,0BAAe,CAACiV,KAAK,EAAE3J,kBAAkB,CAC3C,CAAC,CAAA;AAED,QAAA,OAAO,CAAC,CAAGpuB,EAAAA,IAAI,CAAI7K,CAAAA,EAAAA,KAAK,EAAE,CAAC,CAAA;AAC7B,OAAC,CAAC,CAAA;KACH;IACDm6B,cAAc,EAAGzmB,UAAU,IAAK;MAC9BpG,OAAO,CAAC6F,SAAS,CAAC,MAAM;AACtB,QAAA,OAAOgnB,cAAc,CAACpyB,IAAI,EAAE2L,UAAU,EAAEulB,kBAAkB,CAAC,CAAA;AAC7D,OAAC,CAAC,CAAA;KACH;IACDK,UAAU,EAAGC,IAAI,IAAK;AACpBjsB,MAAAA,OAAO,CAAC6F,SAAS,CAAC,MAChBmmB,UAAU,CAAC;QACTC,IAAI;AACJC,QAAAA,KAAK,EAAEpmB,aAAa;QACpBqmB,kBAAkB,EAAE+E,mBAAmB,CAAC;UACtCz2B,IAAI;AACJ9J,UAAAA,OAAO,EAAEg7B,kBAAAA;AACX,SAAC,CAAC;QACFS,YAAY,EAAE2F,YAAY,EAAC;AAC7B,OAAC,CACH,CAAC,CAAA;KACF;IACDlsB,SAAS,EAAGogC,oBAAoB,IAAK;AACnC,MAAA,IAAIC,aAA6B,CAAA;;AAEjC;AACA;AACAzrC,MAAAA,IAAI,CAAC8nB,SAAS,CAAC4W,KAAK,CAAC,MAAM;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;QACA+M,aAAa,GAAGD,oBAAoB,EAAE,IAAI,CAAC,GAAGngC,aAAa,CAAC,CAAA;AAE5DtJ,QAAAA,IAAI,CAAC;UACH2D,MAAM,EAAE1F,IAAI,CAACwE,MAAM;AACnB6G,UAAAA,aAAa,EAAEogC,aAAAA;AACjB,SAAC,CAAC,CAAA;QAEFd,gBAAgB,CAACc,aAAa,CAAC,CAAA;AACjC,OAAC,CAAC,CAAA;KACH;IACDpJ,gBAAgB,EAAEA,MAAM;AACtBhO,MAAAA,QAAQ,CAACx0B,aAAa,CAACG,IAAI,EAAEqL,aAAa,CAAC,CAAA;AAC7C,KAAA;GACD,CAAA;EAED,MAAMilB,aAAa,GAAGA,CAAC;IACrB7qB,IAAI;AACJmpB,IAAAA,QAAAA;GAC6D,GAAG,EAAE,KAAK;AACvE,IAAA,IAAI8c,eAAe,CAAA;AACnB,IAAA,IAAI9c,QAAQ,EAAE;AACZ8c,MAAAA,eAAe,GAAG;AAChB,QAAA,GAAI9c,QAAgC;AACpCoN,QAAAA,aAAa,EAAE,IAAA;OAChB,CAAA;AACH,KAAA;AAEA,IAAA,QAAQv2B,IAAI;AACV,MAAA,KAAK,QAAQ;AAAE,QAAA;AACb,UAAA,IAAIimC,eAAe,EAAE;YACnBL,YAAY,CAAEM,IAAI,IAAK;cACrB,IAAI,CAACA,IAAI,EAAE;gBACT,OAAO,CAACD,eAAe,CAAC,CAAA;AAC1B,eAAA;AAEA,cAAA,OAAO,CAAC,GAAGC,IAAI,EAAED,eAAe,CAAC,CAAA;AACnC,aAAC,CAAC,CAAA;AACJ,WAAA;AACA,UAAA,MAAA;AACF,SAAA;AAEA,MAAA,KAAK,MAAM;AAAE,QAAA;AACX,UAAA,IAAIA,eAAe,EAAE;YACnBL,YAAY,CAAEM,IAAI,IAAK;cACrB,IAAI,CAACA,IAAI,EAAE;gBACT,OAAO,CAACD,eAAe,CAAC,CAAA;AAC1B,eAAA;AAEA,cAAA,MAAME,aAAa,GAAGD,IAAI,CAAC5H,SAAS,CACjCzmB,CAAC,IAAKA,CAAC,CAACriB,EAAE,KAAKywC,eAAe,CAACzwC,EAClC,CAAC,CAAA;AAED,cAAA,IAAI2wC,aAAa,KAAK,CAAC,CAAC,EAAE;AACxB,gBAAA,OAAOD,IAAI,CAAA;AACb,eAAA;AAEA,cAAA,MAAME,YAAY,GAAG,CAAC,GAAGF,IAAI,CAAC,CAAA;AAC9BE,cAAAA,YAAY,CAACD,aAAa,CAAC,GAAGF,eAAe,CAAA;AAE7C,cAAA,OAAOG,YAAY,CAAA;AACrB,aAAC,CAAC,CAAA;AACJ,WAAA;AACA,UAAA,MAAA;AACF,SAAA;AAEA,MAAA,KAAK,QAAQ;AAAE,QAAA;AACb,UAAA,IAAIH,eAAe,EAAE;YACnBL,YAAY,CAAEM,IAAI,IAAK;cACrB,IAAI,CAACA,IAAI,EAAE;AACT,gBAAA,OAAO,EAAE,CAAA;AACX,eAAA;AAEA,cAAA,MAAMC,aAAa,GAAGD,IAAI,CAAC5H,SAAS,CACjCzmB,CAAC,IAAKA,CAAC,CAACriB,EAAE,KAAKywC,eAAe,CAACzwC,EAClC,CAAC,CAAA;AAED,cAAA,IAAI2wC,aAAa,KAAK,CAAC,CAAC,EAAE;AACxB,gBAAA,OAAOD,IAAI,CAAA;AACb,eAAA;AAEA,cAAA,MAAME,YAAY,GAAG,CAAC,GAAGF,IAAI,CAAC,CAAA;AAC9BE,cAAAA,YAAY,CAACtW,MAAM,CAACqW,aAAa,EAAE,CAAC,CAAC,CAAA;AAErC,cAAA,OAAOC,YAAY,CAAA;AACrB,aAAC,CAAC,CAAA;AACJ,WAAA;AACA,UAAA,MAAA;AACF,SAAA;AAEA,MAAA;AAAS,QAAA;AACP3P,UAAAA,YAAY,CAACr8B,aAAa,EAAGsE,KAAK,CAACuB,MAAM,CAACipB,SAAS,IAAY,EAAE,CAAC,CAAC5W,IAAI,CACpE8zB,YAAY,IAAK;YAChBR,YAAY,CAACQ,YAAY,CAAC,CAAA;AAC5B,WACF,CAAC,CAAA;AACD,UAAA,MAAA;AACF,SAAA;AACF,KAAA;GACD,CAAA;AAEDpuC,EAAAA,eAAS,CAAC,MAAM;IACd+sC,UAAU,CAACrwC,OAAO,GAAGgrC,aAAa,CAAA;AACpC,GAAC,EAAE,CAACA,aAAa,CAAC,CAAC,CAAA;AAEnB1nC,EAAAA,eAAS,CAAC,MAAM;AACd6yB,IAAAA,aAAa,EAAE,CAAA;AACjB,GAAC,EAAE,CAACnsB,KAAK,CAACuB,MAAM,CAACkoB,UAAU,EAAEzpB,KAAK,CAACuB,MAAM,CAACipB,SAAS,CAAC,CAAC,CAAA;EAErD,MAAMmd,WAAuC,GAAGpyC,MAAM,CAACiY,WAAW,CAChEjY,MAAM,CAACkY,OAAO,CAACsf,kBAAkB,CAACvkB,KAAK,CAAC,CAAC5V,GAAG,CAC1C,CAAC,CAACg1C,QAAQ,EAAEC,cAAc,CAAC,KAAK;IAC9B,OAAO,CACLD,QAAQ,EACR;AACE,MAAA,GAAGC,cAAc;AACjB,MAAA,IAAIA,cAAc,CAACrjC,IAAI,KAAK,UAAU,GAClC;QACAuG,OAAO,EAAE88B,cAAc,CAAC98B,OAAO,CAACnY,GAAG,CAAEqY,CAAC,IAAK;UACzC,OAAO;AACL,YAAA,GAAGA,CAAC;AACJ1D,YAAAA,SAAS,EAAEvH,KAAK,CAAC+K,OAAO,GAAGE,CAAC,CAACnU,EAAE,CAAA;WAChC,CAAA;SACF,CAAA;AACH,OAAC,GACC+wC,cAAc,CAAC18B,MAAM,GACnB;AACAA,QAAAA,MAAM,EAAE;UACN,GAAG08B,cAAc,CAAC18B,MAAM;UACxB5D,SAAS,EAAEvH,KAAK,CAAC+K,OAAO,GAAG88B,cAAc,CAAC18B,MAAM,CAACrU,EAAE,CAAA;AACrD,SAAA;OACD,GACC,EAAE,CAAA;AACV,KAAC,CACF,CAAA;AACH,GACF,CACF,CAAC,CAAA;AAED,EAAA,MAAM4E,aAAgC,GAAG;AACvC,IAAA,GAAGqxB,kBAAkB;AACrB7B,IAAAA,OAAO,EAAElrB,KAAK,CAACuB,MAAM,CAAC2pB,OAAO;AAC7B1iB,IAAAA,KAAK,EAAEm/B,WAAW;IAClBxnC,WAAW;IACXqqB,SAAS;IACT2B,aAAa;IACbhjB,eAAe;IACfjC,aAAa;IACbrL,IAAI;AACJ2qC,IAAAA,gBAAgB,EAAEC,sBAAsB;IACxC3f,SAAS;IACT1lB,OAAO;IACPk4B,IAAI,EAAE,MAAOwO,YAAY,IAAK;MAC5BpuC,MAAM,CAAC4mB,WAAW,CAAC;AACjB9b,QAAAA,IAAI,EAAE,2BAA2B;AACjCjL,QAAAA,QAAQ,EAAEuuC,YAAAA;AACZ,OAAC,CAAC,CAAA;KACH;IACDxkB,gBAAgB,EAAEA,gBAAgB,CAACttB,OAAO;IAC1C+K,QAAQ,EAAEf,KAAK,CAACe,QAAQ;AACxBC,IAAAA,sBAAsB,EAAEhB,KAAK,CAACuB,MAAM,CAACP,sBAAsB,IAAI,KAAK;IACpE6V,aAAa,EAAE7a,sCAA2B,CACxCwmC,YAAY,CAACpkC,UAAU,EACvB2uB,kBACF,CAAE;AACFtD,IAAAA,UAAU,EAAEzpB,KAAK,CAACypB,UAAU,IAAI,EAAC;GAClC,CAAA;EAED,MAAM;IAAEziB,eAAe;IAAEw9B,iBAAiB;AAAE/nB,IAAAA,IAAAA;AAAK,GAAC,GAAGomB,eAAe,CAClEnnC,aAAa,EACbsE,KAAK,CAACuB,MAAM,EACZ0lC,YAAY,EACZnvC,YAAY,EACZkI,KAAK,CAAC+iC,oBACR,CAAC,CAAA;EAEDrnC,aAAa,CAAC0B,uBAAuB,GAAGonC,iBAAiB,CAAA;EACzD9oC,aAAa,CAACsL,eAAe,GAAGA,eAAe,CAAA;AAE/C9I,EAAAA,OAAO,CAACu+B,KAAK,CAAC,eAAe,EAAEwK,YAAY,CAAC,CAAA;AAC5C/oC,EAAAA,OAAO,CAACu+B,KAAK,CAAC,eAAe,EAAEv1B,aAAa,CAAC,CAAA;AAC7ChJ,EAAAA,OAAO,CAACu+B,KAAK,CAAC,MAAM,EAAEhgB,IAAI,CAAC,CAAA;AAC3Bve,EAAAA,OAAO,CAACu+B,KAAK,CAAC,iBAAiB,EAAE;IAC/Bz1B,eAAe;AACfw9B,IAAAA,iBAAAA;AACF,GAAC,CAAC,CAAA;AACFtmC,EAAAA,OAAO,CAACu+B,KAAK,CAAC,eAAe,EAAE3kC,YAAY,CAAC,CAAA;EAE5C4B,MAAM,CAACquC,eAAe,GAAGruC,MAAM,CAACquC,eAAe,IAAI,EAAE,CAAA;AACrDruC,EAAAA,MAAM,CAACquC,eAAe,CAACrsC,aAAa,GAAGA,aAAa,CAAA;AACpDhC,EAAAA,MAAM,CAACquC,eAAe,CAACtrB,IAAI,GAAGA,IAAI,CAAA;AAClC/iB,EAAAA,MAAM,CAACquC,eAAe,CAACC,QAAQ,GAC7BxD,iBAAyD,CAAA;AAC3D9qC,EAAAA,MAAM,CAACquC,eAAe,CAACjwC,YAAY,GAAGA,YAAY,CAAA;AAElD,EAAA,MAAMmvB,cAAc,GAAG,MAAOghB,WAAmB,IAAK;AACpD3kB,IAAAA,gBAAgB,CAACttB,OAAO,CAAC6wC,KAAK,EAAE,CAAA;AAChC9Z,IAAAA,kBAAkB,CAACzgB,aAAa,CAACC,MAAM,GAAG07B,WAAW,CAAA;IACrD7B,gBAAgB,CAAC6B,WAAW,CAAC,CAAA;AAC7B3kB,IAAAA,gBAAgB,CAACttB,OAAO,CAAC6wC,KAAK,EAAE,CAAA;AAChCV,IAAAA,UAAU,CAAEqB,IAAI,IAAK,CAACA,IAAI,CAAC,CAAA;IAE3B,MAAMhxC,KAAK,CAAC,CAAC,CAAC,CAAA;AAEd8sB,IAAAA,gBAAgB,CAACttB,OAAO,CAAC6wC,KAAK,EAAE,CAAA;AAChCV,IAAAA,UAAU,CAAEqB,IAAI,IAAK,CAACA,IAAI,CAAC,CAAA;GAC5B,CAAA;AAEDluC,EAAAA,eAAS,CAAC,MAAM;AACdsE,IAAAA,IAAI,CAAC;AACH2D,MAAAA,MAAM,EAAEihC,YAAY;AACpBt7B,MAAAA,aAAa,EAAE,EAAA;AACjB,KAAC,CAAC,CAAA;GACH,EAAE,EAAE,CAAC,CAAA;AAEN5N,EAAAA,eAAS,CAAC,MAAM;AACd,IAAA,IAAII,MAAM,CAACquC,eAAe,EAAEG,QAAQ,EAAE;AACpCxuC,MAAAA,MAAM,CAACquC,eAAe,CAACG,QAAQ,EAAE,CAAA;AACnC,KAAA;AACF,GAAC,EAAE,CACD1D,iBAAiB,EACjBt9B,aAAa,EACb4f,SAAS,EACT+e,eAAe,EACf/tC,YAAY,CACb,CAAC,CAAA;AAEFwB,EAAAA,eAAS,CAAC,MAAM;IACd,SAAS6uC,kBAAkBA,CACzBtvC,KAAsE,EACtE;AACA,MAAA,IAAIA,KAAK,CAACs9B,IAAI,CAAC3xB,IAAI,KAAK,4CAA4C,EAAE;QACpEpD,OAAO,CACJqR,mBAAmB,CAAC;AAAE/f,UAAAA,IAAI,EAAEmG,KAAK,CAACs9B,IAAI,CAACE,OAAO,CAAC3jC,IAAAA;AAAK,SAAC,CAAC,CACtDkhB,IAAI,CAAErS,MAAM,IAAK;UAChB,MAAM6mC,qBAAqB,GAAG1uC,MAAM,CAACH,QAAQ,CAACib,cAAc,CAC1D,kBACF,CAAkC,CAAA;UAElC4zB,qBAAqB,EAAE3uC,aAAa,EAAE6mB,WAAW,CAC/C+nB,gCAAqB,CAAC9mC,MAAM,CAC9B,CAAC,CAAA;AACH,SAAC,CAAC,CAAA;AACN,OAAA;AAEA,MAAA,IAAI1I,KAAK,CAACs9B,IAAI,CAAC3xB,IAAI,KAAK,kCAAkC,EAAE;QAC1DpD,OAAO,CAACq1B,UAAU,CAAC59B,KAAK,CAACs9B,IAAI,CAACE,OAAO,CAAC,CAAA;AACxC,OAAA;AAEA,MAAA,IAAIx9B,KAAK,CAACs9B,IAAI,CAAC3xB,IAAI,KAAK,+BAA+B,EAAE;QACvD,MAAM;UAAE8jC,QAAQ;UAAEC,MAAM;AAAE1iC,UAAAA,SAAAA;AAAU,SAAC,GAAGhN,KAAK,CAACs9B,IAAI,CAACE,OAAO,CAAA;QAE1D,MAAMmS,mBAAmB,GAAG5sC,oBAAS,CAAC0sC,QAAQ,EAAE5sC,aAAa,CAACG,IAAI,CAAC,CAAA;QACnE,MAAM4sC,iBAAiB,GAAG7sC,oBAAS,CAAC2sC,MAAM,EAAE7sC,aAAa,CAACG,IAAI,CAAC,CAAA;AAE/D,QAAA,IACE,CAAC2sC,mBAAmB,CAAC1sC,MAAM,IAC3B,CAAC2sC,iBAAiB,CAAC3sC,MAAM,IACzB0sC,mBAAmB,CAAC10C,KAAK,KAAKyD,SAAS,IACvCkxC,iBAAiB,KAAKlxC,SAAS,EAC/B;AACA,UAAA,OAAA;AACF,SAAA;QAEA,IAAIixC,mBAAmB,CAAC1sC,MAAM,CAACpJ,IAAI,KAAK+1C,iBAAiB,CAAC3sC,MAAM,CAACpJ,IAAI,EAAE;UACrE,MAAMg2C,UAAU,GAAG,CAAA,EAAGF,mBAAmB,CAAC1sC,MAAM,CAACpJ,IAAI,GACjD81C,mBAAmB,CAAC1sC,MAAM,CAACpJ,IAAI,GAAG,GAAG,GACrC,EAAE,CAAA,EACD81C,mBAAmB,CAAC1sC,MAAM,CAACQ,SAAS,CAAE,CAAA,CAAA;UAE3C8E,OAAO,CAAC6F,SAAS,CAAC,MAAM;AACtBpL,YAAAA,IAAI,CAACqxB,QAAQ,CAAC4B,IAAI,CAChB4Z,UAAU,EACVF,mBAAmB,CAAC10C,KAAK,EACzB20C,iBAAiB,CAAC30C,KACpB,CAAC,CAAA;YAED,OAAO,CAACy0C,MAAM,CAAC,CAAA;AACjB,WAAC,CAAC,CAAA;AACJ,SAAC,MAAM;AACL;AACA,UAAA,MAAMI,mBAAmB,GAAGF,iBAAiB,CAACnsC,SAAS,KAAK/E,SAAS,CAAA;AAErE,UAAA,MAAMqxC,aAAa,GAAG,CAAA,EAAGH,iBAAiB,CAAC3sC,MAAM,CAACpJ,IAAI,KAAK,EAAE,GACzD,EAAE,GACF+1C,iBAAiB,CAAC3sC,MAAM,CAACpJ,IAAI,GAAG,GAAG,CAClC+1C,EAAAA,iBAAiB,CAAC3sC,MAAM,CAACQ,SAAS,CAAGqsC,EAAAA,mBAAmB,GACvD,CAAIF,CAAAA,EAAAA,iBAAiB,CAAC30C,KAAK,IAAI20C,iBAAiB,CAACnsC,SAAS,CAAE,CAAA,GAC5D,EAAE,CACJ,CAAA,CAAA;UAEJ8E,OAAO,CAAC6F,SAAS,CAAC,MAAM;AACtB,YAAA,MAAM4M,SAAS,GAAG4N,0BAAe,CAC/BxrB,cAAc,CAAC4F,IAAI,CAACwE,MAAM,EAAEioC,QAAQ,CAAC,EACrC5sC,aACF,CAAC,CAAA;YAED,MAAMmtC,cAAc,GAAGC,uBAAuB,CAC5CR,QAAQ,EACRC,MAAM,EACN1iC,SAAS,EACThK,IACF,CAAC,CAAA;YAEDA,IAAI,CAACqxB,QAAQ,CAACC,MAAM,CAACyb,aAAa,EAAEC,cAAc,EAAEh1B,SAAS,CAAC,CAAA;AAE9DzS,YAAAA,OAAO,CAACmS,WAAW,CAAC,CAAC+0B,QAAQ,CAAC,CAAC,CAAA;AAE/B,YAAA,OAAO,CACLK,mBAAmB,GACf,CAAA,EAAGC,aAAa,CAAA,EAAA,CAAI,GACpB,CAAA,EAAGA,aAAa,CAAA,CAAA,EAAIC,cAAc,CAAA,CAAE,CACzC,CAAA;AACH,WAAC,CAAC,CAAA;AACJ,SAAA;AACF,OAAA;AACF,KAAA;AAEAnvC,IAAAA,MAAM,CAACE,gBAAgB,CAAC,SAAS,EAAEuuC,kBAAkB,CAAC,CAAA;IAEtD,OAAO,MAAMzuC,MAAM,CAACG,mBAAmB,CAAC,SAAS,EAAEsuC,kBAAkB,CAAC,CAAA;GACvE,EAAE,EAAE,CAAC,CAAA;EAEN,MAAM,CAACY,sBAAsB,EAAEC,uBAAuB,CAAC,GAAGnzC,cAAQ,CAAC,KAAK,CAAC,CAAA;EAEzE8nC,gCAAgC,CAACjiC,aAAa,CAAC,CAAA;EAE/C,MAAM;AAAE8hC,IAAAA,OAAAA;AAAQ,GAAC,GAAG5B,YAAY,CAC9BC,eAAe,EACfngC,aACF,CAAC,CAAA;EAED,MAAMutC,SAAS,GAAGrD,UAAU,KAAK,UAAU,GAAG,OAAO,GAAG,MAAM,CAAA;AAE9DtsC,EAAAA,eAAS,CAAC,MAAM;AACdqyB,IAAAA,yBAAK,CAACud,aAAa,CAAC,gBAAgB,CAAC,CAAA;GACtC,EAAE,EAAE,CAAC,CAAA;EAEN,MAAMC,kBAAkB,GAAGA,CAAC;IAC1BnC,cAAc;IACd9/B,aAAa;AACbrL,IAAAA,IAAAA;AAKF,GAAC,KAAK;AAEJ,IAAA,oBACEjK,yBAAA,CAAAmG,aAAA,CAACqpC,gBAAgB,EAAA;AAAC3mC,MAAAA,GAAG,EAAEusC,cAAAA;AAAe,KAAA,eACpCp1C,yBAAA,CAAAmG,aAAA,CAAC2tB,aAAa,EAAA;AAACxe,MAAAA,aAAa,EAAEA,aAAc;AAACrL,MAAAA,IAAI,EAAEA,IAAAA;AAAK,KAAE,CAC1C,CAAC,CAAA;GAEtB,CAAA;AACD,EAAA,MAAMutC,sBAAsB,gBAAGx3C,yBAAK,CAACuwC,IAAI,CAACgH,kBAAkB,CAAC,CAAA;EAE7D,oBACEv3C,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AAAKjB,IAAAA,EAAE,EAAE,eAAgB;AAACkE,IAAAA,KAAK,EAAE;AAAEd,MAAAA,MAAM,EAAE+uC,SAAS;AAAE/+B,MAAAA,QAAQ,EAAE,QAAA;AAAS,KAAA;AAAE,GAAA,EACxE6+B,sBAAsB,iBACrBn3C,yBAAA,CAAAmG,aAAA,CAACupC,aAAa,EACZ1vC,IAAAA,eAAAA,yBAAA,CAAAmG,aAAA,CAACwpC,gBAAgB,MAAmB,CAAC,eAErC3vC,yBAAA,CAAAmG,aAAA,CAACypC,cAAc,EAAA,IAAA,EAAC,gDAEA,CACH,CAChB,eACD5vC,yBAAA,CAAAmG,aAAA,CAACpG,aAAa,CAACqG,QAAQ,EAAA;AAAC7C,IAAAA,KAAK,EAAEuG,aAAAA;AAAc,GAAA,eAC3C9J,yBAAA,CAAAmG,aAAA,CAACP,sBAAsB,CAACQ,QAAQ,EAAA;AAAC7C,IAAAA,KAAK,EAAE6R,eAAAA;AAAgB,GAAA,eACtDpV,yBAAA,CAAAmG,aAAA,CAACH,0BAA0B,EAAA;AAACE,IAAAA,YAAY,EAAEA,YAAAA;GACxClG,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AAAKjB,IAAAA,EAAE,EAAC,eAAA;AAAe,GAAE,CAAC,eAC1BlF,yBAAA,CAAAmG,aAAA,CAAC0uB,YAAY,EAAA;AACXM,IAAAA,MAAM,EAAEwZ,IAAK;AACbvZ,IAAAA,MAAM,EAAEyZ,IAAK;AACb/Z,IAAAA,cAAc,EAAE8W,OAAQ;IACxB5nB,OAAO,EAAEA,MAAM;MACbozB,uBAAuB,CAAC,IAAI,CAAC,CAAA;AAC7BxL,MAAAA,OAAO,EAAE,CAACnR,OAAO,CAAC,MAAM;QACtB2c,uBAAuB,CAAC,KAAK,CAAC,CAAA;QAE9BtvC,MAAM,CAAC4mB,WAAW,CAChB;AACE9b,UAAAA,IAAI,EAAE,oBAAA;SACP,EACD,GACF,CAAC,CAAA;QAED,IAAIxE,KAAK,CAAC4V,OAAO,EAAE;UACjB5V,KAAK,CAAC4V,OAAO,EAAE,CAAA;AACjB,SAAA;AACF,OAAC,CAAC,CAAA;KACF;IACFxM,OAAO,EAAE2jB,kBAAkB,CAAC3jB,OAAQ;AACpCwd,IAAAA,QAAQ,EAAEif,eAAgB;AAC1Blf,IAAAA,gBAAgB,EAAEmf,kBAAmB;AACrCjf,IAAAA,iBAAiB,EAAE+f,gBAAiB;AACpC9f,IAAAA,SAAS,EAAE6f,UAAW;AACtB0C,IAAAA,SAAS,EAAC,MAAM;AAChB98B,IAAAA,MAAM,EAAEy0B,aAAc;IACtBx0B,OAAO,EAAE9Q,aAAa,CAAC8Q,OAAQ;AAC/Bya,IAAAA,cAAc,EAAEA,cAAe;AAC/BC,IAAAA,eAAe,EAAElnB,KAAK,CAACuB,MAAM,CAAC2lB,eAAe,IAAI,KAAM;IACvDnmB,QAAQ,EAAErF,aAAa,CAACqF,QAAAA;AAAS,GAClC,CAAC,eACFnP,yBAAA,CAAAmG,aAAA,CAACopC,0BAA0B,EAAA;AAACjnC,IAAAA,MAAM,EAAE+uC,SAAAA;AAAU,GAAA,eAC5Cr3C,yBAAA,CAAAmG,aAAA,CAACmpC,gBAAgB,EAAA;IACf//B,OAAO,EAAEA,MAAM;MACbqlC,gBAAgB,CAAC,EAAE,CAAC,CAAA;AACtB,KAAA;AAAE,GAAA,eAEF50C,yBAAA,CAAAmG,aAAA,CAAC+B,YAAY,EAAA;AACXE,IAAAA,mBAAmB,EAAEumC,IAAK;AAC1BxmC,IAAAA,mBAAmB,EAAE0mC,IAAK;IAC1BxmC,KAAK,EAAEorC,UAAU,CAACprC,KAAM;IACxBC,MAAM,EAAEmrC,UAAU,CAACnrC,MAAO;IAC1BC,SAAS,EAAEkrC,UAAU,CAAClrC,SAAU;AAChCC,IAAAA,YAAY,EAAE2rC,kBAAAA;GACf,CAAC,EACDY,UAAU,iBACT/0C,yBAAA,CAAAmG,aAAA,CAAC89B,cAAc,EAAA;IACb57B,KAAK,EAAEorC,UAAU,CAACprC,KAAM;IACxBC,MAAM,EAAEmrC,UAAU,CAACnrC,MAAO;IAC1BC,SAAS,EAAEkrC,UAAU,CAAClrC,SAAAA;GACvB,CAEa,CAAC,EAClBwsC,UAAU,iBACT/0C,yBAAA,CAAAmG,aAAA,CAACqxC,sBAAsB,EAAA;AACrBpC,IAAAA,cAAc,EAAEA,cAAe;AAC/B9/B,IAAAA,aAAa,EAAEA,aAAc;AAC7BrL,IAAAA,IAAI,EAAEA,IAAAA;GACP,CAAA;AACD;AACA;AACA;AACD,IACAyqC,mBAAmB,iBAClB10C,yBAAA,CAAAmG,aAAA,CAACoyB,WAAW,EAAA;AACVvU,IAAAA,OAAO,EAAEkxB,yBAA0B;IACnCvlC,MAAM,EAAE+kC,mBAAmB,CAAC/kC,MAAO;IACnC6oB,OAAO,EAAEpqB,KAAK,CAACoqB,OAAAA;GAChB,CAEuB,CAAC,EAE5B+c,uBAAuB,iBACtBv1C,yBAAA,CAAAmG,aAAA,CAACgzB,aAAa,EAAA;AACZE,IAAAA,MAAM,EAAEkc,uBAAwB;IAChCvxB,OAAO,EAAEA,MAAM;MACbwxB,0BAA0B,CAAC7vC,SAAS,CAAC,CAAA;KACrC;IACF2zB,OAAO,EAAExvB,aAAa,CAACwvB,OAAAA;AAAQ,GAChC,CAEuB,CACG,CACX,CACrB,CAAC,CAAA;AAEV,CAAC,CAAA;AAED,SAASuX,iBAAiBA,CACxBlhC,MAA4B,EAC5BwrB,kBAA0C,EAC1C;AACA,EAAA,MAAMuc,oBAAoB,GAAG3N,mBAAmB,CAACp6B,MAAM,EAAEwrB,kBAAkB,CAAC,CAAA;AAC5E,EAAA,MAAMwc,UAAU,GAAG78B,wBAAS,CAAC48B,oBAAoB,EAAEvc,kBAAkB,CAAC,CAAA;AACtE,EAAA,OAAOwc,UAAU,CAAA;AACnB,CAAA;AAEA,SAAST,uBAAuBA,CAC9BR,QAAgB,EAChBC,MAAc,EACd1iC,SAAyC,EACzChK,IAAU,EACV;AACA,EAAA,MAAM2tC,cAAc,GAAGC,oBAAoB,CAACnB,QAAQ,EAAEC,MAAM,CAAC,CAAA;EAC7D,MAAMmB,yBAAyB,GAAG9tC,oBAAS,CAAC4tC,cAAc,IAAI,EAAE,EAAE3tC,IAAI,CAAC,CAAA;AACvE,EAAA,MAAM4sC,iBAAiB,GAAG7sC,oBAAS,CAAC2sC,MAAM,EAAE1sC,IAAI,CAAC,CAAA;EACjD,MAAM8tC,iBAAiB,GAAG1zC,cAAc,CAAC4F,IAAI,CAACwE,MAAM,EAAEkoC,MAAM,CAAC,CAAA;AAE7D,EAAA,IAAIoB,iBAAiB,CAACv3C,MAAM,KAAK,CAAC,EAAE;AAClC,IAAA,OAAO,CAAC,CAAA;AACV,GAAA;;AAEA;AACA,EAAA,IAAIs3C,yBAAyB,CAAC51C,KAAK,KAAKyD,SAAS,EAAE;IACjD,MAAMqyC,wBAAwB,GAAG,CAACtB,QAAQ,CAAC31C,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAA;IACxD,MAAMk3C,sBAAsB,GAAG,CAACtB,MAAM,CAAC51C,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAA;IAEpD,IAAIi3C,wBAAwB,GAAGC,sBAAsB,EAAE;AACrD,MAAA,IAAIhkC,SAAS,EAAE;QACb,IAAIA,SAAS,KAAK,QAAQ,EAAE;UAC1B,OAAO4iC,iBAAiB,CAAC30C,KAAK,CAAA;AAChC,SAAA;AAEA,QAAA,OAAO20C,iBAAiB,CAAC30C,KAAK,GAAI,CAAC,CAAA;AACrC,OAAA;MAEA,OAAO20C,iBAAiB,CAAC30C,KAAK,CAAA;AAChC,KAAA;AAEA,IAAA,IAAI+R,SAAS,EAAE;MACb,IAAIA,SAAS,KAAK,QAAQ,EAAE;QAC1B,OAAO4iC,iBAAiB,CAAC30C,KAAK,CAAA;AAChC,OAAA;AAEA,MAAA,OAAO20C,iBAAiB,CAAC30C,KAAK,GAAI,CAAC,CAAA;AACrC,KAAA;AAEA,IAAA,OAAO20C,iBAAiB,CAAC30C,KAAK,GAAI,CAAC,CAAA;AACrC,GAAA;AAEA,EAAA,OAAO20C,iBAAiB,CAAC30C,KAAK,GAAI,CAAC,CAAA;AACrC,CAAA;AAEA,SAAS21C,oBAAoBA,CAACK,KAAa,EAAEC,KAAa,EAAE;AAC1D,EAAA,MAAMC,aAAa,GAAGF,KAAK,CAACn3C,KAAK,CAAC,GAAG,CAAC,CAAA;AACtC,EAAA,MAAMs3C,WAAW,GAAGF,KAAK,CAACp3C,KAAK,CAAC,GAAG,CAAC,CAAA;EAEpC,IAAIu3C,mBAA8C,GAAG3yC,SAAS,CAAA;EAE9D,KAAK,IAAIjD,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGV,IAAI,CAACC,GAAG,CAACm2C,aAAa,CAAC53C,MAAM,EAAE63C,WAAW,CAAC73C,MAAM,CAAC,EAAEkC,CAAC,EAAE,EAAE;AAC3E,IAAA,MAAM61C,mBAAmB,GAAGH,aAAa,CAAC11C,CAAC,CAAC,CAAA;AAC5C,IAAA,MAAM81C,iBAAiB,GAAGH,WAAW,CAAC31C,CAAC,CAAC,CAAA;IAExC,IAAI61C,mBAAmB,KAAKC,iBAAiB,EAAE;AAC7C,MAAA,MAAA;AACF,KAAA;IAEA,IAAI,CAACF,mBAAmB,EAAE;MACxBA,mBAAmB,GAAG,CAACC,mBAAmB,CAAC,CAAA;AAC3C,MAAA,SAAA;AACF,KAAA;AAEAD,IAAAA,mBAAmB,CAACtsC,IAAI,CAACusC,mBAAmB,CAAC,CAAA;AAC/C,GAAA;AAEA,EAAA,OAAOD,mBAAmB,EAAEvhC,IAAI,CAAC,GAAG,CAAC,CAAA;AACvC,CAAA;AAEA,SAAS07B,cAAcA,CACrB9iC,MAA4B,EAC5BxP,OAA+B,EAC/BimB,QAAgB,EACkB;AAClC,EAAA,IAAIqyB,WAA6C,CAAA;AAEjDnnB,EAAAA,6BAAkB,CAAC3hB,MAAM,EAAExP,OAAO,EAAE,CAAC;AAAEoxB,IAAAA,eAAAA;AAAgB,GAAC,KAAK;AAC3D,IAAA,IAAIknB,WAAW,EAAE;AACf,MAAA,OAAA;AACF,KAAA;AAEA,IAAA,IAAIlnB,eAAe,CAACliB,GAAG,KAAK+W,QAAQ,EAAE;AACpCqyB,MAAAA,WAAW,GAAGlnB,eAAe,CAAA;AAC/B,KAAA;AACF,GAAC,CAAC,CAAA;AAEF,EAAA,OAAOknB,WAAW,CAAA;AACpB,CAAA;AAEA,SAASvF,iBAAiBA,CAAC17B,OAA2B,EAAEnP,KAAa,EAAE;AACrE,EAAA,MAAMqwC,aAAa,GAAGlhC,OAAO,CAAChN,IAAI,CAAEusB,CAAC,IAAKA,CAAC,CAACwc,UAAU,KAAK,IAAI,CAAC,CAAA;AAEhE,EAAA,MAAMoF,cAAc,GAAGnhC,OAAO,CAACrW,MAAM,CAClC41B,CAAC,IAAK,CAACA,CAAC,CAAC3qB,MAAM,IAAI2qB,CAAC,CAACwc,UAAU,KAAK,IACvC,CAAC,CAAA;AAED,EAAA,KAAK,IAAI7wC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGi2C,cAAc,CAACn4C,MAAM,EAAEkC,CAAC,EAAE,EAAE;AAC9C,IAAA,MAAMk2C,aAAa,GAAGD,cAAc,CAACj2C,CAAC,CAAC,CAAA;AAEvC,IAAA,IAAIk2C,aAAa,CAACrF,UAAU,GAAIlrC,KAAK,EAAE;AACrC,MAAA,OAAOuwC,aAAa,CAAA;AACtB,KAAA;AACF,GAAA;AAEA,EAAA,IAAIF,aAAa,EAAE;AACjB,IAAA,OAAOA,aAAa,CAAA;AACtB,GAAA;AAEA,EAAA,OAAO,IAAI,CAAA;AACb;;ACh1CA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,MAAMG,QAAQ,GAAIpiC,KAAa,IAAKA,KAAK,IAAI,OAAOA,KAAK,KAAK,QAAQ,CAAA;AACtE;AACA,MAAMqiC,cAAc,GAAG,CACrB,WAAW,EACX,cAAc,EACd,MAAM,EACN,YAAY,EACZ,OAAO,EACP,OAAO,EACP,QAAQ,EACR,OAAO,EACP,gBAAgB,EAChB,MAAM,EACN,YAAY,EACZ,OAAO,EACP,WAAW,EACX,WAAW,EACX,YAAY,EACZ,WAAW,EACX,OAAO,EACP,gBAAgB,EAChB,UAAU,EACV,SAAS,EACT,MAAM,EACN,UAAU,EACV,UAAU,EACV,eAAe,EACf,UAAU,EACV,WAAW,EACX,WAAW,EACX,aAAa,EACb,gBAAgB,EAChB,YAAY,EACZ,YAAY,EACZ,SAAS,EACT,YAAY,EACZ,cAAc,EACd,eAAe,EACf,eAAe,EACf,eAAe,EACf,YAAY,EACZ,UAAU,EACV,aAAa,EACb,SAAS,EACT,YAAY,EACZ,WAAW,EACX,aAAa,EACb,aAAa,EACb,SAAS,EACT,WAAW,EACX,YAAY,EACZ,MAAM,EACN,WAAW,EACX,MAAM,EACN,OAAO,EACP,aAAa,EACb,UAAU,EACV,SAAS,EACT,WAAW,EACX,QAAQ,EACR,OAAO,EACP,OAAO,EACP,UAAU,EACV,eAAe,EACf,WAAW,EACX,cAAc,EACd,WAAW,EACX,YAAY,EACZ,WAAW,EACX,sBAAsB,EACtB,WAAW,EACX,YAAY,EACZ,WAAW,EACX,aAAa,EACb,aAAa,EACb,eAAe,EACf,cAAc,EACd,gBAAgB,EAChB,gBAAgB,EAChB,aAAa,EACb,MAAM,EACN,WAAW,EACX,OAAO,EACP,SAAS,EACT,QAAQ,EACR,kBAAkB,EAClB,YAAY,EACZ,cAAc,EACd,cAAc,EACd,gBAAgB,EAChB,iBAAiB,EACjB,iBAAiB,EACjB,mBAAmB,EACnB,iBAAiB,EACjB,iBAAiB,EACjB,cAAc,EACd,WAAW,EACX,WAAW,EACX,UAAU,EACV,aAAa,EACb,MAAM,EACN,SAAS,EACT,OAAO,EACP,WAAW,EACX,QAAQ,EACR,WAAW,EACX,QAAQ,EACR,eAAe,EACf,WAAW,EACX,eAAe,EACf,eAAe,EACf,YAAY,EACZ,WAAW,EACX,MAAM,EACN,MAAM,EACN,MAAM,EACN,YAAY,EACZ,QAAQ,EACR,eAAe,EACf,KAAK,EACL,WAAW,EACX,WAAW,EACX,aAAa,EACb,QAAQ,EACR,YAAY,EACZ,UAAU,EACV,UAAU,EACV,QAAQ,EACR,QAAQ,EACR,SAAS,EACT,WAAW,EACX,WAAW,EACX,MAAM,EACN,aAAa,EACb,WAAW,EACX,KAAK,EACL,MAAM,EACN,SAAS,EACT,QAAQ,EACR,WAAW,EACX,QAAQ,EACR,OAAO,EACP,OAAO,EACP,YAAY,EACZ,QAAQ,EACR,aAAa,CACd,CAAA;AACD;AACA,MAAMC,qBAAqB,GAAG,CAAC,cAAc,EAAE,SAAS,EAAE,aAAa,CAAC,CAAA;;AAExE;AACO,MAAMC,qBAAqB,GAAIviC,KAAa,IAAc;EAC/D,IAAIwiC,MAAM,GAAG,KAAK,CAAA;AAClB,EAAA,IAAIJ,QAAQ,CAACpiC,KAAK,CAAC,EAAE;AACnBqiC,IAAAA,cAAc,CAAC93C,GAAG,CAAEoE,CAAC,IAAK;MACxB,IAAIqR,KAAK,CAACmV,WAAW,EAAE,KAAKxmB,CAAC,CAACwmB,WAAW,EAAE,EAAE;AAC3CqtB,QAAAA,MAAM,GAAG,IAAI,CAAA;AACf,OAAA;AACA,MAAA,OAAO,IAAI,CAAA;AACb,KAAC,CAAC,CAAA;AACJ,GAAA;AACA,EAAA,OAAOA,MAAM,CAAA;AACf,CAAC,CAAA;;AAED;AACO,MAAMC,4BAA4B,GAAIziC,KAAa,IAAc;EACtE,IAAIwiC,MAAM,GAAG,KAAK,CAAA;AAClB,EAAA,IAAIJ,QAAQ,CAACpiC,KAAK,CAAC,EAAE;AACnBsiC,IAAAA,qBAAqB,CAAC/3C,GAAG,CAAEoE,CAAC,IAAK;MAC/B,IAAIqR,KAAK,CAACmV,WAAW,EAAE,KAAKxmB,CAAC,CAACwmB,WAAW,EAAE,EAAE;AAC3CqtB,QAAAA,MAAM,GAAG,IAAI,CAAA;AACf,OAAA;AACA,MAAA,OAAO,IAAI,CAAA;AACb,KAAC,CAAC,CAAA;AACJ,GAAA;AACA,EAAA,OAAOA,MAAM,CAAA;AACf,CAAC,CAAA;;AAED;AACO,MAAME,oBAAoB,GAAI1iC,KAAa,IAAc;AAC9D,EAAA,IAAIoiC,QAAQ,CAACpiC,KAAK,CAAC,EAAE;IACnB,MAAM2iC,KAAK,GAAG,4CAA4C,CAAA;IAC1D,OAAO,CAAC,CAAC3iC,KAAK,IAAI2iC,KAAK,CAACl6B,IAAI,CAACzI,KAAK,CAAC,CAAA;AACrC,GAAA;AACA,EAAA,OAAO,KAAK,CAAA;AACd,CAAC,CAAA;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAM4iC,oBAAoB,GAAI5iC,KAAa,IAAc;AAC9D,EAAA,IAAIoiC,QAAQ,CAACpiC,KAAK,CAAC,EAAE;IACnB,MAAM2iC,KAAK,GACT,gGAAgG,CAAA;IAClG,OAAO,CAAC,CAAC3iC,KAAK,IAAI2iC,KAAK,CAACl6B,IAAI,CAACzI,KAAK,CAAC,CAAA;AACrC,GAAA;AACA,EAAA,OAAO,KAAK,CAAA;AACd,CAAC,CAAA;AAED,MAAM6iC,4BAA4B,GAAG,CAAsB,oBAAA,CAAA,CAAA;AAC3D,MAAMC,gBAAgB,GAAG,CAAY,UAAA,CAAA,CAAA;AACrC,MAAMC,aAAa,GAAG,CAASD,MAAAA,EAAAA,gBAAgB,CAAK,GAAA,CAAA,CAAA;AACpD,MAAME,cAAc,GAAG,CAA2B,yBAAA,CAAA,CAAA;AAClD,MAAMC,eAAe,GAAG,CAAA,GAAA,EAAMD,cAAc,CAAA,MAAA,EAASF,gBAAgB,CAAQ,MAAA,CAAA,CAAA;AAC7E,MAAMI,yBAAyB,GAAG,CAA6BD,0BAAAA,EAAAA,eAAe,CAAW,SAAA,CAAA,CAAA;;AAEzF;AACA;AACA;AACA;AACA;AACA;AACO,MAAME,oBAAoB,GAAInjC,KAAa,IAAc;AAC9D,EAAA,IAAIoiC,QAAQ,CAACpiC,KAAK,CAAC,EAAE;AACnB;IACA,MAAMojC,QAAQ,GAAG,CAAsE,oEAAA,CAAA,CAAA;IACvF,MAAMC,QAAQ,GAAG,CAAiE,+DAAA,CAAA,CAAA;IAClF,MAAMC,QAAQ,GAAG,CAAwD,sDAAA,CAAA,CAAA;AACzE,IAAA,MAAMC,SAAS,GAAG,CAAOT,IAAAA,EAAAA,gBAAgB,CAAU,QAAA,CAAA,CAAA;IACnD,MAAMU,UAAU,GAAG,CAAoBJ,iBAAAA,EAAAA,QAAQ,IAAIC,QAAQ,CAAA,CAAA,EAAIC,QAAQ,CAAA,CAAA,EAAIC,SAAS,CAAA,CAAA,EAAIV,4BAA4B,CAAaG,UAAAA,EAAAA,cAAc,IAAIH,4BAA4B,CAAA,UAAA,EAAaG,cAAc,CAAqCA,kCAAAA,EAAAA,cAAc,CAASF,MAAAA,EAAAA,gBAAgB,CAAY,UAAA,CAAA,CAAA;AAClS,IAAA,MAAMH,KAAK,GAAG,IAAI96B,MAAM,CAAC27B,UAAU,CAAC,CAAA;IACpC,OAAO,CAAC,CAACxjC,KAAK,IAAI2iC,KAAK,CAACl6B,IAAI,CAACzI,KAAK,CAAC,CAAA;AACrC,GAAA;AACA,EAAA,OAAO,KAAK,CAAA;AACd,CAAC,CAAA;;AAED;AACA;AACA;AACO,MAAMyjC,oBAAoB,GAAIzjC,KAAa,IAAc;AAC9D,EAAA,IAAIoiC,QAAQ,CAACpiC,KAAK,CAAC,EAAE;IACnB,MAAMojC,QAAQ,GAAG,CAAsE,oEAAA,CAAA,CAAA;IACvF,MAAMI,UAAU,GAAG,CAAA,YAAA,EAAeJ,QAAQ,CAAA,SAAA,EAAYJ,cAAc,CAAaA,UAAAA,EAAAA,cAAc,CAAIE,CAAAA,EAAAA,yBAAyB,CAAE,CAAA,CAAA;AAC9H,IAAA,MAAMP,KAAK,GAAG,IAAI96B,MAAM,CAAC27B,UAAU,CAAC,CAAA;IACpC,OAAO,CAAC,CAACxjC,KAAK,IAAI2iC,KAAK,CAACl6B,IAAI,CAACzI,KAAK,CAAC,CAAA;AACrC,GAAA;AACA,EAAA,OAAO,KAAK,CAAA;AACd,CAAC,CAAA;;AAED;AACA;AACO,MAAM0jC,oBAAoB,GAAI1jC,KAAa,IAAc;AAC9D,EAAA,IAAIoiC,QAAQ,CAACpiC,KAAK,CAAC,EAAE;AACnB,IAAA,MAAM2jC,QAAQ,GAAG,CAAqCb,kCAAAA,EAAAA,gBAAgB,CAAS,OAAA,CAAA,CAAA;IAC/E,MAAMU,UAAU,GAAG,CAAA,YAAA,EAAeT,aAAa,CAAA,IAAA,EAAOY,QAAQ,CAAOA,IAAAA,EAAAA,QAAQ,CAAGT,EAAAA,yBAAyB,CAAE,CAAA,CAAA;AAC3G,IAAA,MAAMP,KAAK,GAAG,IAAI96B,MAAM,CAAC27B,UAAU,CAAC,CAAA;IACpC,OAAO,CAAC,CAACxjC,KAAK,IAAI2iC,KAAK,CAACl6B,IAAI,CAACzI,KAAK,CAAC,CAAA;AACrC,GAAA;AAEA,EAAA,OAAO,KAAK,CAAA;AACd,CAAC,CAAA;AAgBD,MAAM4jC,aAAa,GAAI5jC,KAAa,IAAK;AACvC;AACA;AACA;AACA;AACA;AACA;AACA,EAAA,IACGA,KAAK,IAAI0iC,oBAAoB,CAAC1iC,KAAK,CAAC,IACrCuiC,qBAAqB,CAACviC,KAAK,CAAC,IAC5ByiC,4BAA4B,CAACziC,KAAK,CAAC,IACnC4iC,oBAAoB,CAAC5iC,KAAK,CAAC,IAC3BmjC,oBAAoB,CAACnjC,KAAK,CAAC,IAC3ByjC,oBAAoB,CAACzjC,KAAK,CAAC,IAC3B0jC,oBAAoB,CAAC1jC,KAAK,CAAC,EAC3B;AACA,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;AACA,EAAA,OAAO,KAAK,CAAA;AACd,CAAC;;ACrSD,SAAS6jC,gBAAgBA,CAAClsC,KAA4C,EAAE;EACtE,MAAM,CAACkD,UAAU,EAAE6K,aAAa,CAAC,GAAGlY,cAAQ,CAACmK,KAAK,CAAC7K,KAAK,CAAC,CAAA;AAEzD,EAAA,oBACEvD,yBAAA,CAAAmG,aAAA,CAACwM,4BAAK,EAAA;AACJpP,IAAAA,KAAK,EAAE+N,UAAW;IAClBR,QAAQ,EAAGyM,CAAsC,IAAK;AACpDpB,MAAAA,aAAa,CAACoB,CAAC,CAACC,MAAM,CAACja,KAAK,CAAC,CAAA;KAC7B;IACFka,MAAM,EAAEA,MAAM;AACZ,MAAA,IAAI48B,aAAa,CAAC/oC,UAAU,CAAC,EAAE;AAC7BlD,QAAAA,KAAK,CAAC0C,QAAQ,CAACQ,UAAU,CAAC,CAAA;AAC1B,QAAA,OAAA;AACF,OAAA;AAEA,MAAA,IAAI+oC,aAAa,CAAC,GAAG,GAAG/oC,UAAU,CAAC,EAAE;AACnClD,QAAAA,KAAK,CAAC0C,QAAQ,CAAC,GAAG,GAAGQ,UAAU,CAAC,CAAA;AAChC,QAAA,OAAA;AACF,OAAA;AAEAlD,MAAAA,KAAK,CAAC0C,QAAQ,CAAC1C,KAAK,CAAC7K,KAAK,CAAC,CAAA;KAC3B;AACF0X,IAAAA,KAAK,EAAE,OAAA;AAAQ,GAChB,CAAC,CAAA;AAEN;;AC1BA,SAASs/B,gBAAgBA,CAACnsC,KAA4C,EAAE;EACtE,MAAM,CAACkD,UAAU,EAAE6K,aAAa,CAAC,GAAGlY,cAAQ,CAACmK,KAAK,CAAC7K,KAAK,CAAC,CAAA;AAEzD,EAAA,oBACEvD,yBAAA,CAAAmG,aAAA,CAACwM,4BAAK,EAAA;AACJpP,IAAAA,KAAK,EAAE+N,UAAW;IAClBR,QAAQ,EAAGyM,CAAsC,IAAK;AACpDpB,MAAAA,aAAa,CAACoB,CAAC,CAACC,MAAM,CAACja,KAAK,CAAC,CAAA;KAC7B;IACFka,MAAM,EAAEA,MAAM;MACZ,MAAM+8B,GAAG,GAAGx4C,IAAI,CAACsoB,KAAK,CAACppB,QAAQ,CAACoQ,UAAU,CAAC,CAAC,CAAA;MAE5C,IAAIjQ,KAAK,CAACm5C,GAAG,CAAC,IAAIA,GAAG,GAAG,CAAC,EAAE;AACzBpsC,QAAAA,KAAK,CAAC0C,QAAQ,CAAC,KAAK,CAAC,CAAA;AACrB,QAAA,OAAA;AACF,OAAA;AAEA1C,MAAAA,KAAK,CAAC0C,QAAQ,CAAC,CAAG0pC,EAAAA,GAAG,IAAI,CAAC,CAAA;KAC1B;AACFv/B,IAAAA,KAAK,EAAE,OAAA;AAAQ,GAChB,CAAC,CAAA;AAEN;;ACfO,SAASw/B,gBAAgBA,GAAG;EACjC,MAAMC,YAAY,GAAG,IAAIjlB,eAAe,CAAC3tB,MAAM,CAACmB,QAAQ,CAACysB,MAAM,CAAC,CAAA;EAEhE,MAAMvmB,QAAQ,GACZurC,YAAY,CAAC9kB,GAAG,CAAC,UAAU,CAAC,KAAK,MAAM,GACnC,IAAI,GACJ8kB,YAAY,CAAC9kB,GAAG,CAAC,UAAU,CAAC,KAAK,OAAO,GACxC,KAAK,GACL,IAAI,CAAA;AACV,EAAA,MAAMya,UAAU,GAAGqK,YAAY,CAAC9kB,GAAG,CAAC,UAAU,CAAC,CAAA;AAC/C,EAAA,MAAMvrB,UAAU,GAAGqwC,YAAY,CAAC9kB,GAAG,CAAC,UAAU,CAAC,CAAA;AAC/C,EAAA,MAAM6a,eAAe,GAAGiK,YAAY,CAAC9kB,GAAG,CAAC,eAAe,CAAC,CAAA;AACzD,EAAA,MAAM4a,cAAc,GAAGkK,YAAY,CAAC9kB,GAAG,CAAC,cAAc,CAAC,CAAA;AACvD,EAAA,MAAMjb,MAAM,GAAG+/B,YAAY,CAAC9kB,GAAG,CAAC,QAAQ,CAAC,CAAA;EACzC,MAAMiV,KAAK,GAAG6P,YAAY,CAAC9kB,GAAG,CAAC,OAAO,CAAC,KAAK,MAAM,CAAA;EAElD,MAAMjS,OAAO,GAAG+2B,YAAY,CAAC9kB,GAAG,CAAC,SAAS,CAAC,KAAK,MAAM,CAAA;AAEtD,EAAA,MAAM+kB,kBAAsC,GAAG;IAC7CxrC,QAAQ;IACRkhC,UAAU;IACVhmC,UAAU;IACVomC,eAAe;IACfD,cAAc;IACd71B,MAAM;IACNgJ,OAAO;AACPknB,IAAAA,KAAAA;GACD,CAAA;AAED,EAAA,OAAO8P,kBAAkB,CAAA;AAC3B;;AC1BA,SAASC,2BAA2BA,CAAC;EACnC11C,EAAE;EACF4L,QAAQ;EACRgW,WAAW;AACXhmB,EAAAA,IAAAA;AAC+C,CAAC,EAAE;EAClD,IAAIoE,EAAE,KAAK,IAAI,IAAI,OAAOA,EAAE,KAAK,QAAQ,EAAE;AACzC,IAAA,oBACElF,yBAAA,CAAAmG,aAAA,CAACqT,iCAAU,EAAA;AACTpQ,MAAAA,KAAK,EAAE;AACLyxC,QAAAA,UAAU,EAAE,QAAA;AACd,OAAA;AAAE,KAAA,EACH,0FAEoB,EAAC,OAAO31C,EAAE,EAAC,KACpB,CAAC,CAAA;AAEjB,GAAA;EAEA,MAAM;IAAE4E,aAAa;AAAE5D,IAAAA,YAAAA;AAAkB,GAAC,GAAG4B,MAAM,CAACquC,eAAe,IAAI,EAAE,CAAA;AAEzE,EAAA,MAAM5rC,MAAM,GAAGT,aAAa,CAACmb,aAAa,CAAC61B,UAAU,CAAA;AAErD,EAAA,MAAMC,4BAA4B,GAAGt1C,aAAa,CAAC8E,MAAM,CAAC,CAACvJ,GAAG,CAAEuiB,CAAM,IACpEnM,8CAA+B,CAAC,GAAG,EAAEmM,CAAC,CAAC9Y,IAAI,CAC7C,CAAC,CAAA;AAED,EAAA,MAAMuwC,yBAAyB,GAAGr3C,MAAM,CAACkY,OAAO,CAAC3V,YAAY,CAAC,CAAC/E,MAAM,CAElEkE,CAAC,IAAgE;AAClE,IAAA,MAAM,CAACmtC,UAAU,EAAEhvB,iBAAiB,CAAC,GAAGne,CAAC,CAAA;IACzC,OACE01C,4BAA4B,CAACp4C,QAAQ,CAAC6vC,UAAU,CAAC,IACjD/rB,kDAAmC,CACjCjD,iBACF,CAAC,CAAA;AAEL,GAAC,CAAC,CAAA;EAEF,MAAMsV,KAAK,GAAGz0B,cAAc,CAC1ByF,aAAa,CAACG,IAAI,CAACwE,MAAM,EACzB3N,IAAI,CAACgW,KAAK,CAAC,CAAC,EAAEhW,IAAI,CAACm6C,WAAW,CAAC,GAAG,CAAC,CACrC,CAAC,CAAA;EACD,MAAM9wC,UAAU,GAAGC,sCAA2B,CAC5C0uB,KAAK,CAACtsB,UAAU,EAChB1C,aACF,CAAC,CAAA;EACD,MAAMQ,UAAU,GAAGH,UAAU,CAAEI,MAAM,CAACC,IAAI,CACvC+Y,CAAC,IAAKA,CAAC,CAAC9Y,IAAI,KAAK3J,IAAI,CAACC,KAAK,CAAC,GAAG,CAAC,CAACm6C,GAAG,EACvC,CAAE,CAAA;EAEF,MAAMrqC,OAAO,GAAGmqC,yBAAyB,CAACpuC,OAAO,CAC/C,CAAC,CAAC4lC,UAAU,EAAEhvB,iBAAiB,CAAC,KAC9BmD,uBAAuB,CAACnD,iBAAiB,CAACjgB,KAAK,EAAE+G,UAAU,CAACsI,IAAI,CAAC,CAAC5R,GAAG,CAClEqE,CAAC,IAAK;IACL,MAAM81C,kBAAkB,GAAG11C,aAAa,CACtC8E,MAAM,EAAEC,IAAI,CACT+Y,CAAmB,IAAKA,CAAC,CAAC9Y,IAAI,KAAK+nC,UAAU,CAACzxC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAC7D,CACF,CAAC,CAAA;IAED,OAAO;AACLmE,MAAAA,EAAE,EAAEstC,UAAU;MACd1uC,GAAG,EAAEuB,CAAC,CAACvB,GAAG;AACVsN,MAAAA,KAAK,EAAE,CAAG+pC,EAAAA,kBAAkB,CAAC/pC,KAAK,IAAI+pC,kBAAkB,CAAC1wC,IAAI,CAAA,GAAA,EAC3DpF,CAAC,CAAC+L,KAAK,IAAI/L,CAAC,CAACvB,GAAG,CAAA,CAAA;KAEnB,CAAA;AACH,GACF,CACJ,CAAC,CAAA;EAED,IAAI+M,OAAO,CAACrQ,MAAM,KAAK,CAAC,IAAI,CAAC0E,EAAE,IAAIpE,IAAI,EAAE;AACvC;AACAgJ,IAAAA,aAAa,CAACG,IAAI,CAACgM,MAAM,CAACnV,IAAI,EAAE;AAC9BoE,MAAAA,EAAE,EAAE2L,OAAO,CAAC,CAAC,CAAC,CAAC3L,EAAE;AACjBpB,MAAAA,GAAG,EAAE+M,OAAO,CAAC,CAAC,CAAC,CAAC/M,GAAG;AACnB8U,MAAAA,QAAQ,EAAE,2BAAA;AACZ,KAAC,CAAC,CAAA;AACJ,GAAA;AAEA,EAAA,IAAI,CAACoiC,yBAAyB,CAACx6C,MAAM,EAAE;AACrC,IAAA,oBACER,yBAAA,CAAAmG,aAAA,CAACqT,iCAAU,EAAA;AACTpQ,MAAAA,KAAK,EAAE;AACLyxC,QAAAA,UAAU,EAAE,QAAA;AACd,OAAA;AAAE,KAAA,EACH,qEAEW,CAAC,CAAA;AAEjB,GAAA;AAEA,EAAA,oBACE76C,yBAAA,CAAAmG,aAAA,CAAC+gB,2BAA2B,EAAA;AAC1BrW,IAAAA,OAAO,EAAEA,OAAQ;AACjBsW,IAAAA,QAAQ,EACNjiB,EAAE,KAAK,IAAI,GACP;MACEA,EAAE;AACFpB,MAAAA,GAAG,EAAE6B,SAAAA;AACP,KAAC,GACD;MACET,EAAE;AACFpB,MAAAA,GAAG,EAAEgjB,WAAAA;KAEZ;AACDM,IAAAA,mBAAmB,EAAEA,CAACL,KAAK,EAAEC,MAAM,KAAK;AACtClW,MAAAA,QAAQ,CAACiW,KAAK,EAAEC,MAAM,CAAC,CAAA;AACzB,KAAA;AAAE,GACH,CAAC,CAAA;AAEN;;AC/GA;AACA;AACA;;AAEA,MAAMo0B,QAAQ,GAAG/xC,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,yBAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAEFC,CAAAA,CAAAA,CAAAA,4BAAAA,EAAAA,8EAAAA,CAAAA,EAAAA,6BAAM,CAACikB,OAAO,CAatC,CAAA;AAED,MAAM+G,cAAc,GAAGrrB,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,+BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAAA,CAAA,CAAA,CAAA,qCAAA,EAAA,oCAAA,EAAA,kBAAA,CAAA,EAEXC,6BAAM,CAACikB,OAAO,EAEfnJ,CAAC,IAAMA,CAAC,CAAC9U,IAAI,KAAK,SAAS,GAAG,KAAK,GAAG,KAAM,CAEhE,CAAA;AAED,MAAM2rC,OAAO,GAAGhyC,uBAAM,CAACurB,GAAG,CAAArrB,UAAA,CAAA;EAAAC,WAAA,EAAA,wBAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CASzB,CAAA,CAAA,CAAA,8GAAA,CAAA,CAAA,CAAA;AAED,MAAM6xC,kBAAkB,GAAGjyC,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,mCAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CASpC,CAAA,CAAA,CAAA,+GAAA,CAAA,CAAA,CAAA;AAED,MAAM8xC,UAAU,GAAGlyC,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,2BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAM5B,CAAA,CAAA,CAAA,kGAAA,CAAA,CAAA,CAAA;AAED,MAAM+xC,kBAAkB,GAAGnyC,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,mCAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAIpC,CAAA,CAAA,CAAA,qDAAA,CAAA,CAAA,CAAA;AAED,MAAMgyC,qBAAqB,GAAGpyC,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,sCAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CACpCwE,CAAAA,CAAAA,CAAAA,EAAAA,EAAAA,eAAAA,CAAAA,EAAAA,4BAAK,CAAClG,IAAI,CAEb,CAAA;AAED,MAAM2zC,KAAK,GAAGryC,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,sBAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CACpBwE,CAAAA,CAAAA,CAAAA,EAAAA,EAAAA,EAAAA,CAAAA,EAAAA,4BAAK,CAACmD,KAAK,CACd,CAAA;AAED,MAAMuqC,cAAc,GAAGtyC,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,+BAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAMhC,CAAA,CAAA,CAAA,gFAAA,CAAA,CAAA,CAAA;AAED,MAAMmyC,OAAO,GAAGvyC,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,wBAAA;EAAAC,WAAA,EAAA,aAAA;AAAA,CAEtBwE,CAAAA,CAAAA,CAAAA,mBAAAA,EAAAA,GAAAA,CAAAA,EAAAA,4BAAK,CAAClG,IAAI,CACb,CAAA;AAQD,SAAS8zC,uBAAuBA,CAC9BhjB,QAAkB,EAClB/uB,aAAgC,EACZ;AACpB;EACA,IAAI+uB,QAAQ,CAAC1V,SAAS,EAAE;IACtB,OAAO0V,QAAQ,CAAC1V,SAAS,CAAA;AAC3B,GAAA;AAEA,EAAA,OAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACF,CAAA;AAEA,MAAM24B,WAAuC,GAAGA,CAAC;EAC/CjjB,QAAQ;EACRkjB,QAAQ;AACRrsC,EAAAA,IAAAA;AACF,CAAC,KAAK;AACJ,EAAA,MAAMssC,QAAQ,GAAG73C,YAAM,CAAC,IAAI,CAAC,CAAA;AAC7B,EAAA,MAAM2F,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;AAExC,EAAA,MAAM+7C,YAAY,GAAGJ,uBAAuB,CAAChjB,QAAuB,CAAC,CAAA;EAErE,oBACE74B,yBAAA,CAAAmG,aAAA,CAACi1C,QAAQ,qBACPp7C,yBAAA,CAAAmG,aAAA,CAACuuB,cAAc,EAAA;AAAC7rB,IAAAA,GAAG,EAAEmzC,QAAS;AAACzsC,IAAAA,OAAO,EAAEwsC,QAAS;AAACrsC,IAAAA,IAAI,EAAEA,IAAAA;AAAK,GAAA,EAC1DusC,YAAY,iBAAIj8C,yBAAA,CAAAmG,aAAA,CAACk1C,OAAO,EAAA;AAACryC,IAAAA,GAAG,EAAEizC,YAAAA;AAAa,GAAE,CAAC,EAC9C,CAACA,YAAY,IAAIpjB,QAAQ,CAACe,cAAc,iBACvC55B,yBAAA,CAAAmG,aAAA,CAACm1C,kBAAkB,EACjBt7C,IAAAA,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AAAMiD,IAAAA,KAAK,EAAE;AAAEqN,MAAAA,KAAK,EAAE,SAAA;AAAU,KAAA;GAAIoiB,EAAAA,QAAQ,CAACe,cAAqB,CAChD,CACrB,EACA,CAACqiB,YAAY,IAAI,CAACpjB,QAAQ,CAACe,cAAc,iBACxC55B,yBAAA,CAAAmG,aAAA,CAACm1C,kBAAkB,EAAA,IAAA,eACjBt7C,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEsY,IAAAA,KAAK,EAAC,4BAA4B;AAClCpW,IAAAA,KAAK,EAAC,IAAI;AACVC,IAAAA,MAAM,EAAC,IAAI;AACXoW,IAAAA,OAAO,EAAC,WAAW;AACnBC,IAAAA,IAAI,EAAC,MAAA;GAEL3e,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACE4wB,IAAAA,CAAC,EAAC,mFAAmF;IACrFpY,IAAI,EAAEjV,6BAAM,CAAC6Y,OAAAA;AAAQ,GACtB,CAAC,eACFviB,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACE4wB,IAAAA,CAAC,EAAC,gHAAgH;IAClHpY,IAAI,EAAEjV,6BAAM,CAAC6Y,OAAAA;AAAQ,GACtB,CAAC,eACFviB,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACE4wB,IAAAA,CAAC,EAAC,mHAAmH;IACrHpY,IAAI,EAAEjV,6BAAM,CAAC6Y,OAAAA;AAAQ,GACtB,CAAC,eACFviB,yBAAA,CAAAmG,aAAA,CAAA,MAAA,EAAA;AACE0wB,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,QAAQ,EAAC,SAAS;AAClBC,IAAAA,CAAC,EAAC,0IAA0I;IAC5IpY,IAAI,EAAEjV,6BAAM,CAAC6Y,OAAAA;AAAQ,GACtB,CACE,CACa,CAER,CAAC,eAEjBviB,yBAAA,CAAAmG,aAAA,CAACo1C,UAAU,EAAA,IAAA,eACTv7C,yBAAA,CAAAmG,aAAA,CAACq1C,kBAAkB,EACjBx7C,IAAAA,eAAAA,yBAAA,CAAAmG,aAAA,CAAAnG,yBAAA,CAAA2d,QAAA,EAAA,IAAA,EACGkb,QAAQ,CAACznB,KAAK,iBACbpR,yBAAA,CAAAmG,aAAA,CAAAnG,yBAAA,CAAA2d,QAAA,EAAA,IAAA,eACE3d,yBAAA,CAAAmG,aAAA,CAACs1C,qBAAqB,EAAE5iB,IAAAA,EAAAA,QAAQ,CAACznB,KAA6B,CAC9D,CAEJ,CACgB,CAAC,eAErBpR,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA,IAAU,CAAC,EAEV0yB,QAAQ,CAACoN,aAAa,IAAI,CAACn8B,aAAa,CAACqF,QAAQ,iBAChDnP,yBAAA,CAAAmG,aAAA,CAAC+1C,uCAAgB,EAAA;AACf/lB,IAAAA,SAAS,EAAE,YAAa;IACxB5mB,OAAO,EAAEA,MAAM;AACbzF,MAAAA,aAAa,CAAC0F,OAAO,CAACC,iBAAiB,CAAC;AACtCC,QAAAA,IAAI,EAAE,MAAM;AACZmpB,QAAAA,QAAQ,EAAEA,QAAAA;AACZ,OAAC,CAAC,CAAA;AACJ,KAAA;GACD,EAAA,MAEiB,CAEV,CACJ,CAAC,CAAA;AAEf,CAAC,CAAA;;AAED;AACA;AACA;;AAEA,MAAMsjB,SAAS,GAAG9yC,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,0BAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAQ3B,CAAA,CAAA,CAAA,qGAAA,CAAA,CAAA,CAAA;AAED,MAAM2yC,aAAa,GAAG/yC,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,8BAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAEJ+a,CAAAA,CAAAA,CAAAA,qCAAAA,EAAAA,0CAAAA,CAAAA,EAAAA,CAAC,IACzBA,CAAC,CAAC9U,IAAI,KAAK,SAAS,GAAG,aAAa,GAAG,SAAS,CAGnD,CAAA;AAED,MAAM2sC,OAAO,GAAGhzC,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,wBAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAGEC,CAAAA,CAAAA,CAAAA,6DAAAA,EAAAA,eAAAA,CAAAA,EAAAA,6BAAM,CAAC4yC,MAAM,CAExC,CAAA;AAED,MAAMC,cAAc,GAAGlzC,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,+BAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAKhC,CAAA,CAAA,CAAA,8DAAA,CAAA,CAAA,CAAA;AAED,MAAM+yC,aAAa,GAAGnzC,uBAAM,CAAC8gB,MAAM,CAAA5gB,UAAA,CAAA;EAAAC,WAAA,EAAA,8BAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAAA,CAAA,CAAA,CAAA,wBAAA,EAAA,wEAAA,EAAA,mBAAA,CAAA,EAG/BwE,4BAAK,CAAClG,IAAI,EAKI2B,6BAAM,CAAC4yC,MAAM,CAG9B,CAAA;AAED,MAAMG,QAAQ,GAAGpzC,uBAAM,CAACC,GAAG,CAAAC,UAAA,CAAA;EAAAC,WAAA,EAAA,yBAAA;EAAAC,WAAA,EAAA,cAAA;AAAA,CAK1B,CAAA,CAAA,CAAA,iEAAA,CAAA,CAAA,CAAA;AAEM,MAAMizC,kBAAkC,GAAGA,CAAC;EACjDrpC,MAAM;EACN2Q,OAAO;EACP4U,SAAS;AACTlpB,EAAAA,IAAI,GAAG,OAAA;AACT,CAAC,KAAK;EACJ,MAAMitC,cAAc,GAAG/jB,SAAS,CAAA;AAEhC,EAAA,MAAMgkB,WAAW,GAAGz4C,YAAM,CAAiB,IAAI,CAAC,CAAA;EAEhD,MAAM04C,gBAAgB,GAAIhkB,QAAkB,IAAK;AAC/C,IAAA,IAAI7U,OAAO,EAAE;MACXA,OAAO,CAAC6U,QAAQ,CAAC,CAAA;AACnB,KAAA;GACD,CAAA;AAED,EAAA,oBACE74B,yBAAA,CAAAmG,aAAA,CAAC4zB,4BAAK,EAAA;AACJ3X,IAAAA,SAAS,EAAE,IAAK;AAChB4X,IAAAA,KAAK,EAAE,cAAe;AACtB3mB,IAAAA,MAAM,EAAEA,MAAO;IACf4mB,cAAc,EAAEA,MAAM;AACpB,MAAA,IAAIjW,OAAO,EAAE;AACXA,QAAAA,OAAO,EAAE,CAAA;AACX,OAAA;KACA;AACFtU,IAAAA,IAAI,EAAE,aAAc;AACpBwqB,IAAAA,UAAU,EAAE,IAAA;AAAK,GAAA,eAEjBl6B,yBAAA,CAAAmG,aAAA,CAACg2C,SAAS,EACRn8C,IAAAA,eAAAA,yBAAA,CAAAmG,aAAA,CAACk2C,OAAO,EACLM,IAAAA,EAAAA,cAAc,iBACb38C,yBAAA,CAAAmG,aAAA,CAACo2C,cAAc,EAAA,IAAA,EACZ54C,MAAM,CAACkY,OAAO,CAAC8gC,cAAc,CAAC,CAAC37C,GAAG,CACjC,CAAC,CACCyI,WAAW,EACX;AACEkM,IAAAA,SAAS,EAAE;AAAEvE,MAAAA,KAAAA;AAAM,KAAA;AACrB,GAAC,CACF,kBACCpR,yBAAA,CAAAmG,aAAA,CAACq2C,aAAa,EAAA;IACZ14C,GAAG,EAAE,CAAyB2F,sBAAAA,EAAAA,WAAW,CAAG,CAAA;IAC5C8F,OAAO,EAAEA,MAAM;MACb,MAAMutC,SAAS,GAAGn1C,QAAQ,CAACib,cAAc,CACvC,CAAA,sBAAA,EAAyBnZ,WAAW,CAAA,CACtC,CAAC,CAAA;AACD,MAAA,MAAMszC,cAAc,GAAGD,SAAS,CAAEE,SAAS,CAAA;AAC3CJ,MAAAA,WAAW,CAACx4C,OAAO,CAAE64C,QAAQ,CAAC;AAC5BpvB,QAAAA,GAAG,EAAEkvB,cAAc;AACnBG,QAAAA,QAAQ,EAAE,QAAA;AACZ,OAAC,CAAC,CAAA;AACJ,KAAA;AAAE,GAAA,EAED9rC,KAAK,IAAI3H,WACG,CAEnB,CACc,CAEX,CAAC,eACVzJ,yBAAA,CAAAmG,aAAA,CAACs2C,QAAQ,EAAA;AAAC5zC,IAAAA,GAAG,EAAE+zC,WAAAA;GACZhkB,EAAAA,SAAS,KAAKjzB,SAAS,iBAAI3F,yBAAA,CAAAmG,aAAA,CAACy1C,OAAO,EAAC,IAAA,EAAA,YAAmB,CAAC,EAExDe,cAAc,IACbh5C,MAAM,CAACkY,OAAO,CAAC8gC,cAAc,CAAC,CAAC37C,GAAG,CAChC,CACE,CACEyI,WAAW,EACX;AACEkM,IAAAA,SAAS,EAAE;AAAEvE,MAAAA,KAAAA;KAAO;AACpBwnB,IAAAA,SAAAA;AACF,GAAC,CACF,EACD12B,KAAK,kBAELlC,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEiD,IAAAA,KAAK,EAAE;AAAEwG,MAAAA,UAAU,EAAE,MAAM;AAAEutC,MAAAA,aAAa,EAAE,MAAA;KAAS;IACrDj4C,EAAE,EAAE,CAAyBuE,sBAAAA,EAAAA,WAAW,CAAG,CAAA;IAC3C3F,GAAG,EAAE,yBAAyB2F,WAAW,CAAA,CAAA;GAEzCzJ,eAAAA,yBAAA,CAAAmG,aAAA,CAACw1C,cAAc,EACb37C,IAAAA,eAAAA,yBAAA,CAAAmG,aAAA,CAACu1C,KAAK,QAAEtqC,KAAK,IAAI3H,WAAmB,CACtB,CAAC,eACjBzJ,yBAAA,CAAAmG,aAAA,CAACi2C,aAAa,EAAA;AAAC1sC,IAAAA,IAAI,EAAEA,IAAAA;AAAK,GAAA,EACvBkpB,SAAS,CAAC53B,GAAG,CAAC,CAAC63B,QAAQ,EAAE32B,KAAK,kBAC7BlC,yBAAA,CAAAmG,aAAA,CAAC21C,WAAW,EAAA;AACVh4C,IAAAA,GAAG,EAAE5B,KAAM;AACX22B,IAAAA,QAAQ,EAAEA,QAAS;IACnBkjB,QAAQ,EAAEA,MAAM;MACdc,gBAAgB,CAAChkB,QAAQ,CAAC,CAAA;KAC1B;AACFnpB,IAAAA,IAAI,EAAEA,IAAAA;AAAK,GACZ,CACF,CACY,CACZ,CAET,CACM,CACD,CACN,CAAC,CAAA;AAEZ,CAAC;;AC3WD,SAAS0tC,qBAAqBA,CAC5BC,KAAa,EACbxkB,QAAkB,EAClBljB,SAAoC,EACpC;AACA,EAAA,OAAO,CAAGkjB,EAAAA,QAAQ,CAACznB,KAAK,IAAI,EAAE,CAAGuE,EAAAA,SAAS,CAACvE,KAAK,IAAIuE,SAAS,CAACzQ,EAAE,CAAA,CAAE,CAC/Do4C,iBAAiB,EAAE,CACnB36C,QAAQ,CAAC06C,KAAK,CAAC/xB,IAAI,EAAE,CAACgyB,iBAAiB,EAAE,CAAC,CAAA;AAC/C,CAAA;AAEO,MAAMC,0BAA0C,GAAGA,CAAC;EACzDv5B,OAAO;EACP4U,SAAS;AACTvlB,EAAAA,MAAAA;AACF,CAAC,KAAK;AACJ,EAAA,MAAMvJ,aAAa,GAAG5J,gBAAgB,EAAE,CAAA;EAExC,MAAMs9C,aAAa,GAAG5kB,SAAS,CAAA;EAE/B,MAAM,CAACykB,KAAK,EAAEI,QAAQ,CAAC,GAAGx5C,cAAQ,CAAC,EAAE,CAAC,CAAA;EAEtC,MAAMy5C,YAAY,GAAGL,KAAK,CAAC/xB,IAAI,EAAE,CAACgyB,iBAAiB,EAAE,CAAA;EAErD,MAAMK,qBAA0C,GAAG,EAAE,CAAA;AAErD,EAAA,IAAIH,aAAa,EAAE;IACjB75C,MAAM,CAAC8K,MAAM,CAAC+uC,aAAa,CAAC,CAAC35C,OAAO,CAAC,CAAC;MAAE+0B,SAAS;AAAEjjB,MAAAA,SAAAA;AAAU,KAAC,KAAK;MACjE,MAAMioC,iBAAiB,GACrBF,YAAY,KAAK,EAAE,GACf9kB,SAAS,GACTA,SAAS,CAACz3B,MAAM,CAAE03B,QAAQ,IACxBukB,qBAAqB,CAACM,YAAY,EAAE7kB,QAAQ,EAAEljB,SAAS,CACzD,CAAC,CAAA;AAEP,MAAA,IAAIioC,iBAAiB,CAACp9C,MAAM,GAAG,CAAC,EAAE;AAChCm9C,QAAAA,qBAAqB,CAAChoC,SAAS,CAACzQ,EAAE,CAAC,GAAG;UACpCyQ,SAAS;AACTijB,UAAAA,SAAS,EAAEglB,iBAAAA;SACZ,CAAA;AACH,OAAA;AACF,KAAC,CAAC,CAAA;AACJ,GAAA;EAEA,MAAMnpC,KAAK,GAAIokB,QAAmB,IAAK;IACrC4kB,QAAQ,CAAC,EAAE,CAAC,CAAA;IAEZ,IAAI,CAAC5kB,QAAQ,EAAE;AACb7U,MAAAA,OAAO,EAAE,CAAA;AACX,KAAC,MAAM;AACL;MACAA,OAAO,CAAC6U,QAAQ,CAAC,CAAA;AACnB,KAAA;GACD,CAAA;AAED,EAAA,oBACE74B,yBAAA,CAAAmG,aAAA,CAAC4zB,4BAAK,EAAA;AACJrqB,IAAAA,IAAI,EAAE,cAAe;AACrB2D,IAAAA,MAAM,EAAEA,MAAO;IACf4mB,cAAc,EAAEA,MAAM;MACpBxlB,KAAK,CAAC9O,SAAS,CAAC,CAAA;KAChB;AACFyc,IAAAA,SAAS,EAAE,IAAK;AAChB8X,IAAAA,UAAU,EAAE,IAAK;AACjB2jB,IAAAA,WAAW,EAAE;AACXt6C,MAAAA,KAAK,EAAE85C,KAAK;AACZxiC,MAAAA,WAAW,EAAE,WAAW;MACxB/J,QAAQ,EAAGyM,CAAgC,IAAK;AAC9CkgC,QAAAA,QAAQ,CAAClgC,CAAC,CAACC,MAAM,CAACja,KAAK,CAAC,CAAA;AAC1B,OAAA;KACA;AACFu6C,IAAAA,YAAY,EAAE,GAAA;GAEbN,EAAAA,aAAa,KAAK73C,SAAS,IAAI,YAAY,EAC3C63C,aAAa,KAAK73C,SAAS,IAC1BhC,MAAM,CAACkY,OAAO,CAAC8hC,qBAAqB,CAAC,CAAC38C,GAAG,CACvC,CAAC,GAAG;IAAE43B,SAAS;AAAEjjB,IAAAA,SAAAA;AAAU,GAAC,CAAC,KAAK;AAChC,IAAA,MAAMooC,SAAS,GAAGnlB,SAAS,CAACp4B,MAAM,KAAK,CAAC,CAAA;IACxC,MAAMw9C,cAAc,GAAGroC,SAAS,CAACvE,KAAK,IAAIuE,SAAS,CAACzQ,EAAE,CAAA;AAEtD,IAAA,OAAO0zB,SAAS,CAAC53B,GAAG,CAAE63B,QAAQ,IAAK;MACjC,MAAMolB,aAAa,GAAGplB,QAAQ,CAACznB,KAAK,IAAIynB,QAAQ,CAAC3zB,EAAE,CAAA;AAEnD,MAAA,MAAM80B,KAAK,GAAG+jB,SAAS,GAAGC,cAAc,GAAGC,aAAa,CAAA;MACxD,MAAM96B,SAAS,GAAG0V,QAAQ,CAAC1V,SAAS,IAAIxN,SAAS,CAACwN,SAAS,CAAA;AAC3D,MAAA,MAAM3K,WAAW,GAAGulC,SAAS,GAAGp4C,SAAS,GAAGq4C,cAAc,CAAA;AAE1D,MAAA,oBACEh+C,yBAAA,CAAAmG,aAAA,CAAC+3C,+BAAQ,EAAA;QACPp6C,GAAG,EAAE+0B,QAAQ,CAAC3zB,EAAI;AAClB80B,QAAAA,KAAK,EAAEA,KAAM;AACbxhB,QAAAA,WAAW,EAAEA,WAAY;QACzBjJ,OAAO,EAAEA,MAAM;UACbkF,KAAK,CAACokB,QAAQ,CAAC,CAAA;SACf;AACFslB,QAAAA,KAAK,EAAEh7B,SAAU;AACjBi7B,QAAAA,eAAe,EAAE,IAAK;AACtBC,QAAAA,MAAM,EACJxlB,QAAQ,CAACoN,aAAa,GAClB,MAAM;AACJn8B,UAAAA,aAAa,CAAC0F,OAAO,CAACC,iBAAiB,CAAC;AACtCC,YAAAA,IAAI,EAAE,MAAM;AACZmpB,YAAAA,QAAQ,EAAEA,QAAAA;AACZ,WAAC,CAAC,CAAA;AACJ,SAAC,GACDlzB,SAAAA;AACL,OACF,CAAC,CAAA;AAEN,KAAC,CAAC,CAAA;AACJ,GACF,CACG,CAAC,CAAA;AAEZ,CAAC;;AChFD,MAAM24C,iBAA2C,GAAGA,CAACxuB,QAAQ,EAAEtS,MAAM,KAAK;AACxE,EAAA,IAAI,OAAOA,MAAM,KAAK,QAAQ,EAAE;AAC9B;IACA,OAAO+gC,+BAAW,CAACzuB,QAAQ,CAAC,CAAA;AAC9B,GAAA;AACA;AACA,EAAA,OAAO,IAAI,CAAA;AACb,CAAC,CAAA;AAED,MAAM0uB,cAAgD,GAAG;AACvD/nC,EAAAA,KAAK,EAAE6jC,gBAAgB;AACvBmE,EAAAA,KAAK,EAAElE,gBAAgB;AACvB,EAAA,2BAA2B,EAAEK,2BAAAA;AAC/B,CAAC,CAAA;AAED,MAAM8D,aAA+C,GAAG;AACtDC,EAAAA,KAAK,EAAEjC,kBAAkB;AACzBkC,EAAAA,OAAO,EAAErB,0BAA0B;AACnC,EAAA,SAAS,EAAEb,kBAAAA;AACb,CAAC,CAAA;AAEM,SAASmC,gBAAgBA,CAACzwC,KAA4B,EAAE;AAC7D,EAAA,MAAMusC,kBAAkB,GAAGF,gBAAgB,EAAE,CAAA;AAE7C,EAAA,oBACEz6C,yBAAA,CAAAmG,aAAA,CAAC24C,kCAAiB,EAAA;AAChBR,IAAAA,iBAAiB,EAAEA,iBAAkB;IACrCS,oBAAoB,EAAA,IAAA;AAAA,GAAA,eAEpB/+C,yBAAA,CAAAmG,aAAA,CAAC64C,mCAAY,CAAC54C,QAAQ,EAAA;IACpB7C,KAAK,EAAEA,MAAM;AACX,MAAA,OAAOoE,QAAQ,CAACs3C,aAAa,CAAC,iBAAiB,CAAC,CAAA;AAClD,KAAA;GAEAj/C,eAAAA,yBAAA,CAAAmG,aAAA,CAACysB,YAAY,MAAE,CAAC,eAChB5yB,yBAAA,CAAAmG,aAAA,CAAC+4C,wCAAiB,EAAE,IAAA,CAAC,eACrBl/C,yBAAA,CAAAmG,aAAA,CAACg5C,sCAAe,EAAA,IAAA,eACdn/C,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AACEjB,IAAAA,EAAE,EAAE,gBAAiB;AACrBkE,IAAAA,KAAK,EAAE;AAAEqE,MAAAA,QAAQ,EAAE,OAAO;AAAEC,MAAAA,IAAI,EAAE,CAAC;AAAEmgB,MAAAA,GAAG,EAAE,CAAC;AAAE5a,MAAAA,MAAM,EAAE,MAAA;AAAO,KAAA;AAAE,GAC/D,CAAC,eACFjT,yBAAA,CAAAmG,aAAA,CAAC4pC,MAAM,EAAA;IACLpgC,MAAM,EAAEvB,KAAK,CAACuB,MAAO;AACrBgL,IAAAA,MAAM,EAAEggC,kBAAkB,CAAChgC,MAAM,IAAIhV,SAAU;AAC/CwJ,IAAAA,QAAQ,EAAEwrC,kBAAkB,CAACxrC,QAAQ,IAAI,IAAK;IAC9CkhC,UAAU,EAAEsK,kBAAkB,CAACtK,UAAW;AAC1CI,IAAAA,eAAe,EAAEkK,kBAAkB,CAAClK,eAAe,IAAI,IAAK;IAC5DD,cAAc,EAAEmK,kBAAkB,CAACnK,cAAe;IAClDtqC,YAAY,EAAEkI,KAAK,CAAClI,YAAa;IACjCirC,oBAAoB,EAAE/iC,KAAK,CAAC+iC,oBAAqB;AACjDh4B,IAAAA,OAAO,EAAE;AACP,MAAA,GAAGqlC,cAAc;AACjB,MAAA,GAAGpwC,KAAK,CAAC+K,OAAAA;KACT;IACF0e,UAAU,EAAEzpB,KAAK,CAACypB,UAAW;AAC7BW,IAAAA,OAAO,EAAE;AACP,MAAA,GAAGkmB,aAAa;AAChB,MAAA,GAAGtwC,KAAK,CAACoqB,OAAAA;KACT;IACFjqB,WAAW,EAAEH,KAAK,CAACG,WAAAA;AAAY,GAChC,CACc,CAAC,eAClBvO,yBAAA,CAAAmG,aAAA,CAACi5C,8BAAO,EAAA;AAACC,IAAAA,cAAc,EAAE;AAAEpsC,MAAAA,MAAM,EAAE,MAAA;AAAO,KAAA;GAAI,CACzB,CACN,CAAC,CAAA;AAExB;;ACnGA,SAASqsC,UAAUA,CAAClxC,KAAsB,EAAE;EAC1C,MAAMtE,aAAa,GAAGhC,MAAM,CAACoC,MAAM,CAACisC,eAAe,EAAErsC,aAAa,CAAA;EAElE,IAAI,CAACA,aAAa,EAAE;AAClB,IAAA,MAAM,IAAIzJ,KAAK,CAAC,iCAAiC,CAAC,CAAA;AACpD,GAAA;EAEA0rC,gCAAgC,CAACjiC,aAAa,CAAC,CAAA;EAE/C,oBACE9J,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;IACEoJ,OAAO,EAAEA,MAAM;MACb,IAAIzF,aAAa,CAACorB,SAAS,EAAE;AAC3BprB,QAAAA,aAAa,CAAC8qC,gBAAgB,CAAC,EAAE,CAAC,CAAA;AACpC,OAAA;AACF,KAAA;AAAE,GAAA,EAED9qC,aAAa,CAACorB,SAAS,iBACtBl1B,yBAAA,CAAAmG,aAAA,CAAA,KAAA,EAAA;AAAKiD,IAAAA,KAAK,EAAE;AAAE6X,MAAAA,SAAS,EAAE,OAAA;AAAQ,KAAA;GAC/BjhB,eAAAA,yBAAA,CAAAmG,aAAA,CAAA,OAAA,EAAA;AACE6lB,IAAAA,uBAAuB,EAAE;AACvBC,MAAAA,MAAM,EAAEszB,0BAAAA;AACV,KAAA;AAAE,GACH,CAAC,EACDnxC,KAAK,CAACnI,QACJ,CACN,EACA,CAAC6D,aAAa,CAACorB,SAAS,IAAI9mB,KAAK,CAACnI,QAChC,CAAC,CAAA;AAEV,CAAA;AAEA,MAAMs5C,0BAA0B,GAAG,CAAA;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;ACnJD,SAASC,wBAAwBA,CAAC;EAChCC,QAAQ;EACRC,2BAA2B;EAC3Bz5C,QAAQ;EACR81C,QAAQ;EACR4D,QAAQ;EACRC,QAAQ;EACR16C,EAAE;EACF3D,SAAS;AACTT,EAAAA,IAAAA;AAC6B,CAAC,EAAE;EAChC,MAAM,CAAC0pB,IAAI,EAAEq1B,OAAO,CAAC,GAAG57C,cAAQ,CAAwB,IAAI,CAAC,CAAA;AAE7D67C,EAAAA,sBAAsB,CAAC;IACrBt1B,IAAI;AACJzjB,IAAAA,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"}